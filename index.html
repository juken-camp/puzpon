<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>üê± NEKO2048 üê±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'M PLUS Rounded 1c', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #faf8f5 0%, #f0ede8 50%, #e8e4df 100%);
            color: #8b4513;
            font-weight: bold;
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;
            -ms-text-size-adjust: none;
            text-size-adjust: none;
        }

        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Fredoka One', cursive;
            font-size: 36px;
            color: #d2691e;
            text-shadow: 3px 3px 12px rgba(139,69,19,0.3);
            z-index: 1001;
            letter-spacing: 2px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            white-space: nowrap;
            opacity: 0;
            animation: title-enter 1.5s ease-out 0.2s forwards;
            background: linear-gradient(45deg, #d2691e, #ff7f50, #ffd700);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .title:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .title.title-bounce {
            animation: title-bounce 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes title-enter {
            0% { 
                opacity: 0; 
                transform: translateX(-50%) translateY(-30px) scale(0.8); 
            }
            60% { 
                opacity: 1; 
                transform: translateX(-50%) translateY(5px) scale(1.1); 
            }
            80% { 
                transform: translateX(-50%) translateY(-2px) scale(1.05); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0) scale(1); 
            }
        }

        @keyframes title-bounce {
            0% { transform: translateX(-50%) scale(1) rotate(0deg); }
            15% { transform: translateX(-50%) scale(1.15) rotate(3deg); }
            30% { transform: translateX(-50%) scale(1.28) rotate(-2deg); }
            45% { transform: translateX(-50%) scale(1.35) rotate(2deg); }
            60% { transform: translateX(-50%) scale(1.25) rotate(-1deg); }
            75% { transform: translateX(-50%) scale(1.12) rotate(1deg); }
            85% { transform: translateX(-50%) scale(1.05) rotate(-0.5deg); }
            95% { transform: translateX(-50%) scale(1.02) rotate(0.2deg); }
            100% { transform: translateX(-50%) scale(1) rotate(0deg); }
        }

        .cat-icon {
            display: inline-block;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: 38px;
            margin: 0 6px;
            animation: cat-icon-sparkle 3s ease-in-out infinite;
        }

        .cat-icon:hover {
            transform: scale(1.3) rotate(20deg);
        }

        .cat-icon.bounce {
            animation: cat-bounce 0.8s ease-in-out;
        }

        @keyframes cat-icon-sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.08) rotate(3deg); }
            50% { transform: scale(1.15) rotate(-2deg); }
            75% { transform: scale(1.08) rotate(2deg); }
        }

        @keyframes cat-bounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.5) rotate(20deg); }
            50% { transform: scale(1.7) rotate(-15deg); }
            75% { transform: scale(1.4) rotate(18deg); }
        }

        .header {
            position: absolute;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 1000;
            background: rgba(255,255,255,0.4);
            padding: 8px 24px;
            border-radius: 25px;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 8px 32px rgba(139,69,19,0.15),
                inset 0 1px 0 rgba(255,255,255,0.3);
            opacity: 0;
            animation: header-enter 1.2s ease-out 0.8s forwards;
        }

        @keyframes header-enter {
            0% { 
                opacity: 0; 
                transform: translateX(-50%) translateY(-20px) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0) scale(1); 
            }
        }

        .score-item {
            font-size: 18px;
            color: #8b4513;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            transition: all 0.3s ease;
            opacity: 1;
            cursor: pointer;
            border-radius: 15px;
            padding: 5px 8px;
            position: relative;
        }

        .score-item:hover {
            background: rgba(255,255,255,0.25);
            transform: scale(1.08);
        }

        .score-item.pulse {
            animation: score-pulse 0.6s ease-in-out !important;
        }

        .score-item.tap-sparkle {
            animation: tap-sparkle 0.8s ease-out !important;
        }

        .score-item.tap-fire {
            animation: tap-fire 0.8s ease-out !important;
        }

        .score-item.tap-trophy {
            animation: tap-trophy 0.8s ease-out !important;
        }

        @keyframes score-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.25); filter: brightness(1.6); }
        }

        @keyframes tap-sparkle {
            0% { transform: scale(1); filter: brightness(1); }
            30% { transform: scale(1.5) rotate(8deg); filter: brightness(2.5) drop-shadow(0 0 25px gold) saturate(2.5); }
            60% { transform: scale(1.3) rotate(-5deg); filter: brightness(2) drop-shadow(0 0 20px gold); }
            100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
        }

        @keyframes tap-fire {
            0% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            25% { transform: scale(1.6) rotate(10deg); filter: brightness(3.5) hue-rotate(120deg) saturate(3.5); }
            50% { transform: scale(1.4) rotate(-8deg); filter: brightness(2.8) hue-rotate(60deg) saturate(2.5); }
            75% { transform: scale(1.2) rotate(5deg); filter: brightness(2) hue-rotate(30deg); }
            100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
        }

        @keyframes tap-trophy {
            0% { transform: scale(1); filter: brightness(1); }
            20% { transform: scale(1.7) translateY(-8px); filter: brightness(4.5) drop-shadow(0 0 30px orange) saturate(3.5); }
            40% { transform: scale(1.5) translateY(-5px); filter: brightness(3.5) drop-shadow(0 0 25px gold); }
            60% { transform: scale(1.3) translateY(-2px); filter: brightness(2.5) drop-shadow(0 0 20px orange); }
            80% { transform: scale(1.1) translateY(0px); filter: brightness(1.8); }
            100% { transform: scale(1) translateY(0px); filter: brightness(1); }
        }

        .game-container {
            position: absolute;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            width: 320px;
            max-width: 90vw;
            opacity: 0;
            animation: game-enter 1s ease-out 1.5s forwards;
        }

        @keyframes game-enter {
            0% { 
                opacity: 0; 
                transform: translateX(-50%) scale(0.8) rotate(-5deg); 
            }
            60% { 
                opacity: 1; 
                transform: translateX(-50%) scale(1.05) rotate(2deg); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(-50%) scale(1) rotate(0deg); 
            }
        }

        .game-board {
            background: rgba(139,69,19,0.15);
            border-radius: 15px;
            padding: 10px;
            box-shadow: 
                0 8px 32px rgba(139,69,19,0.2),
                inset 0 1px 0 rgba(255,255,255,0.3);
            backdrop-filter: blur(15px);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 8px;
            width: 100%;
            aspect-ratio: 1;
            position: relative;
        }

        .cell {
            background: rgba(255,255,255,0.3);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 1px solid rgba(139,69,19,0.1);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .cat-tile {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            cursor: pointer;
            user-select: none;
            filter: drop-shadow(0 3px 8px rgba(139,69,19,0.3));
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-radius: 12px;
            animation: cat-breathe 4s ease-in-out infinite;
        }

        .cat-tile.new {
            animation: birth-pop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .cat-tile.merging {
            animation: merge-evolution 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 1000;
        }

        .cat-tile.moving {
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 500;
        }

        @keyframes cat-breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes birth-pop {
            0% { 
                transform: scale(0) rotate(0deg); 
                opacity: 0;
                filter: brightness(2) drop-shadow(0 0 20px gold);
            }
            60% { 
                transform: scale(1.3) rotate(180deg); 
                opacity: 0.9;
                filter: brightness(1.5) drop-shadow(0 0 15px gold);
            }
            100% { 
                transform: scale(1) rotate(360deg); 
                opacity: 1;
                filter: brightness(1) drop-shadow(0 3px 8px rgba(139,69,19,0.3));
            }
        }

        @keyframes merge-evolution {
            0% { 
                transform: scale(1) rotate(0deg); 
                filter: brightness(1) drop-shadow(0 3px 8px rgba(139,69,19,0.3));
            }
            25% { 
                transform: scale(1.5) rotate(90deg); 
                filter: brightness(3) hue-rotate(90deg) drop-shadow(0 0 20px rgba(255,69,0,0.8));
            }
            50% { 
                transform: scale(2) rotate(180deg); 
                filter: brightness(4) hue-rotate(180deg) drop-shadow(0 0 30px rgba(255,215,0,0.8));
            }
            75% { 
                transform: scale(1.8) rotate(270deg); 
                filter: brightness(3) hue-rotate(270deg) drop-shadow(0 0 25px rgba(255,105,180,0.8));
            }
            100% { 
                transform: scale(1) rotate(360deg); 
                filter: brightness(1) drop-shadow(0 3px 8px rgba(139,69,19,0.3));
            }
        }

        /* Áå´„É¨„Éô„É´Âà•„ÅÆËÉåÊôØËâ≤ */
        .cat-tile[data-value="2"] { background: linear-gradient(135deg, #ffebe6, #ffe0d6); }
        .cat-tile[data-value="4"] { background: linear-gradient(135deg, #ffd6cc, #ffcab8); }
        .cat-tile[data-value="8"] { background: linear-gradient(135deg, #ffb3a3, #ffa28a); }
        .cat-tile[data-value="16"] { background: linear-gradient(135deg, #ff9980, #ff8566); }
        .cat-tile[data-value="32"] { background: linear-gradient(135deg, #ff7f66, #ff6b47); }
        .cat-tile[data-value="64"] { background: linear-gradient(135deg, #ff6b47, #ff5722); }
        .cat-tile[data-value="128"] { background: linear-gradient(135deg, #ff8a65, #ffab91); color: white; }
        .cat-tile[data-value="256"] { background: linear-gradient(135deg, #ffcc02, #ffd54f); color: white; }
        .cat-tile[data-value="512"] { background: linear-gradient(135deg, #ff9800, #ffb74d); color: white; }
        .cat-tile[data-value="1024"] { background: linear-gradient(135deg, #ff5722, #ff7043); color: white; }
        .cat-tile[data-value="2048"] { background: linear-gradient(135deg, #e91e63, #f06292); color: white; box-shadow: 0 0 30px rgba(233,30,99,0.6); }

        .instructions {
            background: rgba(255,255,255,0.4);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            font-size: 16px;
            color: #8b4513;
            line-height: 1.4;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(139,69,19,0.1);
        }

        .floating-score {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #ff6347;
            pointer-events: none;
            z-index: 800;
            text-shadow: 2px 2px 8px rgba(139,69,19,0.3);
            animation: float-up 2s ease-out forwards;
            white-space: nowrap;
        }

        .floating-score.evolution {
            font-size: 32px;
            color: #ff1493;
            animation: float-evolution 3s ease-out forwards;
        }

        .floating-score.mega {
            font-size: 40px;
            color: #ff0000;
            animation: float-mega 3.5s ease-out forwards;
        }

        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
        }

        @keyframes float-evolution {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            30% { opacity: 1; transform: translateY(-40px) scale(2.5) rotate(180deg); }
            60% { opacity: 1; transform: translateY(-80px) scale(3) rotate(270deg); }
            100% { opacity: 0; transform: translateY(-150px) scale(4) rotate(540deg); }
        }

        @keyframes float-mega {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            20% { opacity: 1; transform: translateY(-30px) scale(3) rotate(120deg); }
            40% { opacity: 1; transform: translateY(-70px) scale(5) rotate(240deg); }
            60% { opacity: 1; transform: translateY(-120px) scale(7) rotate(360deg); }
            100% { opacity: 0; transform: translateY(-200px) scale(10) rotate(720deg); }
        }

        .msg {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: #8b4513;
            pointer-events: none;
            z-index: 700;
            animation: float-msg 2.5s ease-out forwards;
            text-shadow: 1px 1px 4px rgba(255,255,255,0.8);
            white-space: nowrap;
        }

        @keyframes float-msg {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
        }

        .evolution-text {
            position: absolute;
            font-family: 'Fredoka One', cursive;
            font-size: 48px;
            font-weight: bold;
            color: #ff1493;
            pointer-events: none;
            z-index: 900;
            text-shadow: 3px 3px 12px rgba(139,69,19,0.5);
            animation: evolution-appear 3s ease-out forwards;
            white-space: nowrap;
        }

        @keyframes evolution-appear {
            0% { opacity: 0; transform: scale(0) rotate(-360deg); }
            20% { opacity: 1; transform: scale(2.5) rotate(0deg); }
            80% { opacity: 1; transform: scale(1.8) rotate(15deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }

        .particle {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            z-index: 400;
            animation: particle-burst 2s ease-out forwards;
        }

        @keyframes particle-burst {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            20% { opacity: 1; transform: scale(1.5) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(720deg) translateY(-100px); }
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(139,69,19,0.95);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 2000;
            font-family: 'Fredoka One', cursive;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: game-over-appear 1s ease-out;
            max-width: 320px;
        }

        @keyframes game-over-appear {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(-180deg); }
            60% { opacity: 1; transform: translate(-50%, -50%) scale(1.1) rotate(0deg); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }

        .game-over h2 {
            font-size: 28px;
            margin-bottom: 15px;
            color: #ff6347;
        }

        .game-over p {
            font-size: 16px;
            margin-bottom: 20px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }

        .game-over button {
            background: linear-gradient(145deg, #d2691e, #ff7f50);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(210,105,30,0.3);
            font-family: 'M PLUS Rounded 1c', sans-serif;
        }

        .game-over button:hover {
            background: linear-gradient(145deg, #ff7f50, #ff6347);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(210,105,30,0.4);
        }

        /* „Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 480px) {
            .title {
                font-size: 32px;
                top: 18px;
                letter-spacing: 1px;
            }

            .cat-icon {
                font-size: 34px;
                margin: 0 5px;
            }

            .header {
                top: 70px;
                gap: 15px;
                padding: 6px 20px;
            }

            .score-item {
                font-size: 16px;
                gap: 4px;
            }

            .game-container {
                top: 120px;
                width: 300px;
            }

            .cat-tile {
                font-size: 30px;
            }

            .floating-score {
                font-size: 20px;
            }

            .evolution-text {
                font-size: 36px;
            }
        }

        @media (max-width: 360px) {
            .game-container {
                width: 280px;
            }

            .cat-tile {
                font-size: 26px;
            }
        }
    </style>
</head>
<body>
    <div class="title" id="titleElement">
        <span class="cat-icon" id="leftCat">üê±</span>NEKO2048<span class="cat-icon" id="rightCat">üê±</span>
    </div>

    <div class="header">
        <div class="score-item" id="scoreItem">‚≠ê <span id="score">0</span></div>
        <div class="score-item" id="bestItem">üèÜ <span id="best">0</span></div>
        <div class="score-item" id="levelItem">üéØ <span id="highestCat">üò∫</span></div>
    </div>

    <div class="game-container">
        <div class="game-board">
            <div class="grid" id="gameGrid"></div>
        </div>
        
        <div class="instructions">
            „Çπ„ÉØ„Ç§„Éó„ÅßÁå´„ÇíÁßªÂãïÔºÅÂêå„ÅòÁå´ÂêåÂ£´„ÅåÂêà‰Ωì„Åó„Å¶ÈÄ≤Âåñ„Åô„Çã„Çà‚ô™<br>
            <strong>üêØ„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ</strong>
        </div>
    </div>

    <script>
        class Neko2048 {
            constructor() {
                this.grid = [];
                this.score = 0;
                this.best = parseInt(localStorage.getItem('neko2048-best') || '0');
                this.highestCat = 'üò∫';
                this.isAnimating = false;
                this.audioContext = null;

                // Áå´„ÅÆÈÄ≤Âåñ„ÉÅ„Çß„Éº„É≥
                this.catEvolution = {
                    2: 'üò∫',    // Âü∫Êú¨Áå´
                    4: 'üò∏',    // Á¨ë„ÅÑÁå´
                    8: 'üòª',    // „Éè„Éº„ÉàÁõÆÁå´
                    16: 'üôÄ',   // „Å≥„Å£„Åè„ÇäÁå´
                    32: 'üòø',   // Ê≥£„ÅçÁå´
                    64: 'üòæ',   // ÊÄí„ÇäÁå´
                    128: 'üê±',  // Áå´È°î
                    256: 'üêà',  // Áå´ÂÖ®Ë∫´
                    512: 'üêà‚Äç‚¨õ',// ÈªíÁå´
                    1024: 'ü¶Å', // „É©„Ç§„Ç™„É≥
                    2048: 'üêØ', // „Éà„É©
                    4096: 'üëëüò∫', // ÁéãÊßòÁå´
                    8192: '‚≠êüò∫', // „Çπ„Çø„ÉºÁå´
                    16384: 'üåüüëëüò∫', // Ëºù„ÅèÁéãÊßòÁå´
                    32768: 'üíé‚≠êüò∫', // „ÉÄ„Ç§„É§„Çπ„Çø„ÉºÁå´
                    65536: 'üöÄüíé‚≠êüò∫' // ÂÆáÂÆô„ÉÄ„Ç§„É§„Çπ„Çø„ÉºÁå´
                };

                // „É°„ÉÉ„Çª„Éº„Ç∏
                this.evolutionMessages = [
                    '„Åó„Çì„Åã‚ô™', '„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ', '„Åô„Åî„ÅÑ„Å´„ÇÉÔºÅ', '„ÇÑ„Å£„Åü„Å≠ÔºÅ', '„Åã„Çè„ÅÑ„ÅÑ„ÄúÔºÅ',
                    '„ÇÇ„Åµ„ÇÇ„Åµ', '„Åµ„Çè„Åµ„Çè‚ô™', '„Åç„ÇÉ„Éº‚ô™', '„Å†„ÅÑ„Åô„ÅçÔºÅ', '„Å¶„Çì„Åó‚ô™'
                ];

                this.moveMessages = [
                    '„Å´„ÇÉ„Çì‚ô™', '„Åì„Çç„Åì„Çç„Äú', '„Åô„ÇÑ„Åô„ÇÑ', '„Å∫„Çç„Å∫„Çç', '„ÇÇ„Åç„ÇÖ„ÇÇ„Åç„ÇÖ',
                    '„Åµ„Åø„Åµ„Åø', '„Åè„Çã„Åè„Çã', '„ÅΩ„Çì„ÅΩ„Çì', '„Å≤„Çá„Åì„Å≤„Çá„Åì', '„Åæ„Å£„Åü„Çä'
                ];

                this.megaMessages = [
                    '„Åß„Çì„Åõ„Å§ÔºÅ', '„Åã„Åø„Å´„ÇÉ„ÇìÔºÅ', '„ÅÇ„Çä„Åà„Å™„ÅÑÔºÅ', '„Åï„ÅÑ„Åç„Çá„ÅÜÔºÅ', '„ÇÄ„Åí„Çì„Å†„ÅÑÔºÅ'
                ];

                this.init();
            }

            init() {
                // ÁîªÈù¢Âõ∫ÂÆö
                this.enforceScreenLock();

                // „Ç∞„É™„ÉÉ„ÉâÂàùÊúüÂåñ
                this.initGrid();

                // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
                this.setupEventListeners();

                // Èü≥Â£∞ÂàùÊúüÂåñ
                document.addEventListener('click', () => this.initSound(), {once: true});
                document.addEventListener('touchstart', () => this.initSound(), {once: true});

                // „Éè„Éó„ÉÜ„Ç£„ÉÉ„ÇØ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÂØæÂøú
                this.vibrate = (pattern) => {
                    if ('vibrate' in navigator) {
                        navigator.vibrate(pattern);
                    }
                };

                // ÂàùÊúüÁå´„Çí2ÂåπÈÖçÁΩÆ
                this.addRandomCat();
                this.addRandomCat();

                this.updateUI();
                this.updateDisplay();
            }

            enforceScreenLock() {
                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('gesturestart', (e) => {
                    e.preventDefault();
                });

                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }

            initGrid() {
                const gridElement = document.getElementById('gameGrid');
                gridElement.innerHTML = '';
                
                this.grid = [];
                for (let row = 0; row < 4; row++) {
                    this.grid[row] = [];
                    for (let col = 0; col < 4; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        gridElement.appendChild(cell);
                        this.grid[row][col] = 0;
                    }
                }
            }

            setupEventListeners() {
                // „Çø„Ç§„Éà„É´„ÅÆ„Çø„ÉÉ„Éó
                document.getElementById('titleElement').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceTitle();
                });

                // „Çø„Ç§„Éà„É´Áå´„ÅÆ„Çø„ÉÉ„Éó
                document.getElementById('leftCat').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceCat('left');
                });

                document.getElementById('rightCat').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceCat('right');
                });

                // „Çπ„Ç≥„Ç¢È†ÖÁõÆ„ÅÆ„Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
                document.getElementById('scoreItem').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.tapScoreItem('sparkle');
                });

                document.getElementById('bestItem').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.tapScoreItem('fire');
                });

                document.getElementById('levelItem').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.tapScoreItem('trophy');
                });

                // „Çπ„ÉØ„Ç§„Éó„Ç§„Éô„É≥„Éà
                let startX, startY;
                let isTouch = false;

                const gameGrid = document.getElementById('gameGrid');

                const handleStart = (e) => {
                    if (this.isAnimating) return;
                    isTouch = true;
                    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                    startX = clientX;
                    startY = clientY;
                    e.preventDefault();
                };

                const handleEnd = (e) => {
                    if (!isTouch || this.isAnimating) return;
                    isTouch = false;
                    
                    const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
                    const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
                    
                    const deltaX = clientX - startX;
                    const deltaY = clientY - startY;
                    const minSwipeDistance = 30;

                    if (Math.abs(deltaX) > Math.abs(deltaY)) {
                        if (Math.abs(deltaX) > minSwipeDistance) {
                            if (deltaX > 0) {
                                this.move('right');
                            } else {
                                this.move('left');
                            }
                        }
                    } else {
                        if (Math.abs(deltaY) > minSwipeDistance) {
                            if (deltaY > 0) {
                                this.move('down');
                            } else {
                                this.move('up');
                            }
                        }
                    }
                    e.preventDefault();
                };

                gameGrid.addEventListener('touchstart', handleStart);
                gameGrid.addEventListener('touchend', handleEnd);
                gameGrid.addEventListener('mousedown', handleStart);
                gameGrid.addEventListener('mouseup', handleEnd);

                // „Ç≠„Éº„Éú„Éº„ÉâÂØæÂøú
                document.addEventListener('keydown', (e) => {
                    if (this.isAnimating) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            this.move('up');
                            e.preventDefault();
                            break;
                        case 'ArrowDown':
                            this.move('down');
                            e.preventDefault();
                            break;
                        case 'ArrowLeft':
                            this.move('left');
                            e.preventDefault();
                            break;
                        case 'ArrowRight':
                            this.move('right');
                            e.preventDefault();
                            break;
                    }
                });
            }

            async move(direction) {
                if (this.isAnimating) return;

                const previousGrid = this.grid.map(row => [...row]);
                let moved = false;
                let merges = [];

                // ÁßªÂãï„Å®„Éû„Éº„Ç∏„ÅÆÂá¶ÁêÜ
                if (direction === 'left') {
                    for (let row = 0; row < 4; row++) {
                        const result = this.processLine(this.grid[row]);
                        if (JSON.stringify(result.line) !== JSON.stringify(this.grid[row])) {
                            moved = true;
                        }
                        this.grid[row] = result.line;
                        result.merges.forEach(merge => merges.push({row, col: merge}));
                    }
                } else if (direction === 'right') {
                    for (let row = 0; row < 4; row++) {
                        const result = this.processLine(this.grid[row].slice().reverse());
                        if (JSON.stringify(result.line.reverse()) !== JSON.stringify(this.grid[row])) {
                            moved = true;
                        }
                        this.grid[row] = result.line.reverse();
                        result.merges.forEach(merge => merges.push({row, col: 3 - merge}));
                    }
                } else if (direction === 'up') {
                    for (let col = 0; col < 4; col++) {
                        const column = [this.grid[0][col], this.grid[1][col], this.grid[2][col], this.grid[3][col]];
                        const result = this.processLine(column);
                        if (JSON.stringify(result.line) !== JSON.stringify(column)) {
                            moved = true;
                        }
                        for (let row = 0; row < 4; row++) {
                            this.grid[row][col] = result.line[row];
                        }
                        result.merges.forEach(merge => merges.push({row: merge, col}));
                    }
                } else if (direction === 'down') {
                    for (let col = 0; col < 4; col++) {
                        const column = [this.grid[3][col], this.grid[2][col], this.grid[1][col], this.grid[0][col]];
                        const result = this.processLine(column);
                        if (JSON.stringify(result.line.reverse()) !== JSON.stringify([this.grid[0][col], this.grid[1][col], this.grid[2][col], this.grid[3][col]])) {
                            moved = true;
                        }
                        const reversedLine = result.line.reverse();
                        for (let row = 0; row < 4; row++) {
                            this.grid[row][col] = reversedLine[row];
                        }
                        result.merges.forEach(merge => merges.push({row: 3 - merge, col}));
                    }
                }

                if (moved) {
                    this.isAnimating = true;
                    
                    // ÁßªÂãï„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                    await this.animateMove(previousGrid, this.grid);
                    
                    // „Éû„Éº„Ç∏„Ç®„Éï„Çß„ÇØ„Éà
                    if (merges.length > 0) {
                        await this.animateMerges(merges);
                    }
                    
                    // Êñ∞„Åó„ÅÑÁå´„ÇíËøΩÂä†
                    this.addRandomCat();
                    
                    this.playSound('move');
                    this.vibrate([30]);
                    
                    // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
                    if (Math.random() < 0.3) {
                        const message = this.moveMessages[Math.floor(Math.random() * this.moveMessages.length)];
                        this.showMsg(message, window.innerWidth/2, window.innerHeight/2);
                    }
                    
                    this.isAnimating = false;
                    this.updateUI();
                    
                    // „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº„ÉÅ„Çß„ÉÉ„ÇØ
                    if (this.isGameOver()) {
                        this.gameOver();
                    }
                }
            }

            processLine(line) {
                // 0„ÇíÈô§Âéª
                let newLine = line.filter(cell => cell !== 0);
                let merges = [];

                // „Éû„Éº„Ç∏Âá¶ÁêÜ
                for (let i = 0; i < newLine.length - 1; i++) {
                    if (newLine[i] === newLine[i + 1]) {
                        newLine[i] *= 2;
                        this.score += newLine[i];
                        newLine[i + 1] = 0;
                        merges.push(i);
                        i++; // Ê¨°„ÅÆ„Çª„É´„Çí„Çπ„Ç≠„ÉÉ„Éó
                    }
                }

                // ÂÜçÂ∫¶0„ÇíÈô§Âéª
                newLine = newLine.filter(cell => cell !== 0);

                // 4„Å§„Å´„Å™„Çã„Åæ„Åß0„ÅßÂüã„ÇÅ„Çã
                while (newLine.length < 4) {
                    newLine.push(0);
                }

                return { line: newLine, merges };
            }

            async animateMove(previousGrid, newGrid) {
                const gridElement = document.getElementById('gameGrid');
                
                // Êó¢Â≠ò„ÅÆ„Çø„Ç§„É´„Çí„Åô„Åπ„Å¶ÂâäÈô§
                const existingTiles = gridElement.querySelectorAll('.cat-tile');
                existingTiles.forEach(tile => tile.remove());
                
                // Êñ∞„Åó„ÅÑ„Çø„Ç§„É´„ÇíÈÖçÁΩÆ
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (newGrid[row][col] !== 0) {
                            this.createCatTile(row, col, newGrid[row][col]);
                        }
                    }
                }
                
                await this.delay(300);
            }

            async animateMerges(merges) {
                const promises = merges.map(merge => {
                    const tile = this.getCatTileAt(merge.row, merge.col);
                    if (tile) {
                        tile.classList.add('merging');
                        
                        // ÈÄ≤Âåñ„Ç®„Éï„Çß„ÇØ„Éà
                        const value = parseInt(tile.dataset.value);
                        this.showEvolutionEffects(merge.row, merge.col, value);
                        
                        return this.delay(800).then(() => {
                            tile.classList.remove('merging');
                        });
                    }
                    return Promise.resolve();
                });
                
                await Promise.all(promises);
            }

            showEvolutionEffects(row, col, value) {
                const gridElement = document.getElementById('gameGrid');
                const rect = gridElement.getBoundingClientRect();
                const cellSize = rect.width / 4;
                const x = rect.left + (col + 0.5) * cellSize;
                const y = rect.top + (row + 0.5) * cellSize;

                // „Çπ„Ç≥„Ç¢Ë°®Á§∫
                let scoreType = 'normal';
                if (value >= 1024) {
                    scoreType = 'mega';
                } else if (value >= 256) {
                    scoreType = 'evolution';
                }
                
                this.showFloatingScore(value, x, y, scoreType);

                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
                const particleEmojis = ['‚ú®', 'üí´', 'üåü', 'üíñ', 'üéä'];
                this.createParticles(x, y, particleEmojis, Math.min(8, Math.floor(value / 64) + 3));

                // ÈÄ≤Âåñ„É°„ÉÉ„Çª„Éº„Ç∏
                let messages;
                if (value >= 2048) {
                    messages = this.megaMessages;
                } else {
                    messages = this.evolutionMessages;
                }
                const message = messages[Math.floor(Math.random() * messages.length)];
                this.showMsg(message, x, y + 40);

                // ÁâπÂà•„Å™ÈÄ≤Âåñ„ÉÜ„Ç≠„Çπ„Éà
                if (value >= 512) {
                    this.showEvolutionText(value);
                }

                // „Çµ„Ç¶„É≥„Éâ
                if (value >= 2048) {
                    this.playSound('mega');
                    this.vibrate([200, 100, 200, 100, 300]);
                } else if (value >= 512) {
                    this.playSound('evolution');
                    this.vibrate([100, 50, 100]);
                } else {
                    this.playSound('merge');
                    this.vibrate([50]);
                }
            }

            showEvolutionText(value) {
                const evolutionText = document.createElement('div');
                evolutionText.className = 'evolution-text';
                
                if (value >= 2048) {
                    evolutionText.textContent = 'ÊúÄÂº∑Áå´Ë™ïÁîüÔºÅ';
                } else if (value >= 1024) {
                    evolutionText.textContent = '‰ºùË™¨„ÅÆÁå´ÔºÅ';
                } else if (value >= 512) {
                    evolutionText.textContent = 'Á•ûÁå´Ë¶öÈÜíÔºÅ';
                }
                
                evolutionText.style.left = '50%';
                evolutionText.style.top = '50%';
                evolutionText.style.transform = 'translate(-50%, -50%)';
                document.body.appendChild(evolutionText);
                
                setTimeout(() => evolutionText.remove(), 3000);
            }

            createCatTile(row, col, value) {
                const gridElement = document.getElementById('gameGrid');
                const tile = document.createElement('div');
                tile.className = 'cat-tile';
                tile.dataset.value = value;
                tile.textContent = this.catEvolution[value];
                tile.style.gridRow = row + 1;
                tile.style.gridColumn = col + 1;
                
                gridElement.appendChild(tile);
                return tile;
            }

            getCatTileAt(row, col) {
                const gridElement = document.getElementById('gameGrid');
                return gridElement.querySelector(`.cat-tile[style*="grid-row: ${row + 1}"][style*="grid-column: ${col + 1}"]`);
            }

            addRandomCat() {
                const emptyCells = [];
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] === 0) {
                            emptyCells.push({ row, col });
                        }
                    }
                }

                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    const value = Math.random() < 0.9 ? 2 : 4;
                    this.grid[randomCell.row][randomCell.col] = value;
                    
                    const tile = this.createCatTile(randomCell.row, randomCell.col, value);
                    tile.classList.add('new');
                    
                    setTimeout(() => {
                        tile.classList.remove('new');
                    }, 600);
                    
                    this.playSound('spawn');
                }
            }

            isGameOver() {
                // Á©∫„Åç„Çª„É´„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] === 0) {
                            return false;
                        }
                    }
                }

                // „Éû„Éº„Ç∏ÂèØËÉΩ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        const current = this.grid[row][col];
                        if ((row < 3 && this.grid[row + 1][col] === current) ||
                            (col < 3 && this.grid[row][col + 1] === current)) {
                            return false;
                        }
                    }
                }

                return true;
            }

            gameOver() {
                this.playSound('gameover');
                this.vibrate([300, 200, 300, 200, 500]);

                const gameOverEl = document.createElement('div');
                gameOverEl.className = 'game-over';
                gameOverEl.innerHTML = `
                    <h2>üêæ „Ç≤„Éº„É†ÁµÇ‰∫Ü üêæ</h2>
                    <p>„Çπ„Ç≥„Ç¢: ${this.formatNum(this.score)}</p>
                    <p>ÊúÄÈ´ò„ÅÆÁå´: ${this.highestCat}</p>
                    <p>„Éô„Çπ„Éà„Çπ„Ç≥„Ç¢: ${this.formatNum(this.best)}</p>
                    <button onclick="game.restart()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
                `;
                document.body.appendChild(gameOverEl);
            }

            restart() {
                this.score = 0;
                this.highestCat = 'üò∫';
                this.isAnimating = false;
                
                const gameOverEl = document.querySelector('.game-over');
                if (gameOverEl) gameOverEl.remove();
                
                this.initGrid();
                this.addRandomCat();
                this.addRandomCat();
                this.updateUI();
                this.updateDisplay();
            }

            updateDisplay() {
                const gridElement = document.getElementById('gameGrid');
                
                // Êó¢Â≠ò„ÅÆ„Çø„Ç§„É´„Çí„Åô„Åπ„Å¶ÂâäÈô§
                const existingTiles = gridElement.querySelectorAll('.cat-tile');
                existingTiles.forEach(tile => tile.remove());
                
                // Êñ∞„Åó„ÅÑ„Çø„Ç§„É´„ÇíÈÖçÁΩÆ
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] !== 0) {
                            this.createCatTile(row, col, this.grid[row][col]);
                        }
                    }
                }
            }

            // UI„Éª„Ç®„Éï„Çß„ÇØ„Éà„ÉªÈü≥ÈüøÈñ¢ÈÄ£ÔºàNEKOPON„Å®ÂêåÊßòÔºâ
            tapScoreItem(type) {
                let element, bonusPoints, soundType;

                switch(type) {
                    case 'sparkle':
                        element = document.getElementById('scoreItem');
                        bonusPoints = 20;
                        soundType = 'sparkle';
                        element.classList.add('tap-sparkle');
                        setTimeout(() => element.classList.remove('tap-sparkle'), 800);
                        break;
                    
                    case 'fire':
                        element = document.getElementById('bestItem');
                        bonusPoints = 10;
                        soundType = 'fire';
                        element.classList.add('tap-fire');
                        setTimeout(() => element.classList.remove('tap-fire'), 800);
                        break;
                    
                    case 'trophy':
                        element = document.getElementById('levelItem');
                        bonusPoints = 30;
                        soundType = 'trophy';
                        element.classList.add('tap-trophy');
                        setTimeout(() => element.classList.remove('tap-trophy'), 800);
                        break;
                }

                this.score += bonusPoints;
                this.playSound(soundType);
                this.vibrate([80, 30, 80, 30, 120]);

                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                this.showFloatingScore(bonusPoints, centerX, centerY);
                this.createParticles(centerX, centerY, ['‚ú®', 'üí´', 'üåü'], 3);

                this.updateUI();
            }

            bounceTitle() {
                const titleElement = document.getElementById('titleElement');
                titleElement.classList.add('title-bounce');

                this.playSound('title');
                this.vibrate([120, 60, 120, 60, 180]);

                const rect = titleElement.getBoundingClientRect();
                this.createParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä'], 6);

                this.score += 50;
                this.showFloatingScore(50, rect.left + rect.width/2, rect.top + rect.height/2);
                this.showMsg('NEKO2048‚ô™', rect.left + rect.width/2, rect.top + rect.height/2 + 30);

                setTimeout(() => titleElement.classList.remove('title-bounce'), 1200);
                this.updateUI();
            }

            bounceCat(side) {
                const catId = side === 'left' ? 'leftCat' : 'rightCat';
                const catElement = document.getElementById(catId);

                catElement.classList.add('bounce');
                this.playSound('purr');
                this.vibrate([50]);

                const rect = catElement.getBoundingClientRect();
                this.createParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®'], 2);

                this.score += 10;
                this.showFloatingScore(10, rect.left + rect.width/2, rect.top + rect.height/2);
                this.showMsg('„Å´„ÇÉ„Çì‚ô™', rect.left + rect.width/2, rect.top + rect.height/2 + 20);

                setTimeout(() => catElement.classList.remove('bounce'), 800);
                this.updateUI();
            }

            initSound() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            playSound(type) {
                if (!this.audioContext) return;

                try {
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }

                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filterNode = this.audioContext.createBiquadFilter();

                    oscillator.connect(filterNode);
                    filterNode.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    let frequency, duration, filterFreq;

                    switch(type) {
                        case 'spawn':
                            frequency = 600 + Math.random() * 200;
                            duration = 0.3;
                            filterFreq = 1200;
                            break;
                        case 'move':
                            frequency = 400 + Math.random() * 200;
                            duration = 0.2;
                            filterFreq = 800;
                            break;
                        case 'merge':
                            frequency = 800;
                            duration = 0.5;
                            filterFreq = 2000;
                            break;
                        case 'evolution':
                            frequency = 1200;
                            duration = 0.8;
                            filterFreq = 3000;
                            break;
                        case 'mega':
                            frequency = 1600;
                            duration = 1.5;
                            filterFreq = 4000;
                            break;
                        case 'purr':
                            frequency = 300;
                            duration = 1.0;
                            filterFreq = 600;
                            break;
                        case 'sparkle':
                            frequency = 1000 + Math.random() * 500;
                            duration = 0.8;
                            filterFreq = 2500;
                            break;
                        case 'fire':
                            frequency = 400 + Math.random() * 300;
                            duration = 1.0;
                            filterFreq = 1500;
                            break;
                        case 'trophy':
                            frequency = 1500;
                            duration = 1.5;
                            filterFreq = 3500;
                            break;
                        case 'title':
                            frequency = 900;
                            duration = 1.8;
                            filterFreq = 2500;
                            break;
                        case 'gameover':
                            frequency = 200;
                            duration = 3.0;
                            filterFreq = 400;
                            break;
                        default:
                            frequency = 440;
                            duration = 0.3;
                            filterFreq = 1000;
                    }

                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    if (type === 'evolution' || type === 'mega') {
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, this.audioContext.currentTime + duration);
                    } else if (type === 'gameover') {
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.3, this.audioContext.currentTime + duration);
                    } else {
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.6, this.audioContext.currentTime + duration);
                    }

                    filterNode.frequency.setValueAtTime(filterFreq, this.audioContext.currentTime);
                    filterNode.Q.setValueAtTime(2, this.audioContext.currentTime);

                    gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (e) {
                    // Audio error - ignore
                }
            }

            showFloatingScore(points, x, y, type = 'normal') {
                const el = document.createElement('div');
                el.className = `floating-score ${type}`;
                el.textContent = `+${this.formatNum(points)}`;
                el.style.left = Math.min(x, window.innerWidth - 100) + 'px';
                el.style.top = Math.min(y, window.innerHeight - 50) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), type === 'mega' ? 3500 : (type === 'evolution' ? 3000 : 2000));
            }

            showMsg(text, x, y) {
                const el = document.createElement('div');
                el.className = 'msg';
                el.textContent = text;
                el.style.left = Math.min(x, window.innerWidth - 80) + 'px';
                el.style.top = Math.min(y, window.innerHeight - 40) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 2500);
            }

            createParticles(x, y, emojis, count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const el = document.createElement('div');
                        el.className = 'particle';
                        el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        el.style.left = (x + (Math.random() - 0.5) * 80) + 'px';
                        el.style.top = (y + (Math.random() - 0.5) * 80) + 'px';
                        document.body.appendChild(el);
                        setTimeout(() => el.remove(), 2000);
                    }, i * 50);
                }
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            updateUI() {
                document.getElementById('score').textContent = this.formatNum(this.score);
                
                // „Éô„Çπ„Éà„Çπ„Ç≥„Ç¢Êõ¥Êñ∞
                if (this.score > this.best) {
                    this.best = this.score;
                    localStorage.setItem('neko2048-best', this.best.toString());
                }
                document.getElementById('best').textContent = this.formatNum(this.best);

                // ÊúÄÈ´ò„É¨„Éô„É´„ÅÆÁå´„ÇíÊõ¥Êñ∞
                let highestValue = 0;
                for (let row = 0; row < 4; row++) {
                    for (let col = 0; col < 4; col++) {
                        if (this.grid[row][col] > highestValue) {
                            highestValue = this.grid[row][col];
                        }
                    }
                }
                if (highestValue > 0) {
                    this.highestCat = this.catEvolution[highestValue];
                    document.getElementById('highestCat').textContent = this.highestCat;
                }

                // „Çπ„Ç≥„Ç¢„Ç¢„Ç§„ÉÜ„É†„Å´„Éë„É´„ÇπÂäπÊûú
                if (this.lastScore !== this.score) {
                    document.getElementById('scoreItem').classList.add('pulse');
                    setTimeout(() => {
                        document.getElementById('scoreItem').classList.remove('pulse');
                    }, 600);
                    this.lastScore = this.score;
                }
            }

            formatNum(n) {
                if (n >= 1e9) return Math.floor(n / 1e9) + 'B';
                if (n >= 1e6) return Math.floor(n / 1e6) + 'M';
                if (n >= 1e3) return Math.floor(n / 1e3) + 'K';
                return Math.floor(n).toString();
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„Åó„Å¶Ë®≠ÂÆö
        const game = new Neko2048();
    </script>
</body>
</html>