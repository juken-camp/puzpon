<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ONE WORLD Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-coral: #f4a261;
            --primary-sage: #7fb069;
            --primary-sky: #6bb6ff;
            --primary-lavender: #a584c7;
            --accent-peach: #f9b6a3;
            --accent-mint: #b8e6b8;
            --bg-cream: #fdf8f3;
            --bg-white: #ffffff;
            --text-dark: #2d3748;
            --text-warm: #5d4e75;
            --border-soft: #e6ddd4;
            --shadow-gentle: rgba(116, 139, 141, 0.15);
        }
        body {
            font-family: "Noto Sans JP", "Inter", sans-serif;
            background: #faf7f2;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            color: var(--text-dark);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            padding-top: 5rem;
            padding-bottom: 2rem;
        }
        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }
        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }
        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }
        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }
        .game-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--primary-coral);
            text-align: center;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }
        .warm-card {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 24px;
            box-shadow: 0 8px 32px var(--shadow-gentle);
            position: relative;
            overflow: hidden;
        }
        .warm-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-coral);
            border-radius: 24px 24px 0 0;
        }
        .warm-button {
            background: var(--primary-coral);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.4);
            background: #f19a4e;
        }
        .warm-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        .grade-btn {
            background: #fef9f5;
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            color: var(--text-warm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 1rem 0.75rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px var(--shadow-gentle);
        }
        .grade-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.25);
            background: #fdf5ef;
        }
        .grade-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
        }
        .lesson-btn {
            background: #f0f8ff;
            border: 2px solid #b8d4f0;
            border-radius: 16px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 60px;
            box-shadow: 0 4px 12px rgba(107, 182, 255, 0.15);
            font-size: 0.8rem;
            font-weight: 500;
        }
        .lesson-btn:hover {
            border-color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.25);
            background: #e6f3ff;
        }
        .lesson-btn.selected {
            background: #d9edff;
            border-color: var(--primary-sky);
            color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.3);
        }
        .lesson-btn.selected::after {
            content: '‚úì';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-sky);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .grammar-btn {
            background: #f8f5ff;
            border: 2px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.6rem 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 50px;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
            font-size: 0.75rem;
            font-weight: 500;
        }
        .grammar-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
            background: #f0ebff;
        }
        .grammar-btn.selected {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        .grammar-btn.selected::after {
            content: '‚úì';
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Ê®™„É©„Ç§„É≥„ÅÆÂæπÂ∫ïÂâäÈô§„Ç∑„Çπ„ÉÜ„É†Ôºà„Éï„Ç©„Éº„Ç´„Çπ„Éª„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÂØæÂøúÔºâ */
        *, *::before, *::after,
        *:focus, *:active, *:hover,
        *:focus-visible, *:focus-within {
            border-top: none !important;
            border-bottom: none !important;
            outline: none !important;
        }
        
        /* Tailwind CSS„ÅÆÂÖ®„Éú„Éº„ÉÄ„Éº„ÇØ„É©„Çπ„ÇíÁÑ°ÂäπÂåñ */
        .border, .border-t, .border-b, .border-l, .border-r,
        .border-0, .border-2, .border-4, .border-8,
        .border-t-0, .border-t-2, .border-t-4, .border-t-8,
        .border-b-0, .border-b-2, .border-b-4, .border-b-8,
        .border-solid, .border-dashed, .border-dotted,
        .divide-y, .divide-x {
            border-top: none !important;
            border-bottom: none !important;
        }
        
        /* ÂøÖË¶Å„Å™„Éú„Éº„ÉÄ„Éº„ÅÆ„ÅøÂæ©Ê¥ªÔºàÂÆåÂÖ®ÊåáÂÆöÔºâ */
        .warm-card {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .lesson-btn {
            border: 2px solid #b8d4f0 !important;
            border-top: 2px solid #b8d4f0 !important;
            border-bottom: 2px solid #b8d4f0 !important;
        }
        
        .grammar-btn {
            border: 2px solid #d6c9e3 !important;
            border-top: 2px solid #d6c9e3 !important;
            border-bottom: 2px solid #d6c9e3 !important;
        }
        
        .grade-btn {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .quiz-question {
            border: 3px solid #e2e8f0 !important;
            border-top: 3px solid #e2e8f0 !important;
            border-bottom: 3px solid #e2e8f0 !important;
        }
        
        .answer-display {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .header-stat-item {
            border: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-top: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-bottom: 1.5px solid rgba(165, 132, 199, 0.3) !important;
        }
        
        .header-nav-item {
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-top: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        /* „É¢„Éº„ÉÄ„É´„ÅÆË∂ÖÂº∑Âõ∫„Å™Âõ∫ÂÆö„Ç∑„Çπ„ÉÜ„É† */
        .modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 0 !important;
            margin: 0 !important;
            overflow: hidden !important;
        }
        
        .modal.show {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            animation: modalFadeIn 0.4s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: 90vh !important;
            overflow-y: auto !important;
            margin: 1rem !important;
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
        }
        
        /* üîß „ÇØ„Ç§„Ç∫„É¢„Éº„ÉÄ„É´„ÅÆÂÆåÂÖ®Âõ∫ÂÆöÂåñ„Ç∑„Çπ„ÉÜ„É†ÔºàÂº∑ÂåñÁâàÔºâ */
        #quizModal .modal-content {
            width: 95% !important;
            max-width: 550px !important;
            min-width: 300px !important;
            margin: 1rem auto !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            flex-shrink: 0 !important;
            overflow: visible !important;
        }
        
        #quizModal .modal-content .warm-card {
            width: 100% !important;
            max-width: none !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            margin: 0 !important;
        }
        
        /* „É¨„ÉÉ„Çπ„É≥„ÉªÊñáÊ≥ïÈÅ∏ÊäûÁîªÈù¢„ÅÆ„Çπ„ÇØ„É≠„Éº„É´ÊîπÂñÑ */
        .lesson-modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: 85vh !important;
            overflow-y: auto !important;
            margin: 0.5rem !important;
            margin-bottom: 2rem !important;
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
        }
        
        @media (max-width: 640px) {
            .modal {
                padding: 0 !important;
                margin: 0 !important;
                overflow: hidden !important;
            }
            
            .modal-content {
                margin: 0.5rem !important;
                max-height: 90vh !important;
                width: calc(100% - 1rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            #quizModal .modal-content {
                margin: 0.25rem auto !important;
                max-height: 85vh !important;
                width: calc(100% - 0.5rem) !important;
                min-width: 280px !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            .lesson-modal-content {
                margin: 0.25rem !important;
                margin-bottom: 1rem !important;
                max-height: 85vh !important;
                width: calc(100% - 0.5rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 600;
            z-index: 100;
            animation: particleFloat 2.5s ease-out forwards;
            font-size: 20px;
        }
        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-40px) scale(1.3) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(1.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* „Éò„ÉÉ„ÉÄ„ÉºÔºàÂÖÉ„Éï„ÉÉ„Çø„ÉºÔºâ */
        .fixed-header {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 1001;
            animation: floatingHeader 3s ease-in-out infinite;
            max-width: 90vw;
            overflow: hidden;
            background: transparent;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
        }
        
        @keyframes floatingHeader {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        
        .header-stat-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border: 1.5px solid rgba(165, 132, 199, 0.3);
            border-radius: 18px;
            padding: 0.4rem 0.7rem;
            min-width: 60px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(165, 132, 199, 0.2);
        }
        
        .header-stat-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(165, 132, 199, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.95));
            border-color: rgba(165, 132, 199, 0.5);
        }
        
        .header-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .header-nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .header-nav-item:hover::before {
            opacity: 1;
        }
        
        .header-nav-item:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .header-nav-item:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        .header-nav-item.home {
            background: linear-gradient(135deg, var(--primary-coral), #f19a4e);
        }
        
        .header-nav-item.home:hover {
            box-shadow: 0 8px 25px rgba(244, 162, 97, 0.5);
        }
        
        .header-nav-item.back {
            background: linear-gradient(135deg, var(--primary-sage), #6fa055);
        }
        
        .header-nav-item.back:hover {
            box-shadow: 0 8px 25px rgba(127, 176, 105, 0.5);
        }
        
        .header-nav-item.voice {
            background: linear-gradient(135deg, var(--primary-lavender), #9574b5);
        }
        
        .header-nav-item.voice:hover {
            box-shadow: 0 8px 25px rgba(165, 132, 199, 0.5);
        }
        
        .header-stat-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-lavender);
        }
        .header-stat-emoji {
            font-size: 1.1rem;
        }
        
        /* üîß Èü≥Â£∞Ë®≠ÂÆö„ÅÆÊñ∞„Åó„ÅÑ„Ç≥„É≥„Éë„ÇØ„Éà„Éá„Ç∂„Ç§„É≥ */
        .device-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            border: 2px solid #e2e8f0;
        }
        
        .device-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .device-description {
            font-size: 0.8rem;
            color: var(--text-warm);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .voice-choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .voice-choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.5rem;
            background: var(--bg-white);
            border: 2px solid var(--border-soft);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .voice-choice-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.2);
            background: #faf8ff;
        }
        
        .voice-choice-btn.selected {
            border-color: var(--primary-lavender);
            background: #f0ebff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        
        .voice-choice-btn.selected::after {
            content: '‚úì';
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voice-gender-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-description {
            font-size: 0.65rem;
            color: var(--text-warm);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        
        .voice-test-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-test-btn:hover {
            background: #5aa3f0;
            transform: translateY(-1px);
        }
        
        .voice-toggle {
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-cream);
            border-radius: 12px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: var(--primary-sage);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        .speak-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary-sage);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            vertical-align: middle;
        }
        .speak-btn:hover {
            background: #6fa055;
            transform: scale(1.1);
        }
        .speak-btn.speaking {
            animation: speakPulse 1s infinite;
        }
        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        .timer-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 0.75rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            border: 2px solid;
            display: inline-block;
            min-width: 80px;
        }
        .timer-normal {
            background: linear-gradient(135deg, #e8f5e8, #f0fdf0);
            color: var(--primary-sage);
            border-color: var(--primary-sage);
        }
        .timer-warning {
            background: linear-gradient(135deg, #fef3cd, #fefce8);
            color: #d97706;
            border-color: #d97706;
            animation: timerPulse 1s infinite;
        }
        .timer-danger {
            background: linear-gradient(135deg, #fee2e2, #fef2f2);
            color: #dc2626;
            border-color: #dc2626;
            animation: timerPulse 0.5s infinite;
        }
        .timer-unlimited {
            background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
            color: #0284c7;
            border-color: #0284c7;
        }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .timer-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .timer-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        
        .answer-display {
            background: var(--bg-cream);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 1rem;
            border: 3px solid var(--border-soft);
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.8;
            box-shadow: 0 4px 12px var(--shadow-gentle);
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .answer-display.show {
            border-color: var(--primary-sage);
            background: #f0f9f0;
            box-shadow: 0 4px 12px rgba(127, 176, 105, 0.2);
        }
        .answer-text {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary-sage);
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
            padding: 1rem;
            background: rgba(127, 176, 105, 0.1);
            border-radius: 12px;
            position: relative;
        }
        .explanation-text {
            color: var(--text-dark);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
        }
        
        .show-answer-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(107, 182, 255, 0.3);
            margin: 0.5rem 0;
        }
        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 182, 255, 0.4);
            background: #5aa3f0;
        }
        .show-answer-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        /* üîß „ÇØ„Ç§„Ç∫ÂïèÈ°åÊû†„ÅÆÂÆåÂÖ®Âõ∫ÂÆöÂåñ */
        .quiz-question {
            background: #f8fafc !important;
            border: 3px solid #e2e8f0 !important;
            border-radius: 16px !important;
            padding: 1.5rem !important;
            text-align: center !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            color: var(--text-dark) !important;
            line-height: 1.5 !important;
            margin-bottom: 1rem !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            position: static !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            flex-shrink: 0 !important;
            overflow-wrap: break-word !important;
            word-wrap: break-word !important;
        }
        
        .grade-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .lesson-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        .grammar-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .back-button {
            background: #f1f5f9;
            border: 3px solid #cbd5e1;
            color: var(--text-dark);
            border-radius: 16px;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .back-button:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .stats-display {
            background: var(--bg-cream);
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-gentle);
        }
        .section-divider {
            height: 2px;
            background: var(--border-soft);
            margin: 1.25rem 0;
        }
        .mode-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .mode-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .mode-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        .direction-btn {
            background: var(--bg-white);
            border: 3px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
        }
        .direction-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        .direction-btn.active {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }
            .warm-card {
                margin: 0.25rem;
                padding: 1rem;
            }
            .game-title {
                font-size: clamp(1.25rem, 6vw, 2rem);
            }
            .grade-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .grammar-grid {
                grid-template-columns: 1fr;
                gap: 0.4rem;
            }
            .grade-btn {
                padding: 0.75rem 0.5rem;
                min-height: 70px;
                font-size: 0.8rem;
            }
            .lesson-btn {
                padding: 0.6rem 0.4rem;
                min-height: 50px;
                font-size: 0.75rem;
            }
            .grammar-btn {
                padding: 0.5rem 0.3rem;
                min-height: 45px;
                font-size: 0.7rem;
            }
            .timer-display {
                font-size: 1.25rem;
                padding: 0.5rem;
                min-width: 60px;
            }
            .quiz-question {
                font-size: 1rem !important;
                padding: 1rem !important;
            }
            .answer-display {
                padding: 1.5rem;
                min-height: 150px;
                max-height: 300px;
            }
            .answer-text {
                font-size: 1.2rem;
                padding: 0.75rem;
            }
            .explanation-text {
                font-size: 1rem;
            }
            .fixed-header {
                top: 0.5rem;
                padding: 0.6rem 1.2rem;
                gap: 0.8rem;
            }
            .header-stat-item {
                min-width: 50px;
                padding: 0.3rem 0.5rem;
                gap: 0.3rem;
                border-radius: 14px;
            }
            .header-stat-number {
                font-size: 0.8rem;
            }
            .header-stat-emoji {
                font-size: 0.95rem;
            }
            .header-nav-item {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .voice-choice-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .voice-choice-btn {
                min-height: 70px;
                padding: 0.5rem 0.4rem;
            }
            
            .device-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .voice-gender-icon {
                font-size: 1.2rem;
            }
            
            .voice-gender-label {
                font-size: 0.75rem;
            }
            
            .voice-gender-description {
                font-size: 0.6rem;
            }
        }
        
        button, .grade-btn, .lesson-btn, .grammar-btn, .warm-button, .back-button, .mode-btn, .direction-btn, .timer-btn, .show-answer-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }
        
        * {
            touch-action: manipulation;
        }
        
        input, select, textarea {
            font-size: 16px;
        }

        .sparkle {
            position: relative;
            overflow: visible;
        }
        .sparkle::before,
        .sparkle::after {
            content: '‚ú®';
            position: absolute;
            opacity: 0;
            animation: sparkleFloat 3s infinite ease-in-out;
        }
        .sparkle::before {
            top: -10px;
            left: -10px;
            animation-delay: 0s;
        }
        .sparkle::after {
            bottom: -10px;
            right: -10px;
            animation-delay: 1.5s;
        }
        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
            50% { opacity: 1; transform: translateY(-20px) scale(1.2); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 relative">
    <!-- „É°„Ç§„É≥Â≠¶Âπ¥ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="mainGradeModal" class="modal show">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h1 class="game-title sparkle">üåç ONE WORLD Quiz ‚ú®</h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üéì Â≠¶Âπ¥„ÇíÈÅ∏Êäû„Åó„Çà„ÅÜ
                </h2>
                <p class="text-gray-600 text-sm mb-4">„ÅÇ„Å™„Åü„ÅÆÂ≠¶Áøí„É¨„Éô„É´„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                
                <div class="grid grade-grid mb-6">
                    <button class="grade-btn" data-grade="grade1">
                        <div class="text-3xl mb-1">üå±</div>
                        <div class="font-semibold text-sm">‰∏≠Â≠¶1Âπ¥Áîü</div>
                    </button>
                    <button class="grade-btn" data-grade="grade2">
                        <div class="text-3xl mb-1">üåø</div>
                        <div class="font-semibold text-sm">‰∏≠Â≠¶2Âπ¥Áîü</div>
                    </button>
                    <button class="grade-btn" data-grade="grade3">
                        <div class="text-3xl mb-1">üå≥</div>
                        <div class="font-semibold text-sm">‰∏≠Â≠¶3Âπ¥Áîü</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏≠Â≠¶1Âπ¥Áîü„É¨„ÉÉ„Çπ„É≥ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="grade1Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üå± ‰∏≠Â≠¶1Âπ¥Áîü„ÅÆ„É¨„ÉÉ„Çπ„É≥
                </h2>
                <p class="text-gray-600 text-sm mb-4">Â≠¶Áøí„Åó„Åü„ÅÑ„É¨„ÉÉ„Çπ„É≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                
                <div class="grid lesson-grid mb-6" id="grade1Lessons">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons1" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        üöÄ ÈÅ∏Êäû„Åó„Å¶„É¨„ÉÉ„Çπ„É≥„Çπ„Çø„Éº„ÉàÔºÅ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏≠Â≠¶2Âπ¥Áîü„É¨„ÉÉ„Çπ„É≥ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="grade2Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üåø ‰∏≠Â≠¶2Âπ¥Áîü„ÅÆ„É¨„ÉÉ„Çπ„É≥
                </h2>
                <p class="text-gray-600 text-sm mb-4">Â≠¶Áøí„Åó„Åü„ÅÑ„É¨„ÉÉ„Çπ„É≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                
                <div class="grid lesson-grid mb-6" id="grade2Lessons">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons2" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        üöÄ ÈÅ∏Êäû„Åó„Å¶„É¨„ÉÉ„Çπ„É≥„Çπ„Çø„Éº„ÉàÔºÅ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ‰∏≠Â≠¶3Âπ¥Áîü„É¨„ÉÉ„Çπ„É≥ÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="grade3Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üå≥ ‰∏≠Â≠¶3Âπ¥Áîü„ÅÆ„É¨„ÉÉ„Çπ„É≥
                </h2>
                <p class="text-gray-600 text-sm mb-4">Â≠¶Áøí„Åó„Åü„ÅÑ„É¨„ÉÉ„Çπ„É≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                
                <div class="grid lesson-grid mb-6" id="grade3Lessons">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons3" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        üöÄ ÈÅ∏Êäû„Åó„Å¶„É¨„ÉÉ„Çπ„É≥„Çπ„Çø„Éº„ÉàÔºÅ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊñáÊ≥ïÈ†ÖÁõÆÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="grammarModal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 id="grammarModalTitle" class="text-lg font-semibold mb-3 text-gray-700"></h2>
                <p class="text-gray-600 text-sm mb-4">Â≠¶Áøí„Åô„ÇãÂÜÖÂÆπ„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                
                <div class="grid grammar-grid mb-4" id="grammarCategories">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startGrammarQuiz" class="warm-button px-8 py-3 text-sm sparkle" disabled>
                        üöÄ „ÇØ„Ç§„Ç∫„Çπ„Çø„Éº„ÉàÔºÅ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- üîß Èü≥Â£∞Ë®≠ÂÆö„É¢„Éº„ÉÄ„É´Ôºà„Ç≥„É≥„Éë„ÇØ„ÉàÁâà„ÉªÂÖ®„Éá„Éê„Ç§„ÇπÂØæÂøúÔºâ -->
    <div id="voiceSettingsModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">
                    üé§ Èü≥Â£∞Ë®≠ÂÆö
                </h2>
                
                <!-- Èü≥Â£∞ON/OFFÂàá„ÇäÊõø„Åà -->
                <div class="voice-toggle">
                    <div class="text-sm font-semibold text-gray-700 mb-2">üîä Èü≥Â£∞Ê©üËÉΩ</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="text-xs text-gray-600 mt-2" id="voiceToggleDescription">Èü≥Â£∞Ê©üËÉΩ„ÅåÊúâÂäπ„Åß„Åô</div>
                </div>
                
                <!-- üîß „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®Èü≥Â£∞Ôºà„Ç≥„É≥„Éë„ÇØ„ÉàÁâàÔºâ -->
                <div id="deviceRecommendations">
                    <!-- JavaScript„ÅßÂãïÁöÑ„Å´ÁîüÊàê -->
                </div>
                
                <div class="text-center mt-4">
                    <button class="warm-button px-6 py-2 text-sm" onclick="closeVoiceSettings()">
                        ‚úÖ Ë®≠ÂÆöÂÆå‰∫Ü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen" class="hidden">
        <div class="warm-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title sparkle">üåç ONE WORLD Quiz ‚ú®</h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4"></div>
            <div class="stats-display">
                <div class="grid grid-cols-2 gap-4 text-center mb-4">
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="studyCount">0</div>
                        <div class="text-xs text-gray-600">üìö Â≠¶ÁøíÂõûÊï∞</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="clickCount">0</div>
                        <div class="text-xs text-gray-600">üñ±Ô∏è „Çª„ÉÉ„Ç∑„Éß„É≥</div>
                    </div>
                </div>
                
                <!-- Âà∂ÈôêÊôÇÈñìË®≠ÂÆöÔºà4„Å§„ÅÆ„Éú„Çø„É≥„Çí2x2„Ç∞„É™„ÉÉ„Éâ„ÅßÁµ±‰∏ÄÔºâ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">‚è∞ Âà∂ÈôêÊôÇÈñìË®≠ÂÆö</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="timer3Btn" class="timer-btn active" data-time="3">
                            ‚ö° 3Áßí
                        </button>
                        <button id="timer5Btn" class="timer-btn" data-time="5">
                            üî• 5Áßí
                        </button>
                        <button id="timer10Btn" class="timer-btn" data-time="10">
                            üåü 10Áßí
                        </button>
                        <button id="timerUnlimitedBtn" class="timer-btn" data-time="unlimited">
                            ‚àû ÁÑ°Âà∂Èôê
                        </button>
                    </div>
                </div>
                
                <!-- Âá∫È°åÂΩ¢ÂºèÈÅ∏Êäû -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">üé≤ Âá∫È°å„Çπ„Çø„Ç§„É´</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="randomModeBtn" class="mode-btn active" data-mode="random">
                            üéØ „É©„É≥„ÉÄ„É†
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn" data-mode="sequential">
                            üìñ È†ÜÁï™ÈÄö„Çä
                        </button>
                    </div>
                </div>

                <!-- Âá∫È°åÊñπÂêëÈÅ∏Êäû -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">üåè Ë®ÄË™ûÊñπÂêë</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="jpToEnBtn" class="direction-btn active" data-direction="jp_to_en">
                            üáØüáµ‚Üíüá∫üá∏
                        </button>
                        <button id="enToJpBtn" class="direction-btn" data-direction="en_to_jp">
                            üá∫üá∏‚ÜíüáØüáµ
                        </button>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <button id="mixedBtn" class="direction-btn" data-direction="mixed">
                            üîÄ „Éü„ÉÉ„ÇØ„Çπ„É¢„Éº„Éâ
                        </button>
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="warm-button px-8 py-4 text-base font-semibold mt-6 sparkle">
                üåü „É¨„ÉÉ„ÉÑ„Çπ„Çø„Éº„ÉàÔºÅ
            </button>
        </div>
    </div>

    <!-- „ÇØ„Ç§„Ç∫„É¢„Éº„ÉÄ„É´ -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-4 w-full max-w-lg mx-4">
                <div class="text-center mb-4">
                    <h2 class="font-semibold text-lg text-gray-700">
                        üåç ONE WORLD Quiz Challenge
                    </h2>
                    <div class="flex items-center justify-between mt-2">
                        <div id="remainingCount" class="text-sm text-gray-600"></div>
                        <div id="timerDisplay" class="timer-display timer-normal">
                            <span id="timerValue">Ê∫ñÂÇô‰∏≠</span>
                        </div>
                    </div>
                </div>
                
                <!-- ÂïèÈ°åË°®Á§∫„Ç®„É™„Ç¢ -->
                <div id="quizQuestion" class="quiz-question"></div>
                
                <!-- Ëß£Á≠îË°®Á§∫„Éú„Çø„É≥ -->
                <div class="text-center">
                    <button id="showAnswerBtn" class="show-answer-btn">
                        üí° Ëß£Á≠î„ÇíË¶ã„Çã
                    </button>
                </div>
                
                <!-- Ëß£Á≠î„ÉªËß£Ë™¨Ë°®Á§∫„Ç®„É™„Ç¢ÔºàÊã°Â§ßÁâàÔºâ -->
                <div id="answerDisplay" class="answer-display">
                    <div id="answerContent">
                        <div class="text-gray-500" style="text-align: center;">È†≠„ÅßËÄÉ„Åà„Å¶„Åã„ÇâËß£Á≠î„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Å≠ÔºÅ</div>
                    </div>
                </div>
                
                <!-- Êìç‰Ωú„Éú„Çø„É≥ -->
                <div class="flex gap-2 mt-4">
                    <button id="quizNext" class="flex-1 warm-button py-3 text-sm" disabled>
                        ‚≠ê Ê¨°„ÅÆ„ÉÅ„É£„É¨„É≥„Ç∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éò„ÉÉ„ÉÄ„ÉºÔºàÂÖÉ„Éï„ÉÉ„Çø„ÉºÔºâ -->
    <div class="fixed-header">
        <!-- „Éõ„Éº„É†„Éú„Çø„É≥ -->
        <div class="header-nav-item home" id="footerHomeBtn" title="„Éõ„Éº„É†ÁîªÈù¢„Å´Êàª„Çã">
            üè†
        </div>
        
        <!-- Êàª„Çã„Éú„Çø„É≥ -->
        <div class="header-nav-item back" id="footerBackBtn" title="Ââç„ÅÆÁîªÈù¢„Å´Êàª„Çã">
            ‚óÄÔ∏é
        </div>
        
        <!-- Á∑è„ÇØ„É™„ÉÉ„ÇØÁµ±Ë®à -->
        <div class="header-stat-item" id="footerTotalStat" title="„Çø„ÉÉ„Éó„Åß„É™„Çª„ÉÉ„ÉàÁ¢∫Ë™ç">
            <span class="header-stat-emoji">üèÜ</span>
            <span class="header-stat-number" id="footerTotalClick">0</span>
        </div>
        
        <!-- ‰ªäÊó•„ÅÆ„ÇØ„É™„ÉÉ„ÇØÁµ±Ë®à -->
        <div class="header-stat-item" id="footerTodayStat" title="„Çø„ÉÉ„Éó„Åß„É™„Çª„ÉÉ„ÉàÁ¢∫Ë™ç">
            <span class="header-stat-emoji">üìÖ</span>
            <span class="header-stat-number" id="footerTodayClick">0</span>
        </div>
        
        <!-- Èü≥Â£∞Ë®≠ÂÆö„Éú„Çø„É≥ -->
        <div class="header-nav-item voice" id="footerVoiceBtn" title="Èü≥Â£∞Ë®≠ÂÆö">
            üé§
        </div>
    </div>

<script>
        /* ----------------- „É¨„ÉÉ„Çπ„É≥„ÉªÊñáÊ≥ïÈ†ÖÁõÆÂÆöÁæ©ÔºàÂÆåÂÖ®ÁâàÔºâ ----------------- */
        const lessons = {
            grade1: [
                {
                    id: 'lesson1',
                    name: 'Lesson1 - Êñá„ÅÆÂü∫Êú¨',
                    grammar: [
                        {id: 'word_order', name: '1. Êó•Êú¨Ë™û„Å®Ëã±Ë™û„ÅÆË™ûÈ†Ü'},
                        {id: 'sentence_types', name: '2. Ëã±Ë™û„ÅÆÊñá„ÅÆ‰ª£Ë°®ÁöÑ„Å™2„Å§„ÅÆÂûã'},
                        {id: 'personal_statements', name: '3. Ëá™ÂàÜ„ÅÆ„Åì„Å®„ÇíËø∞„Åπ„Åü„ÇäÁõ∏Êâã„ÅÆ„Åì„Å®„Çí„Åü„Åö„Å≠„Çã'},
                        {id: 'various_questions', name: '4. „Åï„Åæ„Åñ„Åæ„Å™ÁñëÂïèÊñá'},
                        {id: 'requests', name: '5. „ÅäÈ°ò„ÅÑ„Åô„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ‰ª£ÂêçË©û',
                    grammar: [
                        {id: 'she_he_it', name: '1. she, he, it „Å™„Å©„ÅÆ‰Ωø„ÅÑÊñπ'},
                        {id: 'pronoun_questions', name: '2. she, he „Å™„Å©„Çí‰Ωø„Å£„ÅüÊñá„ÅÆÁñëÂïèÊñá'},
                        {id: 'this_that', name: '3. this „Å® that „ÅÆ‰Ωø„ÅÑÊñπ'},
                        {id: 'this_that_questions', name: '4. this, that „Çí‰Ωø„Å£„ÅüÊñá„ÅÆÁñëÂïèÊñá'},
                        {id: 'we_you_they', name: '5. We, you, they „ÅÆ‰Ωø„ÅÑÊñπ'},
                        {id: 'can_usage', name: '6. can „ÅÆÊÑèÂë≥„Å®Áî®Ê≥ï'},
                        {id: 'some_any', name: '7. some „Å® any'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ‰∏ÄËà¨ÂãïË©û',
                    grammar: [
                        {id: 'general_verbs', name: '1. ‰∏ÄËà¨ÂãïË©û„Å´„ÅØ„ÄÅ„Å©„Çì„Å™„ÇÇ„ÅÆ„Åå„ÅÇ„ÇãÔºü'},
                        {id: 'verb_s_es', name: '2. ‰∏ÄËà¨ÂãïË©û„Å´„Å§„Åè s, es'},
                        {id: 'verb_s_es_rules', name: '3. ‰∏ÄËà¨ÂãïË©û„ÅÆ s, es „ÅÆ„Å§„ÅëÊñπ'},
                        {id: 'noun_singular_plural', name: '4. „Äå1„Å§ÔºàÂçòÊï∞Ôºâ„Äç„Å™„ÅÆ„Åã„Äå2„Å§‰ª•‰∏äÔºàË§áÊï∞Ôºâ„Äç„Å™„ÅÆ„Åã„ÇíË°®„ÅôÂêçË©û„Å´„Å§„Åè s, es'},
                        {id: 'plural_rules', name: '5. Ë§áÊï∞ÂΩ¢„ÅÆ„Å§„Åè„ÇäÊñπ'},
                        {id: 'pronoun_i', name: '6. „ÄåÁßÅ„Äç„ÇíË°®„Åô2„Å§„ÅÆÂΩ¢'},
                        {id: 'pronoun_cases', name: '7. ‰∏ªË™û„Å®„Åó„Å¶‰Ωø„ÅÜÂ†¥Âêà„Å®‰∏ªË™û‰ª•Â§ñ„Åß‰Ωø„ÅÜ„Äå„ÅÇ„Å™„Åü„Äç„ÄåÂΩº„Äç„Å™„Å©'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - ÈÅéÂéªÂΩ¢',
                    grammar: [
                        {id: 'past_statements', name: '1. ÈÅéÂéª„ÅÆ„Åì„Å®„ÇíË®Ä„ÅÜ„Å®„Åç'},
                        {id: 'past_questions', name: '2. ÈÅéÂéª„ÅÆ„Åì„Å®„Çí„Åü„Åö„Å≠„Çã„Å®„ÅçÔºàÁñëÂïèÊñáÔºâ'},
                        {id: 'past_negative', name: '3. ÈÅéÂéª„ÅÆ„Åì„Å®„Åß„Äå„Åó„Å™„Åã„Å£„Åü„Äç„Äå„Åß„Å™„Åã„Å£„Åü„Äç„Åì„Å®„ÇíË®Ä„ÅÜ„Å®„ÅçÔºàÂê¶ÂÆöÊñáÔºâ'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ÁèæÂú®ÈÄ≤Ë°åÂΩ¢',
                    grammar: [
                        {id: 'present_continuous', name: '1. ‰ªä„Åó„Å¶„ÅÑ„Çã„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'present_continuous_negative', name: '2. „Äå„Äú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„Äç„Å®„ÅÑ„ÅÜ„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'present_continuous_questions', name: '3. „Äå„Äú„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„Åã„Äç„ÄÅ„Äå‰Ωï„Çí„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„Åã„Äç„Å®Ë≥™Âïè„Åô„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ÁñëÂïèË©û',
                    grammar: [
                        {id: 'why_because', name: '1. „ÄåÁêÜÁî±„Äç„ÇíË≥™Âïè„Åô„Çã„Å®„Åç„ÄÅ„ÄåÁêÜÁî±„Äç„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'how_often', name: '2. „Äå„Å©„ÅÆ„Åè„Çâ„ÅÑ„Çà„Åè„Äú„Åô„Çã„Åã„Äç„ÇíË≥™Âïè„Åô„Çã„Å®„Åç„ÄÅÁ≠î„Åà„Çã„Å®„Åç'},
                        {id: 'which_who_whose', name: '3. „Äå„Å©„ÅÆ„Äú„Äç„ÇíË≥™Âïè„Åô„Çã„Å®„Åç„ÄÅ„Äå„Å©„Å°„Çâ„Çí„Äç„Äå„Å†„Çå„Åå„Äç„Äå„Å†„Çå„ÅÆ„Äú„Äç„ÇíË≥™Âïè„Åô„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - Âä©ÂãïË©û',
                    grammar: [
                        {id: 'must_prohibition', name: '1. „ÄåÂº∑„ÅÑÂëΩ‰ª§„Äç„ÇÑ„ÄåÁ¶ÅÊ≠¢„Äç„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'have_to_necessity', name: '2. „Äå„Äú„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Äç„Äå„Äú„Åô„ÇãÂøÖË¶Å„ÅØ„Å™„ÅÑ„Äç„Å®‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'may_able_to', name: '3. „Äå„Äú„Åã„ÇÇ„Åó„Çå„Å™„ÅÑ„Äç„Å®Ëø∞„Åπ„Çã„Å®„Åç„ÄÅ„Äå„Äú„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Çã„Äç„Å®Ëø∞„Åπ„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - Êú™Êù•Ë°®Áèæ',
                    grammar: [
                        {id: 'be_going_to', name: '1. ‰∫àÂÆö„ÇÑË®àÁîª„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'will_prediction', name: '2. Êú™Êù•„ÅÆ„Åì„Å®„Å´„Å§„ÅÑ„Å¶„Äå„Äú„Å†„Çç„ÅÜ„Äç„Å®„ÅÑ„ÅÜ‰∫àÊÉ≥„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'should', name: '3. „Äå„Äú„Åô„Åπ„Åç„Å†„Äç„Å®Ëø∞„Åπ„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - There is/areÊñá',
                    grammar: [
                        {id: 'there_is_are', name: '1. „Äå„Äú„Å´„Éª„Éª„Éª„Åå„ÅÇ„ÇãÔºà„ÅÑ„ÇãÔºâ„Äç„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'there_is_are_questions', name: '2. „Äå„Äú„Å´„Éª„Éª„Éª„ÅØ„ÅÇ„Çä„Åæ„Åô„Åã„Äç„Äå„Äú„Å´„Éª„Éª„Éª„ÅØ„ÅÑ„Åè„Å§„ÅÇ„Çä„Åæ„Åô„Åã„Äç„Å®Ë≥™Âïè„Åô„ÇãÂ†¥Âêà'},
                        {id: 'look_sound', name: '3. „Äå„Äú„Åù„ÅÜ„Å´Ë¶ã„Åà„ÇãÔºèËÅû„Åì„Åà„Çã„Äç„Å®Ëø∞„Åπ„Çã„Å®„Åç'}
                    ]
                }
            ],
            grade2: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 1Âπ¥Áîü„ÅÆÂæ©Áøí',
                    grammar: [
                        {id: 'have_to_must_review', name: '1. „Äå„Äú„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çã„Äç„ÇÑ„ÄåÂº∑„ÅÑÂëΩ‰ª§„Äç„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàhave [has] to „Å® mustÔºâ'},
                        {id: 'future_review', name: '2. ‰∫àÂÆö„ÇÑÊú™Êù•„Å´„Å§„ÅÑ„Å¶„ÅÆ‰∫àÊÉ≥„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàbe going to „Å® willÔºâ'},
                        {id: 'there_is_are_review', name: '3. „ÇÇ„ÅÆ„Åå„ÅÇ„Çã„Åì„Å®„ÇÑ„ÄÅ‰∫∫„Åå„ÅÑ„Çã„Åì„Å®„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàThere is [are] ~.Ôºâ'},
                        {id: 'there_is_are_transformation', name: '4. There is [are] ~. „ÅÆÊñá„ÅÆÊõ∏„ÅçÊèõ„Åà'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ÁõÆÁöÑË™û2„Å§/Êé•Á∂öË©ûthat',
                    grammar: [
                        {id: 'double_object', name: '1. „ÄåÔºú‰∫∫Ôºû„Å´Ôºú„ÇÇ„ÅÆÔºû„Çí„ÅÇ„Åí„Çã„ÉªÈÄÅ„Çã„Äç„Å™„Å©„Å®Ëø∞„Åπ„Çã„Å®„ÅçÔºàÁõÆÁöÑË™û„ÇíÔºí„Å§„Å®„ÇãÂãïË©ûÔºâ'},
                        {id: 'that_opinion', name: '2. Ëá™ÂàÜ„ÅÆÊÑèË¶ã„ÇÑÁü•„Å£„Å¶„ÅÑ„Çã„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÊé•Á∂öË©û„ÅÆthatÔºâ'},
                        {id: 'that_feeling', name: '3. Ëá™ÂàÜ„ÅÆÊ∞óÊåÅ„Å°„Å®„Åù„ÅÆÁêÜÁî±„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÊé•Á∂öË©û„ÅÆthatÔºâ'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ÈÅéÂéªÈÄ≤Ë°åÂΩ¢/Êé•Á∂öË©û',
                    grammar: [
                        {id: 'past_continuous', name: '1. ÈÅéÂéª„ÅÆ„ÅÇ„ÇãÊôÇÁÇπ„Åß„Åó„Å¶„ÅÑ„Åü„Åì„Å®„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÈÅéÂéªÈÄ≤Ë°åÂΩ¢Ôºâ'},
                        {id: 'when_conjunction', name: '2. „Å©„Çì„Å™ÊôÇ„ÅÆ„Åì„Å®„Åã„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÊé•Á∂öË©û„ÅÆwhenÔºâ'},
                        {id: 'if_because', name: '3. Êù°‰ª∂„ÇíËø∞„Åπ„Çã„Å®„Åç„ÄÅÁêÜÁî±„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÊé•Á∂öË©û„ÅÆifÔºâ'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ‰∏çÂÆöË©û',
                    grammar: [
                        {id: 'infinitive_noun', name: '1. „Åó„Åü„ÅÑ„Åì„Å®„ÄÅ„Å™„Çä„Åü„ÅÑ„ÇÇ„ÅÆ„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÂêçË©ûÁöÑÁî®Ê≥ï„Äå„Äú„Åô„Çã„Åì„Å®„ÄçÔºâ'},
                        {id: 'infinitive_adverb', name: '2. ÁõÆÁöÑ„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÂâØË©ûÁöÑÁî®Ê≥ï„Äå„Äú„Åô„Çã„Åü„ÇÅ„Å´„ÄçÔºâ'},
                        {id: 'infinitive_adjective', name: '3. „Äå„ÇÇ„ÅÆ„ÅÆÁî®ÈÄî„ÄÅ‰Ωï„Çí„Åô„Çã„Åü„ÇÅ„ÅÆ„ÇÇ„ÅÆ„Åã„Äç„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÂΩ¢ÂÆπË©ûÁöÑÁî®Ê≥ï„Äå„Äú„Åô„Çã„Åü„ÇÅ„ÅÆ„ÄçÔºâ'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - ÂãïÂêçË©û',
                    grammar: [
                        {id: 'gerund_object', name: '1. „Äå„Äú„Åô„Çã„Åì„Å®„ÇíÁµÇ„Åà„Çã„ÉªÊ•Ω„Åó„ÇÄ„ÉªÂ•Ω„ÇÄ„Äç„Å™„Å©„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÂãïÂêçË©ûÔºâ'},
                        {id: 'gerund_subject', name: '2. „Äå„Äú„Åô„Çã„Åì„Å®„Äç„Çí‰∏ªË™û„Å´„Åó„Å¶Ëø∞„Åπ„Çã„Å®„ÅçÔºàÂãïÂêçË©ûÔºâ'},
                        {id: 'teach_tell_that', name: '3. „Äå„Å†„Çå„Åå„Å†„Çå„Å´„Å©„Çì„Å™„Åì„Å®„ÇíÊïô„Åà„Åü„Åã„Éª‰ºù„Åà„Åü„Åã„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàÊé•Á∂öË©û„ÅÆthatÔºâ'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ‰∏çÂÆöË©û„ÅÆÁô∫Â±ï',
                    grammar: [
                        {id: 'how_to_what_to', name: '1. „Äå„Äú„ÅÆ‰ªïÊñπ„Äç„ÇÑ„Äå„Åô„Åπ„Åç„Åì„Å®„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'it_is_to', name: '2. „Äå„Äú„Åô„Çã„Åì„Å®„ÅØ„Åä„ÇÇ„Åó„Çç„ÅÑ„ÉªÈõ£„Åó„ÅÑ„Éª‰∏çÂèØËÉΩ„Å†„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„ÅçÔºàIt is + ÂΩ¢ÂÆπË©û + to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äú.Ôºâ'},
                        {id: 'teach_ask_how_to', name: '3. „Äå„Å†„Çå„Å´„Äú„ÅÆ‰ªïÊñπ„ÄÅ‰Ωï„Çí„Åô„Åπ„Åç„Åã„Å™„Å©„Çí‰ºù„Åà„Çã„ÉªÊïô„Åà„Çã„Éª„Åü„Åö„Å≠„Çã„Åã„Äç„ÇíËø∞„Åπ„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ÊØîËºÉ',
                    grammar: [
                        {id: 'comparative', name: '1. 2„Å§„ÅÆ„ÇÇ„ÅÆ„ÇíÊØî„Åπ„Å¶„ÄÅ„Åù„ÅÆÈÅï„ÅÑ„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÊØîËºÉÁ¥öÔºâ'},
                        {id: 'superlative', name: '2. 3„Å§‰ª•‰∏ä„ÅÆ„ÇÇ„ÅÆ„ÇíÊØî„Åπ„Å¶„ÄÅ„Äå„ÅÑ„Å°„Å∞„Çì„Äú„Å†„Äç„Å®‰ºù„Åà„Çã„Å®„ÅçÔºàÊúÄ‰∏äÁ¥öÔºâ'},
                        {id: 'as_as', name: '3. „ÄåÂêå„Åò„Åè„Çâ„ÅÑ„Äú„Å†„Äç„Äå„ÅÑ„Å°„Å∞„ÇìÂ•Ω„Åç„Å†„Äç„Å™„Å©„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÂéüÁ¥ö„Å™„Å©Ôºâ'},
                        {id: 'comparison_rules', name: '4. ÊØîËºÉÁ¥ö„ÉªÊúÄ‰∏äÁ¥ö„ÅÆ‰Ωú„ÇäÊñπ'},
                        {id: 'comparison_transformation', name: '5. ÊØîËºÉË°®Áèæ„ÅÆÊõ∏„ÅçÊèõ„Åà'},
                        {id: 'comparison_notes', name: '6. „Åù„ÅÆ‰ªñ„Å´Ê≥®ÊÑè„Åô„Çã„Åì„Å®'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - ÂèóÂãïÊÖã',
                    grammar: [
                        {id: 'passive_voice', name: '1. „Äå...„ÅØ„Äú„Åï„Çå„Çã„Äç„Äå...„ÅØ„Äú„Åï„Çå„Å¶„ÅÑ„Çã„Äç„ÅÆ„Çà„ÅÜ„Å™Ë°®Áèæ„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'passive_questions', name: '2. „Äå‚Ä¶„ÅØ„Äú„Åï„Çå„Åæ„Åô„Åã„Äç„Äå...„ÅØ„Äú„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„Åã„Äç„Å™„Å©„Å®Ë≥™Âïè„Åô„Çã„Å®„Åç'},
                        {id: 'passive_modal', name: '3. „Äå„Äú„Åï„Çå„Çã„Åπ„Åç„Å†„Äç„Äå„Äú„Åï„Çå„Çã„Åì„Å®„ÅåÂèØËÉΩ„Å†„Äç„Å™„Å©„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'past_participle_rules', name: '4. ÈÅéÂéªÂàÜË©ûÂΩ¢„ÅÆ‰Ωú„ÇäÊñπ'},
                        {id: 'passive_transformation', name: '5. Âèó„ÅëË∫´„ÅÆÊñá„ÅÆÊõ∏„ÅçÊèõ„Åà‰æã'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - ÈñìÊé•ÁñëÂïèÊñá/ÊÑüÂòÜÊñá',
                    grammar: [
                        {id: 'indirect_questions_know', name: '1. „Äå„ÅÑ„Å§„Éª„Å©„Åì„Åß„Äç„Å™„Å©„ÅÆÊÉÖÂ†±„Çí„ÄåÁü•„Å£„Å¶„ÅÑ„Çã„ÉªÁü•„Çâ„Å™„ÅÑ„Äç„Å™„Å©„Å®Ë°®Áèæ„Åô„Çã„Å®„Åç'},
                        {id: 'indirect_questions_tell', name: '2. „Äå„ÅÑ„Å§„Éª„Å©„Åì„Åß„Äç„Å™„Å©„ÅÆÊÉÖÂ†±„Çí„Äå„Å†„Çå„Å´Ë®Ä„Å£„Åü„Åã„ÉªËÅû„ÅÑ„Åü„Åã„Äç„Å™„Å©„Å®Ë°®Áèæ„Åô„Çã„Å®„Åç'},
                        {id: 'exclamatory', name: '3. È©ö„Åç„ÇÑÊÑüÂãï„ÇíË°®Áèæ„Åô„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - ÂãïË©û„ÅÆÊßò„ÄÖ„Å™‰Ωø„ÅÑÊñπ',
                    grammar: [
                        {id: 'make_call', name: '1. „Äå„Å©„Çì„Å™Ê∞óÊåÅ„Å°„Å´„Å™„Å£„Åü„Åã„Äç„ÄåÂëº„Å≥Âêç„ÅØ‰Ωï„Åã„Äç„Å™„Å©„Çí‰ºù„Åà„Çã„Å®„Åç'},
                        {id: 'want_ask_to', name: '2. ‰∫∫„Å´„Åó„Å¶„Åª„Åó„ÅÑ„Åì„Å®„Çí‰ºù„Åà„Åü„ÇäÈ†º„Çì„Å†„Çä„Åô„Çã„Å®„Åç'},
                        {id: 'let_help', name: '3. Ë®±ÂèØ„ÇíÂæó„Çã„Å®„Åç„ÄÅ„Å†„Çå„ÅåÊâã‰ºù„Å£„Å¶„Åè„Çå„Çã„ÅÆ„Åã„ÇíËø∞„Åπ„Çã„Å®„Åç'}
                    ]
                }
            ],
            grade3: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 2Âπ¥Áîü„ÅÆÂæ©Áøí',
                    grammar: [
                        {id: 'how_to_what_to_review', name: '1. „Äå„Äú„ÅÆ‰ªïÊñπ„Äç„ÇÑ„Äå„Åô„Åπ„Åç„Åì„Å®„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'make_call_review', name: '2. „ÄåÂëº„Å≥Âêç„ÅØ‰Ωï„Åã„Äç„Äå„Å©„Çì„Å™Ê∞óÊåÅ„Å°„Å´„Å™„Å£„Åü„Åã„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„Åç'},
                        {id: 'it_is_to_review', name: '3. „Äå„Äú„Åô„Çã„Åì„Å®„ÅØÈõ£„Åó„ÅÑ„Éª„ÇÑ„Åï„Åó„ÅÑ„Äç„Å™„Å©„ÇíËø∞„Åπ„Çã„Å®„Åç'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ÁèæÂú®ÂÆå‰∫ÜÂΩ¢(1)',
                    grammar: [
                        {id: 'present_perfect_completion', name: '1. „Äå„Äú„ÅóÁµÇ„Åà„Åü„Äç„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÂÆå‰∫ÜÁî®Ê≥ïÔºâ'},
                        {id: 'present_perfect_experience', name: '2. „Äå„Äú„Åó„ÅüÁµåÈ®ì„Åå„ÅÇ„Çã„Äç„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁµåÈ®ìÁî®Ê≥ïÔºâ'},
                        {id: 'present_perfect_experience_questions', name: '3. „Äå„Äú„Åó„ÅüÁµåÈ®ì„Åå„ÅÇ„Çã„Åã„Äç„ÇíË≥™Âïè„Åô„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁµåÈ®ìÁî®Ê≥ïÔºâ'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ÁèæÂú®ÂÆå‰∫ÜÂΩ¢(2)',
                    grammar: [
                        {id: 'present_perfect_continuation', name: '1. „Äå„Åö„Å£„Å®„Äú„Åó„Å¶„ÅÑ„Çã„Äç„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁ∂ôÁ∂öÁî®Ê≥ïÔºâ'},
                        {id: 'present_perfect_continuation_questions', name: '2. „Äå„Å©„ÅÆ„Åè„Çâ„ÅÑ„Äú„Åó„Å¶„ÅÑ„Åæ„Åô„Åã„Äç„Å®Ë≥™Âïè„Åô„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁ∂ôÁ∂öÁî®Ê≥ïÔºâ'},
                        {id: 'present_perfect_continuous', name: '3. „Äå„Åö„Å£„Å®„Äú„Åó„Å¶„ÅÑ„Çã„Äç„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÈÄ≤Ë°åÂΩ¢Ôºâ'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ÂæåÁΩÆ‰øÆÈ£æ',
                    grammar: [
                        {id: 'participle_present', name: '1. „Äå„Å©„Çì„Å™‰∫∫„Åã„Éª„Å©„Çì„Å™„ÇÇ„ÅÆ„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºà„Åù„ÅÆ1ÔºöÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æÔºâ'},
                        {id: 'participle_past', name: '2. „Äå„Å©„Çì„Å™‰∫∫„Åã„Éª„Å©„Çì„Å™„ÇÇ„ÅÆ„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºà„Åù„ÅÆ2ÔºöÈÅéÂéªÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æÔºâ'},
                        {id: 'relative_pronoun_omission', name: '3. „Äå„Å©„Çì„Å™‰∫∫„Åã„Éª„Å©„Çì„Å™„ÇÇ„ÅÆ„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºà„Åù„ÅÆ3ÔºöÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û„ÅÆÁúÅÁï•Ôºâ'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - Èñ¢‰øÇ‰ª£ÂêçË©û',
                    grammar: [
                        {id: 'relative_pronoun_who', name: '1. „Äå„Å©„Çì„Å™‰∫∫„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºà‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©ûÔºâ'},
                        {id: 'relative_pronoun_which', name: '2. „Äå„Å©„Çì„Å™„ÇÇ„ÅÆ„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºà‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©ûÔºâ'},
                        {id: 'relative_pronoun_object', name: '3. „Äå„Å©„Çì„Å™‰∫∫„Åã„Éª„Å©„Çì„Å™„ÇÇ„ÅÆ„Åã„Äç„ÇíË™¨Êòé„Åô„Çã„Å®„ÅçÔºàÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©ûÔºâ'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ‰ªÆÂÆöÊ≥ï',
                    grammar: [
                        {id: 'subjunctive_1', name: '1. ÂÆüÁèæ„Åô„ÇãÂèØËÉΩÊÄß„Åå„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØÂèØËÉΩÊÄß„Åå‰Ωé„ÅÑ„Åì„Å®„Çí„Äå„Äú„Å™„Çâ„Å™„ÅÇ„Äç„Å®Ë°®Áèæ„Åô„ÇãÂ†¥ÂêàÔºà„Åù„ÅÆ1Ôºâ'},
                        {id: 'subjunctive_2', name: '2. ÂÆüÁèæ„Åô„ÇãÂèØËÉΩÊÄß„Åå„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØÂèØËÉΩÊÄß„Åå‰Ωé„ÅÑ„Åì„Å®„Çí„Äå„Äú„Å™„Çâ„Å™„ÅÇ„Äç„Å®Ë°®Áèæ„Åô„ÇãÂ†¥ÂêàÔºà„Åù„ÅÆ2Ôºâ'},
                        {id: 'subjunctive_3', name: '3. ÂÆüÁèæ„Åô„ÇãÂèØËÉΩÊÄß„Åå„Å™„ÅÑ„ÄÅ„Åæ„Åü„ÅØÂèØËÉΩÊÄß„Åå‰Ωé„ÅÑ„Åì„Å®„Çí„Äå„Äú„Å™„Çâ„Å™„ÅÇ„Äç„Å®Ë°®Áèæ„Åô„ÇãÂ†¥ÂêàÔºà„Åù„ÅÆ3Ôºâ'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ÂæåÁΩÆ‰øÆÈ£æ„Å®Èñ¢‰øÇ‰ª£ÂêçË©û„ÅÆ„Åæ„Å®„ÇÅ',
                    grammar: [
                        {id: 'postposition_ing', name: '1. „ÄàÂêçË©û Ôºã ÂãïË©û„ÅÆ-ingÂΩ¢ Ôºã Ë™ûÂè•„ÄâÔºàÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æÔºâ'},
                        {id: 'postposition_past_participle', name: '2. „ÄàÂêçË©û Ôºã ÂãïË©û„ÅÆÈÅéÂéªÂàÜË©ûÂΩ¢ Ôºã Ë™ûÂè•„ÄâÔºàÈÅéÂéªÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æÔºâ'},
                        {id: 'postposition_omission', name: '3. „ÄàÂêçË©û Ôºã ‰∏ªË™û Ôºã ÂãïË©û „Äú„ÄâÔºàÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û„ÅÆÁúÅÁï•Ôºâ'},
                        {id: 'relative_summary', name: '4. „ÄàÂêçË©û Ôºã Èñ¢‰øÇ‰ª£ÂêçË©ûÔºàwho, which, thatÔºâ Ôºã Ë™ûÂè•„ÄâÔºà‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û„Å®ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©ûÔºâ'},
                        {id: 'sentence_transformation', name: '5. Êñá„ÅÆÊõ∏„ÅçÊèõ„Åà'}
                    ]
                }
            ]
        };

        /* ----------------- üîß Êã°ÂÖÖ„Åï„Çå„Åü„Çµ„É≥„Éó„É´ÂïèÈ°å„Éá„Éº„ÇøÔºà‰∏≠3ÂÆåÂÖ®ÂØæÂøúÁâàÔºâ ----------------- */
        const sampleProblems = {
            grade1: {
                lesson1: {
                    word_order: [
                        {
                            jp: "ÁßÅ„ÅØÂ≠¶Áîü„Åß„Åô„ÄÇ",
                            en: "I am a student.",
                            explanation: "Êó•Êú¨Ë™û„ÅÆË™ûÈ†Ü„Å®Ëã±Ë™û„ÅÆË™ûÈ†Ü„ÅÆÈÅï„ÅÑ„ÇíÁêÜËß£„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇËã±Ë™û„Åß„ÅØ„Äå‰∏ªË™û + ÂãïË©û„Äç„ÅÆÈ†ÜÁï™„ÅåÂü∫Êú¨„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÇ„Å™„Åü„ÅØÂÖàÁîü„Åß„Åô„ÅãÔºü",
                            en: "Are you a teacher?",
                            explanation: "ÁñëÂïèÊñá„Åß„ÅØÂãïË©û(beÂãïË©û)„Åå‰∏ªË™û„ÅÆÂâç„Å´Êù•„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØÂåªËÄÖ„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
                            en: "He is not a doctor.",
                            explanation: "Âê¶ÂÆöÊñá„Åß„ÅØ beÂãïË©û„ÅÆÂæå„Å´ not „Çí‰ªò„Åë„Åæ„Åô„ÄÇ"
                        }
                    ],
                    sentence_types: [
                        {
                            jp: "„Åì„Çå„ÅØÊú¨„Åß„Åô„ÄÇ",
                            en: "This is a book.",
                            explanation: "Ëã±Ë™û„ÅÆÂü∫Êú¨ÊñáÂûã„ÅÆ‰∏Ä„Å§„Äå‰∏ªË™û + beÂãïË©û + Ë£úË™û„Äç„ÅÆÂΩ¢„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "ÁßÅ„ÅØËã±Ë™û„ÇíË©±„Åó„Åæ„Åô„ÄÇ",
                            en: "I speak English.",
                            explanation: "„Äå‰∏ªË™û + ÂãïË©û + ÁõÆÁöÑË™û„Äç„ÅÆÊñáÂûã„Åß„Åô„ÄÇ"
                        }
                    ],
                    personal_statements: [
                        {
                            jp: "ÁßÅ„ÅÆÂêçÂâç„ÅØÁî∞‰∏≠„Åß„Åô„ÄÇ",
                            en: "My name is Tanaka.",
                            explanation: "Ëá™Â∑±Á¥π‰ªã„ÅÆÂü∫Êú¨ÁöÑ„Å™Ë°®Áèæ„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÇ„Å™„Åü„ÅÆË∂£Âë≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü",
                            en: "What is your hobby?",
                            explanation: "Áõ∏Êâã„Å´„Å§„ÅÑ„Å¶Ë≥™Âïè„Åô„ÇãÊôÇ„ÅÆË°®Áèæ„Åß„Åô„ÄÇ"
                        }
                    ]
                },
                lesson2: {
                    she_he_it: [
                        {
                            jp: "ÂΩº„ÅØÂåªËÄÖ„Åß„Åô„ÄÇ",
                            en: "He is a doctor.",
                            explanation: "Áî∑ÊÄß„ÇíË°®„ÅôÊôÇ„ÅØhe„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩºÂ•≥„ÅØÁúãË≠∑Â∏´„Åß„Åô„ÄÇ",
                            en: "She is a nurse.",
                            explanation: "Â•≥ÊÄß„ÇíË°®„ÅôÊôÇ„ÅØshe„Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson3: {
                    general_verbs: [
                        {
                            jp: "ÁßÅ„ÅØÊØéÊó•Ëã±Ë™û„ÇíÂãâÂº∑„Åó„Åæ„Åô„ÄÇ",
                            en: "I study English every day.",
                            explanation: "‰∏ÄËà¨ÂãïË©û„ÅØÂãï‰Ωú„ÇÑÁä∂ÊÖã„ÇíË°®„ÅôÂãïË©û„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØÈáéÁêÉ„Çí„Åó„Åæ„Åô„ÄÇ",
                            en: "He plays baseball.",
                            explanation: "‰∏â‰∫∫Áß∞ÂçòÊï∞ÁèæÂú®ÂΩ¢„Åß„ÅØÂãïË©û„Å´ s „Åå‰ªò„Åç„Åæ„Åô„ÄÇ"
                        }
                    ]
                }
            },
            grade2: {
                lesson1: {
                    double_object: [
                        {
                            jp: "ÁßÅ„ÅØÂΩº„Å´Êú¨„Çí„ÅÇ„Åí„Åæ„Åó„Åü„ÄÇ",
                            en: "I gave him a book.",
                            explanation: "ÁõÆÁöÑË™û„Çí2„Å§„Å®„ÇãÂãïË©û„Åß„ÅØ„ÄåÂãïË©û + ‰∫∫ + „ÇÇ„ÅÆ„Äç„ÅÆÈ†ÜÁï™„Å´„Å™„Çä„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩºÂ•≥„ÅØÁßÅ„Å´ÊâãÁ¥ô„ÇíÈÄÅ„Çä„Åæ„Åó„Åü„ÄÇ",
                            en: "She sent me a letter.",
                            explanation: "send „ÅØ„Äå‰∫∫„Å´„ÇÇ„ÅÆ„ÇíÈÄÅ„Çã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß‰Ωø„Çè„Çå„Åæ„Åô„ÄÇ"
                        }
                    ]
                }
            },
            grade3: {
                review_lesson: {
                    how_to_what_to_review: [
                        {
                            jp: "ÁßÅ„ÅØÊ≥≥„ÅéÊñπ„ÇíÁü•„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            en: "I know how to swim.",
                            explanation: "„Äåhow to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå„Äú„ÅÆ‰ªïÊñπ„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "‰Ωï„Çí„Åô„Åπ„Åç„Åã„Çè„Åã„Çä„Åæ„Åõ„Çì„ÄÇ",
                            en: "I don't know what to do.",
                            explanation: "„Äåwhat to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå‰Ωï„Çí„Äú„Åô„Åπ„Åç„Åã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        }
                    ],
                    make_call_review: [
                        {
                            jp: "„Åù„ÅÆÊò†Áîª„ÅØÁßÅ„ÇíÊÇ≤„Åó„Åè„Åï„Åõ„Åæ„Åó„Åü„ÄÇ",
                            en: "The movie made me sad.",
                            explanation: "„Äåmake + ‰∫∫ + ÂΩ¢ÂÆπË©û„Äç„Åß„Äå‰∫∫„Çí„Äú„Å´„Åô„Çã„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å´„Å™„Çä„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÁßÅ„Åü„Å°„ÅØÂΩº„Çí„Éà„É†„Å®Âëº„Å≥„Åæ„Åô„ÄÇ",
                            en: "We call him Tom.",
                            explanation: "„Äåcall + ‰∫∫ + ÂêçÂâç„Äç„Åß„Äå‰∫∫„Çí„Äú„Å®Âëº„Å∂„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Å´„Å™„Çä„Åæ„Åô„ÄÇ"
                        }
                    ],
                    it_is_to_review: [
                        {
                            jp: "Ëã±Ë™û„ÇíÂ≠¶„Å∂„Åì„Å®„ÅØÊ•Ω„Åó„ÅÑ„Åß„Åô„ÄÇ",
                            en: "It is fun to learn English.",
                            explanation: "„ÄåIt is + ÂΩ¢ÂÆπË©û + to + ÂãïË©û„ÅÆÂéüÂΩ¢„Äç„Åß„Äå„Äú„Åô„Çã„Åì„Å®„ÅØ...„Å†„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "Êó©Ëµ∑„Åç„Åô„Çã„Åì„Å®„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Åß„Åô„ÄÇ",
                            en: "It is good for your health to get up early.",
                            explanation: "It „Çí‰ªÆ‰∏ªË™û„Å®„Åó„Å¶‰Ωø„ÅÑ„ÄÅÁúü„ÅÆ‰∏ªË™û„ÅØ to ‰ª•‰∏ã„Å´„Å™„Çä„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson1: {
                    present_perfect_completion: [
                        {
                            jp: "ÁßÅ„ÅØÂÆøÈ°å„ÇíÁµÇ„Åà„Åæ„Åó„Åü„ÄÇ",
                            en: "I have finished my homework.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÂÆå‰∫ÜÁî®Ê≥ï„Åß„ÅØ„Äåhave/has + ÈÅéÂéªÂàÜË©û„Äç„Åß„Äå„Äú„ÅóÁµÇ„Åà„Åü„Äç„Åì„Å®„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØ„ÇÇ„ÅÜÂÆ∂„Å´Â∏∞„Çä„Åæ„Åó„Åü„ÄÇ",
                            en: "He has already gone home.",
                            explanation: "already „Çí‰Ωø„Å£„Å¶„Äå„ÇÇ„ÅÜ„Äú„Åó„Åü„Äç„Åì„Å®„ÇíÂº∑Ë™ø„Åß„Åç„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÁßÅ„ÅØ„Åæ„Å†ÊòºÈ£ü„ÇíÈ£ü„Åπ„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ",
                            en: "I haven't eaten lunch yet.",
                            explanation: "yet „ÅØÂê¶ÂÆöÊñá„Åß„Äå„Åæ„Å†„Äú„Åó„Å¶„ÅÑ„Å™„ÅÑ„Äç„Å®„ÅÑ„ÅÜÊÑèÂë≥„Åß‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ],
                    present_perfect_experience: [
                        {
                            jp: "ÁßÅ„ÅØÊù±‰∫¨„Å´Ë°å„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            en: "I have been to Tokyo.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁµåÈ®ìÁî®Ê≥ï„Åß„Äå„Äú„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØÂØåÂ£´Â±±„ÇíË¶ã„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
                            en: "He has never seen Mt. Fuji.",
                            explanation: "never „Çí‰Ωø„Å£„Å¶„Äå‰∏ÄÂ∫¶„ÇÇ„Äú„Åó„Åü„Åì„Å®„Åå„Å™„ÅÑ„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÇ„Å™„Åü„ÅØÂØøÂè∏„ÇíÈ£ü„Åπ„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÅãÔºü",
                            en: "Have you ever eaten sushi?",
                            explanation: "ever „Çí‰Ωø„Å£„Å¶ÁµåÈ®ì„ÇíÂ∞ã„Å≠„ÇãÁñëÂïèÊñá„Çí‰Ωú„Çä„Åæ„Åô„ÄÇ"
                        }
                    ],
                    present_perfect_experience_questions: [
                        {
                            jp: "„ÅÇ„Å™„Åü„ÅØ‰ΩïÂõûÊó•Êú¨„Å´Êù•„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÅãÔºü",
                            en: "How many times have you been to Japan?",
                            explanation: "„ÄåHow many times + ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„Äç„ÅßÂõûÊï∞„ÇíÂ∞ã„Å≠„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÑ„Å§„Åã„Çâ„Éî„Ç¢„Éé„ÇíÂºæ„ÅÑ„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„ÅãÔºü",
                            en: "How long have you been playing the piano?",
                            explanation: "Á∂ôÁ∂öÁî®Ê≥ï„ÅßÊúüÈñì„ÇíÂ∞ã„Å≠„ÇãÊôÇ„ÅØ How long „Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson2: {
                    present_perfect_continuation: [
                        {
                            jp: "ÁßÅ„ÅØ3Âπ¥ÈñìËã±Ë™û„ÇíÂãâÂº∑„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            en: "I have studied English for three years.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁ∂ôÁ∂öÁî®Ê≥ï„Åß„Äå„Åö„Å£„Å®„Äú„Åó„Å¶„ÅÑ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØÊúàÊõúÊó•„Åã„Çâ„Åö„Å£„Å®ÁóÖÊ∞ó„Åß„Åô„ÄÇ",
                            en: "He has been sick since Monday.",
                            explanation: "since „ÅØ„Äå„Äú„Åã„Çâ„Äç„Å®„ÅÑ„ÅÜËµ∑ÁÇπ„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÁßÅ„Åü„Å°„ÅØÂ≠ê‰æõ„ÅÆÈ†É„Åã„Çâ„ÅÆÂèãÈÅî„Åß„Åô„ÄÇ",
                            en: "We have been friends since we were children.",
                            explanation: "Áä∂ÊÖã„ÅÆÁ∂ôÁ∂ö„ÇíË°®„ÅôÁèæÂú®ÂÆå‰∫ÜÂΩ¢„Åß„Åô„ÄÇ"
                        }
                    ],
                    present_perfect_continuation_questions: [
                        {
                            jp: "„Å©„ÅÆ„Åè„Çâ„ÅÑÈï∑„ÅèÊó•Êú¨„Å´‰Ωè„Çì„Åß„ÅÑ„Åæ„Åô„ÅãÔºü",
                            en: "How long have you lived in Japan?",
                            explanation: "Á∂ôÁ∂öÊúüÈñì„ÇíÂ∞ã„Å≠„ÇãÁñëÂïèÊñá„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÑ„Å§„Åã„Çâ„Åù„ÅÆ‰ºöÁ§æ„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Çã„ÅÆ„Åß„Åô„ÅãÔºü",
                            en: "How long have you worked for that company?",
                            explanation: "work „ÅØÁ∂ôÁ∂ö„ÇíË°®„ÅôÂãïË©û„Å®„Åó„Å¶‰Ωø„Åà„Åæ„Åô„ÄÇ"
                        }
                    ],
                    present_perfect_continuous: [
                        {
                            jp: "Èõ®„Åå2ÊôÇÈñìÈôç„ÇäÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            en: "It has been raining for two hours.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÈÄ≤Ë°åÂΩ¢„ÅßÁ∂ôÁ∂öÁöÑ„Å™Âãï‰Ωú„ÇíÂº∑Ë™ø„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅØÊúù„Åã„Çâ„Åö„Å£„Å®ÂÉç„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            en: "He has been working since this morning.",
                            explanation: "Âãï‰Ωú„ÅÆÁ∂ôÁ∂ö„ÇíË°®„ÅôÁèæÂú®ÂÆå‰∫ÜÈÄ≤Ë°åÂΩ¢„Åß„Åô„ÄÇ"
                        }
                    ]
                },
                lesson3: {
                    participle_present: [
                        {
                            jp: "Ëµ∞„Å£„Å¶„ÅÑ„ÇãÂ∞ëÂπ¥„ÅØÁßÅ„ÅÆÂºü„Åß„Åô„ÄÇ",
                            en: "The boy running is my brother.",
                            explanation: "ÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„Åß„Äå„Äú„Åó„Å¶„ÅÑ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÅÇ„Åù„Åì„ÅßÊ≠å„Å£„Å¶„ÅÑ„ÇãÂ•≥„ÅÆÂ≠ê„ÇíÁü•„Å£„Å¶„ÅÑ„Åæ„Åô„ÅãÔºü",
                            en: "Do you know the girl singing over there?",
                            explanation: "ÁèæÂú®ÂàÜË©û„ÅåÂêçË©û„ÇíÂæå„Çç„Åã„Çâ‰øÆÈ£æ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ],
                    participle_past: [
                        {
                            jp: "Êó•Êú¨„Åß‰Ωú„Çâ„Çå„ÅüËªä„ÅØ‰∫∫Ê∞ó„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            en: "Cars made in Japan are popular.",
                            explanation: "ÈÅéÂéªÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„ÅßÂèó„ÅëË∫´„ÅÆÊÑèÂë≥„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "Â£ä„Çå„ÅüÁ™ì„Çí‰øÆÁêÜ„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            en: "We need to repair the broken window.",
                            explanation: "ÈÅéÂéªÂàÜË©û„ÅåÂêçË©û„Çí‰øÆÈ£æ„Åó„Å¶Áä∂ÊÖã„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        }
                    ],
                    relative_pronoun_omission: [
                        {
                            jp: "ÁßÅ„ÅåÊò®Êó•Ë™≠„Çì„Å†Êú¨„ÅØ„Å®„Å¶„ÇÇÈù¢ÁôΩ„Åã„Å£„Åü„Åß„Åô„ÄÇ",
                            en: "The book I read yesterday was very interesting.",
                            explanation: "ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û which/that „ÅåÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅåË©±„Åó„Å¶„ÅÑ„Åü‰∫∫„ÅØÁßÅ„ÅÆÂÖàÁîü„Åß„Åô„ÄÇ",
                            en: "The person he was talking to is my teacher.",
                            explanation: "ÂâçÁΩÆË©û„ÅÆÁõÆÁöÑË™û„Å´„Å™„ÇãÈñ¢‰øÇ‰ª£ÂêçË©û„ÅåÁúÅÁï•„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson4: {
                    relative_pronoun_who: [
                        {
                            jp: "Ëã±Ë™û„ÇíÊïô„Åà„Çã‰∫∫„ÅØÁßÅ„ÅÆÂÖàÁîü„Åß„Åô„ÄÇ",
                            en: "The person who teaches English is my teacher.",
                            explanation: "‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û who „ÅØ‰∫∫„ÇíÂÖàË°åË©û„Å®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "Êò®Êó•Êù•„ÅüÂ≠¶Áîü„Åü„Å°„ÅØ‰∏≠ÂõΩ„Åã„ÇâÊù•„Åæ„Åó„Åü„ÄÇ",
                            en: "The students who came yesterday are from China.",
                            explanation: "Ë§áÊï∞„ÅÆ‰∫∫„ÇíÂÖàË°åË©û„Å®„Åô„ÇãÂ†¥Âêà„ÇÇ who „Çí‰Ωø„ÅÑ„Åæ„Åô„ÄÇ"
                        }
                    ],
                    relative_pronoun_which: [
                        {
                            jp: "Êú∫„ÅÆ‰∏ä„Å´„ÅÇ„ÇãÊú¨„ÅØÁßÅ„ÅÆ„ÇÇ„ÅÆ„Åß„Åô„ÄÇ",
                            en: "The book which is on the desk is mine.",
                            explanation: "‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û which „ÅØÁâ©„ÇíÂÖàË°åË©û„Å®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅåË≤∑„Å£„ÅüËªä„ÅØËµ§„ÅÑ„Åß„Åô„ÄÇ",
                            en: "The car which he bought is red.",
                            explanation: "which „ÅØ that „Å´ÁΩÆ„ÅçÊèõ„Åà„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô„ÄÇ"
                        }
                    ],
                    relative_pronoun_object: [
                        {
                            jp: "ÁßÅ„Åå‰ºö„Å£„Åü‰∫∫„ÅØ„Å®„Å¶„ÇÇË¶™Âàá„Åß„Åó„Åü„ÄÇ",
                            en: "The person whom I met was very kind.",
                            explanation: "ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û whom „ÅØ‰∫∫„ÇíÂÖàË°åË©û„Å®„Åó„Åæ„ÅôÔºàwho „ÇÇÂèØÔºâ„ÄÇ"
                        },
                        {
                            jp: "ÂΩºÂ•≥„Åå‰Ωú„Å£„ÅüÊñôÁêÜ„ÅØ„Åä„ÅÑ„Åó„Åã„Å£„Åü„Åß„Åô„ÄÇ",
                            en: "The food that she cooked was delicious.",
                            explanation: "ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û that „ÅØ‰∫∫„ÉªÁâ©‰∏°Êñπ„Å´‰Ωø„Åà„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson5: {
                    subjunctive_1: [
                        {
                            jp: "„ÇÇ„Åó„ÅäÈáë„Åå„ÅÇ„Å£„Åü„Çâ„ÄÅÊñ∞„Åó„ÅÑËªä„ÇíË≤∑„ÅÜ„ÅÆ„Å´„ÄÇ",
                            en: "If I had money, I would buy a new car.",
                            explanation: "‰ªÆÂÆöÊ≥ïÈÅéÂéª„ÅßÁèæÂú®„ÅÆ‰∫ãÂÆü„Å´Âèç„Åô„Çã‰ªÆÂÆö„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÇÇ„ÅóÊôÇÈñì„Åå„ÅÇ„Å£„Åü„Çâ„ÄÅ„ÅÇ„Å™„Åü„Å®Ë©±„Åô„ÅÆ„Å´„ÄÇ",
                            en: "If I had time, I would talk with you.",
                            explanation: "ÁèæÂú®„ÅÆ‰∫ãÂÆü„Å´Âèç„Åô„ÇãÈ°òÊúõ„ÇÑ‰ªÆÂÆö„ÇíË°®Áèæ„Åó„Åæ„Åô„ÄÇ"
                        }
                    ],
                    subjunctive_2: [
                        {
                            jp: "„ÇÇ„ÅóÊò®Êó•ÂãâÂº∑„Åó„Å¶„ÅÑ„Åü„Çâ„ÄÅ„ÉÜ„Çπ„Éà„Å´ÂêàÊ†º„Åó„Å¶„ÅÑ„Åü„Å†„Çç„ÅÜ„ÄÇ",
                            en: "If I had studied yesterday, I would have passed the test.",
                            explanation: "‰ªÆÂÆöÊ≥ïÈÅéÂéªÂÆå‰∫Ü„ÅßÈÅéÂéª„ÅÆ‰∫ãÂÆü„Å´Âèç„Åô„Çã‰ªÆÂÆö„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "„ÇÇ„ÅóÊó©„ÅèÂá∫Áô∫„Åó„Å¶„ÅÑ„Åü„Çâ„ÄÅÈÅÖÂàª„Åó„Å™„Åã„Å£„Åü„Å†„Çç„ÅÜ„ÄÇ",
                            en: "If we had left earlier, we wouldn't have been late.",
                            explanation: "ÈÅéÂéª„ÅÆ‰∫ãÂÆü„Å´Âèç„Åô„ÇãÂæåÊÇî„ÇÑ‰ªÆÂÆö„ÇíË°®Áèæ„Åó„Åæ„Åô„ÄÇ"
                        }
                    ],
                    subjunctive_3: [
                        {
                            jp: "ÂΩº„Åå„Åù„Åì„Å´„ÅÑ„Çå„Å∞„ÅÑ„ÅÑ„ÅÆ„Å´„ÄÇ",
                            en: "I wish he were there.",
                            explanation: "wish + ‰ªÆÂÆöÊ≥ï„ÅßÂÆüÁèæÂõ∞Èõ£„Å™È°òÊúõ„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "Èõ®„ÅåÈôç„Çâ„Å™„Åë„Çå„Å∞„ÅÑ„ÅÑ„ÅÆ„Å´„ÄÇ",
                            en: "I wish it wouldn't rain.",
                            explanation: "Êú™Êù•„Å∏„ÅÆÈ°òÊúõ„Çí wish + would „ÅßË°®Áèæ„Åó„Åæ„Åô„ÄÇ"
                        }
                    ]
                },
                lesson6: {
                    postposition_ing: [
                        {
                            jp: "ÂÖ¨Âúí„ÅßÈÅä„Çì„Åß„ÅÑ„ÇãÂ≠ê‰æõ„Åü„Å°„ÅØÂÖÉÊ∞ó„Åß„Åô„ÄÇ",
                            en: "The children playing in the park are energetic.",
                            explanation: "ÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„ÅßÁ∂ôÁ∂öÁöÑ„Å™Âãï‰Ωú„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "Âõ≥Êõ∏È§®„ÅßÂãâÂº∑„Åó„Å¶„ÅÑ„ÇãÂ≠¶Áîü„ÇíË¶ã„Åæ„Åó„Åü„ÄÇ",
                            en: "I saw students studying in the library.",
                            explanation: "Â†¥ÊâÄ„ÇíÂê´„ÇÄÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„Åß„Åô„ÄÇ"
                        }
                    ],
                    postposition_past_participle: [
                        {
                            jp: "„Éï„É©„É≥„Çπ„Åß‰Ωú„Çâ„Çå„Åü„ÉØ„Ç§„É≥„ÅØÊúâÂêç„Åß„Åô„ÄÇ",
                            en: "Wine made in France is famous.",
                            explanation: "ÈÅéÂéªÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„ÅßÂèóÂãïÁöÑ„Å™ÊÑèÂë≥„ÇíË°®„Åó„Åæ„Åô„ÄÇ"
                        },
                        {
                            jp: "10Âπ¥Ââç„Å´Âª∫„Å¶„Çâ„Çå„ÅüÂª∫Áâ©„ÅØÂè§„ÅèË¶ã„Åà„Åæ„Åô„ÄÇ",
                            en: "The building built ten years ago looks old.",
                            explanation: "ÊôÇ„ÇíÂê´„ÇÄÈÅéÂéªÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„Åß„Åô„ÄÇ"
                        }
                    ],
                    postposition_omission: [
                        {
                            jp: "ÁßÅ„ÅåË≤∑„Å£„ÅüËä±„ÅØ„Å®„Å¶„ÇÇÁæé„Åó„ÅÑ„Åß„Åô„ÄÇ",
                            en: "The flowers I bought are very beautiful.",
                            explanation: "ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û„ÅåÁúÅÁï•„Åï„Çå„ÅüÂæåÁΩÆ‰øÆÈ£æ„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅåË®Ä„Å£„Åü„Åì„Å®„ÅØÊú¨ÂΩì„Åß„Åó„Åü„ÄÇ",
                            en: "What he said was true.",
                            explanation: "Èñ¢‰øÇ‰ª£ÂêçË©û„ÅÆÁúÅÁï•„Å´„Çà„ÇãÁ∞°ÊΩî„Å™Ë°®Áèæ„Åß„Åô„ÄÇ"
                        }
                    ],
                    relative_summary: [
                        {
                            jp: "„Åù„Åì„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Çã‰∫∫„ÅØÁßÅ„ÅÆÂèãÈÅî„Åß„Åô„ÄÇ",
                            en: "The person who works there is my friend.",
                            explanation: "‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û who „Å´„Çà„Çã‰øÆÈ£æÊñá„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩº„ÅåË™≠„Çì„Åß„ÅÑ„ÇãÊú¨„ÅØÈõ£„Åó„Åù„ÅÜ„Åß„Åô„ÄÇ",
                            en: "The book that he is reading looks difficult.",
                            explanation: "ÁõÆÁöÑÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û that „Å´„Çà„Çã‰øÆÈ£æÊñá„Åß„Åô„ÄÇ"
                        }
                    ],
                    sentence_transformation: [
                        {
                            jp: "„Åù„ÅÆÊò†Áîª„ÅØÈù¢ÁôΩ„Åã„Å£„Åü„Åß„Åô„ÄÇÁßÅ„ÅØ„Åù„ÅÆÊò†Áîª„ÇíË¶ã„Åæ„Åó„Åü„ÄÇ",
                            en: "The movie that I watched was interesting.",
                            explanation: "2„Å§„ÅÆÊñá„ÇíÈñ¢‰øÇ‰ª£ÂêçË©û„Åß1„Å§„Å´„Åæ„Å®„ÇÅ„Åü‰æã„Åß„Åô„ÄÇ"
                        },
                        {
                            jp: "ÂΩºÂ•≥„ÅØË¶™Âàá„Å™‰∫∫„Åß„Åô„ÄÇÂΩºÂ•≥„ÅØÁßÅ„ÇíÂä©„Åë„Å¶„Åè„Çå„Åæ„Åó„Åü„ÄÇ",
                            en: "She is a kind person who helped me.",
                            explanation: "Èñ¢‰øÇ‰ª£ÂêçË©û„Çí‰Ωø„Å£„ÅüÊñá„ÅÆÊõ∏„ÅçÊèõ„Åà‰æã„Åß„Åô„ÄÇ"
                        }
                    ]
                }
            }
        };

        /* ----------------- „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñÔºàÂäπÊûúÈü≥„ÄÅÈü≥Â£∞ÂêàÊàêÁ≠âÔºâ ----------------- */
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }
            }
            playClick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(660, 0.08, 0.15);
                } catch (e) {
                    console.log('„ÇØ„É™„ÉÉ„ÇØÈü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            playStudyComplete() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(440, 0.25, 0.2);
                } catch (e) {
                    console.log('ÂÆå‰∫ÜÈü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            playSuccess() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(523, 0.15, 0.18);
                } catch (e) {
                    console.log('ÊàêÂäüÈü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            playTick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(800, 0.05, 0.1);
                } catch (e) {
                    console.log('„ÉÅ„ÉÉ„ÇØÈü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            playTimeUp() {
                if (!this.audioContext) return;
                try {
                    this.createWarmTone(220, 0.4, 0.3);
                } catch (e) {
                    console.log('ÊôÇÈñìÂàá„ÇåÈü≥„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            }
            createBell(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createSoftTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createWarmTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        // üîß „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†Ôºà„Ç≥„É≥„Éë„ÇØ„ÉàÁâà„ÉªÂÖ®„Éá„Éê„Ç§„ÇπÂØæÂøúÔºâ
        class VoiceSystem {
            constructor() {
                this.synth = null;
                this.voices = [];
                this.selectedVoice = null;
                this.isEnabled = true;
                this.deviceType = this.detectDevice();
                this.currentMaleVoice = null;
                this.currentFemaleVoice = null;
                
                try {
                    if ('speechSynthesis' in window) {
                        this.synth = window.speechSynthesis;
                        this.initializeVoices();
                    } else {
                        console.log('Èü≥Â£∞ÂêàÊàê„Åå„Çµ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    }
                } catch (e) {
                    console.log('Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            // üîß „Éá„Éê„Ç§„ÇπÊ§úÂá∫ÔºàÊã°ÂºµÁâàÔºâ
            detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                
                if (/iphone|ipad|ipod/.test(userAgent) || platform.includes('mac')) {
                    return 'apple';
                } else if (/android/.test(userAgent)) {
                    return 'android';
                } else if (/windows/.test(userAgent) || platform.includes('win')) {
                    return 'windows';
                } else if (/linux/.test(userAgent) || platform.includes('linux')) {
                    return 'linux';
                } else if (/chrome/.test(userAgent)) {
                    return 'chrome';
                } else {
                    return 'other';
                }
            }

            initializeVoices() {
                this.loadVoices();
                
                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }

                // Èü≥Â£∞Ë™≠„ÅøËæº„ÅøÂÜçË©¶Ë°å
                const retryIntervals = [100, 500, 1000, 2000, 3000];
                retryIntervals.forEach((delay) => {
                    setTimeout(() => {
                        this.loadVoices();
                    }, delay);
                });
            }

            loadVoices() {
                if (!this.synth) return;
                
                try {
                    const allVoices = this.synth.getVoices();
                    console.log(`üé§ Âà©Áî®ÂèØËÉΩÈü≥Â£∞: ${allVoices.length}ÂÄã`, allVoices.map(v => v.name));
                    
                    this.voices = allVoices.filter(voice => {
                        const lang = voice.lang.toLowerCase();
                        return lang.startsWith('en') || lang.includes('english');
                    });
                    
                    console.log(`üîç Ëã±Ë™ûÈü≥Â£∞: ${this.voices.length}ÂÄã`, this.voices.map(v => `${v.name} (${v.lang})`));
                    
                    // „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®Èü≥Â£∞Ë®≠ÂÆö
                    this.setDeviceRecommendedVoices();
                    
                    this.loadSettings();
                    
                } catch (e) {
                    console.log('Èü≥Â£∞„É™„Çπ„Éà„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            // üîß „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®Èü≥Â£∞Ë®≠ÂÆöÔºàÊã°ÂºµÁâàÔºâ
            setDeviceRecommendedVoices() {
                const recommendations = this.getDeviceVoiceRecommendations();
                
                // Áî∑ÊÄßÈü≥Â£∞„ÇíË®≠ÂÆö
                this.currentMaleVoice = this.findBestVoice(recommendations.male);
                
                // Â•≥ÊÄßÈü≥Â£∞„ÇíË®≠ÂÆö
                this.currentFemaleVoice = this.findBestVoice(recommendations.female);
                
                console.log('üéØ Êé®Â•®Èü≥Â£∞Ë®≠ÂÆö:', {
                    device: this.deviceType,
                    male: this.currentMaleVoice?.name,
                    female: this.currentFemaleVoice?.name
                });
                
                // „Éá„Éï„Ç©„É´„ÉàÈü≥Â£∞Ë®≠ÂÆö
                if (!this.selectedVoice) {
                    this.selectedVoice = this.currentFemaleVoice || this.currentMaleVoice || this.voices[0];
                }
            }

            // üîß „Éá„Éê„Ç§„ÇπÂà•Èü≥Â£∞Êé®Â•®„Éû„ÉÉ„ÉóÔºàÂÖ®„Éá„Éê„Ç§„ÇπÂØæÂøúÁâàÔºâ
            getDeviceVoiceRecommendations() {
                const recommendations = {
                    apple: {
                        male: ['Alex', 'Daniel', 'Fred', 'Tom', 'Aaron', 'Arthur'],
                        female: ['Samantha', 'Victoria', 'Karen', 'Susan', 'Allison', 'Ava']
                    },
                    android: {
                        male: ['Male', 'en-us-x-sfg#male_1-local', 'en-us-x-sfg#male_2-local', 'en-us-x-sfg#male_3-local', 'English (United States) Male'],
                        female: ['Female', 'en-us-x-sfg#female_1-local', 'en-us-x-sfg#female_2-local', 'en-us-x-sfg#female_3-local', 'English (United States) Female']
                    },
                    windows: {
                        male: ['Microsoft David', 'Microsoft Mark', 'David', 'Mark', 'Microsoft George'],
                        female: ['Microsoft Zira', 'Microsoft Hazel', 'Zira', 'Hazel', 'Microsoft Helen']
                    },
                    linux: {
                        male: ['Male', 'English (US) Male', 'espeak', 'festival male'],
                        female: ['Female', 'English (US) Female', 'espeak female', 'festival female']
                    },
                    chrome: {
                        male: ['Google US English Male', 'Chrome OS US English Male', 'Male'],
                        female: ['Google US English Female', 'Chrome OS US English Female', 'Female']
                    },
                    other: {
                        male: ['Male', 'Alex', 'Google US English', 'English Male', 'Default Male'],
                        female: ['Female', 'Samantha', 'Google US English', 'English Female', 'Default Female']
                    }
                };
                
                return recommendations[this.deviceType] || recommendations.other;
            }

            findBestVoice(candidateNames) {
                for (const name of candidateNames) {
                    const voice = this.voices.find(v => 
                        v.name.toLowerCase().includes(name.toLowerCase()) ||
                        name.toLowerCase().includes(v.name.toLowerCase())
                    );
                    if (voice) {
                        return voice;
                    }
                }
                return null;
            }

            // üîß Èü≥Â£∞ÈÅ∏ÊäûÔºàÁî∑ÊÄß/Â•≥ÊÄßÔºâ
            selectGenderVoice(gender) {
                let targetVoice = null;
                
                if (gender === 'male') {
                    targetVoice = this.currentMaleVoice;
                } else if (gender === 'female') {
                    targetVoice = this.currentFemaleVoice;
                }
                
                if (targetVoice) {
                    this.selectedVoice = targetVoice;
                    this.saveSettings();
                    this.updateVoiceSelectionUI(gender);
                    console.log(`üé§ Èü≥Â£∞ÈÅ∏Êäû: ${gender} - ${targetVoice.name}`);
                    return true;
                }
                return false;
            }

            updateVoiceSelectionUI(selectedGender) {
                document.querySelectorAll('.voice-choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const targetBtn = document.querySelector(`[data-voice-gender="${selectedGender}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('selected');
                }
            }

            // üîß Èü≥Â£∞„ÉÜ„Çπ„Éà
            testVoice(gender) {
                const testTexts = {
                    male: "Hello! I am the male voice for your English learning. I will help you practice pronunciation clearly and confidently.",
                    female: "Hi there! I am the female voice for your English learning. Let me help you improve your pronunciation with clear and natural speech."
                };
                
                if (gender === 'male' && this.currentMaleVoice) {
                    this.testSpecificVoice(this.currentMaleVoice, testTexts.male);
                } else if (gender === 'female' && this.currentFemaleVoice) {
                    this.testSpecificVoice(this.currentFemaleVoice, testTexts.female);
                }
            }

            testSpecificVoice(voice, text) {
                try {
                    this.synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    console.log(`üîä Èü≥Â£∞„ÉÜ„Çπ„Éà: ${voice.name}`);
                    this.synth.speak(utterance);
                } catch (e) {
                    console.log('Èü≥Â£∞„ÉÜ„Çπ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            speak(text) {
                if (!this.isEnabled || !text.trim() || !this.synth) return;
                
                try {
                    this.synth.cancel();
                    
                    const cleanText = this.cleanEnglishText(text);
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    
                    if (this.selectedVoice) {
                        utterance.voice = this.selectedVoice;
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.85;
                    
                    this.synth.speak(utterance);
                    return utterance;
                    
                } catch (e) {
                    console.log('Èü≥Â£∞ÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            cleanEnglishText(text) {
                return text
                    .replace(/[^\w\s.!?',\-]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            setEnabled(enabled) {
                this.isEnabled = enabled;
                this.saveSettings();
                
                if (!enabled && this.synth) {
                    try {
                        this.synth.cancel();
                    } catch (e) {
                        console.log('Èü≥Â£∞ÂÅúÊ≠¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                    }
                }
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceName: this.selectedVoice ? this.selectedVoice.name : null,
                        isEnabled: this.isEnabled,
                        deviceType: this.deviceType
                    };
                    localStorage.setItem('oneWorldQuizVoiceSettings', JSON.stringify(settings));
                } catch (e) {
                    console.log('Èü≥Â£∞Ë®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('oneWorldQuizVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.isEnabled = settings.isEnabled !== false;
                        
                        if (settings.voiceName && this.voices.length > 0) {
                            const savedVoice = this.voices.find(v => v.name === settings.voiceName);
                            if (savedVoice) {
                                this.selectedVoice = savedVoice;
                                // UIÊõ¥Êñ∞
                                const gender = (savedVoice === this.currentMaleVoice) ? 'male' : 'female';
                                this.updateVoiceSelectionUI(gender);
                            }
                        }
                    }
                } catch (e) {
                    console.log('Èü≥Â£∞Ë®≠ÂÆö„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
                }
            }

            getSelectedVoiceName() {
                return this.selectedVoice ? this.selectedVoice.name : '„Éá„Éï„Ç©„É´„Éà';
            }

            getDeviceInfo() {
                const deviceNames = {
                    apple: 'iPhone„ÉªiPad„ÉªMac',
                    android: 'Android',
                    windows: 'Windows',
                    linux: 'Linux',
                    chrome: 'Chrome OS',
                    other: '„Åù„ÅÆ‰ªñ'
                };
                
                return {
                    type: this.deviceType,
                    typeName: deviceNames[this.deviceType] || '„Åù„ÅÆ‰ªñ',
                    totalVoices: this.voices.length,
                    maleVoice: this.currentMaleVoice?.name || '„Å™„Åó',
                    femaleVoice: this.currentFemaleVoice?.name || '„Å™„Åó',
                    selectedVoice: this.selectedVoice?.name || '„Å™„Åó'
                };
            }
        }

        let soundSystem, voiceSystem;
        try {
            soundSystem = new SoundSystem();
            voiceSystem = new VoiceSystem();
        } catch (e) {
            console.log('„Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            soundSystem = { playClick: () => {}, playStudyComplete: () => {}, playSuccess: () => {}, playTick: () => {}, playTimeUp: () => {} };
            voiceSystem = { speak: () => {}, selectGenderVoice: () => false, testVoice: () => {}, setEnabled: () => {}, isEnabled: true };
        }

        /* ----------------- „Ç≤„Éº„É†Â§âÊï∞ ----------------- */
        let selectedGrammarItems = [];
        let selectedLessons = [];
        let currentQuestionIndex = 0;
        let studyCount = 0;
        let sessionClickCount = 0;
        let usedQuestions = [];
        let particleOffset = 0;
        let currentGrade = '';
        let currentLesson = '';
        let questionMode = 'random';
        let sequentialIndex = 0;
        let questionDirection = 'jp_to_en';
        let timerLimit = 3;
        let timerInterval = null;
        let currentTimerValue = 0;
        let isTimerRunning = false;
        let isQuizAnswered = false;
        let allQuestions = [];
        let currentScreen = 'main';

        /* ----------------- „ÇØ„É™„ÉÉ„ÇØÊï∞ÁÆ°ÁêÜÊ©üËÉΩ ----------------- */
        let clickStats = { total: 0, daily: {} };

        function getTodayDateString() {
            const today = new Date();
            return today.getFullYear() + '-' + 
                   String(today.getMonth() + 1).padStart(2, '0') + '-' + 
                   String(today.getDate()).padStart(2, '0');
        }

        function incrementClickCount() {
            const today = getTodayDateString();
            
            clickStats.total++;
            sessionClickCount++;
            
            if (!clickStats.daily[today]) {
                clickStats.daily[today] = 0;
            }
            clickStats.daily[today]++;
            
            updateClickDisplays();
            saveClickStats();
            
            if (clickStats.total % 10 === 0) {
                createParticle('‚ú®', '#a584c7', window.innerWidth / 2, window.innerHeight / 2);
            }
            
            if (clickStats.total % 100 === 0) {
                soundSystem.playSuccess();
                createParticle('üèÜ', '#f4a261', window.innerWidth / 2, window.innerHeight / 2);
            }
            
            return true;
        }

        function updateClickDisplays() {
            try {
                const today = getTodayDateString();
                const todayClicks = clickStats.daily[today] || 0;
                
                const headerTotalElement = document.getElementById('footerTotalClick');
                const headerTodayElement = document.getElementById('footerTodayClick');
                const sessionElement = document.getElementById('clickCount');
                
                if (headerTotalElement) {
                    headerTotalElement.textContent = clickStats.total;
                }
                if (headerTodayElement) {
                    headerTodayElement.textContent = todayClicks;
                }
                if (sessionElement) {
                    sessionElement.textContent = sessionClickCount;
                }
                
            } catch (e) {
                console.log('„ÇØ„É™„ÉÉ„ÇØË°®Á§∫Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function saveClickStats() {
            try {
                localStorage.setItem('oneWorldQuizClickStats', JSON.stringify(clickStats));
            } catch (e) {
                console.log('„ÇØ„É™„ÉÉ„ÇØÁµ±Ë®à„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function loadClickStats() {
            try {
                const saved = localStorage.getItem('oneWorldQuizClickStats');
                if (saved) {
                    clickStats = JSON.parse(saved);
                    updateClickDisplays();
                }
            } catch (e) {
                console.log('„ÇØ„É™„ÉÉ„ÇØÁµ±Ë®à„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                clickStats = { total: 0, daily: {} };
            }
        }

        function confirmResetTotal() {
            if (confirm('üèÜ Á∑è„ÇØ„É™„ÉÉ„ÇØÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü\nÔºà„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„ÇìÔºâ')) {
                clickStats.total = 0;
                saveClickStats();
                updateClickDisplays();
                soundSystem.playClick();
            }
        }

        function confirmResetToday() {
            if (confirm('üìÖ ‰ªäÊó•„ÅÆ„ÇØ„É™„ÉÉ„ÇØÊï∞„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü\nÔºà„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„ÇìÔºâ')) {
                const today = getTodayDateString();
                clickStats.daily[today] = 0;
                saveClickStats();
                updateClickDisplays();
                soundSystem.playClick();
            }
        }

        /* ----------------- „Ç®„Éï„Çß„ÇØ„ÉàÈñ¢Êï∞ÔºàÈÄöÁü•ÂâäÈô§Ôºâ ----------------- */
        function createParticle(text, color, x, y) {
            try {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.textContent = text;
                particle.style.color = color;
                particle.style.left = (x + particleOffset) + 'px';
                particle.style.top = (y + particleOffset) + 'px';
                particle.style.fontSize = '20px';
                document.body.appendChild(particle);

                particleOffset += 40;
                if (particleOffset > 160) particleOffset = 0;

                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 2500);
            } catch (e) {
                console.log('„Éë„Éº„ÉÜ„Ç£„ÇØ„É´‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- ÁîªÈù¢ÈÅ∑ÁßªÈñ¢Êï∞ ----------------- */
        function updateBackButton() {
            const backBtn = document.getElementById('footerBackBtn');
            const homeBtn = document.getElementById('footerHomeBtn');
            
            if (currentScreen === 'main') {
                backBtn.style.opacity = '0.5';
                backBtn.style.pointerEvents = 'none';
                homeBtn.style.opacity = '0.5';
                homeBtn.style.pointerEvents = 'none';
            } else {
                backBtn.style.opacity = '1';
                backBtn.style.pointerEvents = 'auto';
                homeBtn.style.opacity = '1';
                homeBtn.style.pointerEvents = 'auto';
            }
        }

        function hideAllModals() {
            try {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
            } catch (e) {
                console.log('„É¢„Éº„ÉÄ„É´ÈùûË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function goBackToMain() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.add('hidden');
                }
                const mainModal = document.getElementById('mainGradeModal');
                if (mainModal) {
                    mainModal.classList.add('show');
                }
                currentScreen = 'main';
                updateBackButton();
                soundSystem.playClick();
                currentGrade = '';
                
                resetLessonSelections();
                selectedLessons = [];
                selectedGrammarItems = [];
                
            } catch (e) {
                console.log('„É°„Ç§„É≥ÁîªÈù¢„Å∏„ÅÆÈÅ∑Áßª„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function resetLessonSelections() {
            try {
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    if (container) {
                        container.querySelectorAll('.lesson-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                    }
                    
                    const gradeNum = grade.replace('grade', '');
                    const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
                    if (startButton) {
                        startButton.style.display = 'none';
                        startButton.disabled = true;
                    }
                });
            } catch (e) {
                console.log('„É¨„ÉÉ„Çπ„É≥ÈÅ∏Êäû„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
            }
        }

        function goBackToGrade(grade) {
            try {
                hideAllModals();
                const gradeModal = document.getElementById(`${grade}Modal`);
                if (gradeModal) {
                    gradeModal.classList.add('show');
                }
                currentScreen = 'grade';
                updateBackButton();
                soundSystem.playClick();
                selectedGrammarItems = [];
            } catch (e) {
                console.log('Â≠¶Âπ¥ÁîªÈù¢„Å∏„ÅÆÈÅ∑Áßª„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function goBackToGameSettings() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.remove('hidden');
                }
                currentScreen = 'game';
                updateBackButton();
                soundSystem.playClick();
                
                resetQuizState();
                
            } catch (e) {
                console.log('„Ç≤„Éº„É†Ë®≠ÂÆöÁîªÈù¢„Å∏„ÅÆÈÅ∑Áßª„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function resetQuizState() {
            try {
                usedQuestions = [];
                currentQuestionIndex = 0;
                sequentialIndex = 0;
                isQuizAnswered = false;
                
                stopTimer();
            } catch (e) {
                console.log('„ÇØ„Ç§„Ç∫Áä∂ÊÖã„É™„Çª„ÉÉ„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
            }
        }

        function goBack() {
            try {
                incrementClickCount();
                soundSystem.playClick();
                
                if (currentScreen === 'quiz') {
                    goBackToGameSettings();
                } else if (currentScreen === 'game') {
                    goBackToGrade(currentGrade);
                } else if (currentScreen === 'grammar') {
                    goBackToGrade(currentGrade);
                } else if (currentScreen === 'grade') {
                    goBackToMain();
                } else if (currentScreen === 'voice') {
                    closeVoiceSettings();
                } else {
                    goBackToMain();
                }
            } catch (e) {
                console.log('Êàª„ÇãÂãï‰Ωú„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- üîß Èü≥Â£∞Ê©üËÉΩÈñ¢Êï∞ÔºàÂÖ®„Éá„Éê„Ç§„ÇπÂØæÂøú„Éª„Ç≥„É≥„Éë„ÇØ„ÉàÁâàÔºâ ----------------- */
function openVoiceSettings() {
    try {
        // Èü≥Â£∞„ÇíÂº∑Âà∂ÁöÑ„Å´ÂÜçË™≠„ÅøËæº„Åø
        setTimeout(() => {
            voiceSystem.loadVoices();
            // Â∞ë„ÅóÂæÖ„Å£„Å¶„Åã„ÇâUIÊõ¥Êñ∞
            setTimeout(() => {
                generateCompactDeviceRecommendations();
            }, 500);
        }, 100);
        
        const modal = document.getElementById('voiceSettingsModal');
        const enabledCheckbox = document.getElementById('voiceEnabled');
        const toggleDescription = document.getElementById('voiceToggleDescription');
        
        if (enabledCheckbox && toggleDescription) {
            enabledCheckbox.checked = voiceSystem.isEnabled;
            toggleDescription.textContent = voiceSystem.isEnabled ? 'Èü≥Â£∞Ê©üËÉΩ„ÅåÊúâÂäπ„Åß„Åô' : 'Èü≥Â£∞Ê©üËÉΩ„ÅåÁÑ°Âäπ„Åß„Åô';
        }
        
        // „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®UIÁîüÊàêÔºà„Ç≥„É≥„Éë„ÇØ„ÉàÁâàÔºâ
        generateCompactDeviceRecommendations();
        
        currentScreen = 'voice';
        updateBackButton();
        
        if (modal) {
            modal.classList.add('show');
        }
        
        console.log('Èü≥Â£∞Ë®≠ÂÆöÁîªÈù¢Ë°®Á§∫ - „Éá„Éê„Ç§„ÇπÊÉÖÂ†±:', voiceSystem.getDeviceInfo());
        
    } catch (e) {
        console.log('Èü≥Â£∞Ë®≠ÂÆöÁîªÈù¢„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
    }
}

// üîß „Éá„Éê„Ç§„ÇπÂà•Êé®Â•®UIÁîüÊàêÔºàÂº∑ÂåñÁâà„Éª„É™„Ç¢„É´„Çø„Ç§„É†Èü≥Â£∞Ê§úÂá∫Ôºâ
function generateCompactDeviceRecommendations() {
    const container = document.getElementById('deviceRecommendations');
    if (!container) return;
    
    // Èü≥Â£∞„ÇíÂº∑Âà∂ÁöÑ„Å´ÂÜçË™≠„ÅøËæº„Åø
    voiceSystem.loadVoices();
    
    const deviceInfo = voiceSystem.getDeviceInfo();
    const deviceEmojis = {
        apple: 'üì±',
        android: 'ü§ñ',
        windows: 'üíª',
        linux: 'üêß',
        chrome: 'üåê',
        other: 'üñ•Ô∏è'
    };
    
    // Âà©Áî®ÂèØËÉΩ„Å™ÂÖ®Èü≥Â£∞„ÇíÂèñÂæó
    const allVoices = voiceSystem.voices;
    console.log('üé§ Èü≥Â£∞Ë®≠ÂÆöÁîªÈù¢„ÅßÂà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞:', allVoices.length, allVoices.map(v => v.name));
    
    let maleVoiceText = '„Å™„Åó';
    let femaleVoiceText = '„Å™„Åó';
    
    if (voiceSystem.currentMaleVoice) {
        maleVoiceText = voiceSystem.currentMaleVoice.name.substring(0, 20);
        if (maleVoiceText.length < voiceSystem.currentMaleVoice.name.length) {
            maleVoiceText += '...';
        }
    } else if (allVoices.length > 0) {
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: Âà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞„Åã„ÇâÁî∑ÊÄßÈü≥Â£∞„ÇíÊé®Ê∏¨
        const maleCandidate = allVoices.find(v => 
            v.name.toLowerCase().includes('male') || 
            v.name.toLowerCase().includes('man') ||
            v.name.toLowerCase().includes('david') ||
            v.name.toLowerCase().includes('alex')
        );
        if (maleCandidate) {
            voiceSystem.currentMaleVoice = maleCandidate;
            maleVoiceText = maleCandidate.name.substring(0, 20) + '...';
        } else {
            maleVoiceText = 'Âà©Áî®ÂèØËÉΩ';
        }
    }
    
    if (voiceSystem.currentFemaleVoice) {
        femaleVoiceText = voiceSystem.currentFemaleVoice.name.substring(0, 20);
        if (femaleVoiceText.length < voiceSystem.currentFemaleVoice.name.length) {
            femaleVoiceText += '...';
        }
    } else if (allVoices.length > 0) {
        // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: Âà©Áî®ÂèØËÉΩ„Å™Èü≥Â£∞„Åã„ÇâÂ•≥ÊÄßÈü≥Â£∞„ÇíÊé®Ê∏¨
        const femaleCandidate = allVoices.find(v => 
            v.name.toLowerCase().includes('female') || 
            v.name.toLowerCase().includes('woman') ||
            v.name.toLowerCase().includes('zira') ||
            v.name.toLowerCase().includes('samantha')
        );
        if (femaleCandidate) {
            voiceSystem.currentFemaleVoice = femaleCandidate;
            femaleVoiceText = femaleCandidate.name.substring(0, 20) + '...';
        } else if (allVoices.length > 0) {
            // ÊúÄÁµÇ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ: ÊúÄÂàù„ÅÆÈü≥Â£∞„Çí‰ΩøÁî®
            voiceSystem.currentFemaleVoice = allVoices[0];
            femaleVoiceText = allVoices[0].name.substring(0, 20) + '...';
        }
    }
    
    container.innerHTML = `
        <div class="device-section">
            <div class="device-title">
                ${deviceEmojis[deviceInfo.type]} ${deviceInfo.typeName}„ÅÆÈü≥Â£∞ÈÅ∏Êäû
            </div>
            <div class="device-description">
                Ê§úÂá∫„Åï„Çå„Åü ${allVoices.length} ÂÄã„ÅÆÈü≥Â£∞„Åã„ÇâÈÅ∏Êäû„Åß„Åç„Åæ„Åô„ÄÇ
            </div>
            <div class="voice-choice-grid">
                <div class="voice-choice-btn" data-voice-gender="male" onclick="selectAndTestVoice('male')">
                    <div class="voice-gender-icon">üë®</div>
                    <div class="voice-gender-label">Áî∑ÊÄßÈü≥Â£∞</div>
                    <div class="voice-gender-description">
                        ${maleVoiceText}
                    </div>
                    <button class="voice-test-btn" onclick="event.stopPropagation(); testDeviceVoice('male')">
                        üîä Ë©¶ËÅ¥
                    </button>
                </div>
                <div class="voice-choice-btn" data-voice-gender="female" onclick="selectAndTestVoice('female')">
                    <div class="voice-gender-icon">üë©</div>
                    <div class="voice-gender-label">Â•≥ÊÄßÈü≥Â£∞</div>
                    <div class="voice-gender-description">
                        ${femaleVoiceText}
                    </div>
                    <button class="voice-test-btn" onclick="event.stopPropagation(); testDeviceVoice('female')">
                        üîä Ë©¶ËÅ¥
                    </button>
                </div>
            </div>
            <div class="text-center mt-2">
                <div class="text-xs text-gray-600">
                    üí° „Éá„Éê„Ç§„Çπ: ${deviceInfo.type} | Èü≥Â£∞Êï∞: ${allVoices.length}
                </div>
                ${allVoices.length === 0 ? '<div class="text-xs text-red-600">‚ö†Ô∏è Èü≥Â£∞„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Éñ„É©„Ç¶„Ç∂„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</div>' : ''}
            </div>
        </div>
    `;
    
    // ÁèæÂú®ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÈü≥Â£∞„Çí„Éè„Ç§„É©„Ç§„Éà
    if (voiceSystem.selectedVoice) {
        const currentGender = (voiceSystem.selectedVoice === voiceSystem.currentMaleVoice) ? 'male' : 'female';
        voiceSystem.updateVoiceSelectionUI(currentGender);
    }
}

        function selectAndTestVoice(gender) {
            incrementClickCount();
            soundSystem.playClick();
            
            if (voiceSystem.selectGenderVoice(gender)) {
                console.log(`‚úÖ ${gender}Èü≥Â£∞„ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü`);
                // ÈÅ∏ÊäûÂæå„Å´Ëá™Âãï„ÉÜ„Çπ„Éà
                setTimeout(() => {
                    voiceSystem.testVoice(gender);
                }, 200);
            }
        }

        function testDeviceVoice(gender) {
            voiceSystem.testVoice(gender);
        }

        function closeVoiceSettings() {
            try {
                const modal = document.getElementById('voiceSettingsModal');
                if (modal) {
                    modal.classList.remove('show');
                }
                
                if (currentScreen === 'voice') {
                    currentScreen = 'main';
                    hideAllModals();
                    const mainModal = document.getElementById('mainGradeModal');
                    if (mainModal) {
                        mainModal.classList.add('show');
                    }
                }
                
                updateBackButton();
            } catch (e) {
                console.log('Èü≥Â£∞Ë®≠ÂÆöÁîªÈù¢„ÅÆÈñâ„Åò„Çã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function toggleVoiceEnabled() {
            try {
                const checkbox = document.getElementById('voiceEnabled');
                const description = document.getElementById('voiceToggleDescription');
                
                if (checkbox && description) {
                    voiceSystem.setEnabled(checkbox.checked);
                    description.textContent = checkbox.checked ? 'Èü≥Â£∞Ê©üËÉΩ„ÅåÊúâÂäπ„Åß„Åô' : 'Èü≥Â£∞Ê©üËÉΩ„ÅåÁÑ°Âäπ„Åß„Åô';
                }
            } catch (e) {
                console.log('Èü≥Â£∞Âàá„ÇäÊõø„Åà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function addSpeakButton(text, container) {
            try {
                const englishRegex = /[a-zA-Z]/;
                if (!englishRegex.test(text)) return container;
                
                const speakBtn = document.createElement('button');
                speakBtn.className = 'speak-btn';
                speakBtn.innerHTML = 'üîä';
                speakBtn.title = 'Ëã±Ë™û„ÅßË™≠„Åø‰∏ä„Åí';
                speakBtn.onclick = (e) => {
                    e.stopPropagation();
                    speakEnglishText(text, speakBtn);
                };
                
                const wrapper = document.createElement('span');
                wrapper.style.display = 'inline-flex';
                wrapper.style.alignItems = 'center';
                wrapper.appendChild(document.createTextNode(text));
                wrapper.appendChild(speakBtn);
                
                return wrapper;
            } catch (e) {
                console.log('„Çπ„Éî„Éº„Ç´„Éº„Éú„Çø„É≥„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                return container;
            }
        }

        function speakEnglishText(text, button = null) {
            try {
                if (!voiceSystem.isEnabled) {
                    return;
                }
                
                if (button) {
                    button.classList.add('speaking');
                }
                
                const utterance = voiceSystem.speak(text);
                
                if (utterance) {
                    utterance.onend = () => {
                        if (button) {
                            button.classList.remove('speaking');
                        }
                    };
                }
            } catch (e) {
                console.log('Èü≥Â£∞ÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                if (button) {
                    button.classList.remove('speaking');
                }
            }
        }

        /* ----------------- „É¨„ÉÉ„Çπ„É≥ÈÅ∏ÊäûÊ©üËÉΩ ----------------- */
        function toggleLessonSelection(grade, lessonId, lessonName) {
            try {
                const lessonBtn = document.querySelector(`#${grade}Lessons [data-lesson-id="${lessonId}"]`);
                
                if (!lessonBtn) {
                    console.error('„É¨„ÉÉ„Çπ„É≥„Éú„Çø„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', lessonId);
                    return;
                }

                const isSelected = lessonBtn.classList.contains('selected');
                
                if (isSelected) {
                    lessonBtn.classList.remove('selected');
                    selectedLessons = selectedLessons.filter(lesson => lesson.id !== lessonId);
                } else {
                    lessonBtn.classList.add('selected');
                    selectedLessons.push({id: lessonId, name: lessonName, grade: grade});
                }
                
                updateSelectedLessonsDisplay(grade);
                
            } catch (e) {
                console.error('„É¨„ÉÉ„Çπ„É≥ÈÅ∏ÊäûÂàá„ÇäÊõø„Åà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:', e);
            }
        }

        function updateSelectedLessonsDisplay(grade) {
            try {
                const gradeNum = grade.replace('grade', '');
                const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
                
                const gradeSelectedLessons = selectedLessons.filter(lesson => lesson.grade === grade);
                
                if (gradeSelectedLessons.length > 0) {
                    startButton.style.display = 'inline-block';
                    startButton.disabled = false;
                } else {
                    startButton.style.display = 'none';
                    startButton.disabled = true;
                }
                
            } catch (e) {
                console.log('ÈÅ∏Êäû„É¨„ÉÉ„Çπ„É≥Ë°®Á§∫Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function startSelectedLessons(grade) {
            try {
                if (selectedLessons.length === 0) {
                    return;
                }
                
                currentGrade = grade;
                showGrammarSelection();
                
            } catch (e) {
                console.log('„É¨„ÉÉ„Çπ„É≥ÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function showGrammarSelection() {
            try {
                hideAllModals();
                
                const modal = document.getElementById('grammarModal');
                const title = document.getElementById('grammarModalTitle');
                const container = document.getElementById('grammarCategories');
                
                title.textContent = `üìö ${selectedLessons.map(l => l.name).join(', ')} - ÊñáÊ≥ïÈ†ÖÁõÆÈÅ∏Êäû`;
                
                container.innerHTML = '';
                selectedGrammarItems = [];
                
                selectedLessons.forEach(lesson => {
                    const lessonData = lessons[lesson.grade].find(l => l.id === lesson.id);
                    if (lessonData) {
                        lessonData.grammar.forEach(grammar => {
                            const btn = document.createElement('button');
                            btn.className = 'grammar-btn';
                            btn.textContent = grammar.name;
                            btn.dataset.grammarId = `${lesson.id}_${grammar.id}`;
                            btn.dataset.lessonId = lesson.id;
                            btn.dataset.grade = lesson.grade;
                            
                            btn.addEventListener('click', () => {
                                incrementClickCount();
                                soundSystem.playClick();
                                toggleGrammarSelection(btn, grammar, lesson);
                            });
                            
                            container.appendChild(btn);
                        });
                    }
                });
                
                currentScreen = 'grammar';
                updateBackButton();
                modal.classList.add('show');
                
            } catch (e) {
                console.log('ÊñáÊ≥ïÈÅ∏ÊäûÁîªÈù¢Ë°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function toggleGrammarSelection(btn, grammar, lesson) {
            try {
                const isSelected = btn.classList.contains('selected');
                const grammarKey = `${lesson.id}_${grammar.id}`;
                
                if (isSelected) {
                    btn.classList.remove('selected');
                    selectedGrammarItems = selectedGrammarItems.filter(item => item.key !== grammarKey);
                } else {
                    btn.classList.add('selected');
                    selectedGrammarItems.push({
                        key: grammarKey,
                        lessonId: lesson.id,
                        grammarId: grammar.id,
                        name: grammar.name,
                        grade: lesson.grade
                    });
                }
                
                const startButton = document.getElementById('startGrammarQuiz');
                if (selectedGrammarItems.length > 0) {
                    startButton.disabled = false;
                } else {
                    startButton.disabled = true;
                }
                
            } catch (e) {
                console.log('ÊñáÊ≥ïÈÅ∏ÊäûÂàá„ÇäÊõø„Åà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function startGrammarQuiz() {
            try {
                if (selectedGrammarItems.length === 0) {
                    return;
                }
                
                prepareQuestions();
                showGameScreen();
                
            } catch (e) {
                console.log('ÊñáÊ≥ï„ÇØ„Ç§„Ç∫ÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function prepareQuestions() {
            try {
                allQuestions = [];
                
                selectedGrammarItems.forEach(item => {
                    const problems = sampleProblems[item.grade]?.[item.lessonId]?.[item.grammarId];
                    if (problems) {
                        problems.forEach(problem => {
                            allQuestions.push({
                                ...problem,
                                grammarName: item.name,
                                lessonId: item.lessonId,
                                grade: item.grade
                            });
                        });
                    }
                });
                
                // üîß ‰∏≠3ÂïèÈ°å„Éá„Éº„Çø„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ
                if (allQuestions.length === 0) {
                    console.log('‚ö†Ô∏è ÂïèÈ°å„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çâ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Çµ„É≥„Éó„É´ÂïèÈ°å„Çí‰ΩøÁî®„Åó„Åæ„Åô');
                    allQuestions = [
                        {
                            jp: "ÁßÅ„ÅØÂÆøÈ°å„ÇíÁµÇ„Åà„Åæ„Åó„Åü„ÄÇ",
                            en: "I have finished my homework.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÂÆå‰∫ÜÁî®Ê≥ï„Åß„ÅØ„Äåhave/has + ÈÅéÂéªÂàÜË©û„Äç„Åß„Äå„Äú„ÅóÁµÇ„Åà„Åü„Äç„Åì„Å®„ÇíË°®„Åó„Åæ„Åô„ÄÇ„Åì„Çå„ÅØ‰∏≠Â≠¶3Âπ¥Áîü„ÅßÂ≠¶Áøí„Åô„ÇãÈáçË¶Å„Å™ÊñáÊ≥ïÈ†ÖÁõÆ„Åß„Åô„ÄÇ",
                            grammarName: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢ÔºàÂÆå‰∫ÜÁî®Ê≥ïÔºâ",
                            lessonId: "lesson1",
                            grade: "grade3"
                        },
                        {
                            jp: "ÁßÅ„ÅØÊù±‰∫¨„Å´Ë°å„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            en: "I have been to Tokyo.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁµåÈ®ìÁî®Ê≥ï„Åß„Äå„Äú„Åó„Åü„Åì„Å®„Åå„ÅÇ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ„Äåhave/has been to„Äç„ÅØ„Äå„Äú„Å´Ë°å„Å£„Åü„Åì„Å®„Åå„ÅÇ„Çã„Äç„Å®„ÅÑ„ÅÜÁµåÈ®ì„ÇíË°®„ÅôË°®Áèæ„Åß„Åô„ÄÇ",
                            grammarName: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢ÔºàÁµåÈ®ìÁî®Ê≥ïÔºâ",
                            lessonId: "lesson1",
                            grade: "grade3"
                        },
                        {
                            jp: "ÁßÅ„ÅØ3Âπ¥ÈñìËã±Ë™û„ÇíÂãâÂº∑„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            en: "I have studied English for three years.",
                            explanation: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÁ∂ôÁ∂öÁî®Ê≥ï„Åß„Äå„Åö„Å£„Å®„Äú„Åó„Å¶„ÅÑ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇ„Äåfor„Äç„ÅØÊúüÈñì„ÇíË°®„Åó„ÄÅ„Äåsince„Äç„ÅØËµ∑ÁÇπ„ÇíË°®„Åó„Åæ„Åô„ÄÇ",
                            grammarName: "ÁèæÂú®ÂÆå‰∫ÜÂΩ¢ÔºàÁ∂ôÁ∂öÁî®Ê≥ïÔºâ",
                            lessonId: "lesson2",
                            grade: "grade3"
                        },
                        {
                            jp: "Ëµ∞„Å£„Å¶„ÅÑ„ÇãÂ∞ëÂπ¥„ÅØÁßÅ„ÅÆÂºü„Åß„Åô„ÄÇ",
                            en: "The boy running is my brother.",
                            explanation: "ÁèæÂú®ÂàÜË©û„Å´„Çà„ÇãÂæåÁΩÆ‰øÆÈ£æ„Åß„Äå„Äú„Åó„Å¶„ÅÑ„Çã„Äç„ÇíË°®„Åó„Åæ„Åô„ÄÇÂàÜË©û„ÅåÂêçË©û„ÇíÂæå„Çç„Åã„Çâ‰øÆÈ£æ„Åô„ÇãÂΩ¢„Åß„Åô„ÄÇ",
                            grammarName: "ÂæåÁΩÆ‰øÆÈ£æÔºàÁèæÂú®ÂàÜË©ûÔºâ",
                            lessonId: "lesson3",
                            grade: "grade3"
                        },
                        {
                            jp: "Ëã±Ë™û„ÇíÊïô„Åà„Çã‰∫∫„ÅØÁßÅ„ÅÆÂÖàÁîü„Åß„Åô„ÄÇ",
                            en: "The person who teaches English is my teacher.",
                            explanation: "‰∏ªÊ†º„ÅÆÈñ¢‰øÇ‰ª£ÂêçË©û who „ÅØ‰∫∫„ÇíÂÖàË°åË©û„Å®„Åó„Å¶„ÄÅ„Åù„ÅÆ‰∫∫„Å´„Å§„ÅÑ„Å¶Ë©≥„Åó„ÅèË™¨Êòé„Åó„Åæ„Åô„ÄÇ",
                            grammarName: "Èñ¢‰øÇ‰ª£ÂêçË©ûÔºà‰∏ªÊ†ºÔºâ",
                            lessonId: "lesson4",
                            grade: "grade3"
                        }
                    ];
                }
                
                usedQuestions = [];
                currentQuestionIndex = 0;
                sequentialIndex = 0;
                
                console.log(`‚úÖ ÂïèÈ°åÊ∫ñÂÇôÂÆå‰∫Ü: ${allQuestions.length}Âïè (${selectedGrammarItems.map(item => item.name).join(', ')})`);
                
            } catch (e) {
                console.log('ÂïèÈ°åÊ∫ñÂÇô„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function showGameScreen() {
            try {
                hideAllModals();
                const gameScreen = document.getElementById('gameScreen');
                gameScreen.classList.remove('hidden');
                
                const categoryElement = document.getElementById('currentCategory');
                categoryElement.textContent = selectedGrammarItems.map(item => item.name).join(', ');
                
                updateClickDisplays();
                
                currentScreen = 'game';
                updateBackButton();
                
            } catch (e) {
                console.log('„Ç≤„Éº„É†ÁîªÈù¢Ë°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- „Çø„Ç§„Éû„ÉºÊ©üËÉΩÔºàÁÑ°Âà∂ÈôêÂØæÂøúÔºâ ----------------- */
        function startTimer() {
            try {
                if (timerLimit === 'unlimited') {
                    updateTimerDisplayUnlimited();
                    return;
                }
                
                currentTimerValue = timerLimit;
                isTimerRunning = true;
                updateTimerDisplay();
                
                timerInterval = setInterval(() => {
                    currentTimerValue--;
                    updateTimerDisplay();
                    
                    if (currentTimerValue <= 0) {
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        handleTimerExpired();
                    } else if (currentTimerValue <= 2) {
                        soundSystem.playTick();
                    }
                }, 1000);
                
            } catch (e) {
                console.log('„Çø„Ç§„Éû„ÉºÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function updateTimerDisplay() {
            try {
                const timerValue = document.getElementById('timerValue');
                const timerDisplay = document.getElementById('timerDisplay');
                
                if (timerValue && timerDisplay) {
                    timerValue.textContent = currentTimerValue;
                    
                    if (currentTimerValue > 3) {
                        timerDisplay.className = 'timer-display timer-normal';
                    } else if (currentTimerValue > 1) {
                        timerDisplay.className = 'timer-display timer-warning';
                    } else {
                        timerDisplay.className = 'timer-display timer-danger';
                    }
                }
            } catch (e) {
                console.log('„Çø„Ç§„Éû„ÉºË°®Á§∫Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function updateTimerDisplayUnlimited() {
            try {
                const timerValue = document.getElementById('timerValue');
                const timerDisplay = document.getElementById('timerDisplay');
                
                if (timerValue && timerDisplay) {
                    timerValue.textContent = '‚àû';
                    timerDisplay.className = 'timer-display timer-unlimited';
                }
            } catch (e) {
                console.log('ÁÑ°Âà∂Èôê„Çø„Ç§„Éû„ÉºË°®Á§∫Êõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function handleTimerExpired() {
            try {
                soundSystem.playTimeUp();
                
                if (!isQuizAnswered) {
                    showAnswer();
                }
                
            } catch (e) {
                console.log('„Çø„Ç§„Éû„ÉºÊúüÈôêÂàá„ÇåÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function stopTimer() {
            try {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                isTimerRunning = false;
            } catch (e) {
                console.log('„Çø„Ç§„Éû„ÉºÂÅúÊ≠¢„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- „ÇØ„Ç§„Ç∫Ê©üËÉΩ ----------------- */
        function startQuiz() {
            try {
                if (allQuestions.length === 0) {
                    return;
                }
                
                hideAllModals();
                const gameScreenElement = document.getElementById('gameScreen');
                gameScreenElement.classList.add('hidden');
                
                const modal = document.getElementById('quizModal');
                modal.classList.add('show');
                
                currentScreen = 'quiz';
                updateBackButton();
                
                resetQuizState();
                
                showNextQuestion();
                
            } catch (e) {
                console.log('„ÇØ„Ç§„Ç∫ÈñãÂßã„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function showNextQuestion() {
            try {
                if (usedQuestions.length >= allQuestions.length) {
                    endQuiz();
                    return;
                }
                
                let nextQuestion;
                
                if (questionMode === 'random') {
                    const availableQuestions = allQuestions.filter((_, index) => !usedQuestions.includes(index));
                    const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                    nextQuestion = availableQuestions[randomIndex];
                    currentQuestionIndex = allQuestions.indexOf(nextQuestion);
                } else {
                    if (sequentialIndex >= allQuestions.length) {
                        sequentialIndex = 0;
                    }
                    nextQuestion = allQuestions[sequentialIndex];
                    currentQuestionIndex = sequentialIndex;
                }
                
                displayQuestion(nextQuestion);
                isQuizAnswered = false;
                
                const remainingElement = document.getElementById('remainingCount');
                if (remainingElement) {
                    remainingElement.textContent = `ÊÆã„Çä: ${allQuestions.length - usedQuestions.length}Âïè`;
                }
                
                startTimer();
                
            } catch (e) {
                console.log('Ê¨°„ÅÆÂïèÈ°åË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function displayQuestion(question) {
            try {
                const questionElement = document.getElementById('quizQuestion');
                const answerDisplay = document.getElementById('answerDisplay');
                const answerContent = document.getElementById('answerContent');
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                const nextBtn = document.getElementById('quizNext');
                
                let questionText = '';
                let currentQuestionType = '';
                
                if (questionDirection === 'jp_to_en') {
                    questionText = question.jp;
                    currentQuestionType = 'jp_to_en';
                } else if (questionDirection === 'en_to_jp') {
                    questionText = question.en;
                    currentQuestionType = 'en_to_jp';
                } else {
                    const isJpToEn = Math.random() < 0.5;
                    questionText = isJpToEn ? question.jp : question.en;
                    currentQuestionType = isJpToEn ? 'jp_to_en' : 'en_to_jp';
                }
                
                questionElement.dataset.questionType = currentQuestionType;
                questionElement.textContent = questionText;
                
                answerDisplay.classList.remove('show');
                answerContent.innerHTML = '<div class="text-gray-500" style="text-align: center;">È†≠„ÅßËÄÉ„Åà„Å¶„Åã„ÇâËß£Á≠î„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Å≠ÔºÅ</div>';
                
                showAnswerBtn.disabled = false;
                showAnswerBtn.textContent = 'üí° Ëß£Á≠î„ÇíË¶ã„Çã';
                nextBtn.disabled = true;
                
            } catch (e) {
                console.log('ÂïèÈ°åË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function showAnswer() {
            try {
                const question = allQuestions[currentQuestionIndex];
                const questionElement = document.getElementById('quizQuestion');
                const answerDisplay = document.getElementById('answerDisplay');
                const answerContent = document.getElementById('answerContent');
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                const nextBtn = document.getElementById('quizNext');
                
                stopTimer();
                isQuizAnswered = true;
                
                const currentQuestionType = questionElement.dataset.questionType;
                
                let answerText = '';
                if (currentQuestionType === 'jp_to_en') {
                    answerText = question.en;
                } else {
                    answerText = question.jp;
                }
                
                let answerElement;
                if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                    answerElement = addSpeakButton(answerText, document.createElement('div'));
                } else {
                    answerElement = document.createElement('div');
                    answerElement.textContent = answerText;
                }
                
                answerContent.innerHTML = '';
                
                const answerTextDiv = document.createElement('div');
                answerTextDiv.className = 'answer-text';
                answerTextDiv.appendChild(answerElement);
                
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'explanation-text';
                explanationDiv.textContent = question.explanation || 'Ëß£Ë™¨„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ';
                
                answerContent.appendChild(answerTextDiv);
                answerContent.appendChild(explanationDiv);
                
                answerDisplay.classList.add('show');
                
                if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                    setTimeout(() => {
                        speakEnglishText(answerText);
                    }, 500);
                }
                
                showAnswerBtn.disabled = true;
                showAnswerBtn.textContent = '‚úÖ Ëß£Á≠îÊ∏à„Åø';
                nextBtn.disabled = false;
                
                studyCount++;
                document.getElementById('studyCount').textContent = studyCount;
                
                soundSystem.playStudyComplete();
                createParticle('‚≠ê', '#f4a261', window.innerWidth / 2, window.innerHeight / 3);

            } catch (e) {
                console.log('Ëß£Á≠îË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function nextQuestion() {
            try {
                usedQuestions.push(currentQuestionIndex);
                
                if (questionMode === 'sequential') {
                    sequentialIndex++;
                }
                
                incrementClickCount();
                soundSystem.playClick();
                showNextQuestion();
                
            } catch (e) {
                console.log('Ê¨°„ÅÆÂïèÈ°å„Å∏„ÅÆÁßªÂãï„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function endQuiz() {
            try {
                hideAllModals();
                
                const gameScreen = document.getElementById('gameScreen');
                gameScreen.classList.remove('hidden');
                
                currentScreen = 'game';
                updateBackButton();
                
                resetQuizState();
                
            } catch (e) {
                console.log('„ÇØ„Ç§„Ç∫ÁµÇ‰∫ÜÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- Ë®≠ÂÆöÈñ¢Êï∞ÔºàÁÑ°Âà∂Èôê„Çø„Ç§„Éû„ÉºÂØæÂøúÔºâ ----------------- */
        function setTimerLimit(seconds) {
            try {
                timerLimit = seconds;
                
                document.querySelectorAll('.timer-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (seconds === 'unlimited') {
                    document.getElementById('timerUnlimitedBtn').classList.add('active');
                } else {
                    document.getElementById(`timer${seconds}Btn`).classList.add('active');
                }
                
            } catch (e) {
                console.log('„Çø„Ç§„Éû„ÉºË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function setQuestionMode(mode) {
            try {
                questionMode = mode;
                
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                document.getElementById(`${mode}ModeBtn`).classList.add('active');
                
            } catch (e) {
                console.log('ÂïèÈ°å„É¢„Éº„ÉâË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        function setQuestionDirection(direction) {
            try {
                questionDirection = direction;
                
                document.querySelectorAll('.direction-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (direction === 'jp_to_en') {
                    document.getElementById('jpToEnBtn').classList.add('active');
                } else if (direction === 'en_to_jp') {
                    document.getElementById('enToJpBtn').classList.add('active');
                } else {
                    document.getElementById('mixedBtn').classList.add('active');
                }
                
            } catch (e) {
                console.log('Ë®ÄË™ûÊñπÂêëË®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }

        /* ----------------- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÔºàÁÑ°Âà∂Èôê„Çø„Ç§„Éû„ÉºÂØæÂøúÔºâ ----------------- */
        function initEventListeners() {
            try {
                // Â≠¶Âπ¥ÈÅ∏Êäû„Éú„Çø„É≥
                document.querySelectorAll('[data-grade]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const grade = e.currentTarget.dataset.grade;
                        currentGrade = grade;
                        hideAllModals();
                        
                        resetLessonSelections();
                        
                        const targetModal = document.getElementById(grade + 'Modal');
                        if (targetModal) {
                            targetModal.classList.add('show');
                        }
                        currentScreen = 'grade';
                        updateBackButton();
                    });
                });

                // „É¨„ÉÉ„Çπ„É≥ÈñãÂßã„Éú„Çø„É≥ÔºàË§áÊï∞Ôºâ
                ['1', '2', '3'].forEach(gradeNum => {
                    const startBtn = document.getElementById(`startMultipleLessons${gradeNum}`);
                    if (startBtn) {
                        startBtn.addEventListener('click', () => {
                            incrementClickCount();
                            soundSystem.playClick();
                            startSelectedLessons(`grade${gradeNum}`);
                        });
                    }
                });

                // ÊñáÊ≥ï„ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥
                const startGrammarBtn = document.getElementById('startGrammarQuiz');
                if (startGrammarBtn) {
                    startGrammarBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        startGrammarQuiz();
                    });
                }

                // „ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥
                const startQuizBtn = document.getElementById('startQuizButton');
                if (startQuizBtn) {
                    startQuizBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        startQuiz();
                    });
                }

                // Ëß£Á≠îË°®Á§∫„Éú„Çø„É≥
                const showAnswerBtn = document.getElementById('showAnswerBtn');
                if (showAnswerBtn) {
                    showAnswerBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        showAnswer();
                    });
                }

                // Ê¨°„ÅÆÂïèÈ°å„Éú„Çø„É≥
                const nextBtn = document.getElementById('quizNext');
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        nextQuestion();
                    });
                }

                // „Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Éú„Çø„É≥„Ç§„Éô„É≥„ÉàÔºàÊóß„Éï„ÉÉ„Çø„ÉºÔºâ
                const footerHomeBtn = document.getElementById('footerHomeBtn');
                if (footerHomeBtn) {
                    footerHomeBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        goBackToMain();
                    });
                }

                const footerBackBtn = document.getElementById('footerBackBtn');
                if (footerBackBtn) {
                    footerBackBtn.addEventListener('click', () => {
                        goBack();
                    });
                }

                const footerVoiceBtn = document.getElementById('footerVoiceBtn');
                if (footerVoiceBtn) {
                    footerVoiceBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        openVoiceSettings();
                    });
                }

                // Áµ±Ë®à„ÇØ„É™„ÉÉ„ÇØ„Åß„É™„Çª„ÉÉ„ÉàÁ¢∫Ë™ç
                const footerTotalStat = document.getElementById('footerTotalStat');
                if (footerTotalStat) {
                    footerTotalStat.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        confirmResetTotal();
                    });
                }

                const footerTodayStat = document.getElementById('footerTodayStat');
                if (footerTodayStat) {
                    footerTodayStat.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        confirmResetToday();
                    });
                }

                // Èü≥Â£∞ON/OFFÂàá„ÇäÊõø„Åà
                const voiceEnabled = document.getElementById('voiceEnabled');
                if (voiceEnabled) {
                    voiceEnabled.addEventListener('change', toggleVoiceEnabled);
                }

                // „Çø„Ç§„Éû„ÉºË®≠ÂÆö„Éú„Çø„É≥ÔºàÁÑ°Âà∂ÈôêÂØæÂøúÔºâ
                document.querySelectorAll('.timer-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const time = btn.dataset.time;
                        setTimerLimit(time === 'unlimited' ? 'unlimited' : parseInt(time));
                    });
                });

                // ÂïèÈ°å„É¢„Éº„ÉâË®≠ÂÆö„Éú„Çø„É≥
                document.querySelectorAll('.mode-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const mode = btn.dataset.mode;
                        setQuestionMode(mode);
                    });
                });

                // Ë®ÄË™ûÊñπÂêëË®≠ÂÆö„Éú„Çø„É≥
                document.querySelectorAll('.direction-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        const direction = btn.dataset.direction;
                        setQuestionDirection(direction);
                    });
                });

                console.log('ÂÖ®„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÂÆå‰∫Ü');

            } catch (e) {
                console.error('„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂàùÊúüÂåñ„Ç®„É©„Éº:', e);
            }
        }

        /* ----------------- „É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÔºà„ÉÅ„Çß„ÉÉ„ÇØ„Éû„Éº„ÇØÊ©üËÉΩÂØæÂøúÔºâ ----------------- */
        function initLessonsAndGrammar() {
            try {
                console.log('„É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÈñãÂßã...');
                
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    if (!container) {
                        console.error(`„Ç≥„É≥„ÉÜ„Éä„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì: ${grade}Lessons`);
                        return;
                    }
                    
                    console.log(`${grade}„ÅÆ„É¨„ÉÉ„Çπ„É≥Êï∞: ${lessons[grade].length}`);
                    
                    lessons[grade].forEach(lesson => {
                        const btn = document.createElement('button');
                        btn.className = 'lesson-btn';
                        btn.innerHTML = lesson.name;
                        btn.setAttribute('data-lesson-id', lesson.id);
                        
                        btn.addEventListener('click', (e) => {
                            console.log('„É¨„ÉÉ„Çπ„É≥„Éú„Çø„É≥„ÇØ„É™„ÉÉ„ÇØ:', lesson.id, lesson.name);
                            incrementClickCount();
                            soundSystem.playClick();
                            toggleLessonSelection(grade, lesson.id, lesson.name);
                            e.preventDefault();
                        });
                        
                        container.appendChild(btn);
                        console.log(`${grade} - ${lesson.id}„ÅÆ„Éú„Çø„É≥„ÇíËøΩÂä†`);
                    });
                    
                    console.log(`${grade}„ÅÆ„É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÂÆå‰∫Ü`);
                });
                
                console.log('ÂÖ®„É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÂÆå‰∫Ü');
                
            } catch (e) {
                console.error('„É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñ„Ç®„É©„Éº:', e);
            }
        }

        /* ----------------- „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñÔºàÂÆåÂÖ®ÁâàÔºâ ----------------- */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=== ONE WORLD Quiz ÂàùÊúüÂåñÈñãÂßã ===');
            
            try {
                console.log('1. „ÇØ„É™„ÉÉ„ÇØÁµ±Ë®àË™≠„ÅøËæº„ÅøÈñãÂßã');
                loadClickStats();
                console.log('‚úÖ „ÇØ„É™„ÉÉ„ÇØÁµ±Ë®àË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
                
                console.log('2. „É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÈñãÂßã');
                initLessonsAndGrammar();
                console.log('‚úÖ „É¨„ÉÉ„Çπ„É≥ÂàùÊúüÂåñÂÆå‰∫Ü');
                
                console.log('3. „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂàùÊúüÂåñÈñãÂßã');
                initEventListeners();
                console.log('‚úÖ „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºÂàùÊúüÂåñÂÆå‰∫Ü');
                
                // Èö†„Åó„Å¶„Åä„Åè„Åπ„ÅçË¶ÅÁ¥†
                const gameScreen = document.getElementById('gameScreen');
                if (gameScreen) {
                    gameScreen.classList.add('hidden');
                }
                
                // ÂàùÊúüÁîªÈù¢Ë®≠ÂÆö
                currentScreen = 'main';
                updateBackButton();
                
                // ÂàùÊúüÂÄ§Ë®≠ÂÆöÔºàÁÑ°Âà∂Èôê„Çø„Ç§„Éû„ÉºÂØæÂøúÔºâ
                setTimerLimit(3);
                setQuestionMode('random');
                setQuestionDirection('jp_to_en');
                
                resetLessonSelections();
                
                console.log('4. ÂàùÊúüË®≠ÂÆöÂÆå‰∫Ü');
                
                // Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÅÆËøΩÂä†ÂàùÊúüÂåñÔºàÈÅÖÂª∂ÂÆüË°åÔºâ
                setTimeout(() => {
                    if (voiceSystem.voices.length === 0) {
                        console.log('Èü≥Â£∞ÂÜçÂàùÊúüÂåñÂÆüË°å');
                        voiceSystem.loadVoices();
                    }
                }, 2000);
                
                console.log('=== ÂàùÊúüÂåñÂÆå‰∫Ü ===');
                console.log(`Â≠¶Âπ¥Âà•„É¨„ÉÉ„Çπ„É≥Êï∞: 1Âπ¥Áîü=${lessons.grade1.length}, 2Âπ¥Áîü=${lessons.grade2.length}, 3Âπ¥Áîü=${lessons.grade3.length}`);
                console.log('„Éá„Éê„Ç§„ÇπÊÉÖÂ†±:', voiceSystem.getDeviceInfo());
                console.log(`‰∏≠3ÂïèÈ°å„Éá„Éº„Çø: ${Object.keys(sampleProblems.grade3).length}„É¨„ÉÉ„Çπ„É≥ÂàÜ„ÅÆ„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç`);
                
            } catch (error) {
                console.error('=== ÂàùÊúüÂåñ„Ç®„É©„Éº ===', error);
                alert('ÂàùÊúüÂåñ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        });

        /* ----------------- „Éá„Éê„ÉÉ„Ç∞Áî®„Ç≥„É≥„ÇΩ„Éº„É´ÊÉÖÂ†±ÔºàÊã°ÂÖÖÁâàÔºâ ----------------- */
        console.log('ONE WORLD Quiz „Çπ„ÇØ„É™„Éó„ÉàË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
        console.log('Âà©Áî®ÂèØËÉΩ„Å™Â≠¶Âπ¥:', Object.keys(lessons));
        console.log('ÂêÑÂ≠¶Âπ¥„ÅÆ„É¨„ÉÉ„Çπ„É≥Êï∞:', {
            grade1: lessons.grade1.length,
            grade2: lessons.grade2.length,
            grade3: lessons.grade3.length
        });
        console.log('‰∏≠3ÂïèÈ°å„Éá„Éº„ÇøÁ¢∫Ë™ç:', {
            review_lesson: Object.keys(sampleProblems.grade3.review_lesson || {}).length + 'È†ÖÁõÆ',
            lesson1: Object.keys(sampleProblems.grade3.lesson1 || {}).length + 'È†ÖÁõÆ',
            lesson2: Object.keys(sampleProblems.grade3.lesson2 || {}).length + 'È†ÖÁõÆ',
            lesson3: Object.keys(sampleProblems.grade3.lesson3 || {}).length + 'È†ÖÁõÆ',
            lesson4: Object.keys(sampleProblems.grade3.lesson4 || {}).length + 'È†ÖÁõÆ',
            lesson5: Object.keys(sampleProblems.grade3.lesson5 || {}).length + 'È†ÖÁõÆ',
            lesson6: Object.keys(sampleProblems.grade3.lesson6 || {}).length + 'È†ÖÁõÆ'
        });

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÖ¨ÈñãÔºà„Éá„Éê„ÉÉ„Ç∞Áî®„ÉªÊã°ÂÖÖÁâàÔºâ
        window.oneWorldQuizDebug = {
            lessons,
            sampleProblems,
            clickStats,
            selectedLessons,
            selectedGrammarItems,
            allQuestions,
            incrementClickCount,
            currentScreen,
            voiceSystem,
            soundSystem,
            resetLessonSelections,
            resetQuizState,
            // „Éá„Éê„ÉÉ„Ç∞Áî®Èñ¢Êï∞
            testVoice: () => {
                console.log('Èü≥Â£∞„ÉÜ„Çπ„ÉàÈñãÂßã');
                voiceSystem.speak("This is a voice test. Hello World!");
            },
            getDeviceInfo: () => voiceSystem.getDeviceInfo(),
            resetClickStats: () => {
                clickStats = { total: 0, daily: {} };
                saveClickStats();
                updateClickDisplays();
            },
            checkLessonButtons: () => {
                console.log('=== „É¨„ÉÉ„Çπ„É≥„Éú„Çø„É≥„ÉÅ„Çß„ÉÉ„ÇØ ===');
                ['grade1', 'grade2', 'grade3'].forEach(grade => {
                    const container = document.getElementById(`${grade}Lessons`);
                    const buttons = container ? container.querySelectorAll('.lesson-btn') : [];
                    console.log(`${grade}: ${buttons.length}ÂÄã„ÅÆ„Éú„Çø„É≥`);
                    buttons.forEach((btn, index) => {
                        console.log(`  ${index + 1}. ID: ${btn.dataset.lessonId}, „ÉÜ„Ç≠„Çπ„Éà: ${btn.textContent.substring(0, 30)}...`);
                    });
                });
            },
            testLessonSelection: (grade, lessonId) => {
                console.log('„É¨„ÉÉ„Çπ„É≥ÈÅ∏Êäû„ÉÜ„Çπ„Éà:', grade, lessonId);
                const lesson = lessons[grade].find(l => l.id === lessonId);
                if (lesson) {
                    toggleLessonSelection(grade, lessonId, lesson.name);
                } else {
                    console.error('„É¨„ÉÉ„Çπ„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                }
            },
            testSpecificVoice: (gender) => {
                console.log(`${gender}Èü≥Â£∞„ÉÜ„Çπ„ÉàÈñãÂßã`);
                voiceSystem.testVoice(gender);
            },
            checkGrade3Problems: () => {
                console.log('=== ‰∏≠3ÂïèÈ°å„Éá„Éº„ÇøË©≥Á¥∞„ÉÅ„Çß„ÉÉ„ÇØ ===');
                const grade3Data = sampleProblems.grade3;
                Object.keys(grade3Data).forEach(lessonId => {
                    console.log(`${lessonId}:`);
                    Object.keys(grade3Data[lessonId]).forEach(grammarId => {
                        const problems = grade3Data[lessonId][grammarId];
                        console.log(`  ${grammarId}: ${problems.length}Âïè`);
                        problems.forEach((problem, index) => {
                            console.log(`    ${index + 1}. ${problem.jp} ‚Üí ${problem.en}`);
                        });
                    });
                });
            },
            testGrade3Selection: () => {
                console.log('‰∏≠3ÈÅ∏Êäû„ÉÜ„Çπ„ÉàÂÆüË°å');
                currentGrade = 'grade3';
                selectedLessons = [{id: 'lesson1', name: 'Lesson1 - ÁèæÂú®ÂÆå‰∫ÜÂΩ¢(1)', grade: 'grade3'}];
                selectedGrammarItems = [{
                    key: 'lesson1_present_perfect_completion',
                    lessonId: 'lesson1',
                    grammarId: 'present_perfect_completion',
                    name: '1. „Äå„Äú„ÅóÁµÇ„Åà„Åü„Äç„Åì„Å®„Çí‰ºù„Åà„Çã„Å®„ÅçÔºàÁèæÂú®ÂÆå‰∫ÜÂΩ¢„ÅÆÂÆå‰∫ÜÁî®Ê≥ïÔºâ',
                    grade: 'grade3'
                }];
                prepareQuestions();
                console.log('Ê∫ñÂÇô„Åï„Çå„ÅüÂïèÈ°å:', allQuestions);
            }
        };

        // „Ç∞„É≠„Éº„Éê„É´Èñ¢Êï∞„Å®„Åó„Å¶ÂÖ¨ÈñãÔºà„É™„Çª„ÉÉ„ÉàÊ©üËÉΩ„ÄÅÈü≥Â£∞Ê©üËÉΩÔºâ
        window.confirmResetTotal = confirmResetTotal;
        window.confirmResetToday = confirmResetToday;
        window.selectAndTestVoice = selectAndTestVoice;
        window.testDeviceVoice = testDeviceVoice;
        window.closeVoiceSettings = closeVoiceSettings;

    </script>
</body>
</html>