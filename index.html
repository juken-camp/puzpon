<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>üê± NEKOPON Quiz üê±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="problems.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-brown: #8b4513;
            --light-brown: #d2691e;
            --cream: #faf8f5;
            --white: #ffffff;
            --soft-orange: #ff7f50;
            --gold: #ffd700;
            --pink: #ffb6c1;
            --shadow: rgba(139,69,19,0.25);
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background: var(--cream);
            color: var(--primary-brown);
            font-weight: 700;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;
            -ms-text-size-adjust: none;
            text-size-adjust: none;
            cursor: pointer;
        }

        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }

        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }

        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }

        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }

        .game-title {
            font-family: 'Fredoka One', cursive;
            font-weight: 400;
            font-size: clamp(1.2rem, 3.5vw, 1.8rem);
            color: var(--light-brown);
            text-align: center;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 8px var(--shadow);
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            user-select: none;
            opacity: 0;
            animation: title-enter 1.5s ease-out 0.2s forwards;
            white-space: nowrap;
            overflow: hidden;
        }

        .game-title:hover {
            transform: scale(1.05);
        }

        .game-title.title-bounce {
            animation: title-bounce 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes title-enter {
            0% { 
                opacity: 0; 
                transform: translateY(-30px) scale(0.8); 
            }
            60% { 
                opacity: 1; 
                transform: translateY(5px) scale(1.1); 
            }
            80% { 
                transform: translateY(-2px) scale(1.05); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        @keyframes title-bounce {
            0% { transform: scale(1) rotate(0deg); }
            15% { transform: scale(1.1) rotate(2deg); }
            30% { transform: scale(1.18) rotate(-1deg); }
            45% { transform: scale(1.25) rotate(1deg); }
            60% { transform: scale(1.15) rotate(-0.5deg); }
            75% { transform: scale(1.08) rotate(0.5deg); }
            85% { transform: scale(1.03) rotate(-0.2deg); }
            95% { transform: scale(1.01) rotate(0.1deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        .cat-icon {
            display: inline-block;
            cursor: pointer;
            font-size: clamp(24px, 3vw, 32px);
            margin: 0 4px;
            transition: transform 0.1s ease-out;
            animation: cat-icon-sparkle 3s ease-in-out infinite;
        }

        .cat-icon:hover {
            transform: scale(1.2) rotate(15deg) !important;
        }

        .cat-icon.bounce {
            animation: cat-bounce 0.8s ease-in-out !important;
        }

        @keyframes cat-icon-sparkle {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(2deg); }
            50% { transform: scale(1.1) rotate(-1deg); }
            75% { transform: scale(1.05) rotate(1deg); }
        }

        @keyframes cat-bounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.4) rotate(15deg); }
            50% { transform: scale(1.6) rotate(-10deg); }
            75% { transform: scale(1.3) rotate(12deg); }
        }

        /* „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ÔºàÊñ∞Ê©üËÉΩÔºâ */
        .point-header {
            position: sticky;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
            z-index: 1000;
            background: rgba(255,255,255,0.4);
            padding: 8px 20px;
            border-radius: 25px;
            backdrop-filter: blur(15px);
            box-shadow: 
                0 8px 32px rgba(139,69,19,0.15),
                inset 0 1px 0 rgba(255,255,255,0.3);
            margin: 10px auto 20px auto;
            width: fit-content;
            opacity: 0;
            animation: point-header-enter 1.2s ease-out 0.5s forwards;
        }

        @keyframes point-header-enter {
            0% { 
                opacity: 0; 
                transform: translateX(-50%) translateY(-20px) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0) scale(1); 
            }
        }

        .point-item {
            font-size: 16px;
            color: var(--primary-brown);
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            transition: all 0.3s ease;
            opacity: 1;
            cursor: pointer;
            border-radius: 15px;
            padding: 6px 10px;
            position: relative;
        }

        .point-item:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .point-item:nth-child(1) {
            animation: point-enter-sparkle 1s ease-out 0.8s forwards;
        }

        .point-item:nth-child(2) {
            animation: point-enter-fire 1s ease-out 1.0s forwards;
        }

        .point-item:nth-child(3) {
            animation: point-enter-trophy 1s ease-out 1.2s forwards;
        }

        .point-item:nth-child(1):not(.tap-sparkle) {
            animation: point-enter-sparkle 1s ease-out 0.8s forwards, gentle-sparkle 4s ease-in-out 2s infinite;
        }

        .point-item:nth-child(2):not(.tap-fire) {
            animation: point-enter-fire 1s ease-out 1.0s forwards, gentle-fire 3.5s ease-in-out 2.5s infinite;
        }

        .point-item:nth-child(3):not(.tap-trophy) {
            animation: point-enter-trophy 1s ease-out 1.2s forwards, gentle-trophy 5s ease-in-out 3s infinite;
        }

        .point-item.pulse {
            animation: point-pulse 0.6s ease-in-out !important;
        }

        .point-item.tap-sparkle {
            animation: tap-sparkle 0.8s ease-out !important;
        }

        .point-item.tap-fire {
            animation: tap-fire 0.8s ease-out !important;
        }

        .point-item.tap-trophy {
            animation: tap-trophy 0.8s ease-out !important;
        }

        @keyframes point-enter-sparkle {
            0% { 
                opacity: 0; 
                transform: translateY(-15px) scale(0.7); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(3px) scale(1.2); 
                filter: brightness(1.5) drop-shadow(0 0 10px gold);
            }
            70% { 
                transform: translateY(-2px) scale(1.1); 
            }
            100% { 
                opacity: 1 !important; 
                transform: translateY(0) scale(1); 
                filter: brightness(1);
            }
        }

        @keyframes point-enter-fire {
            0% { 
                opacity: 0; 
                transform: translateY(-15px) scale(0.7) rotate(-10deg); 
            }
            50% { 
                opacity: 1; 
                transform: translateY(3px) scale(1.3) rotate(5deg); 
                filter: brightness(1.8) hue-rotate(45deg);
            }
            70% { 
                transform: translateY(-2px) scale(1.1) rotate(-2deg); 
            }
            100% { 
                opacity: 1 !important; 
                transform: translateY(0) scale(1) rotate(0deg); 
                filter: brightness(1);
            }
        }

        @keyframes point-enter-trophy {
            0% { 
                opacity: 0; 
                transform: translateY(-15px) scale(0.7); 
            }
            40% { 
                opacity: 1; 
                transform: translateY(5px) scale(1.4); 
                filter: brightness(2) drop-shadow(0 0 15px orange);
            }
            60% { 
                transform: translateY(-3px) scale(1.2); 
            }
            80% { 
                transform: translateY(1px) scale(1.05); 
            }
            100% { 
                opacity: 1 !important; 
                transform: translateY(0) scale(1); 
                filter: brightness(1);
            }
        }

        @keyframes point-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.5); }
        }

        @keyframes tap-sparkle {
            0% { transform: scale(1); filter: brightness(1); }
            30% { transform: scale(1.4) rotate(5deg); filter: brightness(2) drop-shadow(0 0 20px gold) saturate(2); }
            60% { transform: scale(1.2) rotate(-3deg); filter: brightness(1.8) drop-shadow(0 0 15px gold); }
            100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
        }

        @keyframes tap-fire {
            0% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            25% { transform: scale(1.5) rotate(8deg); filter: brightness(3) hue-rotate(90deg) saturate(3); }
            50% { transform: scale(1.3) rotate(-5deg); filter: brightness(2.5) hue-rotate(45deg) saturate(2); }
            75% { transform: scale(1.1) rotate(3deg); filter: brightness(1.8) hue-rotate(20deg); }
            100% { transform: scale(1) rotate(0deg); filter: brightness(1); }
        }

        @keyframes tap-trophy {
            0% { transform: scale(1); filter: brightness(1); }
            20% { transform: scale(1.6) translateY(-5px); filter: brightness(4) drop-shadow(0 0 25px orange) saturate(3); }
            40% { transform: scale(1.4) translateY(-2px); filter: brightness(3) drop-shadow(0 0 20px gold); }
            60% { transform: scale(1.2) translateY(0px); filter: brightness(2) drop-shadow(0 0 15px orange); }
            80% { transform: scale(1.05) translateY(0px); filter: brightness(1.5); }
            100% { transform: scale(1) translateY(0px); filter: brightness(1); }
        }

        @keyframes gentle-sparkle {
            0%, 100% { filter: brightness(1); transform: scale(1); }
            50% { filter: brightness(1.2) drop-shadow(0 0 5px gold); transform: scale(1.02); }
        }

        @keyframes gentle-fire {
            0%, 100% { filter: brightness(1); transform: scale(1) rotate(0deg); }
            33% { filter: brightness(1.3) hue-rotate(15deg); transform: scale(1.03) rotate(1deg); }
            66% { filter: brightness(1.1) hue-rotate(-10deg); transform: scale(1.01) rotate(-1deg); }
        }

        @keyframes gentle-trophy {
            0%, 100% { filter: brightness(1); transform: scale(1); }
            50% { filter: brightness(1.4) drop-shadow(0 0 8px orange); transform: scale(1.04); }
        }

        /* „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Çπ„Ç≥„Ç¢ÔºàÊñ∞Ê©üËÉΩÔºâ */
        .floating-points {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: #ff6347;
            pointer-events: none;
            z-index: 1200;
            text-shadow: 2px 2px 8px rgba(139,69,19,0.3);
            animation: float-points 2s ease-out forwards;
            white-space: nowrap;
        }

        .floating-points.bonus {
            font-size: 26px;
            color: #ffd700;
            animation: float-bonus-points 2.5s ease-out forwards;
        }

        .floating-points.mega {
            font-size: 32px;
            color: #ff1493;
            animation: float-mega-points 3s ease-out forwards;
        }

        @keyframes float-points {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
        }

        @keyframes float-bonus-points {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            40% { opacity: 1; transform: translateY(-30px) scale(1.8) rotate(180deg); }
            70% { opacity: 1; transform: translateY(-60px) scale(2.2) rotate(270deg); }
            100% { opacity: 0; transform: translateY(-120px) scale(3) rotate(540deg); }
        }

        @keyframes float-mega-points {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            30% { opacity: 1; transform: translateY(-40px) scale(2.5) rotate(120deg); }
            60% { opacity: 1; transform: translateY(-100px) scale(4) rotate(240deg); }
            100% { opacity: 0; transform: translateY(-200px) scale(6) rotate(720deg); }
        }

        /* „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÔºàÊñ∞Ê©üËÉΩÔºâ */
        .neko-particle {
            position: absolute;
            font-size: 20px;
            pointer-events: none;
            z-index: 1100;
            animation: particle-burst 2s ease-out forwards;
        }

        @keyframes particle-burst {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            20% { opacity: 1; transform: scale(1.5) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(720deg) translateY(-80px); }
        }

        .clean-card {
            background: var(--white);
            border: 2px solid var(--light-brown);
            border-radius: 20px;
            box-shadow: 0 8px 24px var(--shadow);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .clean-button {
            background: var(--light-brown);
            border: none;
            color: white;
            font-weight: 700;
            border-radius: 25px;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .clean-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow);
            background: var(--soft-orange);
        }

        .clean-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .clean-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .subject-btn, .category-btn {
            background: var(--white);
            border: 3px solid var(--light-brown);
            border-radius: 15px;
            color: var(--primary-brown);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            cursor: pointer;
            text-align: center;
        }

        .subject-btn:hover, .category-btn:hover {
            border-color: var(--soft-orange);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 28px var(--shadow);
            background: #fff8f0;
        }

        .subject-btn.active, .category-btn.active {
            background: #ffe4cc;
            border-color: var(--soft-orange);
            color: var(--soft-orange);
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 28px var(--shadow);
        }

        .category-btn {
            padding: 0.5rem 0.75rem !important;
            min-height: 50px !important;
            font-size: 0.85rem !important;
            line-height: 1.2 !important;
        }

        .category-btn:hover {
            transform: translateY(-2px) scale(1.01) !important;
        }

        .category-btn.active {
            transform: translateY(-2px) scale(1.01) !important;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(139,69,19,0.4);
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal.show {
            display: flex;
            animation: modalFadeIn 0.5s ease-out;
        }

        .modal.unit-modal {
            align-items: flex-start;
            padding: 0.5rem;
            overflow-y: auto;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .floating-msg {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-brown);
            pointer-events: none;
            z-index: 1100;
            animation: float-up 2.5s ease-out forwards;
            text-shadow: 1px 1px 4px rgba(255,255,255,0.8);
            white-space: nowrap;
        }

        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
        }

        .particle {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            z-index: 1100;
            animation: particle-burst 2s ease-out forwards;
        }

        .quiz-option {
            background: var(--white);
            border: 3px solid var(--light-brown);
            color: var(--primary-brown);
            border-radius: 15px;
            padding: 0.75rem 1rem;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-weight: 700;
            font-size: 0.9rem;
            position: relative;
            box-shadow: 0 4px 12px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }

        .quiz-option:hover {
            border-color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow);
            background: #fff8f0;
        }

        .quiz-explanation {
            height: 150px;
            background: #fff8f0;
            border-radius: 15px;
            padding: 0.75rem;
            margin-top: 1rem;
            border: 3px solid var(--light-brown);
            display: flex;
            align-items: flex-start;
            justify-content: center;
            text-align: center;
            overflow-y: auto;
            box-sizing: border-box;
            font-size: 1rem;
            line-height: 1.4;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
        }

        .quiz-explanation p {
            margin: 0;
            padding: 0;
            word-wrap: break-word;
            max-height: 100%;
            overflow: hidden;
            font-size: 1rem;
        }

        .quiz-explanation.has-content {
            border-color: var(--soft-orange);
            background: #ffe4cc;
        }

        .back-button {
            background: #f8f4f0;
            border: 2px solid var(--light-brown);
            color: var(--primary-brown);
            border-radius: 15px;
            padding: 0.5rem 1rem;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: 0.9rem;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }

        .back-button:hover {
            background: #fff8f0;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        .mode-btn {
            background: var(--white);
            border: 3px solid var(--light-brown);
            border-radius: 12px;
            color: var(--primary-brown);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 0.5rem;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            cursor: pointer;
        }

        .mode-btn:hover {
            border-color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
            background: #fff8f0;
        }

        .mode-btn.active {
            background: #ffe4cc;
            border-color: var(--soft-orange);
            color: var(--soft-orange);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow);
        }

        .stats-display {
            background: #fff8f0;
            border: 2px solid var(--light-brown);
            border-radius: 20px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 12px var(--shadow);
        }

        .floating-button {
            position: fixed !important;
            bottom: 24px !important;
            left: 24px !important;
            right: auto !important;
            margin: 0 !important;
            transform: none !important;
            width: 56px;
            height: 56px;
            background: var(--light-brown);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px var(--shadow);
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            z-index: 1002;
            cursor: pointer;
        }

        .floating-button.hidden {
            display: none !important;
        }

        .floating-button:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 24px var(--shadow);
            background: var(--soft-orange);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--white);
            color: var(--primary-brown);
            padding: 12px 16px;
            border-radius: 20px;
            border: 2px solid var(--light-brown);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            box-shadow: 0 6px 20px var(--shadow);
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
        }

        .notification.show {
            transform: translateX(0);
        }

        .subject-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .category-grid {
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
            gap: 0.4rem !important;
        }

        .section-divider {
            height: 2px;
            background: var(--light-brown);
            margin: 1rem 0;
            border-radius: 1px;
        }

        .grade-label {
            font-size: 0.7rem !important;
            font-weight: 700;
            color: var(--light-brown);
            text-align: center;
            margin: 0.5rem 0 0.3rem 0 !important;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .score-pulse {
            animation: score-pulse 0.6s ease-in-out;
        }

        @keyframes score-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.3); }
        }

        .tap-effect {
            position: relative;
            overflow: visible;
        }

        .tap-effect::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--gold);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            pointer-events: none;
            z-index: 1050;
        }

        .tap-effect.tapped::after {
            animation: tap-ripple 0.6s ease-out;
        }

        @keyframes tap-ripple {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }

        .subject-modal-content {
            max-height: 85vh;
            overflow-y: auto;
            padding-top: 0;
        }
        
        .modal .clean-card {
            margin: 2rem 1rem 1rem 1rem;
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal.unit-modal .clean-card {
            margin: 0.25rem 1rem 1rem 1rem;
            max-height: 94vh;
            overflow-y: auto;
            padding: 1rem;
        }

        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }

            .point-header {
                gap: 12px;
                padding: 6px 16px;
                margin: 8px auto 15px auto;
            }

            .point-item {
                font-size: 14px;
                gap: 4px;
                padding: 4px 8px;
            }

            .modal .clean-card {
                margin: 1.5rem 0.25rem 0.25rem 0.25rem;
                padding: 0.75rem;
                max-height: 92vh;
            }

            .modal.unit-modal .clean-card {
                margin: 0.1rem 0.25rem 0.25rem 0.25rem !important;
                padding: 0.6rem 0.75rem 0.8rem 0.75rem !important;
                max-height: 98vh !important;
            }

            .floating-button {
                bottom: 20px !important;
                left: 20px !important;
                right: auto !important;
                width: 52px;
                height: 52px;
                font-size: 20px;
            }

            .clean-card {
                margin: 0.5rem;
                padding: 1rem;
            }

            .clean-card:last-of-type {
                margin-bottom: 4rem;
            }

            body {
                padding-bottom: 5rem;
            }

            .game-title {
                font-size: clamp(1rem, 4vw, 1.5rem);
                letter-spacing: 0.5px;
            }
            
            .cat-icon {
                font-size: clamp(20px, 4vw, 28px);
                margin: 0 2px;
            }

            .subject-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }

            .category-grid {
                grid-template-columns: 1fr !important;
                gap: 0.3rem !important;
            }

            .subject-btn, .category-btn {
                padding: 0.75rem 0.5rem;
                min-height: 70px;
                font-size: 0.8rem;
            }

            .category-btn {
                padding: 0.4rem 0.5rem !important;
                min-height: 45px !important;
                font-size: 0.8rem !important;
                line-height: 1.1 !important;
            }

            .quiz-option {
                padding: 0.5rem 0.75rem;
                font-size: 0.85rem;
            }

            #quizQ {
                font-size: 0.9rem;
                line-height: 1.3;
            }

            .quiz-explanation {
                height: 120px;
                padding: 0.5rem;
                font-size: 0.9rem;
                line-height: 1.3;
            }

            .quiz-explanation p {
                font-size: 0.9rem;
            }

            .grade-label {
                margin: 0.4rem 0 0.25rem 0 !important;
            }

            .floating-points {
                font-size: 18px;
            }

            .floating-points.bonus {
                font-size: 22px;
            }

            .floating-points.mega {
                font-size: 26px;
            }
        }

        @media (max-width: 380px) {
            .game-title {
                font-size: clamp(0.9rem, 4.5vw, 1.3rem);
                letter-spacing: 0px;
            }
            
            .cat-icon {
                font-size: clamp(18px, 4.5vw, 24px);
                margin: 0 1px;
            }

            .point-header {
                gap: 10px;
                padding: 5px 14px;
            }

            .point-item {
                font-size: 13px;
                gap: 3px;
                padding: 3px 6px;
            }
        }

        button, .subject-btn, .category-btn, .quiz-option, .clean-button, .back-button, .mode-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }

        * {
            touch-action: manipulation;
        }

        input, select, textarea {
            font-size: 16px;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pt-6 pb-12 gap-6 relative">
    <!-- „É°„Ç§„É≥„ÅÆÊïôÁßëÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="mainSubjectModal" class="modal show">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header" id="pointHeader">
                <div class="point-item" id="sparkleItem">‚ú® <span id="sparklePoints">0</span></div>
                <div class="point-item" id="fireItem">üî• <span id="firePoints">0</span></div>
                <div class="point-item" id="trophyItem">üèÜ <span id="trophyPoints">0</span></div>
            </div>

            <div class="text-center mb-6">
                <h1 class="game-title" id="gameTitle">
                    <span class="cat-icon" id="leftCat">üê±</span>NEKOPON Quiz<span class="cat-icon" id="rightCat">üê±</span>
                </h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üìö ÊïôÁßë„ÇíÈÅ∏„Å∂„Å´„ÇÉ„Äú‚ô™
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åó„Åü„ÅÑÊïôÁßë„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>„Éù„Ç§„É≥„Éà„ÇÇ„ÇØ„É™„ÉÉ„ÇØ„ÅßÁ®º„Åí„Çã„Å´„ÇÉ„Äú‚ú®</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect" data-subject="social">
                    <div class="subject-icon text-2xl mb-1">üåç</div>
                    <div class="subject-name font-semibold text-sm">Á§æ‰ºö</div>
                </button>
                <button class="subject-btn tap-effect" data-subject="science">
                    <div class="subject-icon text-2xl mb-1">üî¨</div>
                    <div class="subject-name font-semibold text-sm">ÁêÜÁßë</div>
                </button>
                <button class="subject-btn tap-effect" data-subject="english">
                    <div class="subject-icon text-2xl mb-1">üìñ</div>
                    <div class="subject-name font-semibold text-sm">Ëã±Ë™û</div>
                </button>
            </div>
        </div>
    </div>

    <!-- Á§æ‰ºö„É¢„Éº„ÉÄ„É´ -->
    <div id="socialModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem2">‚ú® <span id="sparklePoints2">0</span></div>
                <div class="point-item" id="fireItem2">üî• <span id="firePoints2">0</span></div>
                <div class="point-item" id="trophyItem2">üèÜ <span id="trophyPoints2">0</span></div>
            </div>

            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üåç Á§æ‰ºö
                </h2>
                <p class="text-gray-600 text-sm">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect" data-category="geography">
                    <div class="subject-icon text-2xl mb-1">üó∫Ô∏è</div>
                    <div class="subject-name font-semibold text-sm">Âú∞ÁêÜ</div>
                </button>
                <button class="subject-btn tap-effect" data-category="history">
                    <div class="subject-icon text-2xl mb-1">üèõÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">Ê≠¥Âè≤</div>
                </button>
                <button class="subject-btn tap-effect" data-category="civics">
                    <div class="subject-icon text-2xl mb-1">‚öñÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">ÂÖ¨Ê∞ë</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÁêÜÁßë„É¢„Éº„ÉÄ„É´ -->
    <div id="scienceModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem3">‚ú® <span id="sparklePoints3">0</span></div>
                <div class="point-item" id="fireItem3">üî• <span id="firePoints3">0</span></div>
                <div class="point-item" id="trophyItem3">üèÜ <span id="trophyPoints3">0</span></div>
            </div>

            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üî¨ ÁêÜÁßë
                </h2>
                <p class="text-gray-600 text-sm">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect" data-category="chemistry">
                    <div class="subject-icon text-2xl mb-1">üß™</div>
                    <div class="subject-name font-semibold text-sm">ÂåñÂ≠¶</div>
                </button>
                <button class="subject-btn tap-effect" data-category="biology">
                    <div class="subject-icon text-2xl mb-1">üß¨</div>
                    <div class="subject-name font-semibold text-sm">ÁîüÁâ©</div>
                </button>
                <button class="subject-btn tap-effect" data-category="physics">
                    <div class="subject-icon text-2xl mb-1">‚öõÔ∏è</div>
                    <div class="subject-name font-semibold text-sm">Áâ©ÁêÜ</div>
                </button>
                <button class="subject-btn tap-effect" data-category="earth">
                    <div class="subject-icon text-2xl mb-1">üåç</div>
                    <div class="subject-name font-semibold text-sm">Âú∞Â≠¶</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±Ë™û„É¢„Éº„ÉÄ„É´ -->
    <div id="englishModal" class="modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem4">‚ú® <span id="sparklePoints4">0</span></div>
                <div class="point-item" id="fireItem4">üî• <span id="firePoints4">0</span></div>
                <div class="point-item" id="trophyItem4">üèÜ <span id="trophyPoints4">0</span></div>
            </div>

            <div class="text-center mb-6">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üìñ Ëã±Ë™û
                </h2>
                <p class="text-gray-600 text-sm">ÂàÜÈáé„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™</p>
            </div>
            <div class="grid subject-grid mb-6">
                <button class="subject-btn tap-effect" data-category="english_words">
                    <div class="subject-icon text-2xl mb-1">üìù</div>
                    <div class="subject-name font-semibold text-sm">Ëã±ÂçòË™û</div>
                </button>
                <button class="subject-btn tap-effect" data-category="english_phrases">
                    <div class="subject-icon text-2xl mb-1">üí¨</div>
                    <div class="subject-name font-semibold text-sm">Ëã±ÁÜüË™û</div>
                </button>
                <button class="subject-btn tap-effect" data-category="english_grammar">
                    <div class="subject-icon text-2xl mb-1">üìò</div>
                    <div class="subject-name font-semibold text-sm">Ë™ûÂΩ¢Â§âÂåñ</div>
                </button>
            </div>
            <div class="text-center">
                <button class="back-button tap-effect" onclick="goBackToMain()">
                    ‚Üê ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Âú∞ÁêÜ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="geographyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem5">‚ú® <span id="sparklePoints5">0</span></div>
                <div class="point-item" id="fireItem5">üî• <span id="firePoints5">0</span></div>
                <div class="point-item" id="trophyItem5">üèÜ <span id="trophyPoints5">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üó∫Ô∏è Âú∞ÁêÜ
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="geographyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startGeographyQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ê≠¥Âè≤„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="historyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem6">‚ú® <span id="sparklePoints6">0</span></div>
                <div class="point-item" id="fireItem6">üî• <span id="firePoints6">0</span></div>
                <div class="point-item" id="trophyItem6">üèÜ <span id="trophyPoints6">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üèõÔ∏è Ê≠¥Âè≤
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="historyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startHistoryQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÂÖ¨Ê∞ë„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="civicsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem7">‚ú® <span id="sparklePoints7">0</span></div>
                <div class="point-item" id="fireItem7">üî• <span id="firePoints7">0</span></div>
                <div class="point-item" id="trophyItem7">üèÜ <span id="trophyPoints7">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ‚öñÔ∏è ÂÖ¨Ê∞ë
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="civicsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startCivicsQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToSocial()">
                    ‚Üê Á§æ‰ºö„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÂåñÂ≠¶„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="chemistryModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem8">‚ú® <span id="sparklePoints8">0</span></div>
                <div class="point-item" id="fireItem8">üî• <span id="firePoints8">0</span></div>
                <div class="point-item" id="trophyItem8">üèÜ <span id="trophyPoints8">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üß™ ÂåñÂ≠¶
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="chemistryCategories"></div>
            <div class="text-center space-y-2">
                <button id="startChemistryQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- ÁîüÁâ©„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="biologyModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem9">‚ú® <span id="sparklePoints9">0</span></div>
                <div class="point-item" id="fireItem9">üî• <span id="firePoints9">0</span></div>
                <div class="point-item" id="trophyItem9">üèÜ <span id="trophyPoints9">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üß¨ ÁîüÁâ©
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="biologyCategories"></div>
            <div class="text-center space-y-2">
                <button id="startBiologyQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Áâ©ÁêÜ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="physicsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem10">‚ú® <span id="sparklePoints10">0</span></div>
                <div class="point-item" id="fireItem10">üî• <span id="firePoints10">0</span></div>
                <div class="point-item" id="trophyItem10">üèÜ <span id="trophyPoints10">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ‚öõÔ∏è Áâ©ÁêÜ
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="physicsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startPhysicsQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Âú∞Â≠¶„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="earthModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem11">‚ú® <span id="sparklePoints11">0</span></div>
                <div class="point-item" id="fireItem11">üî• <span id="firePoints11">0</span></div>
                <div class="point-item" id="trophyItem11">üèÜ <span id="trophyPoints11">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üåç Âú∞Â≠¶
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="earthCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEarthQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToScience()">
                    ‚Üê ÁêÜÁßë„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±ÂçòË™û„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishWordsModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem12">‚ú® <span id="sparklePoints12">0</span></div>
                <div class="point-item" id="fireItem12">üî• <span id="firePoints12">0</span></div>
                <div class="point-item" id="trophyItem12">üèÜ <span id="trophyPoints12">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üìù Ëã±ÂçòË™û
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishWordsCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishWordsQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ëã±ÁÜüË™û„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishPhrasesModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem13">‚ú® <span id="sparklePoints13">0</span></div>
                <div class="point-item" id="fireItem13">üî• <span id="firePoints13">0</span></div>
                <div class="point-item" id="trophyItem13">üèÜ <span id="trophyPoints13">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üí¨ Ëã±ÁÜüË™û
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishPhrasesCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishPhrasesQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- Ë™ûÂΩ¢Â§âÂåñ„ÅÆÂçòÂÖÉÈÅ∏Êäû„É¢„Éº„ÉÄ„É´ -->
    <div id="englishGrammarModal" class="modal unit-modal">
        <div class="clean-card p-6 container-spacing subject-modal-content">
            <!-- „Éù„Ç§„É≥„ÉàÁç≤Âæó„Ç®„É™„Ç¢ -->
            <div class="point-header">
                <div class="point-item" id="sparkleItem14">‚ú® <span id="sparklePoints14">0</span></div>
                <div class="point-item" id="fireItem14">üî• <span id="firePoints14">0</span></div>
                <div class="point-item" id="trophyItem14">üèÜ <span id="trophyPoints14">0</span></div>
            </div>

            <div class="text-center mb-4">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    üìò Ë™ûÂΩ¢Â§âÂåñ
                </h2>
                <p class="text-gray-600 text-sm">Â≠¶Áøí„Åô„ÇãÂçòÂÖÉ„ÇíÈÅ∏„Çì„Åß„Åª„Åó„ÅÑ„Å´„ÇÉ„Çì‚ô™<br>Ë§áÊï∞ÈÅ∏Êäû„ÇÇ„Åß„Åç„Çã„Å´„ÇÉ„Äú‚ô™</p>
            </div>
            <div class="grid category-grid mb-4" id="englishGrammarCategories"></div>
            <div class="text-center space-y-2">
                <button id="startEnglishGrammarQuiz" class="clean-button px-6 py-2 text-sm tap-effect" disabled>
                    Ê±∫ÂÆö„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                </button>
                <br>
                <button class="back-button tap-effect" onclick="goBackToEnglish()">
                    ‚Üê Ëã±Ë™û„Å´Êàª„Çã„Å´„ÇÉ„Äú
                </button>
            </div>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen" class="hidden">
        <div class="clean-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title">
                <span class="cat-icon">üê±</span>NEKOPON Quiz<span class="cat-icon">üê±</span>
            </h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4"></div>
            <div class="stats-display">
                <div class="grid grid-cols-3 gap-4 text-center mb-4">
                    <div>
                        <div class="text-xl font-bold text-gray-800" id="correctCount">0</div>
                        <div class="text-xs text-gray-600">Ê≠£Ëß£Êï∞„Å†„Å´„ÇÉ‚ô™</div>
                    </div>
                    <div>
                        <div class="text-xl font-bold text-gray-800" id="wrongCount">0</div>
                        <div class="text-xs text-gray-600">‰∏çÊ≠£Ëß£Êï∞„Å†„Å´„ÇÉ</div>
                    </div>
                    <div>
                        <div class="text-xl font-bold text-gray-800" id="totalCount">0</div>
                        <div class="text-xs text-gray-600">Á∑èÂïèÈ°åÊï∞„Å†„Å´„ÇÉ„Äú</div>
                    </div>
                </div>
                
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">üìã Âá∫È°åÂΩ¢Âºè„Å†„Å´„ÇÉ„Äú</div>
                    <div class="grid grid-cols-2 gap-2">
                        <button id="randomModeBtn" class="mode-btn active tap-effect" data-mode="random">
                            üé≤ „É©„É≥„ÉÄ„É†„Å´„ÇÉ
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn tap-effect" data-mode="sequential">
                            üìã È†ÜÁï™ÈÄö„Çä„Å´„ÇÉ
                        </button>
                    </div>
                    <div class="text-xs text-gray-600 mt-2" id="modeDescription">
                        ÂïèÈ°å„Çí„É©„É≥„ÉÄ„É†„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="clean-button px-6 py-3 text-base font-semibold mt-6 tap-effect">
                ‚ú® „Çπ„Çø„Éº„Éà„Å´„ÇÉ„Äú‚ô™
            </button>
        </div>
    </div>

    <!-- „ÇØ„Ç§„Ç∫„É¢„Éº„ÉÄ„É´ -->
    <div id="quizModal" class="modal">
        <div class="clean-card p-4 w-full max-w-lg mx-4">
            <div class="text-center mb-4">
                <h2 class="font-semibold text-lg text-gray-700">
                    ‚ú® NEKOPON Quiz ‚ú®
                </h2>
            </div>
            <div class="space-y-4">
                <p id="quizQ" class="text-base font-medium text-center text-gray-800 leading-relaxed"></p>
                <div id="quizOptions" class="space-y-2"></div>
                <div id="quizExplanation" class="quiz-explanation">
                    <p id="quizMsg" class="font-semibold text-center text-base"></p>
                </div>
                <div class="flex gap-2">
                    <button id="quizNext" class="flex-1 clean-button py-2 text-sm tap-effect">
                        üåü Ê¨°„ÅÆÂïèÈ°å„Å´„ÇÉ„Äú
                    </button>
                    <button id="quizBack" class="flex-1 back-button py-2 text-sm tap-effect">
                        üè† Êàª„Çã„Å´„ÇÉ„Äú
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éú„Çø„É≥ -->
    <button id="changeSubject" class="floating-button hidden tap-effect">
        üìö
    </button>

    <!-- ÈÄöÁü• -->
    <div id="notification" class="notification">
        <div class="flex items-center gap-3">
            <span class="text-xl">‚ú®</span>
            <div>
                <div class="font-semibold text-sm">NEKOPON Quiz</div>
                <div id="notificationText" class="text-xs text-gray-600"></div>
            </div>
        </div>
    </div>

    <script>
        /* ----------------- „Éù„Ç§„É≥„Éà„Ç∑„Çπ„ÉÜ„É†ÔºàÊñ∞Ê©üËÉΩÔºâ ----------------- */
        class NekoponPointSystem {
            constructor() {
                this.sparklePoints = 0;
                this.firePoints = 0;
                this.trophyPoints = 0;
                this.totalClicks = 0;
                
                this.sparkleMessages = [
                    '„Åç„ÇÉ„Éº‚ô™', '„Åç„Çâ„Åç„Çâ„Äú', '„Åæ„Å∂„Åó„ÅÑÔºÅ', '„Åô„Å¶„Åç‚ô™', '„Å¥„Åã„Å¥„Åã„Äú',
                    '„Å≤„Åã„Å£„Å¶„Çã„Äú', '„Åæ„Åª„ÅÜ‚ô™', '„Å†„ÅÑ„Åô„ÅçÔºÅ', '„Åç„Çå„ÅÑ„Äú', '„Çè„Éº„ÅÑ‚ô™'
                ];

                this.fireMessages = [
                    '„ÅÇ„Å§„ÅÇ„Å§„Äú', '„ÇÅ„Çâ„ÇÅ„ÇâÔºÅ', '„ÇÇ„Åà„ÇÇ„Åà„Äú', '„ÅΩ„Åã„ÅΩ„Åã‚ô™', '„ÅØ„Éº„Å®‚ô™',
                    '„Å†„ÅÑ„Åô„Åç„Äú', '„Çâ„Å∂„Çâ„Å∂‚ô™', '„ÅÇ„Å£„Åü„Åã„Äú', '„ÇÇ„Åµ„ÇÇ„Åµ„Äú', '„Åç„ÇÖ„Éº„Çì‚ô™'
                ];

                this.trophyMessages = [
                    '„Åô„Åî„ÅÑ„Å≠ÔºÅ', '„Åà„Çâ„ÅÑ„Åà„Çâ„ÅÑ‚ô™', '„ÇÑ„Å£„Åü„ÉºÔºÅ', '„Åå„Çì„Å∞„Å£„ÅüÔºÅ', 'ÊúÄÈ´ò„Å†„Å≠‚ô™',
                    '„Åï„ÅÑ„Åì„ÅÜ„Äú', '„Åß„Çì„Åõ„Å§ÔºÅ', '„Åç„Çá„ÅÜ„Çä„Çá„ÅèÔºÅ', '„Åô„Å∞„Çâ„Åó„ÅÑ‚ô™', '„Åã„Çì„Å©„ÅÜ„Äú'
                ];

                this.initPointItems();
            }

            initPointItems() {
                // „Åô„Åπ„Å¶„ÅÆ„Éù„Ç§„É≥„Éà„Ç¢„Ç§„ÉÜ„É†„Å´„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
                for (let i = 1; i <= 14; i++) {
                    const sparkleItem = document.getElementById(`sparkleItem${i === 1 ? '' : i}`);
                    const fireItem = document.getElementById(`fireItem${i === 1 ? '' : i}`);
                    const trophyItem = document.getElementById(`trophyItem${i === 1 ? '' : i}`);

                    if (sparkleItem) {
                        sparkleItem.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.tapPointItem('sparkle', sparkleItem);
                        });
                    }

                    if (fireItem) {
                        fireItem.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.tapPointItem('fire', fireItem);
                        });
                    }

                    if (trophyItem) {
                        trophyItem.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.tapPointItem('trophy', trophyItem);
                        });
                    }
                }
            }

            tapPointItem(type, element) {
                let bonusPoints, messages, particles, soundType;

                switch(type) {
                    case 'sparkle':
                        bonusPoints = 25;
                        messages = this.sparkleMessages;
                        particles = ['‚ú®', 'üí´', 'üåü', 'üíé', '‚≠ê'];
                        soundType = 'sparkle';
                        this.sparklePoints += bonusPoints;
                        element.classList.add('tap-sparkle');
                        setTimeout(() => element.classList.remove('tap-sparkle'), 800);
                        break;
                    
                    case 'fire':
                        bonusPoints = 15;
                        messages = this.fireMessages;
                        particles = ['üî•', 'üíï', '‚ù§Ô∏è', 'üíñ', 'üíù'];
                        soundType = 'fire';
                        this.firePoints += bonusPoints;
                        element.classList.add('tap-fire');
                        setTimeout(() => element.classList.remove('tap-fire'), 800);
                        break;
                    
                    case 'trophy':
                        bonusPoints = 50;
                        messages = this.trophyMessages;
                        particles = ['üèÜ', 'üëë', 'üéä', 'üéâ', 'üåü'];
                        soundType = 'trophy';
                        this.trophyPoints += bonusPoints;
                        element.classList.add('tap-trophy');
                        setTimeout(() => element.classList.remove('tap-trophy'), 800);
                        break;
                }

                this.totalClicks++;

                // „Çµ„Ç¶„É≥„ÉâÂÜçÁîü
                soundSystem.playSound(soundType);

                // „Éê„Ç§„Éñ„É¨„Éº„Ç∑„Éß„É≥Ôºà„Çø„Ç§„ÉóÂà•Ôºâ
                if (type === 'sparkle') {
                    soundSystem.vibrate([80, 30, 80, 30, 120]);
                } else if (type === 'fire') {
                    soundSystem.vibrate([100, 50, 100, 50, 150]);
                } else if (type === 'trophy') {
                    soundSystem.vibrate([150, 80, 150, 80, 200]);
                }

                // „Ç®„Éï„Çß„ÇØ„ÉàË°®Á§∫
                const rect = element.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;

                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ÁîüÊàê
                this.createPointParticles(centerX, centerY, particles, type === 'trophy' ? 8 : 6);

                // „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éù„Ç§„É≥„Éà
                this.showFloatingPoints(bonusPoints, centerX, centerY, type === 'trophy' ? 'bonus' : 'normal');

                // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
                const message = messages[Math.floor(Math.random() * messages.length)];
                showNekoMsg(message, centerX, centerY);

                // „Ç≥„É≥„Éú„ÉÅ„Çß„ÉÉ„ÇØ
                if (this.totalClicks % 10 === 0) {
                    this.triggerCombo(centerX, centerY);
                }

                this.updateAllPointDisplays();
            }

            triggerCombo(x, y) {
                const megaBonus = 100;
                this.sparklePoints += megaBonus;
                this.firePoints += megaBonus;
                this.trophyPoints += megaBonus;

                soundSystem.playSuccess();
                soundSystem.vibrate([200, 100, 200, 100, 300]);

                this.showFloatingPoints(megaBonus * 3, x, y, 'mega');
                this.createPointParticles(x, y, ['üéä', 'üéâ', 'üåü', 'üí´', '‚ú®', 'üèÜ', 'üëë'], 12);
                showNekoMsg('„Åô„Åî„ÅÑ„Ç≥„É≥„Éú„Å´„ÇÉ„Äú‚ô™', x, y);

                showNotification(`${this.totalClicks}Âõû„ÇØ„É™„ÉÉ„ÇØ„Ç≥„É≥„ÉúÈÅîÊàê„Å´„ÇÉ„Äú‚ô™`);
                this.updateAllPointDisplays();
            }

            createPointParticles(x, y, emojis, count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = 'neko-particle';
                        particle.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        particle.style.left = (x + (Math.random() - 0.5) * 60) + 'px';
                        particle.style.top = (y + (Math.random() - 0.5) * 60) + 'px';
                        document.body.appendChild(particle);
                        setTimeout(() => particle.remove(), 2000);
                    }, i * 50);
                }
            }

            showFloatingPoints(points, x, y, type = 'normal') {
                const element = document.createElement('div');
                element.className = `floating-points ${type}`;
                element.textContent = `+${this.formatNum(points)}`;
                element.style.left = Math.min(x, window.innerWidth - 100) + 'px';
                element.style.top = Math.min(y, window.innerHeight - 50) + 'px';
                document.body.appendChild(element);
                setTimeout(() => element.remove(), type === 'mega' ? 3000 : (type === 'bonus' ? 2500 : 2000));
            }

            updateAllPointDisplays() {
                // „Åô„Åπ„Å¶„ÅÆ„Éù„Ç§„É≥„ÉàË°®Á§∫„ÇíÊõ¥Êñ∞
                for (let i = 1; i <= 14; i++) {
                    const suffix = i === 1 ? '' : i;
                    const sparkleDisplay = document.getElementById(`sparklePoints${suffix}`);
                    const fireDisplay = document.getElementById(`firePoints${suffix}`);
                    const trophyDisplay = document.getElementById(`trophyPoints${suffix}`);

                    if (sparkleDisplay) sparkleDisplay.textContent = this.formatNum(this.sparklePoints);
                    if (fireDisplay) fireDisplay.textContent = this.formatNum(this.firePoints);
                    if (trophyDisplay) trophyDisplay.textContent = this.formatNum(this.trophyPoints);
                }
            }

            formatNum(n) {
                if (n >= 1e9) return Math.floor(n / 1e9) + 'B';
                if (n >= 1e6) return Math.floor(n / 1e6) + 'M';
                if (n >= 1e3) return Math.floor(n / 1e3) + 'K';
                return Math.floor(n).toString();
            }

            getTotalPoints() {
                return this.sparklePoints + this.firePoints + this.trophyPoints;
            }
        }

        /* ----------------- NEKOPONÂäπÊûúÈü≥„Ç∑„Çπ„ÉÜ„É†ÔºàÊã°ÂºµÁâàÔºâ ----------------- */
        class NekoponSoundSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.initAudio();
            }

            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÇíÂàùÊúüÂåñ„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„Å´„ÇÉ„Äú');
                }
            }

            playClick() {
                this.createNekoTone(600, 0.2, 0.15, 'sine');
            }

            playCorrect() {
                this.createNekoTone(523, 0.15, 0.2);
                setTimeout(() => this.createNekoTone(659, 0.15, 0.2), 100);
                setTimeout(() => this.createNekoTone(784, 0.25, 0.25), 200);
                setTimeout(() => this.createNekoTone(1047, 0.3, 0.2), 350);
            }

            playWrong() {
                this.createNekoTone(400, 0.2, 0.15, 'sine');
                setTimeout(() => this.createNekoTone(300, 0.3, 0.2, 'sine'), 150);
            }

            playSuccess() {
                const notes = [523, 587, 659, 698, 784, 880, 988, 1047, 1175];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createNekoTone(freq, 0.15, 0.2, 'sine'), i * 80);
                });
            }

            playTitle() {
                this.createNekoTone(900, 0.3, 0.2);
                setTimeout(() => this.createNekoTone(1200, 0.4, 0.15), 200);
                setTimeout(() => this.createNekoTone(800, 0.5, 0.1), 600);
            }

            playPurr() {
                this.createNekoTone(300, 1.2, 0.1, 'sine');
            }

            playSpawn() {
                this.createNekoTone(800, 0.3, 0.15, 'sine');
            }

            playMerge() {
                this.createNekoTone(700, 0.4, 0.2);
                setTimeout(() => this.createNekoTone(900, 0.3, 0.15), 200);
            }

            playLevelup() {
                const notes = [523, 659, 784, 1047, 1319];
                notes.forEach((freq, i) => {
                    setTimeout(() => this.createNekoTone(freq, 0.2, 0.3), i * 120);
                });
            }

            // „Éù„Ç§„É≥„Éà„Ç∑„Çπ„ÉÜ„É†Áî®„ÅÆÊñ∞„Çµ„Ç¶„É≥„Éâ
            playSound(type) {
                if (!this.audioContext) return;

                try {
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }

                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filterNode = this.audioContext.createBiquadFilter();

                    oscillator.connect(filterNode);
                    filterNode.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    let frequency, duration, filterFreq;

                    switch(type) {
                        case 'sparkle':
                            frequency = 1000 + Math.random() * 500;
                            duration = 0.8;
                            filterFreq = 2500;
                            // „Ç≠„É©„Ç≠„É©Èü≥„ÅØÈ´òÈü≥„Åã„Çâ‰ΩéÈü≥„Å∏
                            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.4, this.audioContext.currentTime + duration);
                            break;
                        case 'fire':
                            frequency = 400 + Math.random() * 300;
                            duration = 1.0;
                            filterFreq = 1500;
                            // ÁÇéÈü≥„ÅØÊè∫„Çå„Çã„Çà„ÅÜ„Å™Â§âÂåñ
                            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.3, this.audioContext.currentTime + duration * 0.5);
                            oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.7, this.audioContext.currentTime + duration);
                            break;
                        case 'trophy':
                            frequency = 1500;
                            duration = 1.5;
                            filterFreq = 3500;
                            // „Éà„É≠„Éï„Ç£„ÉºÈü≥„ÅØË±™ËèØ„Å´‰∏äÊòá
                            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.8, this.audioContext.currentTime + duration);
                            break;
                        default:
                            frequency = 440;
                            duration = 0.3;
                            filterFreq = 1000;
                            oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                            oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.6, this.audioContext.currentTime + duration);
                    }

                    filterNode.frequency.setValueAtTime(filterFreq, this.audioContext.currentTime);
                    filterNode.Q.setValueAtTime(2, this.audioContext.currentTime);

                    gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (e) {
                    // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
                }
            }

            createNekoTone(frequency, duration, volume = 0.2, type = 'sine') {
                if (!this.audioContext) return;

                try {
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }

                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filterNode = this.audioContext.createBiquadFilter();

                    oscillator.connect(filterNode);
                    filterNode.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.type = type;

                    filterNode.frequency.setValueAtTime(frequency * 2, this.audioContext.currentTime);
                    filterNode.Q.setValueAtTime(1, this.audioContext.currentTime);

                    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (e) {
                    // „Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
                }
            }

            vibrate(pattern) {
                if ('vibrate' in navigator) {
                    navigator.vibrate(pattern);
                }
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´„Ç§„É≥„Çπ„Çø„É≥„Çπ
        const soundSystem = new NekoponSoundSystem();
        const pointSystem = new NekoponPointSystem();

        /* ----------------- Áå´Ë™û„É°„ÉÉ„Çª„Éº„Ç∏ ----------------- */
        const nekoMessages = {
            correct: [
                '„Åô„Åî„ÅÑ„Å´„ÇÉ„Äú‚ô™', 'Ê≠£Ëß£„Å†„Å´„ÇÉÔºÅ', '„ÇÑ„Å£„Åü„Å´„ÇÉ„ÄúÔºÅ', 'Â§©Êâç„Å´„ÇÉ‚ô™', '„Åã„Åó„Åì„ÅÑ„Å´„ÇÉ„Äú',
                '„Å∞„Å£„Å°„Çä„Å´„ÇÉÔºÅ', '„Åô„Å∞„Çâ„Åó„ÅÑ„Å´„ÇÉ‚ô™', '„Åï„Åô„Åå„Å´„ÇÉ„Äú', '„Åà„Çâ„ÅÑ„Å´„ÇÉÔºÅ', '„Å±„Éº„Åµ„Åá„Åè„Å®„Å´„ÇÉ‚ô™'
            ],
            wrong: [
                '„Åñ„Çì„Å≠„Çì„Å´„ÇÉ„Äú', '„Åä„Åó„ÅÑ„Å´„ÇÉÔºÅ', '„Å§„Åé„Åå„Çì„Å∞„Çã„Å´„ÇÉ„Äú', '„Å©„Çì„Åæ„ÅÑ„Å´„ÇÉ‚ô™', '„Åä„Åó„Åã„Å£„Åü„Å´„ÇÉ„Äú',
                '„ÇÇ„ÅÜÂ∞ë„Åó„Å´„ÇÉÔºÅ', '„Éï„Ç°„Ç§„Éà„Å´„ÇÉ„Äú‚ô™', '„Å§„Åé„ÅØ„Åß„Åç„Çã„Å´„ÇÉÔºÅ', '„Åå„Çì„Å∞„Çã„Å´„ÇÉ„Äú', '„ÅÇ„Åç„Çâ„ÇÅ„Å™„ÅÑ„Å´„ÇÉ‚ô™'
            ],
            tap: [
                '„Å´„ÇÉ„Äú„Çì‚ô™', '„ÅΩ„Çì„ÅΩ„Çì‚ô™', '„Åç„ÇÉ„Çè„ÅÑ„ÅÑ„Äú', '„ÇÇ„Åµ„ÇÇ„Åµ‚ô™', '„Åµ„Çè„Åµ„Çè„Äú',
                '„Å∫„Çç„Å∫„Çç‚ô™', '„ÅΩ„Çà„ÅΩ„Çà„Äú', '„Åç„Çâ„Åç„Çâ‚ô™', '„Å¥„Åã„Å¥„Åã„Äú', '„Çè„Åè„Çè„Åè‚ô™'
            ],
            notification: [
                '„ÅäÁü•„Çâ„Åõ„Å´„ÇÉ„Äú‚ô™', '„Å†„ÅÑ„Åò„Å™„Åì„Å®„Å´„ÇÉÔºÅ', '„Åç„ÅÑ„Å¶„Åª„Åó„ÅÑ„Å´„ÇÉ„Äú', '„ÉÅ„Çß„ÉÉ„ÇØ„Å´„ÇÉ‚ô™', '„Åø„Å¶„Å´„ÇÉ„Äú'
            ],
            start: [
                '„ÅØ„Åò„Åæ„Çã„Å´„ÇÉ„Äú‚ô™', '„Åå„Çì„Å∞„Çã„Å´„ÇÉÔºÅ', '„Çà„Çç„Åó„Åè„Å´„ÇÉ„Äú', '„Åü„ÅÆ„Åó„ÇÇ„ÅÜ„Å´„ÇÉ‚ô™', '„Åô„Åü„Éº„Å®„Å´„ÇÉ„ÄúÔºÅ'
            ]
        };

        /* ----------------- „Ç´„ÉÜ„Ç¥„É™„ÉºÂÆöÁæ©ÔºàÂÆåÂÖ®ÂÆüË£ÖÔºâ ----------------- */
        const categories = {
            geography: [
                {id: 'geo_world_overview', name: '1.‰∏ñÁïå„ÅÆÂßø'},
                {id: 'geo_japan_overview', name: '2.Êó•Êú¨„ÅÆÂßø'},
                {id: 'geo_world_life', name: '3.‰∏ñÁïåÂêÑÂú∞„ÅÆ‰∫∫„ÄÖ„ÅÆÁîüÊ¥ª„Å®Áí∞Â¢É'},
                {id: 'geo_asia', name: '4.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç¢„Ç∏„Ç¢Â∑û'},
                {id: 'geo_europe', name: '5.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„É®„Éº„É≠„ÉÉ„ÉëÂ∑û'},
                {id: 'geo_africa', name: '6.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç¢„Éï„É™„Ç´Â∑û'},
                {id: 'geo_north_america', name: '7.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄÂåó„Ç¢„É°„É™„Ç´Â∑û'},
                {id: 'geo_south_america', name: '8.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄÂçó„Ç¢„É°„É™„Ç´Â∑û'},
                {id: 'geo_oceania', name: '9.‰∏ñÁïå„ÅÆË´∏Âú∞Âüü„ÄÄ„Ç™„Çª„Ç¢„Éã„Ç¢'},
                {id: 'geo_japan_features', name: '10.Êó•Êú¨„ÅÆÂú∞ÂüüÁöÑÁâπËâ≤'},
                {id: 'geo_japan_kyushu', name: '11.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄ‰πùÂ∑ûÂú∞Êñπ'},
                {id: 'geo_japan_chugoku', name: '12.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄ‰∏≠ÂõΩ„ÉªÂõõÂõΩÂú∞Êñπ'},
                {id: 'geo_japan_kinki', name: '13.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄËøëÁïøÂú∞Êñπ'},
                {id: 'geo_japan_chubu', name: '14.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄ‰∏≠ÈÉ®Âú∞Êñπ'},
                {id: 'geo_japan_kanto', name: '15.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄÈñ¢Êù±Âú∞Êñπ'},
                {id: 'geo_japan_tohoku', name: '16.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄÊù±ÂåóÂú∞Êñπ'},
                {id: 'geo_japan_hokkaido', name: '17.Êó•Êú¨„ÅÆË´∏Âú∞Âüü„ÄÄÂåóÊµ∑ÈÅìÂú∞Êñπ'}
            ],
            history: [
                {id: 'hist_ancient', name: '1.ÊñáÊòé„ÅÆ„Åä„Åì„Çä„Å®Êó•Êú¨„ÅÆÊàê„ÇäÁ´ã„Å°'},
                {id: 'hist_ancient_state', name: '2.Âè§‰ª£ÂõΩÂÆ∂„ÅÆÊ≠©„Åø„Å®Êù±„Ç¢„Ç∏„Ç¢'},
                {id: 'hist_kamakura', name: '3.Ê≠¶Â£´„ÅÆ„Åä„Åì„Çä„Å®ÈéåÂÄâÂπïÂ∫ú'},
                {id: 'hist_muromachi', name: '4.„É¢„É≥„Ç¥„É´„ÅÆË•≤Êù•„Å®ÂÆ§Áî∫ÂπïÂ∫ú'},
                {id: 'hist_unification', name: '5.„É®„Éº„É≠„ÉÉ„Éë‰∫∫„Å®„ÅÆÂá∫‰ºö„ÅÑ„Å®ÂÖ®ÂõΩÁµ±‰∏Ä'},
                {id: 'hist_edo_early', name: '6.Ê±üÊà∏ÂπïÂ∫ú„ÅÆÊàêÁ´ã„Å®ÈéñÂõΩ'},
                {id: 'hist_edo_develop', name: '7.Áî£Ê•≠„ÅÆÁô∫ÈÅî„Å®ÂπïÂ∫úÊîøÊ≤ª„ÅÆÂ±ïÈñã'},
                {id: 'hist_opening', name: '8.Ê¨ßÁ±≥„ÅÆÈÄ≤Âá∫„Å®Êó•Êú¨„ÅÆÈñãÂõΩ'},
                {id: 'hist_meiji', name: '9.ÊòéÊ≤ªÁ∂≠Êñ∞'},
                {id: 'hist_wars', name: '10.Êó•Ê∏Ö„ÉªÊó•Èú≤Êà¶‰∫â„Å®Êó•Êú¨„ÅÆÁî£Ê•≠Èù©ÂëΩ'},
                {id: 'hist_wwi', name: '11.Á¨¨‰∏ÄÊ¨°‰∏ñÁïåÂ§ßÊà¶„Å®Êó•Êú¨'},
                {id: 'hist_wwii', name: '12.‰∏ñÁïåÊÅêÊÖå„Å®Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶'},
                {id: 'hist_postwar', name: '13.Êà¶Âæå„ÅÆÊó•Êú¨„ÅÆÁô∫Â±ï„Å®ÂõΩÈöõÁ§æ‰ºö'}
            ],
            civics: [
                {id: 'civics_modern', name: '1.Áèæ‰ª£Á§æ‰ºö„Å®ÁßÅ„Åü„Å°'},
                {id: 'civics_constitution', name: '2.‰∫∫Èñì„ÅÆÂ∞äÈáç„Å®Êó•Êú¨ÂõΩÊÜ≤Ê≥ï'},
                {id: 'civics_democracy', name: '3.Áèæ‰ª£„ÅÆÊ∞ë‰∏ªÊîøÊ≤ª'},
                {id: 'civics_economy', name: '4.ÊöÆ„Çâ„Åó„Å®ÁµåÊ∏à'}
            ],
            chemistry: [
                {id: 'chemistry_basic', name: '1.Áâ©Ë≥™„Å®„Åù„ÅÆÊÄßË≥™'},
                {id: 'chemistry_gas', name: '2.Ê∞ó‰Ωì„ÅÆÊÄßË≥™'},
                {id: 'chemistry_solution', name: '3.Ê∞¥Ê∫∂Ê∂≤„ÅÆÊÄßË≥™'},
                {id: 'chemistry_state', name: '4.Áä∂ÊÖãÂ§âÂåñ'},
                {id: 'chemistry_change', name: '5.Áâ©Ë≥™„ÅÆÂ§âÂåñ'},
                {id: 'chemistry_structure', name: '6.Áâ©Ë≥™„ÅÆÊàê„ÇäÁ´ã„Å°'},
                {id: 'chemistry_reaction', name: '7.Áâ©Ë≥™„Å©„ÅÜ„Åó„ÅÆÂåñÂ≠¶Â§âÂåñ'},
                {id: 'chemistry_mass', name: '8.ÂåñÂ≠¶Â§âÂåñ„Å®Ë≥™Èáè'},
                {id: 'chemistry_ion', name: '9.„Ç§„Ç™„É≥„Å®ÈõªÊ±†'},
                {id: 'chemistry_acid', name: '10.ÈÖ∏„ÄÅ„Ç¢„É´„Ç´„É™„ÄÅÂ°©'}
            ],
            biology: [
                {id: 'biology_flower', name: '1.Ëä±„ÅÆ„Å§„Åè„Çä'},
                {id: 'biology_plant', name: '2.Ê†π„ÉªËëâ„ÅÆ„Å§„Åè„Çä„ÄÅÊ§çÁâ©„ÅÆÁâπÂæ¥„Å®ÂàÜÈ°û'},
                {id: 'biology_animal', name: '3.ÂãïÁâ©„ÅÆÁâπÂæ¥„Å®ÂàÜÈ°û'},
                {id: 'biology_microscope', name: '4.È°ïÂæÆÈè°„ÅÆ‰Ωø„ÅÑÊñπ'},
                {id: 'biology_cell', name: '5.ÁîüÁâ©„Å®Á¥∞ËÉû'},
                {id: 'biology_plant_body', name: '6.Ê§çÁâ©„ÅÆ„Åã„Çâ„Å†„ÅÆ„Å§„Åè„Çä„ÄÅÊ§çÁâ©„Å®Êó•ÂÖâ'},
                {id: 'biology_digestion', name: '7.Ê∂àÂåñ„Å®Âê∏Âèé'},
                {id: 'biology_breathing', name: '8.ÂëºÂê∏'},
                {id: 'biology_circulation', name: '9.Ë°ÄÊ∂≤„ÅÆÂæ™Áí∞„ÄÅÊéíÂá∫„ÅÆ„Åó„Åè„Åø'},
                {id: 'biology_response', name: '10.Âà∫ÊøÄ„Å®ÂèçÂøú„ÄÅÂãïÁâ©„ÅÆ„Åã„Çâ„Å†'},
                {id: 'biology_growth', name: '11.ÁîüÁâ©„ÅÆÊàêÈï∑„Å®Á¥∞ËÉû„ÅÆÂ§âÂåñ'},
                {id: 'biology_reproduction', name: '12.ÁîüÁâ©„ÅÆÁîüÊÆñ'},
                {id: 'biology_heredity', name: '13.ÈÅ∫‰ºù„ÅÆË¶èÂâáÊÄß„Å®ÈÅ∫‰ºùÂ≠ê'},
                {id: 'biology_evolution', name: '14.ÁîüÁâ©„ÅÆÈÄ≤Âåñ„ÄÅÁîüÊÖãÁ≥ª„Å®È£üÁâ©ÈÄ£Èéñ'},
                {id: 'biology_environment', name: '15.Ëá™ÁÑ∂„Å®Áí∞Â¢É„ÄÅ‰∫∫Èñì„Å®Ëá™ÁÑ∂Áí∞Â¢É'}
            ],
            physics: [
                {id: 'physics_light', name: '1.ÂÖâ„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_sound', name: '2.Èü≥„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_force', name: '3.Âäõ„Å´„Çà„ÇãÁèæË±°'},
                {id: 'physics_current', name: '4.ÈõªÊµÅ„Å®ÈõªÂúß'},
                {id: 'physics_energy', name: '5.ÈõªÊ∞ó„Ç®„Éç„É´„ÇÆ„Éº'},
                {id: 'physics_magnetic', name: '6.ÈõªÊµÅ„Å®Á£ÅÁïå'},
                {id: 'physics_balance', name: '7.Âäõ„ÅÆ„Å§„ÇäÂêà„ÅÑ„Å®ÂêàÊàê„ÉªÂàÜËß£'},
                {id: 'physics_motion', name: '8.Áâ©‰Ωì„ÅÆÈÅãÂãï'},
                {id: 'physics_pressure', name: '9.Ê∞¥Âúß„Å®ÊµÆÂäõ'},
                {id: 'physics_work', name: '10.„Ç®„Éç„É´„ÇÆ„Éº„Å®‰ªï‰∫ã'},
                {id: 'physics_energy_change', name: '11.„Ç®„Éç„É´„ÇÆ„Éº„ÅÆÁßª„ÇäÂ§â„Çè„Çä'},
                {id: 'physics_resources', name: '12.„Ç®„Éç„É´„ÇÆ„ÉºË≥áÊ∫ê„ÅÆÂà©Áî®'}
            ],
            earth: [
                {id: 'earth_volcano', name: '1.ÁÅ´Â±±'},
                {id: 'earth_earthquake', name: '2.Âú∞Èúá'},
                {id: 'earth_strata', name: '3.Âú∞Â±§„ÅÆ„Åß„ÅçÊñπ'},
                {id: 'earth_weather', name: '4.Ê∞óË±°„ÅÆË¶≥Ê∏¨„ÄÅÂ§ßÊ∞óÂúß„Å®ÂúßÂäõ'},
                {id: 'earth_front', name: '5.Ê∞óÂõ£„Å®ÂâçÁ∑ö„ÄÅÊó•Êú¨„ÅÆÂ§©Ê∞ó'},
                {id: 'earth_cloud', name: '6.Èõ≤„ÅÆ„Åß„ÅçÊñπ„Å®Ê∞¥Ëí∏Ê∞ó'},
                {id: 'earth_celestial', name: '7.Âú∞ÁêÉ„ÅÆÂãï„Åç„Å®Â§©‰Ωì„ÅÆÂãï„Åç'},
                {id: 'earth_solar', name: '8.Â§™ÈôΩÁ≥ª„ÅÆÂ§©‰Ωì'},
                {id: 'earth_moon', name: '9.Êúà„Å®ÊÉëÊòü„ÅÆË¶ã„ÅàÊñπ„ÄÅËá™ÁÑ∂„ÅÆÊÅµ„Åø„Å®ÁÅΩÂÆ≥'}
            ],
            english_words: [
                {id: 'words_time', name: 'Êúà„ÉªÂ∫èÊï∞'},
                {id: 'words_week', name: 'ÊõúÊó•'},
                {id: 'words_timeday', name: 'ÊôÇ„ÉªÊôÇÈñìÂ∏Ø„Å™„Å©'},
                {id: 'words_season', name: 'Â≠£ÁØÄ„ÉªÂÆ∂Êóè'},
                {id: 'words_sports', name: '„Çπ„Éù„Éº„ÉÑ„ÉªÊïôÁßë'},
                {id: 'words_job', name: 'ËÅ∑Ê•≠„Éª‰∫∫„ÉªÂª∫Áâ©„ÉªÊñΩË®≠'},
                {id: 'words_uncountable', name: 'Êï∞„Åà„Çâ„Çå„Å™„ÅÑÂêçË©û'},
                {id: 'words_verb_important', name: 'ÂÖ•Ë©¶ÂøÖÂá∫ÈáçË¶ÅÂãïË©û'},
                {id: 'words_verb_various', name: '„ÅÑ„Çç„ÅÑ„Çç„Å™ÊÑèÂë≥„Çí„ÇÇ„Å§ÂãïË©û'},
                {id: 'words_verb_set', name: '„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Å¶„Åä„Åç„Åü„ÅÑÂãïË©û'},
                {id: 'words_verb_other', name: '„Åù„ÅÆ‰ªñ„ÅÆÈáçË¶ÅÂãïË©û'},
                {id: 'words_adj_quantity', name: 'Êï∞„ÉªÈáè„ÇíË°®„ÅôÂΩ¢ÂÆπË©û'},
                {id: 'words_adj_various', name: '„ÅÑ„Çç„ÅÑ„Çç„Å™ÂΩ¢ÂÆπË©û'},
                {id: 'words_adj_adv', name: '„Åù„ÅÆ‰ªñ„ÅÆÈáçË¶ÅÂΩ¢ÂÆπË©û„ÉªÂâØË©û'},
                {id: 'words_adv_manner', name: 'ÊßòÂ≠ê„ÇíË°®„ÅôÂâØË©û'}
            ],
            english_phrases: [
                {id: 'phrases_verb', name: '„Çà„ÅèÂá∫„ÇãÂãïË©û„ÅÆÁÜüË™û'},
                {id: 'phrases_set', name: '„Çª„ÉÉ„Éà„ÅßË¶ö„Åà„Å¶„Åä„Åç„Åü„ÅÑÁÜüË™û'},
                {id: 'phrases_similar', name: 'ÊÑèÂë≥„ÅÆ‰ºº„Å¶„ÅÑ„ÇãÁÜüË™û'},
                {id: 'phrases_verb_other', name: '„Åù„ÅÆ‰ªñ„ÅÆÂãïË©û„ÅÆÁÜüË™û'},
                {id: 'phrases_be', name: 'be ÂãïË©û„Çí‰Ωø„Å£„ÅüÁÜüË™û'},
                {id: 'phrases_quantity', name: 'Êï∞„ÇÑÈáè„ÇíË°®„ÅôÁÜüË™û'},
                {id: 'phrases_time_place', name: 'ÊôÇ„ÉªÂ†¥ÊâÄ„ÇíË°®„ÅôÁÜüË™û'},
                {id: 'phrases_important', name: '„Åù„ÅÆ‰ªñ„ÅÆÈáçË¶ÅÁÜüË™û'}
            ],
            english_grammar: [
                {id: 'grammar_irregular_past', name: '‰∏çË¶èÂâáÂãïË©û - ÈÅéÂéªÂΩ¢„ÉªÈÅéÂéªÂàÜË©û'},
                {id: 'grammar_irregular_same', name: '‰∏çË¶èÂâáÂãïË©û - ÈÅéÂéªÂΩ¢„Å®ÈÅéÂéªÂàÜË©û„ÅåÂêå„Åò'},
                {id: 'grammar_irregular_special', name: '‰∏çË¶èÂâáÂãïË©û - ÁâπÊÆä„Å™„Ç±„Éº„Çπ'},
                {id: 'grammar_be_past', name: 'be ÂãïË©û - ÈÅéÂéªÂΩ¢„ÉªÈÅéÂéªÂàÜË©û'},
                {id: 'grammar_regular', name: 'Ë¶èÂâáÂãïË©û - ÈÅéÂéªÂΩ¢„ÉªÈÅéÂéªÂàÜË©û'},
                {id: 'grammar_third_person', name: '‰∏â‰∫∫Áß∞ÂçòÊï∞ÁèæÂú®ÂΩ¢'},
                {id: 'grammar_ing', name: 'ÂãïË©û„ÅÆ -ing ÂΩ¢'},
                {id: 'grammar_comparative', name: 'ÂΩ¢ÂÆπË©û - ÊØîËºÉÁ¥ö„ÉªÊúÄ‰∏äÁ¥ö'},
                {id: 'grammar_more_most', name: 'more„ÄÅmost „Çí„Å§„Åë„ÇãÂΩ¢ÂÆπË©û'},
                {id: 'grammar_noun_plural', name: 'ÂêçË©û„ÅÆË§áÊï∞ÂΩ¢'},
                {id: 'grammar_irregular_plural', name: '‰∏çË¶èÂâá„Å™Ë§áÊï∞ÂΩ¢'},
                {id: 'grammar_pronoun', name: '‰∫∫Áß∞‰ª£ÂêçË©û'}
            ]
        };

        /* ----------------- „Ç≤„Éº„É†Â§âÊï∞ ----------------- */
        let selectedCategories = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let totalCount = 0;
        let usedQuestions = [];
        let currentSubject = '';
        let questionMode = 'random';
        let sequentialIndex = 0;

        /* ----------------- „Ç®„Éï„Çß„ÇØ„ÉàÈñ¢Êï∞ ----------------- */
        function createNekoParticle(text, color, x, y) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = text;
            particle.style.color = color;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.fontSize = '24px';
            document.body.appendChild(particle);

            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 2000);
        }

        function createNekoParticles(x, y, emojis, count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const emoji = emojis[Math.floor(Math.random() * emojis.length)];
                    const offsetX = (Math.random() - 0.5) * 60;
                    const offsetY = (Math.random() - 0.5) * 60;
                    createNekoParticle(emoji, '#d2691e', x + offsetX, y + offsetY);
                }, i * 50);
            }
        }

        function showNekoMsg(text, x, y) {
            const el = document.createElement('div');
            el.className = 'floating-msg';
            el.textContent = text;
            el.style.left = Math.min(x, window.innerWidth - 100) + 'px';
            el.style.top = Math.min(y, window.innerHeight - 40) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 2500);
        }

        function showNotification(text) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            const nekoText = text + '„Å´„ÇÉ„Äú‚ô™';
            notificationText.textContent = nekoText;
            notification.classList.add('show');
            
            soundSystem.playSpawn();
            soundSystem.vibrate([50, 30, 50]);
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function addTapEffect(element) {
            element.addEventListener('click', function(e) {
                this.classList.add('tapped');
                setTimeout(() => this.classList.remove('tapped'), 600);
                
                const rect = this.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                createNekoParticles(centerX, centerY, ['‚ú®', 'üåü', 'üí´', 'üíñ'], 3);
                
                const message = nekoMessages.tap[Math.floor(Math.random() * nekoMessages.tap.length)];
                showNekoMsg(message, centerX, centerY);
                
                soundSystem.playClick();
                soundSystem.vibrate([30]);
            });
        }

        /* ----------------- „Çø„Ç§„Éà„É´Áå´„ÅÆ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ ----------------- */
        function bounceCat(side) {
            const catId = side === 'left' ? 'leftCat' : 'rightCat';
            const catElement = document.getElementById(catId);

            catElement.classList.add('bounce');
            soundSystem.playPurr();
            soundSystem.vibrate([50]);

            const rect = catElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü'], 3);

            const message = '„Å´„ÇÉ„Äú„Çì‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                catElement.classList.remove('bounce');
            }, 800);
        }

        function bounceTitle() {
            const titleElement = document.getElementById('gameTitle');
            titleElement.classList.add('title-bounce');

            soundSystem.playTitle();
            soundSystem.vibrate([120, 60, 120, 60, 180]);

            const rect = titleElement.getBoundingClientRect();
            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, 
                              ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä', 'üéÜ', 'üåà'], 8);

            const message = 'NEKOPON Quiz „Å†„Å´„ÇÉ„Äú‚ô™';
            showNekoMsg(message, rect.left + rect.width/2, rect.top + rect.height/2);

            setTimeout(() => {
                titleElement.classList.remove('title-bounce');
            }, 1200);
        }

        /* ----------------- Ëã±Ë™ûÁô∫Èü≥„Ç∑„Çπ„ÉÜ„É† ----------------- */
        function speakWord(wordToSpeak) {
            if (!('speechSynthesis' in window) || !wordToSpeak) return;
            
            const utterance = new SpeechSynthesisUtterance(wordToSpeak);
            const voices = speechSynthesis.getVoices();
            let preferredVoice = voices.find(v => /en-(US|GB)/.test(v.lang) && (v.name.includes('Google') || v.localService || v.default));
            if (!preferredVoice) preferredVoice = voices.find(v => /en-(US|GB)/.test(v.lang));
           
            utterance.voice = preferredVoice || voices.find(v => v.lang && v.lang.startsWith('en-')); 
            utterance.lang = utterance.voice ? utterance.voice.lang : 'en-US';
            utterance.rate = 0.9; 
            utterance.pitch = 1;
            speechSynthesis.cancel(); 
            speechSynthesis.speak(utterance);
        }

        function isEnglishCategory() {
            return selectedCategories.some(categoryId => 
                categoryId.startsWith('words_') || categoryId.startsWith('phrases_') || categoryId.startsWith('grammar_')
            );
        }

        /* ----------------- ÁîªÈù¢ÈÅ∑ÁßªÈñ¢Êï∞ ----------------- */
        function hideAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
        }

        function goBackToMain() {
            hideAllModals();
            document.getElementById('mainSubjectModal').classList.add('show');
            soundSystem.playClick();
        }

        function goBackToSocial() {
            hideAllModals();
            document.getElementById('socialModal').classList.add('show');
            soundSystem.playClick();
        }

        function goBackToScience() {
            hideAllModals();
            document.getElementById('scienceModal').classList.add('show');
            soundSystem.playClick();
        }

        function goBackToEnglish() {
            hideAllModals();
            document.getElementById('englishModal').classList.add('show');
            soundSystem.playClick();
        }

        /* ----------------- „Ç´„ÉÜ„Ç¥„É™„ÉºÈÅ∏Êäû„ÅÆÂàùÊúüÂåñÔºàÂÆåÂÖ®ÂÆüË£ÖÔºâ ----------------- */
        function initCategorySelection() {
            // Âú∞ÁêÜ„Ç´„ÉÜ„Ç¥„É™„Éº
            const geographyContainer = document.getElementById('geographyCategories');
            categories.geography.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('geography', category.id, btn);
                addTapEffect(btn);
                geographyContainer.appendChild(btn);
            });

            // Ê≠¥Âè≤„Ç´„ÉÜ„Ç¥„É™„Éº
            const historyContainer = document.getElementById('historyCategories');
            categories.history.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('history', category.id, btn);
                addTapEffect(btn);
                historyContainer.appendChild(btn);
            });

            // ÂÖ¨Ê∞ë„Ç´„ÉÜ„Ç¥„É™„Éº
            const civicsContainer = document.getElementById('civicsCategories');
            categories.civics.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('civics', category.id, btn);
                addTapEffect(btn);
                civicsContainer.appendChild(btn);
            });

            // ÂåñÂ≠¶„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®„Å´ÂàÜ„Åë„Å¶Ë°®Á§∫Ôºâ
            const chemistryContainer = document.getElementById('chemistryCategories');
            // ‰∏≠1
            const grade1Label = document.createElement('div');
            grade1Label.className = 'grade-label';
            grade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
            chemistryContainer.appendChild(grade1Label);
            categories.chemistry.slice(0, 4).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('chemistry', category.id, btn);
                addTapEffect(btn);
                chemistryContainer.appendChild(btn);
            });
            // ‰∏≠2
            const grade2Label = document.createElement('div');
            grade2Label.className = 'grade-label';
            grade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
            chemistryContainer.appendChild(grade2Label);
            categories.chemistry.slice(4, 8).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('chemistry', category.id, btn);
                addTapEffect(btn);
                chemistryContainer.appendChild(btn);
            });
            // ‰∏≠3
            const grade3Label = document.createElement('div');
            grade3Label.className = 'grade-label';
            grade3Label.textContent = '‰∏≠Â≠¶3Âπ¥Áîü';
            chemistryContainer.appendChild(grade3Label);
            categories.chemistry.slice(8).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('chemistry', category.id, btn);
                addTapEffect(btn);
                chemistryContainer.appendChild(btn);
            });

            // ÁîüÁâ©„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®„Å´ÂàÜ„Åë„Å¶Ë°®Á§∫Ôºâ
            const biologyContainer = document.getElementById('biologyCategories');
            // ‰∏≠1
            const bioGrade1Label = document.createElement('div');
            bioGrade1Label.className = 'grade-label';
            bioGrade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
            biologyContainer.appendChild(bioGrade1Label);
            categories.biology.slice(0, 3).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('biology', category.id, btn);
                addTapEffect(btn);
                biologyContainer.appendChild(btn);
            });
            // ‰∏≠2
            const bioGrade2Label = document.createElement('div');
            bioGrade2Label.className = 'grade-label';
            bioGrade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
            biologyContainer.appendChild(bioGrade2Label);
            categories.biology.slice(3, 10).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('biology', category.id, btn);
                addTapEffect(btn);
                biologyContainer.appendChild(btn);
            });
            // ‰∏≠3
            const bioGrade3Label = document.createElement('div');
            bioGrade3Label.className = 'grade-label';
            bioGrade3Label.textContent = '‰∏≠Â≠¶3Âπ¥Áîü';
            biologyContainer.appendChild(bioGrade3Label);
            categories.biology.slice(10).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('biology', category.id, btn);
                addTapEffect(btn);
                biologyContainer.appendChild(btn);
            });

            // Áâ©ÁêÜ„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®„Å´ÂàÜ„Åë„Å¶Ë°®Á§∫Ôºâ
            const physicsContainer = document.getElementById('physicsCategories');
            // ‰∏≠1
            const phyGrade1Label = document.createElement('div');
            phyGrade1Label.className = 'grade-label';
            phyGrade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
            physicsContainer.appendChild(phyGrade1Label);
            categories.physics.slice(0, 3).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('physics', category.id, btn);
                addTapEffect(btn);
                physicsContainer.appendChild(btn);
            });
            // ‰∏≠2
            const phyGrade2Label = document.createElement('div');
            phyGrade2Label.className = 'grade-label';
            phyGrade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
            physicsContainer.appendChild(phyGrade2Label);
            categories.physics.slice(3, 6).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('physics', category.id, btn);
                addTapEffect(btn);
                physicsContainer.appendChild(btn);
            });
            // ‰∏≠3
            const phyGrade3Label = document.createElement('div');
            phyGrade3Label.className = 'grade-label';
            phyGrade3Label.textContent = '‰∏≠Â≠¶3Âπ¥Áîü';
            physicsContainer.appendChild(phyGrade3Label);
            categories.physics.slice(6).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('physics', category.id, btn);
                addTapEffect(btn);
                physicsContainer.appendChild(btn);
            });

            // Âú∞Â≠¶„Ç´„ÉÜ„Ç¥„É™„ÉºÔºàÂ≠¶Âπ¥„Åî„Å®„Å´ÂàÜ„Åë„Å¶Ë°®Á§∫Ôºâ
            const earthContainer = document.getElementById('earthCategories');
            // ‰∏≠1
            const earthGrade1Label = document.createElement('div');
            earthGrade1Label.className = 'grade-label';
            earthGrade1Label.textContent = '‰∏≠Â≠¶1Âπ¥Áîü';
            earthContainer.appendChild(earthGrade1Label);
            categories.earth.slice(0, 3).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('earth', category.id, btn);
                addTapEffect(btn);
                earthContainer.appendChild(btn);
            });
            // ‰∏≠2
            const earthGrade2Label = document.createElement('div');
            earthGrade2Label.className = 'grade-label';
            earthGrade2Label.textContent = '‰∏≠Â≠¶2Âπ¥Áîü';
            earthContainer.appendChild(earthGrade2Label);
            categories.earth.slice(3, 6).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('earth', category.id, btn);
                addTapEffect(btn);
                earthContainer.appendChild(btn);
            });
            // ‰∏≠3
            const earthGrade3Label = document.createElement('div');
            earthGrade3Label.className = 'grade-label';
            earthGrade3Label.textContent = '‰∏≠Â≠¶3Âπ¥Áîü';
            earthContainer.appendChild(earthGrade3Label);
            categories.earth.slice(6).forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('earth', category.id, btn);
                addTapEffect(btn);
                earthContainer.appendChild(btn);
            });

            // Ëã±ÂçòË™û„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishWordsContainer = document.getElementById('englishWordsCategories');
            categories.english_words.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('english_words', category.id, btn);
                addTapEffect(btn);
                englishWordsContainer.appendChild(btn);
            });

            // Ëã±ÁÜüË™û„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishPhrasesContainer = document.getElementById('englishPhrasesCategories');
            categories.english_phrases.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('english_phrases', category.id, btn);
                addTapEffect(btn);
                englishPhrasesContainer.appendChild(btn);
            });

            // Ë™ûÂΩ¢Â§âÂåñ„Ç´„ÉÜ„Ç¥„É™„Éº
            const englishGrammarContainer = document.getElementById('englishGrammarCategories');
            categories.english_grammar.forEach(category => {
                const btn = document.createElement('button');
                btn.className = 'category-btn tap-effect';
                btn.innerHTML = category.name;
                btn.dataset.categoryId = category.id;
                btn.onclick = () => toggleCategorySelection('english_grammar', category.id, btn);
                addTapEffect(btn);
                englishGrammarContainer.appendChild(btn);
            });
        }

        function toggleCategorySelection(subject, categoryId, buttonElement) {
            soundSystem.playClick();
            if (selectedCategories.includes(categoryId)) {
                selectedCategories = selectedCategories.filter(id => id !== categoryId);
                buttonElement.classList.remove('active');
            } else {
                selectedCategories.push(categoryId);
                buttonElement.classList.add('active');
            }

            // „ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
            const camelCase = subject.split('_')
                .map((word, index) => index === 0 ? word.charAt(0).toUpperCase() + word.slice(1) : word.charAt(0).toUpperCase() + word.slice(1))
                .join('');
            const startButton = document.getElementById(`start${camelCase}Quiz`);

            if (startButton) {
                startButton.disabled = selectedCategories.length === 0;
                startButton.style.opacity = selectedCategories.length === 0 ? '0.5' : '1';
            }
        }

        function startSelectedQuiz(subject, subjectName) {
            currentSubject = subject;
            hideAllModals();
            document.getElementById('currentCategory').textContent = `${subjectName} - ${selectedCategories.length}ÂçòÂÖÉÈÅ∏Êäû‰∏≠„Å†„Å´„ÇÉ„Äú‚ô™`;
            document.getElementById('gameScreen').classList.remove('hidden');
            
            const floatingBtn = document.getElementById('changeSubject');
            floatingBtn.classList.remove('hidden');
            floatingBtn.style.display = 'flex';

            correctCount = 0;
            wrongCount = 0;
            totalCount = 0;
            usedQuestions = [];
            sequentialIndex = 0;
            updateStats();
            showNotification(`${subjectName}„ÅÆ${selectedCategories.length}ÂçòÂÖÉ„ÇíÈÅ∏Êäû„Åó„Åü„Å´„ÇÉ„Äú‚ô™`);
        }

        function updateStats() {
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('totalCount').textContent = totalCount;
            
            document.querySelector('.stats-display').classList.add('score-pulse');
            setTimeout(() => {
                document.querySelector('.stats-display').classList.remove('score-pulse');
            }, 600);
        }

        function setQuestionMode(mode) {
            questionMode = mode;
            
            document.getElementById('randomModeBtn').classList.remove('active');
            document.getElementById('sequentialModeBtn').classList.remove('active');
            
            if (mode === 'random') {
                document.getElementById('randomModeBtn').classList.add('active');
                document.getElementById('modeDescription').textContent = 'ÂïèÈ°å„Çí„É©„É≥„ÉÄ„É†„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™';
                usedQuestions = [];
                showNotification('„É©„É≥„ÉÄ„É†Âá∫È°å„Å´Âàá„ÇäÊõø„Åà„Åü„Å´„ÇÉ„Äú');
            } else {
                document.getElementById('sequentialModeBtn').classList.add('active');
                document.getElementById('modeDescription').textContent = 'ÂïèÈ°å„ÇíÈ†ÜÁï™ÈÄö„Çä„Å´Âá∫È°å„Åô„Çã„Å´„ÇÉ„Äú‚ô™';
                sequentialIndex = 0;
                showNotification('È†ÜÁï™ÈÄö„ÇäÂá∫È°å„Å´Âàá„ÇäÊõø„Åà„Åü„Å´„ÇÉ„Äú');
            }
        }

        /* ----------------- „ÇØ„Ç§„Ç∫Ê©üËÉΩ ----------------- */
        function openQuiz() {
            if (selectedCategories.length === 0) {
                showNotification('ÂçòÂÖÉ„ÇíÈÅ∏Êäû„Åó„Å¶„Åª„Åó„ÅÑ„Å´„ÇÉ„Äú');
                return;
            }

            let allProblems = [];
            selectedCategories.forEach(categoryId => {
                if (problemDatabase[categoryId]) {
                    allProblems = allProblems.concat(problemDatabase[categoryId]);
                }
            });

            if (allProblems.length === 0) {
                showNotification('ÂïèÈ°å„Åå„Åæ„Å†Ê∫ñÂÇô‰∏≠„Å†„Å´„ÇÉ„Äú');
                return;
            }

            if (usedQuestions.length >= allProblems.length) {
                usedQuestions = [];
                showNotification('ÂÖ®Âïè„ÇØ„É™„Ç¢„Å†„Å´„ÇÉ„Äú‚ô™ „É™„Çª„ÉÉ„Éà„Åó„Åü„Å´„ÇÉÔºÅ');
            }

            let quiz;
            let remainingCount;
            
            if (questionMode === 'random') {
                const availableQuestions = allProblems.filter((_, index) => !usedQuestions.includes(index));
                if (availableQuestions.length === 0) return;
                
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                quiz = availableQuestions[randomIndex];
                const originalIndex = allProblems.indexOf(quiz);
                usedQuestions.push(originalIndex);
                remainingCount = allProblems.length - usedQuestions.length;
            } else {
                if (sequentialIndex >= allProblems.length) {
                    sequentialIndex = 0;
                    showNotification('ÂÖ®ÂïèÈ°å„Çí‰∏ÄÂë®„Åó„Åü„Å´„ÇÉ„Äú‚ô™ ÊúÄÂàù„Åã„ÇâÂÜçÈñã„Å´„ÇÉÔºÅ');
                }
                quiz = allProblems[sequentialIndex];
                sequentialIndex++;
                remainingCount = allProblems.length - sequentialIndex;
                if (remainingCount < 0) remainingCount = 0;
            }

            const modal = document.getElementById('quizModal');
            const qEl = document.getElementById('quizQ');
            const optDiv = document.getElementById('quizOptions');
            const msgEl = document.getElementById('quizMsg');
            const explanationEl = document.getElementById('quizExplanation');
            const nextBtn = document.getElementById('quizNext');
            const backBtn = document.getElementById('quizBack');

            qEl.textContent = `${quiz.q} (ÊÆã„Çä${remainingCount}Âïè„Å†„Å´„ÇÉ„Äú)`;
            optDiv.innerHTML = '';
            msgEl.textContent = '';
            explanationEl.classList.remove('has-content');

            if (isEnglishCategory()) {
                speakWord(quiz.q);
            }

            nextBtn.disabled = true;
            nextBtn.style.opacity = '0.3';
            backBtn.disabled = true;
            backBtn.style.opacity = '0.3';

            let firstAnswer = false;

            quiz.opts.forEach((txt, i) => {
                const btn = document.createElement('button');
                btn.textContent = txt;
                btn.className = 'quiz-option w-full tap-effect';
                
                addTapEffect(btn);
                
                btn.onclick = () => {
                    if (isEnglishCategory()) {
                        speakWord(txt);
                    }
                    
                    if (!firstAnswer) {
                        firstAnswer = true;
                        totalCount++;
                        if (i === quiz.ans) {
                            correctCount++;
                            soundSystem.playCorrect();
                            soundSystem.vibrate([100, 50, 100, 50, 150]);
                            
                            const correctMsg = nekoMessages.correct[Math.floor(Math.random() * nekoMessages.correct.length)];
                            showNotification(correctMsg);
                            
                            const rect = btn.getBoundingClientRect();
                            createNekoParticles(rect.left + rect.width/2, rect.top + rect.height/2, 
                                              ['‚ú®', 'üåü', 'üí´', 'üéâ', 'üéä'], 5);

                            // Ê≠£Ëß£„Åß„ÇÇ„Éù„Ç§„É≥„Éà„Éú„Éº„Éä„Çπ
                            pointSystem.sparklePoints += 100;
                            pointSystem.firePoints += 50;
                            pointSystem.trophyPoints += 200;
                            pointSystem.updateAllPointDisplays();
                            pointSystem.showFloatingPoints(350, rect.left + rect.width/2, rect.top + rect.height/2, 'bonus');
                        } else {
                            wrongCount++;
                            soundSystem.playWrong();
                            soundSystem.vibrate([80, 40, 80]);
                            
                            const wrongMsg = nekoMessages.wrong[Math.floor(Math.random() * nekoMessages.wrong.length)];
                            showNotification(wrongMsg);

                            // ‰∏çÊ≠£Ëß£„Åß„ÇÇÂ∞ë„Åó„Éù„Ç§„É≥„Éà
                            pointSystem.sparklePoints += 10;
                            pointSystem.firePoints += 5;
                            pointSystem.trophyPoints += 25;
                            pointSystem.updateAllPointDisplays();
                            pointSystem.showFloatingPoints(40, rect.left + rect.width/2, rect.top + rect.height/2);
                        }
                        updateStats();
                        
                        nextBtn.disabled = false;
                        nextBtn.style.opacity = '1';
                        backBtn.disabled = false;
                        backBtn.style.opacity = '1';
                    }
                    
                    if (i === quiz.ans) {
                        msgEl.innerHTML = `üéâ Ê≠£Ëß£„Å†„Å´„ÇÉ„Äú‚ô™ ${quiz.exp || ''}`;
                        msgEl.style.color = 'var(--light-brown)';
                    } else {
                        msgEl.innerHTML = `‚ùå ÊÆãÂøµ„Å´„ÇÉ„Äú...Ê≠£Ëß£„ÅØ„Äå${quiz.opts[quiz.ans]}„Äç„Å†„Å´„ÇÉ‚ô™ ${quiz.exp || ''}`;
                        msgEl.style.color = '#cd5c5c';
                    }
                    explanationEl.classList.add('has-content');
                };
                optDiv.appendChild(btn);
            });

            nextBtn.onclick = () => {
                soundSystem.playSuccess();
                loadNextQuiz();
            };

            backBtn.onclick = () => {
                soundSystem.playClick();
                modal.classList.remove('show');
                showNotification('„ÅäÁñ≤„ÇåÊßò„Å†„Å£„Åü„Å´„ÇÉ„Äú‚ô™');
            };

            modal.classList.add('show');
        }

        function loadNextQuiz() {
            openQuiz();
        }

        /* ----------------- „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆöÔºàÂÆåÂÖ®ÁâàÔºâ ----------------- */
        function initEventListeners() {
            // „Çø„Ç§„Éà„É´„Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà
            document.getElementById('gameTitle').addEventListener('click', (e) => {
                e.stopPropagation();
                bounceTitle();
            });

            // „Çø„Ç§„Éà„É´Áå´„ÅÆ„Çø„ÉÉ„Éó
            document.getElementById('leftCat').addEventListener('click', (e) => {
                e.stopPropagation();
                bounceCat('left');
            });

            document.getElementById('rightCat').addEventListener('click', (e) => {
                e.stopPropagation();
                bounceCat('right');
            });

            // „É°„Ç§„É≥ÊïôÁßëÈÅ∏Êäû
            document.querySelectorAll('[data-subject]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    soundSystem.playSuccess();
                    const subject = e.currentTarget.dataset.subject;
                    hideAllModals();
                    document.getElementById(subject + 'Modal').classList.add('show');
                });
            });

            // Ë©≥Á¥∞„Ç´„ÉÜ„Ç¥„É™ÈÅ∏Êäû
            document.querySelectorAll('[data-category]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    soundSystem.playClick();
                    const category = e.currentTarget.dataset.category;
                    selectedCategories = [];
                    hideAllModals();
                    
                    const modalId = category.split('_')
                        .map((word, index) => index === 0 ? word : word.charAt(0).toUpperCase() + word.slice(1))
                        .join('');
                    
                    const modal = document.getElementById(modalId + 'Modal');
                    modal.classList.add('show');
                    
                    // „É¢„Éº„ÉÄ„É´Ë°®Á§∫Âæå„ÄÅ„Çπ„ÇØ„É≠„Éº„É´‰ΩçÁΩÆ„ÇíÊúÄ‰∏äÈÉ®„Å´„É™„Çª„ÉÉ„Éà
                    setTimeout(() => {
                        const modalCard = modal.querySelector('.clean-card');
                        if (modalCard) {
                            modalCard.scrollTop = 0;
                        }
                    }, 50);
                });
            });

            // „ÇØ„Ç§„Ç∫ÈñãÂßã„Éú„Çø„É≥Áæ§
            document.getElementById('startGeographyQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('geography', 'üó∫Ô∏è Âú∞ÁêÜ');
            });
            document.getElementById('startHistoryQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('history', 'üèõÔ∏è Ê≠¥Âè≤');
            });
            document.getElementById('startCivicsQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('civics', '‚öñÔ∏è ÂÖ¨Ê∞ë');
            });
            document.getElementById('startChemistryQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('chemistry', 'üß™ ÂåñÂ≠¶');
            });
            document.getElementById('startBiologyQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('biology', 'üß¨ ÁîüÁâ©');
            });
            document.getElementById('startPhysicsQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('physics', '‚öõÔ∏è Áâ©ÁêÜ');
            });
            document.getElementById('startEarthQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('earth', 'üåç Âú∞Â≠¶');
            });
            document.getElementById('startEnglishWordsQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('english_words', 'üìù Ëã±ÂçòË™û');
            });
            document.getElementById('startEnglishPhrasesQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('english_phrases', 'üí¨ Ëã±ÁÜüË™û');
            });
            document.getElementById('startEnglishGrammarQuiz').addEventListener('click', () => {
                soundSystem.playSuccess();
                startSelectedQuiz('english_grammar', 'üìò Ë™ûÂΩ¢Â§âÂåñ');
            });

            // Âá∫È°åÂΩ¢ÂºèÂàá„ÇäÊõø„Åà„Éú„Çø„É≥
            document.getElementById('randomModeBtn').addEventListener('click', () => {
                soundSystem.playClick();
                setQuestionMode('random');
            });
            
            document.getElementById('sequentialModeBtn').addEventListener('click', () => {
                soundSystem.playClick();
                setQuestionMode('sequential');
            });

            // „É°„Ç§„É≥„ÇØ„Ç§„Ç∫„Çπ„Çø„Éº„Éà„Éú„Çø„É≥
            document.getElementById('startQuizButton').addEventListener('click', () => {
                soundSystem.playLevelup();
                const startMsg = nekoMessages.start[Math.floor(Math.random() * nekoMessages.start.length)];
                showNotification(startMsg);
                openQuiz();
            });

            // ÊïôÁßëÂ§âÊõ¥„Éú„Çø„É≥
            document.getElementById('changeSubject').addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                soundSystem.playClick();
                selectedCategories = [];
                sequentialIndex = 0;
                usedQuestions = [];
                document.getElementById('gameScreen').classList.add('hidden');
                document.getElementById('changeSubject').classList.add('hidden');
                goBackToMain();
                showNotification('ÊïôÁßëÈÅ∏Êäû„Å´Êàª„Å£„Åü„Å´„ÇÉ„Äú‚ô™');
            });
        }

        /* ----------------- ÂàùÊúüÂåñ ----------------- */
        document.addEventListener('DOMContentLoaded', () => {
            initCategorySelection();
            initEventListeners();
            
            document.getElementById('changeSubject').classList.add('hidden');
            
            document.querySelectorAll('.tap-effect').forEach(addTapEffect);

            // Èü≥Â£∞„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñ
            document.addEventListener('click', () => {
                if (soundSystem.audioContext && soundSystem.audioContext.state === 'suspended') {
                    soundSystem.audioContext.resume();
                }
            }, { once: true });

            // Èü≥Â£∞ÂêàÊàê„ÅÆÂàùÊúüÂåñ
            if ('speechSynthesis' in window && typeof speechSynthesis.getVoices === 'function') {
                const voicePolling = setInterval(() => {
                    if (speechSynthesis.getVoices().length) {
                        clearInterval(voicePolling);
                    } else {
                        speechSynthesis.getVoices(); 
                    }
                }, 200);
            }

            // ÂàùÂõû„É°„ÉÉ„Çª„Éº„Ç∏
            setTimeout(() => {
                showNotification('NEKOPON Quiz„Å∏„Çà„ÅÜ„Åì„Åù„Å´„ÇÉ„Äú‚ô™');
            }, 1000);
            
            // „Éù„Ç§„É≥„Éà„Ç∑„Çπ„ÉÜ„É†„ÅÆÂàùÊúüÂåñË°®Á§∫
            setTimeout(() => {
                showNotification('„Éù„Ç§„É≥„Éà„ÇÇ„ÇØ„É™„ÉÉ„ÇØ„ÅßÁ®º„Åí„Çã„Å´„ÇÉ„Äú‚ô™ ‚ú®üî•üèÜ');
            }, 3000);
        });
    </script>
</body>
</html>