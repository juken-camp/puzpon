<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ONE WORLD Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-coral: #f4a261;
            --primary-sage: #7fb069;
            --primary-sky: #6bb6ff;
            --primary-lavender: #a584c7;
            --accent-peach: #f9b6a3;
            --accent-mint: #b8e6b8;
            --bg-cream: #fdf8f3;
            --bg-white: #ffffff;
            --text-dark: #2d3748;
            --text-warm: #5d4e75;
            --border-soft: #e6ddd4;
            --shadow-gentle: rgba(116, 139, 141, 0.15);
        }
        body {
            font-family: "Noto Sans JP", "Inter", sans-serif;
            background: #faf7f2;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            color: var(--text-dark);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            padding-top: 5rem;
            padding-bottom: 2rem;
        }
        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }
        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }
        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }
        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }
        .game-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--primary-coral);
            text-align: center;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }
        .warm-card {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 24px;
            box-shadow: 0 8px 32px var(--shadow-gentle);
            position: relative;
            overflow: hidden;
        }
        .warm-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-coral);
            border-radius: 24px 24px 0 0;
        }
        .warm-button {
            background: var(--primary-coral);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.4);
            background: #f19a4e;
        }
        .warm-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        .grade-btn {
            background: #fef9f5;
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            color: var(--text-warm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 1rem 0.75rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px var(--shadow-gentle);
        }
        .grade-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.25);
            background: #fdf5ef;
        }
        .grade-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
        }
        .lesson-btn {
            background: #f0f8ff;
            border: 2px solid #b8d4f0;
            border-radius: 16px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 60px;
            box-shadow: 0 4px 12px rgba(107, 182, 255, 0.15);
            font-size: 0.8rem;
            font-weight: 500;
        }
        .lesson-btn:hover {
            border-color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.25);
            background: #e6f3ff;
        }
        .lesson-btn.selected {
            background: #d9edff;
            border-color: var(--primary-sky);
            color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.3);
        }
        .lesson-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-sky);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .grammar-btn {
            background: #f8f5ff;
            border: 2px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.6rem 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 50px;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
            font-size: 0.75rem;
            font-weight: 500;
        }
        .grammar-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
            background: #f0ebff;
        }
        .grammar-btn.selected {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        .grammar-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* æ¨ªãƒ©ã‚¤ãƒ³ã®å¾¹åº•å‰Šé™¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¯¾å¿œï¼‰ */
        *, *::before, *::after,
        *:focus, *:active, *:hover,
        *:focus-visible, *:focus-within {
            border-top: none !important;
            border-bottom: none !important;
            outline: none !important;
        }
        
        /* Tailwind CSSã®å…¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ç„¡åŠ¹åŒ– */
        .border, .border-t, .border-b, .border-l, .border-r,
        .border-0, .border-2, .border-4, .border-8,
        .border-t-0, .border-t-2, .border-t-4, .border-t-8,
        .border-b-0, .border-b-2, .border-b-4, .border-b-8,
        .border-solid, .border-dashed, .border-dotted,
        .divide-y, .divide-x {
            border-top: none !important;
            border-bottom: none !important;
        }
        
        /* å¿…è¦ãªãƒœãƒ¼ãƒ€ãƒ¼ã®ã¿å¾©æ´»ï¼ˆå®Œå…¨æŒ‡å®šï¼‰ */
        .warm-card {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .lesson-btn {
            border: 2px solid #b8d4f0 !important;
            border-top: 2px solid #b8d4f0 !important;
            border-bottom: 2px solid #b8d4f0 !important;
        }
        
        .grammar-btn {
            border: 2px solid #d6c9e3 !important;
            border-top: 2px solid #d6c9e3 !important;
            border-bottom: 2px solid #d6c9e3 !important;
        }
        
        .grade-btn {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .quiz-question {
            border: 3px solid #e2e8f0 !important;
            border-top: 3px solid #e2e8f0 !important;
            border-bottom: 3px solid #e2e8f0 !important;
        }
        
        .answer-display {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .header-stat-item {
            border: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-top: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-bottom: 1.5px solid rgba(165, 132, 199, 0.3) !important;
        }
        
        .header-nav-item {
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-top: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ”¹å–„ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        .modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 0 !important;
            margin: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«å¤‰æ›´ */
            overflow-y: auto !important;
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚’é˜»å®³ã—ãªã„ã‚ˆã†ã« */
            pointer-events: none;
        }
        
        .modal.show {
            display: flex !important;
            align-items: flex-start !important;
            justify-content: center !important;
            animation: modalFadeIn 0.4s ease-out;
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
            pointer-events: auto;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            margin: 1rem !important;
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            /* ğŸ”§ è‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
            overflow: visible !important;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ«ã®å®Œå…¨æ”¹å–„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        #quizModal .modal-content {
            width: 95% !important;
            max-width: 550px !important;
            min-width: 300px !important;
            margin: 1rem auto !important;
            /* ğŸ”§ æœ€å°é™ã®ä¸Šä¸‹ãƒãƒ¼ã‚¸ãƒ³ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            margin-top: 6rem !important;
            margin-bottom: 2rem !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            flex-shrink: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            overflow: visible !important;
        }
        
        #quizModal .modal-content .warm-card {
            width: 100% !important;
            max-width: none !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            margin: 0 !important;
        }
        
        /* ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é¸æŠç”»é¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ”¹å–„ */
        .lesson-modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ */
            margin: 0.5rem !important;
            margin-bottom: 2rem !important;
            margin-top: 6rem !important;
            /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            overflow: visible !important;
        }
        
        @media (max-width: 640px) {
            .modal {
                padding: 0 !important;
                margin: 0 !important;
                /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
                overflow-y: auto !important;
            }
            
            .modal-content {
                margin: 0.5rem !important;
                width: calc(100% - 1rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            #quizModal .modal-content {
                margin: 0.25rem auto !important;
                width: calc(100% - 0.5rem) !important;
                min-width: 280px !important;
                /* ğŸ”§ ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
                margin-top: 5rem !important;
                margin-bottom: 2rem !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            .lesson-modal-content {
                margin: 0.25rem !important;
                margin-bottom: 1rem !important;
                margin-top: 5rem !important;
                width: calc(100% - 0.5rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 600;
            z-index: 100;
            animation: particleFloat 2.5s ease-out forwards;
            font-size: 20px;
        }
        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-40px) scale(1.3) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(1.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰- z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
        .fixed-header {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            /* ğŸ”§ z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚ˆã‚Šä¸Šã«è¡¨ç¤º */
            z-index: 10000;
            animation: floatingHeader 3s ease-in-out infinite;
            max-width: 90vw;
            overflow: hidden;
            background: transparent;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        @keyframes floatingHeader {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        
        .header-stat-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border: 1.5px solid rgba(165, 132, 199, 0.3);
            border-radius: 18px;
            padding: 0.4rem 0.7rem;
            min-width: 60px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(165, 132, 199, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-stat-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(165, 132, 199, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.95));
            border-color: rgba(165, 132, 199, 0.5);
        }
        
        .header-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .header-nav-item:hover::before {
            opacity: 1;
        }
        
        .header-nav-item:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .header-nav-item:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        .header-nav-item.home {
            background: linear-gradient(135deg, var(--primary-coral), #f19a4e);
        }
        
        .header-nav-item.home:hover {
            box-shadow: 0 8px 25px rgba(244, 162, 97, 0.5);
        }
        
        .header-nav-item.back {
            background: linear-gradient(135deg, var(--primary-sage), #6fa055);
        }
        
        .header-nav-item.back:hover {
            box-shadow: 0 8px 25px rgba(127, 176, 105, 0.5);
        }
        
        .header-nav-item.voice {
            background: linear-gradient(135deg, var(--primary-lavender), #9574b5);
        }
        
        .header-nav-item.voice:hover {
            box-shadow: 0 8px 25px rgba(165, 132, 199, 0.5);
        }
        
        .header-stat-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-lavender);
        }
        .header-stat-emoji {
            font-size: 1.1rem;
        }
        
        /* ğŸ”§ éŸ³å£°è¨­å®šã®æ–°ã—ã„ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ */
        .device-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            border: 2px solid #e2e8f0;
        }
        
        .device-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .device-description {
            font-size: 0.8rem;
            color: var(--text-warm);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .voice-choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .voice-choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.5rem;
            background: var(--bg-white);
            border: 2px solid var(--border-soft);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .voice-choice-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.2);
            background: #faf8ff;
        }
        
        .voice-choice-btn.selected {
            border-color: var(--primary-lavender);
            background: #f0ebff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        
        .voice-choice-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voice-gender-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-description {
            font-size: 0.65rem;
            color: var(--text-warm);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        
        .voice-test-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-test-btn:hover {
            background: #5aa3f0;
            transform: translateY(-1px);
        }
        
        .voice-toggle {
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-cream);
            border-radius: 12px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: var(--primary-sage);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        .speak-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary-sage);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            vertical-align: middle;
        }
        .speak-btn:hover {
            background: #6fa055;
            transform: scale(1.1);
        }
        .speak-btn.speaking {
            animation: speakPulse 1s infinite;
        }
        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        .timer-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 0.75rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            border: 2px solid;
            display: inline-block;
            min-width: 80px;
        }
        .timer-normal {
            background: linear-gradient(135deg, #e8f5e8, #f0fdf0);
            color: var(--primary-sage);
            border-color: var(--primary-sage);
        }
        .timer-warning {
            background: linear-gradient(135deg, #fef3cd, #fefce8);
            color: #d97706;
            border-color: #d97706;
            animation: timerPulse 1s infinite;
        }
        .timer-danger {
            background: linear-gradient(135deg, #fee2e2, #fef2f2);
            color: #dc2626;
            border-color: #dc2626;
            animation: timerPulse 0.5s infinite;
        }
        .timer-unlimited {
            background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
            color: #0284c7;
            border-color: #0284c7;
        }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .timer-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .timer-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        
        .answer-display {
            background: var(--bg-cream);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 1rem;
            border: 3px solid var(--border-soft);
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.8;
            box-shadow: 0 4px 12px var(--shadow-gentle);
            min-height: 200px;
            /* ğŸ”§ æœ€å¤§é«˜ã•ã‚’åˆ¶é™ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
            /* max-height: 400px; */
            /* overflow-y: auto; */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .answer-display.show {
            border-color: var(--primary-sage);
            background: #f0f9f0;
            box-shadow: 0 4px 12px rgba(127, 176, 105, 0.2);
        }
        .answer-text {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary-sage);
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
            padding: 1rem;
            background: rgba(127, 176, 105, 0.1);
            border-radius: 12px;
            position: relative;
        }
        .explanation-text {
            color: var(--text-dark);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
        }
        
        .show-answer-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(107, 182, 255, 0.3);
            margin: 0.5rem 0;
        }
        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 182, 255, 0.4);
            background: #5aa3f0;
        }
        .show-answer-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºå•é¡Œæ ã®å›ºå®šåŒ– */
        .quiz-question {
            background: #f8fafc !important;
            border: 3px solid #e2e8f0 !important;
            border-radius: 16px !important;
            padding: 1.5rem !important;
            text-align: center !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            color: var(--text-dark) !important;
            line-height: 1.5 !important;
            margin-bottom: 1rem !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            position: static !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            flex-shrink: 0 !important;
            overflow-wrap: break-word !important;
            word-wrap: break-word !important;
        }
        
        .grade-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .lesson-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        .grammar-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .back-button {
            background: #f1f5f9;
            border: 3px solid #cbd5e1;
            color: var(--text-dark);
            border-radius: 16px;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .back-button:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .stats-display {
            background: var(--bg-cream);
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-gentle);
        }
        .section-divider {
            height: 2px;
            background: var(--border-soft);
            margin: 1.25rem 0;
        }
        .mode-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .mode-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .mode-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        .direction-btn {
            background: var(--bg-white);
            border: 3px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
        }
        .direction-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        .direction-btn.active {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }
            .warm-card {
                margin: 0.25rem;
                padding: 1rem;
            }
            .game-title {
                font-size: clamp(1.25rem, 6vw, 2rem);
            }
            .grade-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .grammar-grid {
                grid-template-columns: 1fr;
                gap: 0.4rem;
            }
            .grade-btn {
                padding: 0.75rem 0.5rem;
                min-height: 70px;
                font-size: 0.8rem;
            }
            .lesson-btn {
                padding: 0.6rem 0.4rem;
                min-height: 50px;
                font-size: 0.75rem;
            }
            .grammar-btn {
                padding: 0.5rem 0.3rem;
                min-height: 45px;
                font-size: 0.7rem;
            }
            .timer-display {
                font-size: 1.25rem;
                padding: 0.5rem;
                min-width: 60px;
            }
            .quiz-question {
                font-size: 1rem !important;
                padding: 1rem !important;
            }
            .answer-display {
                padding: 1.5rem;
                min-height: 150px;
            }
            .answer-text {
                font-size: 1.2rem;
                padding: 0.75rem;
            }
            .explanation-text {
                font-size: 1rem;
            }
            .fixed-header {
                top: 0.5rem;
                padding: 0.6rem 1.2rem;
                gap: 0.8rem;
            }
            .header-stat-item {
                min-width: 50px;
                padding: 0.3rem 0.5rem;
                gap: 0.3rem;
                border-radius: 14px;
            }
            .header-stat-number {
                font-size: 0.8rem;
            }
            .header-stat-emoji {
                font-size: 0.95rem;
            }
            .header-nav-item {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .voice-choice-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .voice-choice-btn {
                min-height: 70px;
                padding: 0.5rem 0.4rem;
            }
            
            .device-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .voice-gender-icon {
                font-size: 1.2rem;
            }
            
            .voice-gender-label {
                font-size: 0.75rem;
            }
            
            .voice-gender-description {
                font-size: 0.6rem;
            }
        }
        
        button, .grade-btn, .lesson-btn, .grammar-btn, .warm-button, .back-button, .mode-btn, .direction-btn, .timer-btn, .show-answer-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }
        
        * {
            touch-action: manipulation;
        }
        
        input, select, textarea {
            font-size: 16px;
        }

        .sparkle {
            position: relative;
            overflow: visible;
        }
        .sparkle::before,
        .sparkle::after {
            content: 'âœ¨';
            position: absolute;
            opacity: 0;
            animation: sparkleFloat 3s infinite ease-in-out;
        }
        .sparkle::before {
            top: -10px;
            left: -10px;
            animation-delay: 0s;
        }
        .sparkle::after {
            bottom: -10px;
            right: -10px;
            animation-delay: 1.5s;
        }
        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
            50% { opacity: 1; transform: translateY(-20px) scale(1.2); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 relative">
    <!-- ãƒ¡ã‚¤ãƒ³å­¦å¹´é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="mainGradeModal" class="modal show">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸ“ å­¦å¹´ã‚’é¸æŠã—ã‚ˆã†
                </h2>
                <p class="text-gray-600 text-sm mb-4">ã‚ãªãŸã®å­¦ç¿’ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grade-grid mb-6">
                    <button class="grade-btn" data-grade="grade1">
                        <div class="text-3xl mb-1">ğŸŒ±</div>
                        <div class="font-semibold text-sm">ä¸­å­¦1å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade2">
                        <div class="text-3xl mb-1">ğŸŒ¿</div>
                        <div class="font-semibold text-sm">ä¸­å­¦2å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade3">
                        <div class="text-3xl mb-1">ğŸŒ³</div>
                        <div class="font-semibold text-sm">ä¸­å­¦3å¹´ç”Ÿ</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦1å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade1Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ± ä¸­å­¦1å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade1Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons1" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦2å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade2Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ¿ ä¸­å­¦2å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade2Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons2" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦3å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade3Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ³ ä¸­å­¦3å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade3Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons3" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡æ³•é …ç›®é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grammarModal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 id="grammarModalTitle" class="text-lg font-semibold mb-3 text-gray-700"></h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã™ã‚‹å†…å®¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grammar-grid mb-4" id="grammarCategories">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startGrammarQuiz" class="warm-button px-8 py-3 text-sm sparkle" disabled>
                        ğŸš€ ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”§ éŸ³å£°è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰ -->
    <div id="voiceSettingsModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">
                    ğŸ¤ éŸ³å£°è¨­å®š
                </h2>
                
                <!-- éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="voice-toggle">
                    <div class="text-sm font-semibold text-gray-700 mb-2">ğŸ”Š éŸ³å£°æ©Ÿèƒ½</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="text-xs text-gray-600 mt-2" id="voiceToggleDescription">éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™</div>
                </div>
                
                <!-- ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰ -->
                <div id="deviceRecommendations">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center mt-4">
                    <button class="warm-button px-6 py-2 text-sm" onclick="closeVoiceSettings()">
                        âœ… è¨­å®šå®Œäº†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="hidden">
        <div class="warm-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4"></div>
            <div class="stats-display">
                <div class="grid grid-cols-2 gap-4 text-center mb-4">
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="studyCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ“š å­¦ç¿’å›æ•°</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="clickCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ–±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                </div>
                
                <!-- åˆ¶é™æ™‚é–“è¨­å®šï¼ˆ4ã¤ã®ãƒœã‚¿ãƒ³ã‚’2x2ã‚°ãƒªãƒƒãƒ‰ã§çµ±ä¸€ï¼‰ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">â° åˆ¶é™æ™‚é–“è¨­å®š</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="timer3Btn" class="timer-btn active" data-time="3">
                            âš¡ 3ç§’
                        </button>
                        <button id="timer5Btn" class="timer-btn" data-time="5">
                            ğŸ”¥ 5ç§’
                        </button>
                        <button id="timer10Btn" class="timer-btn" data-time="10">
                            ğŸŒŸ 10ç§’
                        </button>
                        <button id="timerUnlimitedBtn" class="timer-btn" data-time="unlimited">
                            âˆ ç„¡åˆ¶é™
                        </button>
                    </div>
                </div>
                
                <!-- å‡ºé¡Œå½¢å¼é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ² å‡ºé¡Œã‚¹ã‚¿ã‚¤ãƒ«</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="randomModeBtn" class="mode-btn active" data-mode="random">
                            ğŸ¯ ãƒ©ãƒ³ãƒ€ãƒ 
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn" data-mode="sequential">
                            ğŸ“– é †ç•ªé€šã‚Š
                        </button>
                    </div>
                </div>

                <!-- å‡ºé¡Œæ–¹å‘é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸŒ è¨€èªæ–¹å‘</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="jpToEnBtn" class="direction-btn active" data-direction="jp_to_en">
                            ğŸ‡¯ğŸ‡µâ†’ğŸ‡ºğŸ‡¸
                        </button>
                        <button id="enToJpBtn" class="direction-btn" data-direction="en_to_jp">
                            ğŸ‡ºğŸ‡¸â†’ğŸ‡¯ğŸ‡µ
                        </button>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <button id="mixedBtn" class="direction-btn" data-direction="mixed">
                            ğŸ”€ ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="warm-button px-8 py-4 text-base font-semibold mt-6 sparkle">
                ğŸŒŸ ãƒ¬ãƒƒãƒ„ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
        </div>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-4 w-full max-w-lg mx-4">
                <div class="text-center mb-4">
                    <h2 class="font-semibold text-lg text-gray-700">
                        ğŸŒ ONE WORLD Quiz Challenge
                    </h2>
                    <div class="flex items-center justify-between mt-2">
                        <div id="remainingCount" class="text-sm text-gray-600"></div>
                        <div id="timerDisplay" class="timer-display timer-normal">
                            <span id="timerValue">æº–å‚™ä¸­</span>
                        </div>
                    </div>
                </div>
                
                <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="quizQuestion" class="quiz-question"></div>
                
                <!-- è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
                <div class="text-center">
                    <button id="showAnswerBtn" class="show-answer-btn">
                        ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹
                    </button>
                </div>
                
                <!-- è§£ç­”ãƒ»è§£èª¬è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆæ‹¡å¤§ç‰ˆï¼‰ -->
                <div id="answerDisplay" class="answer-display">
                    <div id="answerContent">
                        <div class="text-gray-500" style="text-align: center;">é ­ã§è€ƒãˆã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>
                    </div>
                </div>
                
                <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
                <div class="flex gap-2 mt-4">
                    <button id="quizNext" class="flex-1 warm-button py-3 text-sm" disabled>
                        â­ æ¬¡ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰ -->
    <div class="fixed-header">
        <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item home" id="footerHomeBtn" title="ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹">
            ğŸ 
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item back" id="footerBackBtn" title="å‰ã®ç”»é¢ã«æˆ»ã‚‹">
            â—€ï¸
        </div>
        
        <!-- ç·ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTotalStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ†</span>
            <span class="header-stat-number" id="footerTotalClick">0</span>
        </div>
        
        <!-- ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTodayStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ“…</span>
            <span class="header-stat-number" id="footerTodayClick">0</span>
        </div>
        
        <!-- éŸ³å£°è¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item voice" id="footerVoiceBtn" title="éŸ³å£°è¨­å®š">
            ğŸ¤
        </div>
    </div>

<script>
        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é …ç›®å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰ ----------------- */
        const lessons = {
            grade1: [
                {
                    id: 'lesson1',
                    name: 'Lesson1 - æ–‡ã®åŸºæœ¬',
                    grammar: [
                        {id: 'word_order', name: '1. æ—¥æœ¬èªã¨è‹±èªã®èªé †'},
                        {id: 'sentence_types', name: '2. è‹±èªã®æ–‡ã®ä»£è¡¨çš„ãª2ã¤ã®å‹'},
                        {id: 'personal_statements', name: '3. è‡ªåˆ†ã®ã“ã¨ã‚’è¿°ã¹ãŸã‚Šç›¸æ‰‹ã®ã“ã¨ã‚’ãŸãšã­ã‚‹'},
                        {id: 'various_questions', name: '4. ã•ã¾ã–ã¾ãªç–‘å•æ–‡'},
                        {id: 'requests', name: '5. ãŠé¡˜ã„ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ä»£åè©',
                    grammar: [
                        {id: 'she_he_it', name: '1. she, he, it ãªã©ã®ä½¿ã„æ–¹'},
                        {id: 'pronoun_questions', name: '2. she, he ãªã©ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'this_that', name: '3. this ã¨ that ã®ä½¿ã„æ–¹'},
                        {id: 'this_that_questions', name: '4. this, that ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'we_you_they', name: '5. We, you, they ã®ä½¿ã„æ–¹'},
                        {id: 'can_usage', name: '6. can ã®æ„å‘³ã¨ç”¨æ³•'},
                        {id: 'some_any', name: '7. some ã¨ any'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸€èˆ¬å‹•è©',
                    grammar: [
                        {id: 'general_verbs', name: '1. ä¸€èˆ¬å‹•è©ã«ã¯ã€ã©ã‚“ãªã‚‚ã®ãŒã‚ã‚‹ï¼Ÿ'},
                        {id: 'verb_s_es', name: '2. ä¸€èˆ¬å‹•è©ã«ã¤ã s, es'},
                        {id: 'verb_s_es_rules', name: '3. ä¸€èˆ¬å‹•è©ã® s, es ã®ã¤ã‘æ–¹'},
                        {id: 'noun_singular_plural', name: '4. ã€Œ1ã¤ï¼ˆå˜æ•°ï¼‰ã€ãªã®ã‹ã€Œ2ã¤ä»¥ä¸Šï¼ˆè¤‡æ•°ï¼‰ã€ãªã®ã‹ã‚’è¡¨ã™åè©ã«ã¤ã s, es'},
                        {id: 'plural_rules', name: '5. è¤‡æ•°å½¢ã®ã¤ãã‚Šæ–¹'},
                        {id: 'pronoun_i', name: '6. ã€Œç§ã€ã‚’è¡¨ã™2ã¤ã®å½¢'},
                        {id: 'pronoun_cases', name: '7. ä¸»èªã¨ã—ã¦ä½¿ã†å ´åˆã¨ä¸»èªä»¥å¤–ã§ä½¿ã†ã€Œã‚ãªãŸã€ã€Œå½¼ã€ãªã©'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - éå»å½¢',
                    grammar: [
                        {id: 'past_statements', name: '1. éå»ã®ã“ã¨ã‚’è¨€ã†ã¨ã'},
                        {id: 'past_questions', name: '2. éå»ã®ã“ã¨ã‚’ãŸãšã­ã‚‹ã¨ãï¼ˆç–‘å•æ–‡ï¼‰'},
                        {id: 'past_negative', name: '3. éå»ã®ã“ã¨ã§ã€Œã—ãªã‹ã£ãŸã€ã€Œã§ãªã‹ã£ãŸã€ã“ã¨ã‚’è¨€ã†ã¨ãï¼ˆå¦å®šæ–‡ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ç¾åœ¨é€²è¡Œå½¢',
                    grammar: [
                        {id: 'present_continuous', name: '1. ä»Šã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_negative', name: '2. ã€Œã€œã—ã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_questions', name: '3. ã€Œã€œã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã€ã€Œä½•ã‚’ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ç–‘å•è©',
                    grammar: [
                        {id: 'why_because', name: '1. ã€Œç†ç”±ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œç†ç”±ã€ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'how_often', name: '2. ã€Œã©ã®ãã‚‰ã„ã‚ˆãã€œã™ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ç­”ãˆã‚‹ã¨ã'},
                        {id: 'which_who_whose', name: '3. ã€Œã©ã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œã©ã¡ã‚‰ã‚’ã€ã€Œã ã‚ŒãŒã€ã€Œã ã‚Œã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - åŠ©å‹•è©',
                    grammar: [
                        {id: 'must_prohibition', name: '1. ã€Œå¼·ã„å‘½ä»¤ã€ã‚„ã€Œç¦æ­¢ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'have_to_necessity', name: '2. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã€Œã€œã™ã‚‹å¿…è¦ã¯ãªã„ã€ã¨ä¼ãˆã‚‹ã¨ã'},
                        {id: 'may_able_to', name: '3. ã€Œã€œã‹ã‚‚ã—ã‚Œãªã„ã€ã¨è¿°ã¹ã‚‹ã¨ãã€ã€Œã€œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - æœªæ¥è¡¨ç¾',
                    grammar: [
                        {id: 'be_going_to', name: '1. äºˆå®šã‚„è¨ˆç”»ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'will_prediction', name: '2. æœªæ¥ã®ã“ã¨ã«ã¤ã„ã¦ã€Œã€œã ã‚ã†ã€ã¨ã„ã†äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'should', name: '3. ã€Œã€œã™ã¹ãã ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - There is/areæ–‡',
                    grammar: [
                        {id: 'there_is_are', name: '1. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ãŒã‚ã‚‹ï¼ˆã„ã‚‹ï¼‰ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'there_is_are_questions', name: '2. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã‚ã‚Šã¾ã™ã‹ã€ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã„ãã¤ã‚ã‚Šã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹å ´åˆ'},
                        {id: 'look_sound', name: '3. ã€Œã€œãã†ã«è¦‹ãˆã‚‹ï¼èã“ãˆã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade2: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 1å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'have_to_must_review', name: '1. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã‚„ã€Œå¼·ã„å‘½ä»¤ã€ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆhave [has] to ã¨ mustï¼‰'},
                        {id: 'future_review', name: '2. äºˆå®šã‚„æœªæ¥ã«ã¤ã„ã¦ã®äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆbe going to ã¨ willï¼‰'},
                        {id: 'there_is_are_review', name: '3. ã‚‚ã®ãŒã‚ã‚‹ã“ã¨ã‚„ã€äººãŒã„ã‚‹ã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆThere is [are] ~.ï¼‰'},
                        {id: 'there_is_are_transformation', name: '4. There is [are] ~. ã®æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç›®çš„èª2ã¤/æ¥ç¶šè©that',
                    grammar: [
                        {id: 'double_object', name: '1. ã€Œï¼œäººï¼ã«ï¼œã‚‚ã®ï¼ã‚’ã‚ã’ã‚‹ãƒ»é€ã‚‹ã€ãªã©ã¨è¿°ã¹ã‚‹ã¨ãï¼ˆç›®çš„èªã‚’ï¼’ã¤ã¨ã‚‹å‹•è©ï¼‰'},
                        {id: 'that_opinion', name: '2. è‡ªåˆ†ã®æ„è¦‹ã‚„çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'},
                        {id: 'that_feeling', name: '3. è‡ªåˆ†ã®æ°—æŒã¡ã¨ãã®ç†ç”±ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - éå»é€²è¡Œå½¢/æ¥ç¶šè©',
                    grammar: [
                        {id: 'past_continuous', name: '1. éå»ã®ã‚ã‚‹æ™‚ç‚¹ã§ã—ã¦ã„ãŸã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆéå»é€²è¡Œå½¢ï¼‰'},
                        {id: 'when_conjunction', name: '2. ã©ã‚“ãªæ™‚ã®ã“ã¨ã‹ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®whenï¼‰'},
                        {id: 'if_because', name: '3. æ¡ä»¶ã‚’è¿°ã¹ã‚‹ã¨ãã€ç†ç”±ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®ifï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸å®šè©',
                    grammar: [
                        {id: 'infinitive_noun', name: '1. ã—ãŸã„ã“ã¨ã€ãªã‚ŠãŸã„ã‚‚ã®ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆåè©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ã“ã¨ã€ï¼‰'},
                        {id: 'infinitive_adverb', name: '2. ç›®çš„ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå‰¯è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã«ã€ï¼‰'},
                        {id: 'infinitive_adjective', name: '3. ã€Œã‚‚ã®ã®ç”¨é€”ã€ä½•ã‚’ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå½¢å®¹è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã®ã€ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - å‹•åè©',
                    grammar: [
                        {id: 'gerund_object', name: '1. ã€Œã€œã™ã‚‹ã“ã¨ã‚’çµ‚ãˆã‚‹ãƒ»æ¥½ã—ã‚€ãƒ»å¥½ã‚€ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'gerund_subject', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã€ã‚’ä¸»èªã«ã—ã¦è¿°ã¹ã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'teach_tell_that', name: '3. ã€Œã ã‚ŒãŒã ã‚Œã«ã©ã‚“ãªã“ã¨ã‚’æ•™ãˆãŸã‹ãƒ»ä¼ãˆãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä¸å®šè©ã®ç™ºå±•',
                    grammar: [
                        {id: 'how_to_what_to', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã¯ãŠã‚‚ã—ã‚ã„ãƒ»é›£ã—ã„ãƒ»ä¸å¯èƒ½ã ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€œ.ï¼‰'},
                        {id: 'teach_ask_how_to', name: '3. ã€Œã ã‚Œã«ã€œã®ä»•æ–¹ã€ä½•ã‚’ã™ã¹ãã‹ãªã©ã‚’ä¼ãˆã‚‹ãƒ»æ•™ãˆã‚‹ãƒ»ãŸãšã­ã‚‹ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - æ¯”è¼ƒ',
                    grammar: [
                        {id: 'comparative', name: '1. 2ã¤ã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ãã®é•ã„ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¯”è¼ƒç´šï¼‰'},
                        {id: 'superlative', name: '2. 3ã¤ä»¥ä¸Šã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ã€Œã„ã¡ã°ã‚“ã€œã ã€ã¨ä¼ãˆã‚‹ã¨ãï¼ˆæœ€ä¸Šç´šï¼‰'},
                        {id: 'as_as', name: '3. ã€ŒåŒã˜ãã‚‰ã„ã€œã ã€ã€Œã„ã¡ã°ã‚“å¥½ãã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆåŸç´šãªã©ï¼‰'},
                        {id: 'comparison_rules', name: '4. æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šã®ä½œã‚Šæ–¹'},
                        {id: 'comparison_transformation', name: '5. æ¯”è¼ƒè¡¨ç¾ã®æ›¸ãæ›ãˆ'},
                        {id: 'comparison_notes', name: '6. ãã®ä»–ã«æ³¨æ„ã™ã‚‹ã“ã¨'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - å—å‹•æ…‹',
                    grammar: [
                        {id: 'passive_voice', name: '1. ã€Œ...ã¯ã€œã•ã‚Œã‚‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã‚‹ã€ã®ã‚ˆã†ãªè¡¨ç¾ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'passive_questions', name: '2. ã€Œâ€¦ã¯ã€œã•ã‚Œã¾ã™ã‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã¾ã™ã‹ã€ãªã©ã¨è³ªå•ã™ã‚‹ã¨ã'},
                        {id: 'passive_modal', name: '3. ã€Œã€œã•ã‚Œã‚‹ã¹ãã ã€ã€Œã€œã•ã‚Œã‚‹ã“ã¨ãŒå¯èƒ½ã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'past_participle_rules', name: '4. éå»åˆ†è©å½¢ã®ä½œã‚Šæ–¹'},
                        {id: 'passive_transformation', name: '5. å—ã‘èº«ã®æ–‡ã®æ›¸ãæ›ãˆä¾‹'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - é–“æ¥ç–‘å•æ–‡/æ„Ÿå˜†æ–‡',
                    grammar: [
                        {id: 'indirect_questions_know', name: '1. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€ŒçŸ¥ã£ã¦ã„ã‚‹ãƒ»çŸ¥ã‚‰ãªã„ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'indirect_questions_tell', name: '2. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€Œã ã‚Œã«è¨€ã£ãŸã‹ãƒ»èã„ãŸã‹ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'exclamatory', name: '3. é©šãã‚„æ„Ÿå‹•ã‚’è¡¨ç¾ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - å‹•è©ã®æ§˜ã€…ãªä½¿ã„æ–¹',
                    grammar: [
                        {id: 'make_call', name: '1. ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ã€Œå‘¼ã³åã¯ä½•ã‹ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'want_ask_to', name: '2. äººã«ã—ã¦ã»ã—ã„ã“ã¨ã‚’ä¼ãˆãŸã‚Šé ¼ã‚“ã ã‚Šã™ã‚‹ã¨ã'},
                        {id: 'let_help', name: '3. è¨±å¯ã‚’å¾—ã‚‹ã¨ãã€ã ã‚ŒãŒæ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ã‹ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade3: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 2å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'how_to_what_to_review', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'make_call_review', name: '2. ã€Œå‘¼ã³åã¯ä½•ã‹ã€ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to_review', name: '3. ã€Œã€œã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ»ã‚„ã•ã—ã„ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç¾åœ¨å®Œäº†å½¢(1)',
                    grammar: [
                        {id: 'present_perfect_completion', name: '1. ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience', name: '2. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience_questions', name: '3. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ç¾åœ¨å®Œäº†å½¢(2)',
                    grammar: [
                        {id: 'present_perfect_continuation', name: '1. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuation_questions', name: '2. ã€Œã©ã®ãã‚‰ã„ã€œã—ã¦ã„ã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuous', name: '3. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†é€²è¡Œå½¢ï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - å¾Œç½®ä¿®é£¾',
                    grammar: [
                        {id: 'participle_present', name: '1. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®1ï¼šç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'participle_past', name: '2. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®2ï¼šéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'relative_pronoun_omission', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®3ï¼šç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - é–¢ä¿‚ä»£åè©',
                    grammar: [
                        {id: 'relative_pronoun_who', name: '1. ã€Œã©ã‚“ãªäººã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_which', name: '2. ã€Œã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_object', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä»®å®šæ³•',
                    grammar: [
                        {id: 'subjunctive_1', name: '1. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®1ï¼‰'},
                        {id: 'subjunctive_2', name: '2. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®2ï¼‰'},
                        {id: 'subjunctive_3', name: '3. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®3ï¼‰'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - å¾Œç½®ä¿®é£¾ã¨é–¢ä¿‚ä»£åè©ã®ã¾ã¨ã‚',
                    grammar: [
                        {id: 'postposition_ing', name: '1. ã€ˆåè© ï¼‹ å‹•è©ã®-ingå½¢ ï¼‹ èªå¥ã€‰ï¼ˆç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_past_participle', name: '2. ã€ˆåè© ï¼‹ å‹•è©ã®éå»åˆ†è©å½¢ ï¼‹ èªå¥ã€‰ï¼ˆéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_omission', name: '3. ã€ˆåè© ï¼‹ ä¸»èª ï¼‹ å‹•è© ã€œã€‰ï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'},
                        {id: 'relative_summary', name: '4. ã€ˆåè© ï¼‹ é–¢ä¿‚ä»£åè©ï¼ˆwho, which, thatï¼‰ ï¼‹ èªå¥ã€‰ï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ã¨ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'sentence_transformation', name: '5. æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                }
            ]
        };

        /* ----------------- ğŸ”§ æ‹¡å……ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆä¸­3å®Œå…¨å¯¾å¿œç‰ˆï¼‰ ----------------- */
        const sampleProblems = {
            grade1: {
                lesson1: {
                    word_order: [
                        {
                            jp: "ç§ã¯å­¦ç”Ÿã§ã™ã€‚",
                            en: "I am a student.",
                            explanation: "æ—¥æœ¬èªã®èªé †ã¨è‹±èªã®èªé †ã®é•ã„ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚è‹±èªã§ã¯ã€Œä¸»èª + å‹•è©ã€ã®é †ç•ªãŒåŸºæœ¬ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å…ˆç”Ÿã§ã™ã‹ï¼Ÿ",
                            en: "Are you a teacher?",
                            explanation: "ç–‘å•æ–‡ã§ã¯å‹•è©(beå‹•è©)ãŒä¸»èªã®å‰ã«æ¥ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He is not a doctor.",
                            explanation: "å¦å®šæ–‡ã§ã¯ beå‹•è©ã®å¾Œã« not ã‚’ä»˜ã‘ã¾ã™ã€‚"
                        }
                    ],
                    sentence_types: [
                        {
                            jp: "ã“ã‚Œã¯æœ¬ã§ã™ã€‚",
                            en: "This is a book.",
                            explanation: "è‹±èªã®åŸºæœ¬æ–‡å‹ã®ä¸€ã¤ã€Œä¸»èª + beå‹•è© + è£œèªã€ã®å½¢ã§ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯è‹±èªã‚’è©±ã—ã¾ã™ã€‚",
                            en: "I speak English.",
                            explanation: "ã€Œä¸»èª + å‹•è© + ç›®çš„èªã€ã®æ–‡å‹ã§ã™ã€‚"
                        }
                    ],
                    personal_statements: [
                        {
                            jp: "ç§ã®åå‰ã¯ç”°ä¸­ã§ã™ã€‚",
                            en: "My name is Tanaka.",
                            explanation: "è‡ªå·±ç´¹ä»‹ã®åŸºæœ¬çš„ãªè¡¨ç¾ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã®è¶£å‘³ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                            en: "What is your hobby?",
                            explanation: "ç›¸æ‰‹ã«ã¤ã„ã¦è³ªå•ã™ã‚‹æ™‚ã®è¡¨ç¾ã§ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    she_he_it: [
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã™ã€‚",
                            en: "He is a doctor.",
                            explanation: "ç”·æ€§ã‚’è¡¨ã™æ™‚ã¯heã‚’ä½¿ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯çœ‹è­·å¸«ã§ã™ã€‚",
                            en: "She is a nurse.",
                            explanation: "å¥³æ€§ã‚’è¡¨ã™æ™‚ã¯sheã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    general_verbs: [
                        {
                            jp: "ç§ã¯æ¯æ—¥è‹±èªã‚’å‹‰å¼·ã—ã¾ã™ã€‚",
                            en: "I study English every day.",
                            explanation: "ä¸€èˆ¬å‹•è©ã¯å‹•ä½œã‚„çŠ¶æ…‹ã‚’è¡¨ã™å‹•è©ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯é‡çƒã‚’ã—ã¾ã™ã€‚",
                            en: "He plays baseball.",
                            explanation: "ä¸‰äººç§°å˜æ•°ç¾åœ¨å½¢ã§ã¯å‹•è©ã« s ãŒä»˜ãã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade2: {
                lesson1: {
                    double_object: [
                        {
                            jp: "ç§ã¯å½¼ã«æœ¬ã‚’ã‚ã’ã¾ã—ãŸã€‚",
                            en: "I gave him a book.",
                            explanation: "ç›®çš„èªã‚’2ã¤ã¨ã‚‹å‹•è©ã§ã¯ã€Œå‹•è© + äºº + ã‚‚ã®ã€ã®é †ç•ªã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯ç§ã«æ‰‹ç´™ã‚’é€ã‚Šã¾ã—ãŸã€‚",
                            en: "She sent me a letter.",
                            explanation: "send ã¯ã€Œäººã«ã‚‚ã®ã‚’é€ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã‚ã‚Œã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade3: {
                review_lesson: {
                    how_to_what_to_review: [
                        {
                            jp: "ç§ã¯æ³³ãæ–¹ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚",
                            en: "I know how to swim.",
                            explanation: "ã€Œhow to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã®ä»•æ–¹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ä½•ã‚’ã™ã¹ãã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚",
                            en: "I don't know what to do.",
                            explanation: "ã€Œwhat to + å‹•è©ã®åŸå½¢ã€ã§ã€Œä½•ã‚’ã€œã™ã¹ãã‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    make_call_review: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯ç§ã‚’æ‚²ã—ãã•ã›ã¾ã—ãŸã€‚",
                            en: "The movie made me sad.",
                            explanation: "ã€Œmake + äºº + å½¢å®¹è©ã€ã§ã€Œäººã‚’ã€œã«ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å½¼ã‚’ãƒˆãƒ ã¨å‘¼ã³ã¾ã™ã€‚",
                            en: "We call him Tom.",
                            explanation: "ã€Œcall + äºº + åå‰ã€ã§ã€Œäººã‚’ã€œã¨å‘¼ã¶ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ],
                    it_is_to_review: [
                        {
                            jp: "è‹±èªã‚’å­¦ã¶ã“ã¨ã¯æ¥½ã—ã„ã§ã™ã€‚",
                            en: "It is fun to learn English.",
                            explanation: "ã€ŒIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã™ã‚‹ã“ã¨ã¯...ã ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ—©èµ·ãã™ã‚‹ã“ã¨ã¯å¥åº·ã«è‰¯ã„ã§ã™ã€‚",
                            en: "It is good for your health to get up early.",
                            explanation: "It ã‚’ä»®ä¸»èªã¨ã—ã¦ä½¿ã„ã€çœŸã®ä¸»èªã¯ to ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ]
                },
                lesson1: {
                    present_perfect_completion: [
                        {
                            jp: "ç§ã¯å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã€‚",
                            en: "I have finished my homework.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ã§ã¯ã€Œhave/has + éå»åˆ†è©ã€ã§ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯ã‚‚ã†å®¶ã«å¸°ã‚Šã¾ã—ãŸã€‚",
                            en: "He has already gone home.",
                            explanation: "already ã‚’ä½¿ã£ã¦ã€Œã‚‚ã†ã€œã—ãŸã€ã“ã¨ã‚’å¼·èª¿ã§ãã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯ã¾ã æ˜¼é£Ÿã‚’é£Ÿã¹ã¦ã„ã¾ã›ã‚“ã€‚",
                            en: "I haven't eaten lunch yet.",
                            explanation: "yet ã¯å¦å®šæ–‡ã§ã€Œã¾ã ã€œã—ã¦ã„ãªã„ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience: [
                        {
                            jp: "ç§ã¯æ±äº¬ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "I have been to Tokyo.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ã§ã€Œã€œã—ãŸã“ã¨ãŒã‚ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯å¯Œå£«å±±ã‚’è¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He has never seen Mt. Fuji.",
                            explanation: "never ã‚’ä½¿ã£ã¦ã€Œä¸€åº¦ã‚‚ã€œã—ãŸã“ã¨ãŒãªã„ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å¯¿å¸ã‚’é£Ÿã¹ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "Have you ever eaten sushi?",
                            explanation: "ever ã‚’ä½¿ã£ã¦çµŒé¨“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã‚’ä½œã‚Šã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience_questions: [
                        {
                            jp: "ã‚ãªãŸã¯ä½•å›æ—¥æœ¬ã«æ¥ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "How many times have you been to Japan?",
                            explanation: "ã€ŒHow many times + ç¾åœ¨å®Œäº†å½¢ã€ã§å›æ•°ã‚’å°‹ã­ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãƒ”ã‚¢ãƒã‚’å¼¾ã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you been playing the piano?",
                            explanation: "ç¶™ç¶šç”¨æ³•ã§æœŸé–“ã‚’å°‹ã­ã‚‹æ™‚ã¯ How long ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    present_perfect_continuation: [
                        {
                            jp: "ç§ã¯3å¹´é–“è‹±èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚",
                            en: "I have studied English for three years.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ã§ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœˆæ›œæ—¥ã‹ã‚‰ãšã£ã¨ç—…æ°—ã§ã™ã€‚",
                            en: "He has been sick since Monday.",
                            explanation: "since ã¯ã€Œã€œã‹ã‚‰ã€ã¨ã„ã†èµ·ç‚¹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å­ä¾›ã®é ƒã‹ã‚‰ã®å‹é”ã§ã™ã€‚",
                            en: "We have been friends since we were children.",
                            explanation: "çŠ¶æ…‹ã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†å½¢ã§ã™ã€‚"
                        }
                    ],
                    present_perfect_continuation_questions: [
                        {
                            jp: "ã©ã®ãã‚‰ã„é•·ãæ—¥æœ¬ã«ä½ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "How long have you lived in Japan?",
                            explanation: "ç¶™ç¶šæœŸé–“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãã®ä¼šç¤¾ã§åƒã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you worked for that company?",
                            explanation: "work ã¯ç¶™ç¶šã‚’è¡¨ã™å‹•è©ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_continuous: [
                        {
                            jp: "é›¨ãŒ2æ™‚é–“é™ã‚Šç¶šã„ã¦ã„ã¾ã™ã€‚",
                            en: "It has been raining for two hours.",
                            explanation: "ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’å¼·èª¿ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœã‹ã‚‰ãšã£ã¨åƒã„ã¦ã„ã¾ã™ã€‚",
                            en: "He has been working since this morning.",
                            explanation: "å‹•ä½œã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    participle_present: [
                        {
                            jp: "èµ°ã£ã¦ã„ã‚‹å°‘å¹´ã¯ç§ã®å¼Ÿã§ã™ã€‚",
                            en: "The boy running is my brother.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã€Œã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãã“ã§æ­Œã£ã¦ã„ã‚‹å¥³ã®å­ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "Do you know the girl singing over there?",
                            explanation: "ç¾åœ¨åˆ†è©ãŒåè©ã‚’å¾Œã‚ã‹ã‚‰ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚"
                        }
                    ],
                    participle_past: [
                        {
                            jp: "æ—¥æœ¬ã§ä½œã‚‰ã‚ŒãŸè»Šã¯äººæ°—ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "Cars made in Japan are popular.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—ã‘èº«ã®æ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å£Šã‚ŒãŸçª“ã‚’ä¿®ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "We need to repair the broken window.",
                            explanation: "éå»åˆ†è©ãŒåè©ã‚’ä¿®é£¾ã—ã¦çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_omission: [
                        {
                            jp: "ç§ãŒæ˜¨æ—¥èª­ã‚“ã æœ¬ã¯ã¨ã¦ã‚‚é¢ç™½ã‹ã£ãŸã§ã™ã€‚",
                            en: "The book I read yesterday was very interesting.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© which/that ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè©±ã—ã¦ã„ãŸäººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person he was talking to is my teacher.",
                            explanation: "å‰ç½®è©ã®ç›®çš„èªã«ãªã‚‹é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson4: {
                    relative_pronoun_who: [
                        {
                            jp: "è‹±èªã‚’æ•™ãˆã‚‹äººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person who teaches English is my teacher.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ˜¨æ—¥æ¥ãŸå­¦ç”ŸãŸã¡ã¯ä¸­å›½ã‹ã‚‰æ¥ã¾ã—ãŸã€‚",
                            en: "The students who came yesterday are from China.",
                            explanation: "è¤‡æ•°ã®äººã‚’å…ˆè¡Œè©ã¨ã™ã‚‹å ´åˆã‚‚ who ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_which: [
                        {
                            jp: "æœºã®ä¸Šã«ã‚ã‚‹æœ¬ã¯ç§ã®ã‚‚ã®ã§ã™ã€‚",
                            en: "The book which is on the desk is mine.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© which ã¯ç‰©ã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè²·ã£ãŸè»Šã¯èµ¤ã„ã§ã™ã€‚",
                            en: "The car which he bought is red.",
                            explanation: "which ã¯ that ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_object: [
                        {
                            jp: "ç§ãŒä¼šã£ãŸäººã¯ã¨ã¦ã‚‚è¦ªåˆ‡ã§ã—ãŸã€‚",
                            en: "The person whom I met was very kind.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© whom ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ï¼ˆwho ã‚‚å¯ï¼‰ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ãŒä½œã£ãŸæ–™ç†ã¯ãŠã„ã—ã‹ã£ãŸã§ã™ã€‚",
                            en: "The food that she cooked was delicious.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã¯äººãƒ»ç‰©ä¸¡æ–¹ã«ä½¿ãˆã¾ã™ã€‚"
                        }
                    ]
                },
                lesson5: {
                    subjunctive_1: [
                        {
                            jp: "ã‚‚ã—ãŠé‡‘ãŒã‚ã£ãŸã‚‰ã€æ–°ã—ã„è»Šã‚’è²·ã†ã®ã«ã€‚",
                            en: "If I had money, I would buy a new car.",
                            explanation: "ä»®å®šæ³•éå»ã§ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ™‚é–“ãŒã‚ã£ãŸã‚‰ã€ã‚ãªãŸã¨è©±ã™ã®ã«ã€‚",
                            en: "If I had time, I would talk with you.",
                            explanation: "ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹é¡˜æœ›ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_2: [
                        {
                            jp: "ã‚‚ã—æ˜¨æ—¥å‹‰å¼·ã—ã¦ã„ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ã¦ã„ãŸã ã‚ã†ã€‚",
                            en: "If I had studied yesterday, I would have passed the test.",
                            explanation: "ä»®å®šæ³•éå»å®Œäº†ã§éå»ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ—©ãå‡ºç™ºã—ã¦ã„ãŸã‚‰ã€é…åˆ»ã—ãªã‹ã£ãŸã ã‚ã†ã€‚",
                            en: "If we had left earlier, we wouldn't have been late.",
                            explanation: "éå»ã®äº‹å®Ÿã«åã™ã‚‹å¾Œæ‚”ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_3: [
                        {
                            jp: "å½¼ãŒãã“ã«ã„ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish he were there.",
                            explanation: "wish + ä»®å®šæ³•ã§å®Ÿç¾å›°é›£ãªé¡˜æœ›ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "é›¨ãŒé™ã‚‰ãªã‘ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish it wouldn't rain.",
                            explanation: "æœªæ¥ã¸ã®é¡˜æœ›ã‚’ wish + would ã§è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson6: {
                    postposition_ing: [
                        {
                            jp: "å…¬åœ’ã§éŠã‚“ã§ã„ã‚‹å­ä¾›ãŸã¡ã¯å…ƒæ°—ã§ã™ã€‚",
                            en: "The children playing in the park are energetic.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å›³æ›¸é¤¨ã§å‹‰å¼·ã—ã¦ã„ã‚‹å­¦ç”Ÿã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "I saw students studying in the library.",
                            explanation: "å ´æ‰€ã‚’å«ã‚€ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_past_participle: [
                        {
                            jp: "ãƒ•ãƒ©ãƒ³ã‚¹ã§ä½œã‚‰ã‚ŒãŸãƒ¯ã‚¤ãƒ³ã¯æœ‰åã§ã™ã€‚",
                            en: "Wine made in France is famous.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—å‹•çš„ãªæ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "10å¹´å‰ã«å»ºã¦ã‚‰ã‚ŒãŸå»ºç‰©ã¯å¤ãè¦‹ãˆã¾ã™ã€‚",
                            en: "The building built ten years ago looks old.",
                            explanation: "æ™‚ã‚’å«ã‚€éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_omission: [
                        {
                            jp: "ç§ãŒè²·ã£ãŸèŠ±ã¯ã¨ã¦ã‚‚ç¾ã—ã„ã§ã™ã€‚",
                            en: "The flowers I bought are very beautiful.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚ŒãŸå¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè¨€ã£ãŸã“ã¨ã¯æœ¬å½“ã§ã—ãŸã€‚",
                            en: "What he said was true.",
                            explanation: "é–¢ä¿‚ä»£åè©ã®çœç•¥ã«ã‚ˆã‚‹ç°¡æ½”ãªè¡¨ç¾ã§ã™ã€‚"
                        }
                    ],
                    relative_summary: [
                        {
                            jp: "ãã“ã§åƒã„ã¦ã„ã‚‹äººã¯ç§ã®å‹é”ã§ã™ã€‚",
                            en: "The person who works there is my friend.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒèª­ã‚“ã§ã„ã‚‹æœ¬ã¯é›£ã—ãã†ã§ã™ã€‚",
                            en: "The book that he is reading looks difficult.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        }
                    ],
                    sentence_transformation: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯é¢ç™½ã‹ã£ãŸã§ã™ã€‚ç§ã¯ãã®æ˜ ç”»ã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "The movie that I watched was interesting.",
                            explanation: "2ã¤ã®æ–‡ã‚’é–¢ä¿‚ä»£åè©ã§1ã¤ã«ã¾ã¨ã‚ãŸä¾‹ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯è¦ªåˆ‡ãªäººã§ã™ã€‚å½¼å¥³ã¯ç§ã‚’åŠ©ã‘ã¦ãã‚Œã¾ã—ãŸã€‚",
                            en: "She is a kind person who helped me.",
                            explanation: "é–¢ä¿‚ä»£åè©ã‚’ä½¿ã£ãŸæ–‡ã®æ›¸ãæ›ãˆä¾‹ã§ã™ã€‚"
                        }
                    ]
                }
            }
        };

        /* ----------------- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆåŠ¹æœéŸ³ã€éŸ³å£°åˆæˆç­‰ï¼‰ ----------------- */
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
            }
            playClick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(660, 0.08, 0.15);
                } catch (e) {
                    console.log('ã‚¯ãƒªãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playStudyComplete() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(440, 0.25, 0.2);
                } catch (e) {
                    console.log('å®Œäº†éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playSuccess() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(523, 0.15, 0.18);
                } catch (e) {
                    console.log('æˆåŠŸéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(800, 0.05, 0.1);
                } catch (e) {
                    console.log('ãƒãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTimeUp() {
                if (!this.audioContext) return;
                try {
                    this.createWarmTone(220, 0.4, 0.3);
                } catch (e) {
                    console.log('æ™‚é–“åˆ‡ã‚ŒéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            createBell(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createSoftTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createWarmTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰
        class VoiceSystem {
            constructor() {
                this.synth = null;
                this.voices = [];
                this.selectedVoice = null;
                this.isEnabled = true;
                this.deviceType = this.detectDevice();
                this.currentMaleVoice = null;
                this.currentFemaleVoice = null;
                
                try {
                    if ('speechSynthesis' in window) {
                        this.synth = window.speechSynthesis;
                        this.initializeVoices();
                    } else {
                        console.log('éŸ³å£°åˆæˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            // ğŸ”§ éŸ³å£°åˆæœŸåŒ–ã®æ”¹å–„
            initializeVoices() {
                this.loadVoices();
                
                // éŸ³å£°èª­ã¿è¾¼ã¿å®Œäº†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }
            }

            loadVoices() {
                this.voices = speechSynthesis.getVoices();
                if (this.voices.length > 0) {
                    this.setDeviceRecommendedVoices();
                    this.loadSettings();
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆæ‹¡å¼µç‰ˆãƒ»ç¢ºå®Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
            detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                
                console.log('ğŸ” ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º:', { userAgent, platform });
                
                if (/iphone|ipad|ipod/.test(userAgent) || platform.includes('mac')) {
                    return 'apple';
                } else if (/android/.test(userAgent)) {
                    return 'android';
                } else if (/windows/.test(userAgent) || platform.includes('win')) {
                    return 'windows';
                } else if (/linux/.test(userAgent) || platform.includes('linux')) {
                    return 'linux';
                } else if (/chrome/.test(userAgent)) {
                    return 'chrome';
                } else {
                    return 'other';
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°è¨­å®šï¼ˆå¼·åŒ–ç‰ˆãƒ»ç¢ºå®Ÿå‹•ä½œï¼‰
            setDeviceRecommendedVoices() {
                console.log('ğŸ¯ éŸ³å£°è¨­å®šé–‹å§‹ - ãƒ‡ãƒã‚¤ã‚¹:', this.deviceType, 'éŸ³å£°æ•°:', this.voices.length);
                
                // åˆ©ç”¨å¯èƒ½ãªå…¨éŸ³å£°ã‚’ãƒ­ã‚°å‡ºåŠ›
                this.voices.forEach((voice, index) => {
                    console.log(`éŸ³å£°${index + 1}:`, voice.name, voice.lang);
                });
                
                // ç”·æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentMaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('male') || 
                           name.includes('man') || 
                           name.includes('alex') || 
                           name.includes('david') || 
                           name.includes('daniel') || 
                           name.includes('mark') || 
                           name.includes('tom') ||
                           name.includes('aaron') ||
                           name.includes('arthur') ||
                           name.includes('george');
                });
                
                // å¥³æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentFemaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('female') || 
                           name.includes('woman') || 
                           name.includes('samantha') || 
                           name.includes('zira') || 
                           name.includes('victoria') || 
                           name.includes('karen') || 
                           name.includes('susan') ||
                           name.includes('allison') ||
                           name.includes('ava') ||
                           name.includes('hazel') ||
                           name.includes('helen');
                });
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼šæ€§åˆ¥ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                if (!this.currentMaleVoice && this.voices.length > 0) {
                    // æœ€åˆã®éŸ³å£°ã‚’ç”·æ€§ã¨ã—ã¦ä½¿ç”¨
                    this.currentMaleVoice = this.voices[0];
                    console.log('âš ï¸ ç”·æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentMaleVoice.name);
                }
                
                if (!this.currentFemaleVoice && this.voices.length > 1) {
                    // 2ç•ªç›®ã®éŸ³å£°ã‚’å¥³æ€§ã¨ã—ã¦ä½¿ç”¨ï¼ˆ1ç•ªç›®ã¨é•ã†éŸ³å£°ï¼‰
                    this.currentFemaleVoice = this.voices[1];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentFemaleVoice.name);
                } else if (!this.currentFemaleVoice && this.voices.length === 1) {
                    // 1ã¤ã—ã‹ãªã„å ´åˆã¯åŒã˜éŸ³å£°ã‚’ä½¿ç”¨
                    this.currentFemaleVoice = this.voices[0];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€åŒã˜éŸ³å£°ã‚’ä½¿ç”¨:', this.currentFemaleVoice.name);
                }
                
                console.log('ğŸ¤ æœ€çµ‚é¸æŠéŸ³å£°:', {
                    device: this.deviceType,
                    male: this.currentMaleVoice?.name || 'ãªã—',
                    female: this.currentFemaleVoice?.name || 'ãªã—',
                    totalVoices: this.voices.length
                });
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³å£°è¨­å®š
                if (!this.selectedVoice) {
                    this.selectedVoice = this.currentFemaleVoice || this.currentMaleVoice || this.voices[0];
                }
            }

            // ğŸ”§ éŸ³å£°é¸æŠï¼ˆç”·æ€§/å¥³æ€§ï¼‰
            selectGenderVoice(gender) {
                let targetVoice = null;
                
                if (gender === 'male') {
                    targetVoice = this.currentMaleVoice;
                } else if (gender === 'female') {
                    targetVoice = this.currentFemaleVoice;
                }
                
                if (targetVoice) {
                    this.selectedVoice = targetVoice;
                    this.saveSettings();
                    this.updateVoiceSelectionUI(gender);
                    console.log(`ğŸ¤ éŸ³å£°é¸æŠ: ${gender} - ${targetVoice.name}`);
                    return true;
                }
                return false;
            }

            updateVoiceSelectionUI(selectedGender) {
                document.querySelectorAll('.voice-choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const targetBtn = document.querySelector(`[data-voice-gender="${selectedGender}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('selected');
                }
            }

            // ğŸ”§ éŸ³å£°ãƒ†ã‚¹ãƒˆ
            testVoice(gender) {
                const testTexts = {
                    male: "Hello! I am the male voice for your English learning. I will help you practice pronunciation clearly and confidently.",
                    female: "Hi there! I am the female voice for your English learning. Let me help you improve your pronunciation with clear and natural speech."
                };
                
                if (gender === 'male' && this.currentMaleVoice) {
                    this.testSpecificVoice(this.currentMaleVoice, testTexts.male);
                } else if (gender === 'female' && this.currentFemaleVoice) {
                    this.testSpecificVoice(this.currentFemaleVoice, testTexts.female);
                }
            }

            testSpecificVoice(voice, text) {
                try {
                    this.synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    console.log(`ğŸ”Š éŸ³å£°ãƒ†ã‚¹ãƒˆ: ${voice.name}`);
                    this.synth.speak(utterance);
                } catch (e) {
                    console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            speak(text) {
                if (!this.isEnabled || !text.trim() || !this.synth) return;
                
                try {
                    this.synth.cancel();
                    
                    const cleanText = this.cleanEnglishText(text);
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    
                    if (this.selectedVoice) {
                        utterance.voice = this.selectedVoice;
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.85;
                    
                    this.synth.speak(utterance);
                    return utterance;
                    
                } catch (e) {
                    console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            cleanEnglishText(text) {
                return text
                    .replace(/[^\w\s.!?',\-]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            setEnabled(enabled) {
                this.isEnabled = enabled;
                this.saveSettings();
                
                if (!enabled && this.synth) {
                    try {
                        this.synth.cancel();
                    } catch (e) {
                        console.log('éŸ³å£°åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    }
                }
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceName: this.selectedVoice ? this.selectedVoice.name : null,
                        isEnabled: this.isEnabled,
                        deviceType: this.deviceType
                    };
                    localStorage.setItem('oneWorldQuizVoiceSettings', JSON.stringify(settings));
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('oneWorldQuizVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.isEnabled = settings.isEnabled !== false;
                        
                        if (settings.voiceName && this.voices.length > 0) {
                            const savedVoice = this.voices.find(v => v.name === settings.voiceName);
                            if (savedVoice) {
                                this.selectedVoice = savedVoice;
                                // UIæ›´æ–°
                                const gender = (savedVoice === this.currentMaleVoice) ? 'male' : 'female';
                                this.updateVoiceSelectionUI(gender);
                            }
                        }
                    }
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            getSelectedVoiceName() {
                return this.selectedVoice ? this.selectedVoice.name : 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
            }

            getDeviceInfo() {
                const deviceNames = {
                    apple: 'iPhoneãƒ»iPadãƒ»Mac',
                    android: 'Android',
                    windows: 'Windows',
                    linux: 'Linux',
                    chrome: 'Chrome OS',
                    other: 'ãã®ä»–'
                };
                
                return {
                    type: this.deviceType,
                    typeName: deviceNames[this.deviceType] || 'ãã®ä»–',
                    totalVoices: this.voices.length,
                    maleVoice: this.currentMaleVoice?.name || 'ãªã—',
                    femaleVoice: this.currentFemaleVoice?.name || 'ãªã—',
                    selectedVoice: this.selectedVoice?.name || 'ãªã—'
                };
            }
        }

        let soundSystem, voiceSystem;
        try {
            soundSystem = new SoundSystem();
            voiceSystem = new VoiceSystem<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ONE WORLD Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-coral: #f4a261;
            --primary-sage: #7fb069;
            --primary-sky: #6bb6ff;
            --primary-lavender: #a584c7;
            --accent-peach: #f9b6a3;
            --accent-mint: #b8e6b8;
            --bg-cream: #fdf8f3;
            --bg-white: #ffffff;
            --text-dark: #2d3748;
            --text-warm: #5d4e75;
            --border-soft: #e6ddd4;
            --shadow-gentle: rgba(116, 139, 141, 0.15);
        }
        body {
            font-family: "Noto Sans JP", "Inter", sans-serif;
            background: #faf7f2;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            color: var(--text-dark);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            padding-top: 5rem;
            padding-bottom: 2rem;
        }
        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }
        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }
        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }
        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }
        .game-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--primary-coral);
            text-align: center;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }
        .warm-card {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 24px;
            box-shadow: 0 8px 32px var(--shadow-gentle);
            position: relative;
            overflow: hidden;
        }
        .warm-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-coral);
            border-radius: 24px 24px 0 0;
        }
        .warm-button {
            background: var(--primary-coral);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.4);
            background: #f19a4e;
        }
        .warm-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        .grade-btn {
            background: #fef9f5;
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            color: var(--text-warm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 1rem 0.75rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px var(--shadow-gentle);
        }
        .grade-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.25);
            background: #fdf5ef;
        }
        .grade-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
        }
        .lesson-btn {
            background: #f0f8ff;
            border: 2px solid #b8d4f0;
            border-radius: 16px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 60px;
            box-shadow: 0 4px 12px rgba(107, 182, 255, 0.15);
            font-size: 0.8rem;
            font-weight: 500;
        }
        .lesson-btn:hover {
            border-color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.25);
            background: #e6f3ff;
        }
        .lesson-btn.selected {
            background: #d9edff;
            border-color: var(--primary-sky);
            color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.3);
        }
        .lesson-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-sky);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .grammar-btn {
            background: #f8f5ff;
            border: 2px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.6rem 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 50px;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
            font-size: 0.75rem;
            font-weight: 500;
        }
        .grammar-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
            background: #f0ebff;
        }
        .grammar-btn.selected {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        .grammar-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* æ¨ªãƒ©ã‚¤ãƒ³ã®å¾¹åº•å‰Šé™¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¯¾å¿œï¼‰ */
        *, *::before, *::after,
        *:focus, *:active, *:hover,
        *:focus-visible, *:focus-within {
            border-top: none !important;
            border-bottom: none !important;
            outline: none !important;
        }
        
        /* Tailwind CSSã®å…¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ç„¡åŠ¹åŒ– */
        .border, .border-t, .border-b, .border-l, .border-r,
        .border-0, .border-2, .border-4, .border-8,
        .border-t-0, .border-t-2, .border-t-4, .border-t-8,
        .border-b-0, .border-b-2, .border-b-4, .border-b-8,
        .border-solid, .border-dashed, .border-dotted,
        .divide-y, .divide-x {
            border-top: none !important;
            border-bottom: none !important;
        }
        
        /* å¿…è¦ãªãƒœãƒ¼ãƒ€ãƒ¼ã®ã¿å¾©æ´»ï¼ˆå®Œå…¨æŒ‡å®šï¼‰ */
        .warm-card {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .lesson-btn {
            border: 2px solid #b8d4f0 !important;
            border-top: 2px solid #b8d4f0 !important;
            border-bottom: 2px solid #b8d4f0 !important;
        }
        
        .grammar-btn {
            border: 2px solid #d6c9e3 !important;
            border-top: 2px solid #d6c9e3 !important;
            border-bottom: 2px solid #d6c9e3 !important;
        }
        
        .grade-btn {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .quiz-question {
            border: 3px solid #e2e8f0 !important;
            border-top: 3px solid #e2e8f0 !important;
            border-bottom: 3px solid #e2e8f0 !important;
        }
        
        .answer-display {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .header-stat-item {
            border: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-top: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-bottom: 1.5px solid rgba(165, 132, 199, 0.3) !important;
        }
        
        .header-nav-item {
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-top: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ”¹å–„ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        .modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 0 !important;
            margin: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«å¤‰æ›´ */
            overflow-y: auto !important;
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚’é˜»å®³ã—ãªã„ã‚ˆã†ã« */
            pointer-events: none;
        }
        
        .modal.show {
            display: flex !important;
            align-items: flex-start !important;
            justify-content: center !important;
            animation: modalFadeIn 0.4s ease-out;
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
            pointer-events: auto;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            margin: 1rem !important;
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            /* ğŸ”§ è‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
            overflow: visible !important;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ«ã®å®Œå…¨æ”¹å–„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        #quizModal .modal-content {
            width: 95% !important;
            max-width: 550px !important;
            min-width: 300px !important;
            margin: 1rem auto !important;
            /* ğŸ”§ æœ€å°é™ã®ä¸Šä¸‹ãƒãƒ¼ã‚¸ãƒ³ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            margin-top: 6rem !important;
            margin-bottom: 2rem !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            flex-shrink: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            overflow: visible !important;
        }
        
        #quizModal .modal-content .warm-card {
            width: 100% !important;
            max-width: none !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            margin: 0 !important;
        }
        
        /* ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é¸æŠç”»é¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ”¹å–„ */
        .lesson-modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ */
            margin: 0.5rem !important;
            margin-bottom: 2rem !important;
            margin-top: 6rem !important;
            /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            overflow: visible !important;
        }
        
        @media (max-width: 640px) {
            .modal {
                padding: 0 !important;
                margin: 0 !important;
                /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
                overflow-y: auto !important;
            }
            
            .modal-content {
                margin: 0.5rem !important;
                width: calc(100% - 1rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            #quizModal .modal-content {
                margin: 0.25rem auto !important;
                width: calc(100% - 0.5rem) !important;
                min-width: 280px !important;
                /* ğŸ”§ ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
                margin-top: 5rem !important;
                margin-bottom: 2rem !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            .lesson-modal-content {
                margin: 0.25rem !important;
                margin-bottom: 1rem !important;
                margin-top: 5rem !important;
                width: calc(100% - 0.5rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 600;
            z-index: 100;
            animation: particleFloat 2.5s ease-out forwards;
            font-size: 20px;
        }
        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-40px) scale(1.3) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(1.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰- z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
        .fixed-header {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            /* ğŸ”§ z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚ˆã‚Šä¸Šã«è¡¨ç¤º */
            z-index: 10000;
            animation: floatingHeader 3s ease-in-out infinite;
            max-width: 90vw;
            overflow: hidden;
            background: transparent;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        @keyframes floatingHeader {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        
        .header-stat-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border: 1.5px solid rgba(165, 132, 199, 0.3);
            border-radius: 18px;
            padding: 0.4rem 0.7rem;
            min-width: 60px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(165, 132, 199, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-stat-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(165, 132, 199, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.95));
            border-color: rgba(165, 132, 199, 0.5);
        }
        
        .header-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .header-nav-item:hover::before {
            opacity: 1;
        }
        
        .header-nav-item:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .header-nav-item:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        .header-nav-item.home {
            background: linear-gradient(135deg, var(--primary-coral), #f19a4e);
        }
        
        .header-nav-item.home:hover {
            box-shadow: 0 8px 25px rgba(244, 162, 97, 0.5);
        }
        
        .header-nav-item.back {
            background: linear-gradient(135deg, var(--primary-sage), #6fa055);
        }
        
        .header-nav-item.back:hover {
            box-shadow: 0 8px 25px rgba(127, 176, 105, 0.5);
        }
        
        .header-nav-item.voice {
            background: linear-gradient(135deg, var(--primary-lavender), #9574b5);
        }
        
        .header-nav-item.voice:hover {
            box-shadow: 0 8px 25px rgba(165, 132, 199, 0.5);
        }
        
        .header-stat-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-lavender);
        }
        .header-stat-emoji {
            font-size: 1.1rem;
        }
        
        /* ğŸ”§ éŸ³å£°è¨­å®šã®æ–°ã—ã„ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ */
        .device-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            border: 2px solid #e2e8f0;
        }
        
        .device-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .device-description {
            font-size: 0.8rem;
            color: var(--text-warm);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .voice-choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .voice-choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.5rem;
            background: var(--bg-white);
            border: 2px solid var(--border-soft);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .voice-choice-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.2);
            background: #faf8ff;
        }
        
        .voice-choice-btn.selected {
            border-color: var(--primary-lavender);
            background: #f0ebff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        
        .voice-choice-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voice-gender-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-description {
            font-size: 0.65rem;
            color: var(--text-warm);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        
        .voice-test-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-test-btn:hover {
            background: #5aa3f0;
            transform: translateY(-1px);
        }
        
        .voice-toggle {
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-cream);
            border-radius: 12px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: var(--primary-sage);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        .speak-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary-sage);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            vertical-align: middle;
        }
        .speak-btn:hover {
            background: #6fa055;
            transform: scale(1.1);
        }
        .speak-btn.speaking {
            animation: speakPulse 1s infinite;
        }
        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        .timer-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 0.75rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            border: 2px solid;
            display: inline-block;
            min-width: 80px;
        }
        .timer-normal {
            background: linear-gradient(135deg, #e8f5e8, #f0fdf0);
            color: var(--primary-sage);
            border-color: var(--primary-sage);
        }
        .timer-warning {
            background: linear-gradient(135deg, #fef3cd, #fefce8);
            color: #d97706;
            border-color: #d97706;
            animation: timerPulse 1s infinite;
        }
        .timer-danger {
            background: linear-gradient(135deg, #fee2e2, #fef2f2);
            color: #dc2626;
            border-color: #dc2626;
            animation: timerPulse 0.5s infinite;
        }
        .timer-unlimited {
            background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
            color: #0284c7;
            border-color: #0284c7;
        }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .timer-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .timer-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        
        .answer-display {
            background: var(--bg-cream);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 1rem;
            border: 3px solid var(--border-soft);
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.8;
            box-shadow: 0 4px 12px var(--shadow-gentle);
            min-height: 200px;
            /* ğŸ”§ æœ€å¤§é«˜ã•ã‚’åˆ¶é™ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
            /* max-height: 400px; */
            /* overflow-y: auto; */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .answer-display.show {
            border-color: var(--primary-sage);
            background: #f0f9f0;
            box-shadow: 0 4px 12px rgba(127, 176, 105, 0.2);
        }
        .answer-text {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary-sage);
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
            padding: 1rem;
            background: rgba(127, 176, 105, 0.1);
            border-radius: 12px;
            position: relative;
        }
        .explanation-text {
            color: var(--text-dark);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
        }
        
        .show-answer-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(107, 182, 255, 0.3);
            margin: 0.5rem 0;
        }
        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 182, 255, 0.4);
            background: #5aa3f0;
        }
        .show-answer-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºå•é¡Œæ ã®å›ºå®šåŒ– */
        .quiz-question {
            background: #f8fafc !important;
            border: 3px solid #e2e8f0 !important;
            border-radius: 16px !important;
            padding: 1.5rem !important;
            text-align: center !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            color: var(--text-dark) !important;
            line-height: 1.5 !important;
            margin-bottom: 1rem !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            position: static !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            flex-shrink: 0 !important;
            overflow-wrap: break-word !important;
            word-wrap: break-word !important;
        }
        
        .grade-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .lesson-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        .grammar-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .back-button {
            background: #f1f5f9;
            border: 3px solid #cbd5e1;
            color: var(--text-dark);
            border-radius: 16px;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .back-button:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .stats-display {
            background: var(--bg-cream);
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-gentle);
        }
        .section-divider {
            height: 2px;
            background: var(--border-soft);
            margin: 1.25rem 0;
        }
        .mode-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .mode-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .mode-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        .direction-btn {
            background: var(--bg-white);
            border: 3px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
        }
        .direction-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        .direction-btn.active {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }
            .warm-card {
                margin: 0.25rem;
                padding: 1rem;
            }
            .game-title {
                font-size: clamp(1.25rem, 6vw, 2rem);
            }
            .grade-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .grammar-grid {
                grid-template-columns: 1fr;
                gap: 0.4rem;
            }
            .grade-btn {
                padding: 0.75rem 0.5rem;
                min-height: 70px;
                font-size: 0.8rem;
            }
            .lesson-btn {
                padding: 0.6rem 0.4rem;
                min-height: 50px;
                font-size: 0.75rem;
            }
            .grammar-btn {
                padding: 0.5rem 0.3rem;
                min-height: 45px;
                font-size: 0.7rem;
            }
            .timer-display {
                font-size: 1.25rem;
                padding: 0.5rem;
                min-width: 60px;
            }
            .quiz-question {
                font-size: 1rem !important;
                padding: 1rem !important;
            }
            .answer-display {
                padding: 1.5rem;
                min-height: 150px;
            }
            .answer-text {
                font-size: 1.2rem;
                padding: 0.75rem;
            }
            .explanation-text {
                font-size: 1rem;
            }
            .fixed-header {
                top: 0.5rem;
                padding: 0.6rem 1.2rem;
                gap: 0.8rem;
            }
            .header-stat-item {
                min-width: 50px;
                padding: 0.3rem 0.5rem;
                gap: 0.3rem;
                border-radius: 14px;
            }
            .header-stat-number {
                font-size: 0.8rem;
            }
            .header-stat-emoji {
                font-size: 0.95rem;
            }
            .header-nav-item {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .voice-choice-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .voice-choice-btn {
                min-height: 70px;
                padding: 0.5rem 0.4rem;
            }
            
            .device-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .voice-gender-icon {
                font-size: 1.2rem;
            }
            
            .voice-gender-label {
                font-size: 0.75rem;
            }
            
            .voice-gender-description {
                font-size: 0.6rem;
            }
        }
        
        button, .grade-btn, .lesson-btn, .grammar-btn, .warm-button, .back-button, .mode-btn, .direction-btn, .timer-btn, .show-answer-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }
        
        * {
            touch-action: manipulation;
        }
        
        input, select, textarea {
            font-size: 16px;
        }

        .sparkle {
            position: relative;
            overflow: visible;
        }
        .sparkle::before,
        .sparkle::after {
            content: 'âœ¨';
            position: absolute;
            opacity: 0;
            animation: sparkleFloat 3s infinite ease-in-out;
        }
        .sparkle::before {
            top: -10px;
            left: -10px;
            animation-delay: 0s;
        }
        .sparkle::after {
            bottom: -10px;
            right: -10px;
            animation-delay: 1.5s;
        }
        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
            50% { opacity: 1; transform: translateY(-20px) scale(1.2); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 relative">
    <!-- ãƒ¡ã‚¤ãƒ³å­¦å¹´é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="mainGradeModal" class="modal show">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸ“ å­¦å¹´ã‚’é¸æŠã—ã‚ˆã†
                </h2>
                <p class="text-gray-600 text-sm mb-4">ã‚ãªãŸã®å­¦ç¿’ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grade-grid mb-6">
                    <button class="grade-btn" data-grade="grade1">
                        <div class="text-3xl mb-1">ğŸŒ±</div>
                        <div class="font-semibold text-sm">ä¸­å­¦1å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade2">
                        <div class="text-3xl mb-1">ğŸŒ¿</div>
                        <div class="font-semibold text-sm">ä¸­å­¦2å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade3">
                        <div class="text-3xl mb-1">ğŸŒ³</div>
                        <div class="font-semibold text-sm">ä¸­å­¦3å¹´ç”Ÿ</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦1å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade1Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ± ä¸­å­¦1å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade1Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons1" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦2å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade2Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ¿ ä¸­å­¦2å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade2Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons2" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦3å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade3Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ³ ä¸­å­¦3å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade3Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons3" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡æ³•é …ç›®é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grammarModal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 id="grammarModalTitle" class="text-lg font-semibold mb-3 text-gray-700"></h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã™ã‚‹å†…å®¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grammar-grid mb-4" id="grammarCategories">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startGrammarQuiz" class="warm-button px-8 py-3 text-sm sparkle" disabled>
                        ğŸš€ ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”§ éŸ³å£°è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰ -->
    <div id="voiceSettingsModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">
                    ğŸ¤ éŸ³å£°è¨­å®š
                </h2>
                
                <!-- éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="voice-toggle">
                    <div class="text-sm font-semibold text-gray-700 mb-2">ğŸ”Š éŸ³å£°æ©Ÿèƒ½</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="text-xs text-gray-600 mt-2" id="voiceToggleDescription">éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™</div>
                </div>
                
                <!-- ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰ -->
                <div id="deviceRecommendations">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center mt-4">
                    <button class="warm-button px-6 py-2 text-sm" onclick="closeVoiceSettings()">
                        âœ… è¨­å®šå®Œäº†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="hidden">
        <div class="warm-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4"></div>
            <div class="stats-display">
                <div class="grid grid-cols-2 gap-4 text-center mb-4">
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="studyCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ“š å­¦ç¿’å›æ•°</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="clickCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ–±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                </div>
                
                <!-- åˆ¶é™æ™‚é–“è¨­å®šï¼ˆ4ã¤ã®ãƒœã‚¿ãƒ³ã‚’2x2ã‚°ãƒªãƒƒãƒ‰ã§çµ±ä¸€ï¼‰ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">â° åˆ¶é™æ™‚é–“è¨­å®š</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="timer3Btn" class="timer-btn active" data-time="3">
                            âš¡ 3ç§’
                        </button>
                        <button id="timer5Btn" class="timer-btn" data-time="5">
                            ğŸ”¥ 5ç§’
                        </button>
                        <button id="timer10Btn" class="timer-btn" data-time="10">
                            ğŸŒŸ 10ç§’
                        </button>
                        <button id="timerUnlimitedBtn" class="timer-btn" data-time="unlimited">
                            âˆ ç„¡åˆ¶é™
                        </button>
                    </div>
                </div>
                
                <!-- å‡ºé¡Œå½¢å¼é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ² å‡ºé¡Œã‚¹ã‚¿ã‚¤ãƒ«</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="randomModeBtn" class="mode-btn active" data-mode="random">
                            ğŸ¯ ãƒ©ãƒ³ãƒ€ãƒ 
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn" data-mode="sequential">
                            ğŸ“– é †ç•ªé€šã‚Š
                        </button>
                    </div>
                </div>

                <!-- å‡ºé¡Œæ–¹å‘é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸŒ è¨€èªæ–¹å‘</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="jpToEnBtn" class="direction-btn active" data-direction="jp_to_en">
                            ğŸ‡¯ğŸ‡µâ†’ğŸ‡ºğŸ‡¸
                        </button>
                        <button id="enToJpBtn" class="direction-btn" data-direction="en_to_jp">
                            ğŸ‡ºğŸ‡¸â†’ğŸ‡¯ğŸ‡µ
                        </button>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <button id="mixedBtn" class="direction-btn" data-direction="mixed">
                            ğŸ”€ ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="warm-button px-8 py-4 text-base font-semibold mt-6 sparkle">
                ğŸŒŸ ãƒ¬ãƒƒãƒ„ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
        </div>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-4 w-full max-w-lg mx-4">
                <div class="text-center mb-4">
                    <h2 class="font-semibold text-lg text-gray-700">
                        ğŸŒ ONE WORLD Quiz Challenge
                    </h2>
                    <div class="flex items-center justify-between mt-2">
                        <div id="remainingCount" class="text-sm text-gray-600"></div>
                        <div id="timerDisplay" class="timer-display timer-normal">
                            <span id="timerValue">æº–å‚™ä¸­</span>
                        </div>
                    </div>
                </div>
                
                <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="quizQuestion" class="quiz-question"></div>
                
                <!-- è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
                <div class="text-center">
                    <button id="showAnswerBtn" class="show-answer-btn">
                        ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹
                    </button>
                </div>
                
                <!-- è§£ç­”ãƒ»è§£èª¬è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆæ‹¡å¤§ç‰ˆï¼‰ -->
                <div id="answerDisplay" class="answer-display">
                    <div id="answerContent">
                        <div class="text-gray-500" style="text-align: center;">é ­ã§è€ƒãˆã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>
                    </div>
                </div>
                
                <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
                <div class="flex gap-2 mt-4">
                    <button id="quizNext" class="flex-1 warm-button py-3 text-sm" disabled>
                        â­ æ¬¡ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰ -->
    <div class="fixed-header">
        <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item home" id="footerHomeBtn" title="ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹">
            ğŸ 
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item back" id="footerBackBtn" title="å‰ã®ç”»é¢ã«æˆ»ã‚‹">
            â—€ï¸
        </div>
        
        <!-- ç·ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTotalStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ†</span>
            <span class="header-stat-number" id="footerTotalClick">0</span>
        </div>
        
        <!-- ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTodayStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ“…</span>
            <span class="header-stat-number" id="footerTodayClick">0</span>
        </div>
        
        <!-- éŸ³å£°è¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item voice" id="footerVoiceBtn" title="éŸ³å£°è¨­å®š">
            ğŸ¤
        </div>
    </div>

<script>
        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é …ç›®å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰ ----------------- */
        const lessons = {
            grade1: [
                {
                    id: 'lesson1',
                    name: 'Lesson1 - æ–‡ã®åŸºæœ¬',
                    grammar: [
                        {id: 'word_order', name: '1. æ—¥æœ¬èªã¨è‹±èªã®èªé †'},
                        {id: 'sentence_types', name: '2. è‹±èªã®æ–‡ã®ä»£è¡¨çš„ãª2ã¤ã®å‹'},
                        {id: 'personal_statements', name: '3. è‡ªåˆ†ã®ã“ã¨ã‚’è¿°ã¹ãŸã‚Šç›¸æ‰‹ã®ã“ã¨ã‚’ãŸãšã­ã‚‹'},
                        {id: 'various_questions', name: '4. ã•ã¾ã–ã¾ãªç–‘å•æ–‡'},
                        {id: 'requests', name: '5. ãŠé¡˜ã„ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ä»£åè©',
                    grammar: [
                        {id: 'she_he_it', name: '1. she, he, it ãªã©ã®ä½¿ã„æ–¹'},
                        {id: 'pronoun_questions', name: '2. she, he ãªã©ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'this_that', name: '3. this ã¨ that ã®ä½¿ã„æ–¹'},
                        {id: 'this_that_questions', name: '4. this, that ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'we_you_they', name: '5. We, you, they ã®ä½¿ã„æ–¹'},
                        {id: 'can_usage', name: '6. can ã®æ„å‘³ã¨ç”¨æ³•'},
                        {id: 'some_any', name: '7. some ã¨ any'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸€èˆ¬å‹•è©',
                    grammar: [
                        {id: 'general_verbs', name: '1. ä¸€èˆ¬å‹•è©ã«ã¯ã€ã©ã‚“ãªã‚‚ã®ãŒã‚ã‚‹ï¼Ÿ'},
                        {id: 'verb_s_es', name: '2. ä¸€èˆ¬å‹•è©ã«ã¤ã s, es'},
                        {id: 'verb_s_es_rules', name: '3. ä¸€èˆ¬å‹•è©ã® s, es ã®ã¤ã‘æ–¹'},
                        {id: 'noun_singular_plural', name: '4. ã€Œ1ã¤ï¼ˆå˜æ•°ï¼‰ã€ãªã®ã‹ã€Œ2ã¤ä»¥ä¸Šï¼ˆè¤‡æ•°ï¼‰ã€ãªã®ã‹ã‚’è¡¨ã™åè©ã«ã¤ã s, es'},
                        {id: 'plural_rules', name: '5. è¤‡æ•°å½¢ã®ã¤ãã‚Šæ–¹'},
                        {id: 'pronoun_i', name: '6. ã€Œç§ã€ã‚’è¡¨ã™2ã¤ã®å½¢'},
                        {id: 'pronoun_cases', name: '7. ä¸»èªã¨ã—ã¦ä½¿ã†å ´åˆã¨ä¸»èªä»¥å¤–ã§ä½¿ã†ã€Œã‚ãªãŸã€ã€Œå½¼ã€ãªã©'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - éå»å½¢',
                    grammar: [
                        {id: 'past_statements', name: '1. éå»ã®ã“ã¨ã‚’è¨€ã†ã¨ã'},
                        {id: 'past_questions', name: '2. éå»ã®ã“ã¨ã‚’ãŸãšã­ã‚‹ã¨ãï¼ˆç–‘å•æ–‡ï¼‰'},
                        {id: 'past_negative', name: '3. éå»ã®ã“ã¨ã§ã€Œã—ãªã‹ã£ãŸã€ã€Œã§ãªã‹ã£ãŸã€ã“ã¨ã‚’è¨€ã†ã¨ãï¼ˆå¦å®šæ–‡ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ç¾åœ¨é€²è¡Œå½¢',
                    grammar: [
                        {id: 'present_continuous', name: '1. ä»Šã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_negative', name: '2. ã€Œã€œã—ã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_questions', name: '3. ã€Œã€œã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã€ã€Œä½•ã‚’ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ç–‘å•è©',
                    grammar: [
                        {id: 'why_because', name: '1. ã€Œç†ç”±ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œç†ç”±ã€ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'how_often', name: '2. ã€Œã©ã®ãã‚‰ã„ã‚ˆãã€œã™ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ç­”ãˆã‚‹ã¨ã'},
                        {id: 'which_who_whose', name: '3. ã€Œã©ã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œã©ã¡ã‚‰ã‚’ã€ã€Œã ã‚ŒãŒã€ã€Œã ã‚Œã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - åŠ©å‹•è©',
                    grammar: [
                        {id: 'must_prohibition', name: '1. ã€Œå¼·ã„å‘½ä»¤ã€ã‚„ã€Œç¦æ­¢ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'have_to_necessity', name: '2. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã€Œã€œã™ã‚‹å¿…è¦ã¯ãªã„ã€ã¨ä¼ãˆã‚‹ã¨ã'},
                        {id: 'may_able_to', name: '3. ã€Œã€œã‹ã‚‚ã—ã‚Œãªã„ã€ã¨è¿°ã¹ã‚‹ã¨ãã€ã€Œã€œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - æœªæ¥è¡¨ç¾',
                    grammar: [
                        {id: 'be_going_to', name: '1. äºˆå®šã‚„è¨ˆç”»ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'will_prediction', name: '2. æœªæ¥ã®ã“ã¨ã«ã¤ã„ã¦ã€Œã€œã ã‚ã†ã€ã¨ã„ã†äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'should', name: '3. ã€Œã€œã™ã¹ãã ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - There is/areæ–‡',
                    grammar: [
                        {id: 'there_is_are', name: '1. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ãŒã‚ã‚‹ï¼ˆã„ã‚‹ï¼‰ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'there_is_are_questions', name: '2. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã‚ã‚Šã¾ã™ã‹ã€ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã„ãã¤ã‚ã‚Šã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹å ´åˆ'},
                        {id: 'look_sound', name: '3. ã€Œã€œãã†ã«è¦‹ãˆã‚‹ï¼èã“ãˆã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade2: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 1å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'have_to_must_review', name: '1. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã‚„ã€Œå¼·ã„å‘½ä»¤ã€ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆhave [has] to ã¨ mustï¼‰'},
                        {id: 'future_review', name: '2. äºˆå®šã‚„æœªæ¥ã«ã¤ã„ã¦ã®äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆbe going to ã¨ willï¼‰'},
                        {id: 'there_is_are_review', name: '3. ã‚‚ã®ãŒã‚ã‚‹ã“ã¨ã‚„ã€äººãŒã„ã‚‹ã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆThere is [are] ~.ï¼‰'},
                        {id: 'there_is_are_transformation', name: '4. There is [are] ~. ã®æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç›®çš„èª2ã¤/æ¥ç¶šè©that',
                    grammar: [
                        {id: 'double_object', name: '1. ã€Œï¼œäººï¼ã«ï¼œã‚‚ã®ï¼ã‚’ã‚ã’ã‚‹ãƒ»é€ã‚‹ã€ãªã©ã¨è¿°ã¹ã‚‹ã¨ãï¼ˆç›®çš„èªã‚’ï¼’ã¤ã¨ã‚‹å‹•è©ï¼‰'},
                        {id: 'that_opinion', name: '2. è‡ªåˆ†ã®æ„è¦‹ã‚„çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'},
                        {id: 'that_feeling', name: '3. è‡ªåˆ†ã®æ°—æŒã¡ã¨ãã®ç†ç”±ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - éå»é€²è¡Œå½¢/æ¥ç¶šè©',
                    grammar: [
                        {id: 'past_continuous', name: '1. éå»ã®ã‚ã‚‹æ™‚ç‚¹ã§ã—ã¦ã„ãŸã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆéå»é€²è¡Œå½¢ï¼‰'},
                        {id: 'when_conjunction', name: '2. ã©ã‚“ãªæ™‚ã®ã“ã¨ã‹ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®whenï¼‰'},
                        {id: 'if_because', name: '3. æ¡ä»¶ã‚’è¿°ã¹ã‚‹ã¨ãã€ç†ç”±ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®ifï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸å®šè©',
                    grammar: [
                        {id: 'infinitive_noun', name: '1. ã—ãŸã„ã“ã¨ã€ãªã‚ŠãŸã„ã‚‚ã®ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆåè©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ã“ã¨ã€ï¼‰'},
                        {id: 'infinitive_adverb', name: '2. ç›®çš„ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå‰¯è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã«ã€ï¼‰'},
                        {id: 'infinitive_adjective', name: '3. ã€Œã‚‚ã®ã®ç”¨é€”ã€ä½•ã‚’ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå½¢å®¹è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã®ã€ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - å‹•åè©',
                    grammar: [
                        {id: 'gerund_object', name: '1. ã€Œã€œã™ã‚‹ã“ã¨ã‚’çµ‚ãˆã‚‹ãƒ»æ¥½ã—ã‚€ãƒ»å¥½ã‚€ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'gerund_subject', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã€ã‚’ä¸»èªã«ã—ã¦è¿°ã¹ã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'teach_tell_that', name: '3. ã€Œã ã‚ŒãŒã ã‚Œã«ã©ã‚“ãªã“ã¨ã‚’æ•™ãˆãŸã‹ãƒ»ä¼ãˆãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä¸å®šè©ã®ç™ºå±•',
                    grammar: [
                        {id: 'how_to_what_to', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã¯ãŠã‚‚ã—ã‚ã„ãƒ»é›£ã—ã„ãƒ»ä¸å¯èƒ½ã ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€œ.ï¼‰'},
                        {id: 'teach_ask_how_to', name: '3. ã€Œã ã‚Œã«ã€œã®ä»•æ–¹ã€ä½•ã‚’ã™ã¹ãã‹ãªã©ã‚’ä¼ãˆã‚‹ãƒ»æ•™ãˆã‚‹ãƒ»ãŸãšã­ã‚‹ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - æ¯”è¼ƒ',
                    grammar: [
                        {id: 'comparative', name: '1. 2ã¤ã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ãã®é•ã„ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¯”è¼ƒç´šï¼‰'},
                        {id: 'superlative', name: '2. 3ã¤ä»¥ä¸Šã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ã€Œã„ã¡ã°ã‚“ã€œã ã€ã¨ä¼ãˆã‚‹ã¨ãï¼ˆæœ€ä¸Šç´šï¼‰'},
                        {id: 'as_as', name: '3. ã€ŒåŒã˜ãã‚‰ã„ã€œã ã€ã€Œã„ã¡ã°ã‚“å¥½ãã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆåŸç´šãªã©ï¼‰'},
                        {id: 'comparison_rules', name: '4. æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šã®ä½œã‚Šæ–¹'},
                        {id: 'comparison_transformation', name: '5. æ¯”è¼ƒè¡¨ç¾ã®æ›¸ãæ›ãˆ'},
                        {id: 'comparison_notes', name: '6. ãã®ä»–ã«æ³¨æ„ã™ã‚‹ã“ã¨'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - å—å‹•æ…‹',
                    grammar: [
                        {id: 'passive_voice', name: '1. ã€Œ...ã¯ã€œã•ã‚Œã‚‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã‚‹ã€ã®ã‚ˆã†ãªè¡¨ç¾ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'passive_questions', name: '2. ã€Œâ€¦ã¯ã€œã•ã‚Œã¾ã™ã‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã¾ã™ã‹ã€ãªã©ã¨è³ªå•ã™ã‚‹ã¨ã'},
                        {id: 'passive_modal', name: '3. ã€Œã€œã•ã‚Œã‚‹ã¹ãã ã€ã€Œã€œã•ã‚Œã‚‹ã“ã¨ãŒå¯èƒ½ã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'past_participle_rules', name: '4. éå»åˆ†è©å½¢ã®ä½œã‚Šæ–¹'},
                        {id: 'passive_transformation', name: '5. å—ã‘èº«ã®æ–‡ã®æ›¸ãæ›ãˆä¾‹'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - é–“æ¥ç–‘å•æ–‡/æ„Ÿå˜†æ–‡',
                    grammar: [
                        {id: 'indirect_questions_know', name: '1. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€ŒçŸ¥ã£ã¦ã„ã‚‹ãƒ»çŸ¥ã‚‰ãªã„ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'indirect_questions_tell', name: '2. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€Œã ã‚Œã«è¨€ã£ãŸã‹ãƒ»èã„ãŸã‹ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'exclamatory', name: '3. é©šãã‚„æ„Ÿå‹•ã‚’è¡¨ç¾ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - å‹•è©ã®æ§˜ã€…ãªä½¿ã„æ–¹',
                    grammar: [
                        {id: 'make_call', name: '1. ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ã€Œå‘¼ã³åã¯ä½•ã‹ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'want_ask_to', name: '2. äººã«ã—ã¦ã»ã—ã„ã“ã¨ã‚’ä¼ãˆãŸã‚Šé ¼ã‚“ã ã‚Šã™ã‚‹ã¨ã'},
                        {id: 'let_help', name: '3. è¨±å¯ã‚’å¾—ã‚‹ã¨ãã€ã ã‚ŒãŒæ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ã‹ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade3: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 2å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'how_to_what_to_review', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'make_call_review', name: '2. ã€Œå‘¼ã³åã¯ä½•ã‹ã€ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to_review', name: '3. ã€Œã€œã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ»ã‚„ã•ã—ã„ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç¾åœ¨å®Œäº†å½¢(1)',
                    grammar: [
                        {id: 'present_perfect_completion', name: '1. ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience', name: '2. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience_questions', name: '3. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ç¾åœ¨å®Œäº†å½¢(2)',
                    grammar: [
                        {id: 'present_perfect_continuation', name: '1. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuation_questions', name: '2. ã€Œã©ã®ãã‚‰ã„ã€œã—ã¦ã„ã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuous', name: '3. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†é€²è¡Œå½¢ï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - å¾Œç½®ä¿®é£¾',
                    grammar: [
                        {id: 'participle_present', name: '1. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®1ï¼šç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'participle_past', name: '2. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®2ï¼šéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'relative_pronoun_omission', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®3ï¼šç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - é–¢ä¿‚ä»£åè©',
                    grammar: [
                        {id: 'relative_pronoun_who', name: '1. ã€Œã©ã‚“ãªäººã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_which', name: '2. ã€Œã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_object', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä»®å®šæ³•',
                    grammar: [
                        {id: 'subjunctive_1', name: '1. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®1ï¼‰'},
                        {id: 'subjunctive_2', name: '2. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®2ï¼‰'},
                        {id: 'subjunctive_3', name: '3. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®3ï¼‰'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - å¾Œç½®ä¿®é£¾ã¨é–¢ä¿‚ä»£åè©ã®ã¾ã¨ã‚',
                    grammar: [
                        {id: 'postposition_ing', name: '1. ã€ˆåè© ï¼‹ å‹•è©ã®-ingå½¢ ï¼‹ èªå¥ã€‰ï¼ˆç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_past_participle', name: '2. ã€ˆåè© ï¼‹ å‹•è©ã®éå»åˆ†è©å½¢ ï¼‹ èªå¥ã€‰ï¼ˆéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_omission', name: '3. ã€ˆåè© ï¼‹ ä¸»èª ï¼‹ å‹•è© ã€œã€‰ï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'},
                        {id: 'relative_summary', name: '4. ã€ˆåè© ï¼‹ é–¢ä¿‚ä»£åè©ï¼ˆwho, which, thatï¼‰ ï¼‹ èªå¥ã€‰ï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ã¨ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'sentence_transformation', name: '5. æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                }
            ]
        };

        /* ----------------- ğŸ”§ æ‹¡å……ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆä¸­3å®Œå…¨å¯¾å¿œç‰ˆï¼‰ ----------------- */
        const sampleProblems = {
            grade1: {
                lesson1: {
                    word_order: [
                        {
                            jp: "ç§ã¯å­¦ç”Ÿã§ã™ã€‚",
                            en: "I am a student.",
                            explanation: "æ—¥æœ¬èªã®èªé †ã¨è‹±èªã®èªé †ã®é•ã„ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚è‹±èªã§ã¯ã€Œä¸»èª + å‹•è©ã€ã®é †ç•ªãŒåŸºæœ¬ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å…ˆç”Ÿã§ã™ã‹ï¼Ÿ",
                            en: "Are you a teacher?",
                            explanation: "ç–‘å•æ–‡ã§ã¯å‹•è©(beå‹•è©)ãŒä¸»èªã®å‰ã«æ¥ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He is not a doctor.",
                            explanation: "å¦å®šæ–‡ã§ã¯ beå‹•è©ã®å¾Œã« not ã‚’ä»˜ã‘ã¾ã™ã€‚"
                        }
                    ],
                    sentence_types: [
                        {
                            jp: "ã“ã‚Œã¯æœ¬ã§ã™ã€‚",
                            en: "This is a book.",
                            explanation: "è‹±èªã®åŸºæœ¬æ–‡å‹ã®ä¸€ã¤ã€Œä¸»èª + beå‹•è© + è£œèªã€ã®å½¢ã§ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯è‹±èªã‚’è©±ã—ã¾ã™ã€‚",
                            en: "I speak English.",
                            explanation: "ã€Œä¸»èª + å‹•è© + ç›®çš„èªã€ã®æ–‡å‹ã§ã™ã€‚"
                        }
                    ],
                    personal_statements: [
                        {
                            jp: "ç§ã®åå‰ã¯ç”°ä¸­ã§ã™ã€‚",
                            en: "My name is Tanaka.",
                            explanation: "è‡ªå·±ç´¹ä»‹ã®åŸºæœ¬çš„ãªè¡¨ç¾ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã®è¶£å‘³ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                            en: "What is your hobby?",
                            explanation: "ç›¸æ‰‹ã«ã¤ã„ã¦è³ªå•ã™ã‚‹æ™‚ã®è¡¨ç¾ã§ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    she_he_it: [
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã™ã€‚",
                            en: "He is a doctor.",
                            explanation: "ç”·æ€§ã‚’è¡¨ã™æ™‚ã¯heã‚’ä½¿ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯çœ‹è­·å¸«ã§ã™ã€‚",
                            en: "She is a nurse.",
                            explanation: "å¥³æ€§ã‚’è¡¨ã™æ™‚ã¯sheã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    general_verbs: [
                        {
                            jp: "ç§ã¯æ¯æ—¥è‹±èªã‚’å‹‰å¼·ã—ã¾ã™ã€‚",
                            en: "I study English every day.",
                            explanation: "ä¸€èˆ¬å‹•è©ã¯å‹•ä½œã‚„çŠ¶æ…‹ã‚’è¡¨ã™å‹•è©ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯é‡çƒã‚’ã—ã¾ã™ã€‚",
                            en: "He plays baseball.",
                            explanation: "ä¸‰äººç§°å˜æ•°ç¾åœ¨å½¢ã§ã¯å‹•è©ã« s ãŒä»˜ãã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade2: {
                lesson1: {
                    double_object: [
                        {
                            jp: "ç§ã¯å½¼ã«æœ¬ã‚’ã‚ã’ã¾ã—ãŸã€‚",
                            en: "I gave him a book.",
                            explanation: "ç›®çš„èªã‚’2ã¤ã¨ã‚‹å‹•è©ã§ã¯ã€Œå‹•è© + äºº + ã‚‚ã®ã€ã®é †ç•ªã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯ç§ã«æ‰‹ç´™ã‚’é€ã‚Šã¾ã—ãŸã€‚",
                            en: "She sent me a letter.",
                            explanation: "send ã¯ã€Œäººã«ã‚‚ã®ã‚’é€ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã‚ã‚Œã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade3: {
                review_lesson: {
                    how_to_what_to_review: [
                        {
                            jp: "ç§ã¯æ³³ãæ–¹ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚",
                            en: "I know how to swim.",
                            explanation: "ã€Œhow to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã®ä»•æ–¹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ä½•ã‚’ã™ã¹ãã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚",
                            en: "I don't know what to do.",
                            explanation: "ã€Œwhat to + å‹•è©ã®åŸå½¢ã€ã§ã€Œä½•ã‚’ã€œã™ã¹ãã‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    make_call_review: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯ç§ã‚’æ‚²ã—ãã•ã›ã¾ã—ãŸã€‚",
                            en: "The movie made me sad.",
                            explanation: "ã€Œmake + äºº + å½¢å®¹è©ã€ã§ã€Œäººã‚’ã€œã«ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å½¼ã‚’ãƒˆãƒ ã¨å‘¼ã³ã¾ã™ã€‚",
                            en: "We call him Tom.",
                            explanation: "ã€Œcall + äºº + åå‰ã€ã§ã€Œäººã‚’ã€œã¨å‘¼ã¶ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ],
                    it_is_to_review: [
                        {
                            jp: "è‹±èªã‚’å­¦ã¶ã“ã¨ã¯æ¥½ã—ã„ã§ã™ã€‚",
                            en: "It is fun to learn English.",
                            explanation: "ã€ŒIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã™ã‚‹ã“ã¨ã¯...ã ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ—©èµ·ãã™ã‚‹ã“ã¨ã¯å¥åº·ã«è‰¯ã„ã§ã™ã€‚",
                            en: "It is good for your health to get up early.",
                            explanation: "It ã‚’ä»®ä¸»èªã¨ã—ã¦ä½¿ã„ã€çœŸã®ä¸»èªã¯ to ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ]
                },
                lesson1: {
                    present_perfect_completion: [
                        {
                            jp: "ç§ã¯å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã€‚",
                            en: "I have finished my homework.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ã§ã¯ã€Œhave/has + éå»åˆ†è©ã€ã§ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯ã‚‚ã†å®¶ã«å¸°ã‚Šã¾ã—ãŸã€‚",
                            en: "He has already gone home.",
                            explanation: "already ã‚’ä½¿ã£ã¦ã€Œã‚‚ã†ã€œã—ãŸã€ã“ã¨ã‚’å¼·èª¿ã§ãã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯ã¾ã æ˜¼é£Ÿã‚’é£Ÿã¹ã¦ã„ã¾ã›ã‚“ã€‚",
                            en: "I haven't eaten lunch yet.",
                            explanation: "yet ã¯å¦å®šæ–‡ã§ã€Œã¾ã ã€œã—ã¦ã„ãªã„ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience: [
                        {
                            jp: "ç§ã¯æ±äº¬ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "I have been to Tokyo.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ã§ã€Œã€œã—ãŸã“ã¨ãŒã‚ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯å¯Œå£«å±±ã‚’è¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He has never seen Mt. Fuji.",
                            explanation: "never ã‚’ä½¿ã£ã¦ã€Œä¸€åº¦ã‚‚ã€œã—ãŸã“ã¨ãŒãªã„ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å¯¿å¸ã‚’é£Ÿã¹ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "Have you ever eaten sushi?",
                            explanation: "ever ã‚’ä½¿ã£ã¦çµŒé¨“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã‚’ä½œã‚Šã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience_questions: [
                        {
                            jp: "ã‚ãªãŸã¯ä½•å›æ—¥æœ¬ã«æ¥ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "How many times have you been to Japan?",
                            explanation: "ã€ŒHow many times + ç¾åœ¨å®Œäº†å½¢ã€ã§å›æ•°ã‚’å°‹ã­ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãƒ”ã‚¢ãƒã‚’å¼¾ã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you been playing the piano?",
                            explanation: "ç¶™ç¶šç”¨æ³•ã§æœŸé–“ã‚’å°‹ã­ã‚‹æ™‚ã¯ How long ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    present_perfect_continuation: [
                        {
                            jp: "ç§ã¯3å¹´é–“è‹±èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚",
                            en: "I have studied English for three years.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ã§ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœˆæ›œæ—¥ã‹ã‚‰ãšã£ã¨ç—…æ°—ã§ã™ã€‚",
                            en: "He has been sick since Monday.",
                            explanation: "since ã¯ã€Œã€œã‹ã‚‰ã€ã¨ã„ã†èµ·ç‚¹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å­ä¾›ã®é ƒã‹ã‚‰ã®å‹é”ã§ã™ã€‚",
                            en: "We have been friends since we were children.",
                            explanation: "çŠ¶æ…‹ã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†å½¢ã§ã™ã€‚"
                        }
                    ],
                    present_perfect_continuation_questions: [
                        {
                            jp: "ã©ã®ãã‚‰ã„é•·ãæ—¥æœ¬ã«ä½ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "How long have you lived in Japan?",
                            explanation: "ç¶™ç¶šæœŸé–“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãã®ä¼šç¤¾ã§åƒã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you worked for that company?",
                            explanation: "work ã¯ç¶™ç¶šã‚’è¡¨ã™å‹•è©ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_continuous: [
                        {
                            jp: "é›¨ãŒ2æ™‚é–“é™ã‚Šç¶šã„ã¦ã„ã¾ã™ã€‚",
                            en: "It has been raining for two hours.",
                            explanation: "ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’å¼·èª¿ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœã‹ã‚‰ãšã£ã¨åƒã„ã¦ã„ã¾ã™ã€‚",
                            en: "He has been working since this morning.",
                            explanation: "å‹•ä½œã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    participle_present: [
                        {
                            jp: "èµ°ã£ã¦ã„ã‚‹å°‘å¹´ã¯ç§ã®å¼Ÿã§ã™ã€‚",
                            en: "The boy running is my brother.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã€Œã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãã“ã§æ­Œã£ã¦ã„ã‚‹å¥³ã®å­ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "Do you know the girl singing over there?",
                            explanation: "ç¾åœ¨åˆ†è©ãŒåè©ã‚’å¾Œã‚ã‹ã‚‰ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚"
                        }
                    ],
                    participle_past: [
                        {
                            jp: "æ—¥æœ¬ã§ä½œã‚‰ã‚ŒãŸè»Šã¯äººæ°—ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "Cars made in Japan are popular.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—ã‘èº«ã®æ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å£Šã‚ŒãŸçª“ã‚’ä¿®ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "We need to repair the broken window.",
                            explanation: "éå»åˆ†è©ãŒåè©ã‚’ä¿®é£¾ã—ã¦çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_omission: [
                        {
                            jp: "ç§ãŒæ˜¨æ—¥èª­ã‚“ã æœ¬ã¯ã¨ã¦ã‚‚é¢ç™½ã‹ã£ãŸã§ã™ã€‚",
                            en: "The book I read yesterday was very interesting.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© which/that ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè©±ã—ã¦ã„ãŸäººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person he was talking to is my teacher.",
                            explanation: "å‰ç½®è©ã®ç›®çš„èªã«ãªã‚‹é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson4: {
                    relative_pronoun_who: [
                        {
                            jp: "è‹±èªã‚’æ•™ãˆã‚‹äººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person who teaches English is my teacher.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ˜¨æ—¥æ¥ãŸå­¦ç”ŸãŸã¡ã¯ä¸­å›½ã‹ã‚‰æ¥ã¾ã—ãŸã€‚",
                            en: "The students who came yesterday are from China.",
                            explanation: "è¤‡æ•°ã®äººã‚’å…ˆè¡Œè©ã¨ã™ã‚‹å ´åˆã‚‚ who ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_which: [
                        {
                            jp: "æœºã®ä¸Šã«ã‚ã‚‹æœ¬ã¯ç§ã®ã‚‚ã®ã§ã™ã€‚",
                            en: "The book which is on the desk is mine.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© which ã¯ç‰©ã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè²·ã£ãŸè»Šã¯èµ¤ã„ã§ã™ã€‚",
                            en: "The car which he bought is red.",
                            explanation: "which ã¯ that ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_object: [
                        {
                            jp: "ç§ãŒä¼šã£ãŸäººã¯ã¨ã¦ã‚‚è¦ªåˆ‡ã§ã—ãŸã€‚",
                            en: "The person whom I met was very kind.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© whom ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ï¼ˆwho ã‚‚å¯ï¼‰ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ãŒä½œã£ãŸæ–™ç†ã¯ãŠã„ã—ã‹ã£ãŸã§ã™ã€‚",
                            en: "The food that she cooked was delicious.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã¯äººãƒ»ç‰©ä¸¡æ–¹ã«ä½¿ãˆã¾ã™ã€‚"
                        }
                    ]
                },
                lesson5: {
                    subjunctive_1: [
                        {
                            jp: "ã‚‚ã—ãŠé‡‘ãŒã‚ã£ãŸã‚‰ã€æ–°ã—ã„è»Šã‚’è²·ã†ã®ã«ã€‚",
                            en: "If I had money, I would buy a new car.",
                            explanation: "ä»®å®šæ³•éå»ã§ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ™‚é–“ãŒã‚ã£ãŸã‚‰ã€ã‚ãªãŸã¨è©±ã™ã®ã«ã€‚",
                            en: "If I had time, I would talk with you.",
                            explanation: "ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹é¡˜æœ›ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_2: [
                        {
                            jp: "ã‚‚ã—æ˜¨æ—¥å‹‰å¼·ã—ã¦ã„ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ã¦ã„ãŸã ã‚ã†ã€‚",
                            en: "If I had studied yesterday, I would have passed the test.",
                            explanation: "ä»®å®šæ³•éå»å®Œäº†ã§éå»ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ—©ãå‡ºç™ºã—ã¦ã„ãŸã‚‰ã€é…åˆ»ã—ãªã‹ã£ãŸã ã‚ã†ã€‚",
                            en: "If we had left earlier, we wouldn't have been late.",
                            explanation: "éå»ã®äº‹å®Ÿã«åã™ã‚‹å¾Œæ‚”ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_3: [
                        {
                            jp: "å½¼ãŒãã“ã«ã„ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish he were there.",
                            explanation: "wish + ä»®å®šæ³•ã§å®Ÿç¾å›°é›£ãªé¡˜æœ›ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "é›¨ãŒé™ã‚‰ãªã‘ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish it wouldn't rain.",
                            explanation: "æœªæ¥ã¸ã®é¡˜æœ›ã‚’ wish + would ã§è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson6: {
                    postposition_ing: [
                        {
                            jp: "å…¬åœ’ã§éŠã‚“ã§ã„ã‚‹å­ä¾›ãŸã¡ã¯å…ƒæ°—ã§ã™ã€‚",
                            en: "The children playing in the park are energetic.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å›³æ›¸é¤¨ã§å‹‰å¼·ã—ã¦ã„ã‚‹å­¦ç”Ÿã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "I saw students studying in the library.",
                            explanation: "å ´æ‰€ã‚’å«ã‚€ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_past_participle: [
                        {
                            jp: "ãƒ•ãƒ©ãƒ³ã‚¹ã§ä½œã‚‰ã‚ŒãŸãƒ¯ã‚¤ãƒ³ã¯æœ‰åã§ã™ã€‚",
                            en: "Wine made in France is famous.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—å‹•çš„ãªæ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "10å¹´å‰ã«å»ºã¦ã‚‰ã‚ŒãŸå»ºç‰©ã¯å¤ãè¦‹ãˆã¾ã™ã€‚",
                            en: "The building built ten years ago looks old.",
                            explanation: "æ™‚ã‚’å«ã‚€éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_omission: [
                        {
                            jp: "ç§ãŒè²·ã£ãŸèŠ±ã¯ã¨ã¦ã‚‚ç¾ã—ã„ã§ã™ã€‚",
                            en: "The flowers I bought are very beautiful.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚ŒãŸå¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè¨€ã£ãŸã“ã¨ã¯æœ¬å½“ã§ã—ãŸã€‚",
                            en: "What he said was true.",
                            explanation: "é–¢ä¿‚ä»£åè©ã®çœç•¥ã«ã‚ˆã‚‹ç°¡æ½”ãªè¡¨ç¾ã§ã™ã€‚"
                        }
                    ],
                    relative_summary: [
                        {
                            jp: "ãã“ã§åƒã„ã¦ã„ã‚‹äººã¯ç§ã®å‹é”ã§ã™ã€‚",
                            en: "The person who works there is my friend.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒèª­ã‚“ã§ã„ã‚‹æœ¬ã¯é›£ã—ãã†ã§ã™ã€‚",
                            en: "The book that he is reading looks difficult.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        }
                    ],
                    sentence_transformation: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯é¢ç™½ã‹ã£ãŸã§ã™ã€‚ç§ã¯ãã®æ˜ ç”»ã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "The movie that I watched was interesting.",
                            explanation: "2ã¤ã®æ–‡ã‚’é–¢ä¿‚ä»£åè©ã§1ã¤ã«ã¾ã¨ã‚ãŸä¾‹ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯è¦ªåˆ‡ãªäººã§ã™ã€‚å½¼å¥³ã¯ç§ã‚’åŠ©ã‘ã¦ãã‚Œã¾ã—ãŸã€‚",
                            en: "She is a kind person who helped me.",
                            explanation: "é–¢ä¿‚ä»£åè©ã‚’ä½¿ã£ãŸæ–‡ã®æ›¸ãæ›ãˆä¾‹ã§ã™ã€‚"
                        }
                    ]
                }
            }
        };

        /* ----------------- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆåŠ¹æœéŸ³ã€éŸ³å£°åˆæˆç­‰ï¼‰ ----------------- */
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
            }
            playClick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(660, 0.08, 0.15);
                } catch (e) {
                    console.log('ã‚¯ãƒªãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playStudyComplete() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(440, 0.25, 0.2);
                } catch (e) {
                    console.log('å®Œäº†éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playSuccess() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(523, 0.15, 0.18);
                } catch (e) {
                    console.log('æˆåŠŸéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(800, 0.05, 0.1);
                } catch (e) {
                    console.log('ãƒãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTimeUp() {
                if (!this.audioContext) return;
                try {
                    this.createWarmTone(220, 0.4, 0.3);
                } catch (e) {
                    console.log('æ™‚é–“åˆ‡ã‚ŒéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            createBell(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createSoftTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createWarmTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰
        class VoiceSystem {
            constructor() {
                this.synth = null;
                this.voices = [];
                this.selectedVoice = null;
                this.isEnabled = true;
                this.deviceType = this.detectDevice();
                this.currentMaleVoice = null;
                this.currentFemaleVoice = null;
                
                try {
                    if ('speechSynthesis' in window) {
                        this.synth = window.speechSynthesis;
                        this.initializeVoices();
                    } else {
                        console.log('éŸ³å£°åˆæˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            // ğŸ”§ éŸ³å£°åˆæœŸåŒ–ã®æ”¹å–„
            initializeVoices() {
                this.loadVoices();
                
                // éŸ³å£°èª­ã¿è¾¼ã¿å®Œäº†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }
            }

            loadVoices() {
                this.voices = speechSynthesis.getVoices();
                if (this.voices.length > 0) {
                    this.setDeviceRecommendedVoices();
                    this.loadSettings();
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆæ‹¡å¼µç‰ˆãƒ»ç¢ºå®Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
            detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                
                console.log('ğŸ” ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º:', { userAgent, platform });
                
                if (/iphone|ipad|ipod/.test(userAgent) || platform.includes('mac')) {
                    return 'apple';
                } else if (/android/.test(userAgent)) {
                    return 'android';
                } else if (/windows/.test(userAgent) || platform.includes('win')) {
                    return 'windows';
                } else if (/linux/.test(userAgent) || platform.includes('linux')) {
                    return 'linux';
                } else if (/chrome/.test(userAgent)) {
                    return 'chrome';
                } else {
                    return 'other';
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°è¨­å®šï¼ˆå¼·åŒ–ç‰ˆãƒ»ç¢ºå®Ÿå‹•ä½œï¼‰
            setDeviceRecommendedVoices() {
                console.log('ğŸ¯ éŸ³å£°è¨­å®šé–‹å§‹ - ãƒ‡ãƒã‚¤ã‚¹:', this.deviceType, 'éŸ³å£°æ•°:', this.voices.length);
                
                // åˆ©ç”¨å¯èƒ½ãªå…¨éŸ³å£°ã‚’ãƒ­ã‚°å‡ºåŠ›
                this.voices.forEach((voice, index) => {
                    console.log(`éŸ³å£°${index + 1}:`, voice.name, voice.lang);
                });
                
                // ç”·æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentMaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('male') || 
                           name.includes('man') || 
                           name.includes('alex') || 
                           name.includes('david') || 
                           name.includes('daniel') || 
                           name.includes('mark') || 
                           name.includes('tom') ||
                           name.includes('aaron') ||
                           name.includes('arthur') ||
                           name.includes('george');
                });
                
                // å¥³æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentFemaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('female') || 
                           name.includes('woman') || 
                           name.includes('samantha') || 
                           name.includes('zira') || 
                           name.includes('victoria') || 
                           name.includes('karen') || 
                           name.includes('susan') ||
                           name.includes('allison') ||
                           name.includes('ava') ||
                           name.includes('hazel') ||
                           name.includes('helen');
                });
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼šæ€§åˆ¥ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                if (!this.currentMaleVoice && this.voices.length > 0) {
                    // æœ€åˆã®éŸ³å£°ã‚’ç”·æ€§ã¨ã—ã¦ä½¿ç”¨
                    this.currentMaleVoice = this.voices[0];
                    console.log('âš ï¸ ç”·æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentMaleVoice.name);
                }
                
                if (!this.currentFemaleVoice && this.voices.length > 1) {
                    // 2ç•ªç›®ã®éŸ³å£°ã‚’å¥³æ€§ã¨ã—ã¦ä½¿ç”¨ï¼ˆ1ç•ªç›®ã¨é•ã†éŸ³å£°ï¼‰
                    this.currentFemaleVoice = this.voices[1];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentFemaleVoice.name);
                } else if (!this.currentFemaleVoice && this.voices.length === 1) {
                    // 1ã¤ã—ã‹ãªã„å ´åˆã¯åŒã˜éŸ³å£°ã‚’ä½¿ç”¨
                    this.currentFemaleVoice = this.voices[0];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€åŒã˜éŸ³å£°ã‚’ä½¿ç”¨:', this.currentFemaleVoice.name);
                }
                
                console.log('ğŸ¤ æœ€çµ‚é¸æŠéŸ³å£°:', {
                    device: this.deviceType,
                    male: this.currentMaleVoice?.name || 'ãªã—',
                    female: this.currentFemaleVoice?.name || 'ãªã—',
                    totalVoices: this.voices.length
                });
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³å£°è¨­å®š
                if (!this.selectedVoice) {
                    this.selectedVoice = this.currentFemaleVoice || this.currentMaleVoice || this.voices[0];
                }
            }

            // ğŸ”§ éŸ³å£°é¸æŠï¼ˆç”·æ€§/å¥³æ€§ï¼‰
            selectGenderVoice(gender) {
                let targetVoice = null;
                
                if (gender === 'male') {
                    targetVoice = this.currentMaleVoice;
                } else if (gender === 'female') {
                    targetVoice = this.currentFemaleVoice;
                }
                
                if (targetVoice) {
                    this.selectedVoice = targetVoice;
                    this.saveSettings();
                    this.updateVoiceSelectionUI(gender);
                    console.log(`ğŸ¤ éŸ³å£°é¸æŠ: ${gender} - ${targetVoice.name}`);
                    return true;
                }
                return false;
            }

            updateVoiceSelectionUI(selectedGender) {
                document.querySelectorAll('.voice-choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const targetBtn = document.querySelector(`[data-voice-gender="${selectedGender}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('selected');
                }
            }

            // ğŸ”§ éŸ³å£°ãƒ†ã‚¹ãƒˆ
            testVoice(gender) {
                const testTexts = {
                    male: "Hello! I am the male voice for your English learning. I will help you practice pronunciation clearly and confidently.",
                    female: "Hi there! I am the female voice for your English learning. Let me help you improve your pronunciation with clear and natural speech."
                };
                
                if (gender === 'male' && this.currentMaleVoice) {
                    this.testSpecificVoice(this.currentMaleVoice, testTexts.male);
                } else if (gender === 'female' && this.currentFemaleVoice) {
                    this.testSpecificVoice(this.currentFemaleVoice, testTexts.female);
                }
            }

            testSpecificVoice(voice, text) {
                try {
                    this.synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    console.log(`ğŸ”Š éŸ³å£°ãƒ†ã‚¹ãƒˆ: ${voice.name}`);
                    this.synth.speak(utterance);
                } catch (e) {
                    console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            speak(text) {
                if (!this.isEnabled || !text.trim() || !this.synth) return;
                
                try {
                    this.synth.cancel();
                    
                    const cleanText = this.cleanEnglishText(text);
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    
                    if (this.selectedVoice) {
                        utterance.voice = this.selectedVoice;
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.85;
                    
                    this.synth.speak(utterance);
                    return utterance;
                    
                } catch (e) {
                    console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            cleanEnglishText(text) {
                return text
                    .replace(/[^\w\s.!?',\-]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            setEnabled(enabled) {
                this.isEnabled = enabled;
                this.saveSettings();
                
                if (!enabled && this.synth) {
                    try {
                        this.synth.cancel();
                    } catch (e) {
                        console.log('éŸ³å£°åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    }
                }
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceName: this.selectedVoice ? this.selectedVoice.name : null,
                        isEnabled: this.isEnabled,
                        deviceType: this.deviceType
                    };
                    localStorage.setItem('oneWorldQuizVoiceSettings', JSON.stringify(settings));
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('oneWorldQuizVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.isEnabled = settings.isEnabled !== false;
                        
                        if (settings.voiceName && this.voices.length > 0) {
                            const savedVoice = this.voices.find(v => v.name === settings.voiceName);
                            if (savedVoice) {
                                this.selectedVoice = savedVoice;
                                // UIæ›´æ–°
                                const gender = (savedVoice === this.currentMaleVoice) ? 'male' : 'female';
                                this.updateVoiceSelectionUI(gender);
                            }
                        }
                    }
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            getSelectedVoiceName() {
                return this.selectedVoice ? this.selectedVoice.name : 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
            }

            getDeviceInfo() {
                const deviceNames = {
                    apple: 'iPhoneãƒ»iPadãƒ»Mac',
                    android: 'Android',
                    windows: 'Windows',
                    linux: 'Linux',
                    chrome: 'Chrome OS',
                    other: 'ãã®ä»–'
                };
                
                return {
                    type: this.deviceType,
                    typeName: deviceNames[this.deviceType] || 'ãã®ä»–',
                    totalVoices: this.voices.length,
                    maleVoice: this.currentMaleVoice?.name || 'ãªã—',
                    femaleVoice: this.currentFemaleVoice?.name || 'ãªã—',
                    selectedVoice: this.selectedVoice?.name || 'ãªã—'
                };
            }
        }

        let soundSystem, voiceSystem;
        try {
            soundSystem = new SoundSystem();
            voiceSystem = new VoiceSystem<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>ONE WORLD Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-coral: #f4a261;
            --primary-sage: #7fb069;
            --primary-sky: #6bb6ff;
            --primary-lavender: #a584c7;
            --accent-peach: #f9b6a3;
            --accent-mint: #b8e6b8;
            --bg-cream: #fdf8f3;
            --bg-white: #ffffff;
            --text-dark: #2d3748;
            --text-warm: #5d4e75;
            --border-soft: #e6ddd4;
            --shadow-gentle: rgba(116, 139, 141, 0.15);
        }
        body {
            font-family: "Noto Sans JP", "Inter", sans-serif;
            background: #faf7f2;
            min-height: 100vh;
            touch-action: manipulation;
            overflow-x: hidden;
            color: var(--text-dark);
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            padding-top: 5rem;
            padding-bottom: 2rem;
        }
        .container-spacing {
            margin: 0 auto;
            max-width: 95%;
            width: 100%;
        }
        @media (min-width: 640px) {
            .container-spacing {
                max-width: 500px;
            }
        }
        @media (min-width: 768px) {
            .container-spacing {
                max-width: 600px;
            }
        }
        @media (min-width: 1024px) {
            .container-spacing {
                max-width: 700px;
            }
        }
        .game-title {
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: var(--primary-coral);
            text-align: center;
            letter-spacing: -0.025em;
            margin-bottom: 0.5rem;
        }
        .warm-card {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 24px;
            box-shadow: 0 8px 32px var(--shadow-gentle);
            position: relative;
            overflow: hidden;
        }
        .warm-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-coral);
            border-radius: 24px 24px 0 0;
        }
        .warm-button {
            background: var(--primary-coral);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.4);
            background: #f19a4e;
        }
        .warm-button:active {
            transform: translateY(0);
            box-shadow: 0 4px 16px rgba(244, 162, 97, 0.3);
        }
        .warm-button:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        .grade-btn {
            background: #fef9f5;
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            color: var(--text-warm);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 1rem 0.75rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 16px var(--shadow-gentle);
        }
        .grade-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.25);
            background: #fdf5ef;
        }
        .grade-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(244, 162, 97, 0.3);
        }
        .lesson-btn {
            background: #f0f8ff;
            border: 2px solid #b8d4f0;
            border-radius: 16px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.75rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 60px;
            box-shadow: 0 4px 12px rgba(107, 182, 255, 0.15);
            font-size: 0.8rem;
            font-weight: 500;
        }
        .lesson-btn:hover {
            border-color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.25);
            background: #e6f3ff;
        }
        .lesson-btn.selected {
            background: #d9edff;
            border-color: var(--primary-sky);
            color: var(--primary-sky);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(107, 182, 255, 0.3);
        }
        .lesson-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-sky);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .grammar-btn {
            background: #f8f5ff;
            border: 2px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 0.6rem 0.4rem;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 50px;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
            font-size: 0.75rem;
            font-weight: 500;
        }
        .grammar-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
            background: #f0ebff;
        }
        .grammar-btn.selected {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        .grammar-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 4px;
            right: 4px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* æ¨ªãƒ©ã‚¤ãƒ³ã®å¾¹åº•å‰Šé™¤ã‚·ã‚¹ãƒ†ãƒ ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ–å¯¾å¿œï¼‰ */
        *, *::before, *::after,
        *:focus, *:active, *:hover,
        *:focus-visible, *:focus-within {
            border-top: none !important;
            border-bottom: none !important;
            outline: none !important;
        }
        
        /* Tailwind CSSã®å…¨ãƒœãƒ¼ãƒ€ãƒ¼ã‚¯ãƒ©ã‚¹ã‚’ç„¡åŠ¹åŒ– */
        .border, .border-t, .border-b, .border-l, .border-r,
        .border-0, .border-2, .border-4, .border-8,
        .border-t-0, .border-t-2, .border-t-4, .border-t-8,
        .border-b-0, .border-b-2, .border-b-4, .border-b-8,
        .border-solid, .border-dashed, .border-dotted,
        .divide-y, .divide-x {
            border-top: none !important;
            border-bottom: none !important;
        }
        
        /* å¿…è¦ãªãƒœãƒ¼ãƒ€ãƒ¼ã®ã¿å¾©æ´»ï¼ˆå®Œå…¨æŒ‡å®šï¼‰ */
        .warm-card {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .lesson-btn {
            border: 2px solid #b8d4f0 !important;
            border-top: 2px solid #b8d4f0 !important;
            border-bottom: 2px solid #b8d4f0 !important;
        }
        
        .grammar-btn {
            border: 2px solid #d6c9e3 !important;
            border-top: 2px solid #d6c9e3 !important;
            border-bottom: 2px solid #d6c9e3 !important;
        }
        
        .grade-btn {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .quiz-question {
            border: 3px solid #e2e8f0 !important;
            border-top: 3px solid #e2e8f0 !important;
            border-bottom: 3px solid #e2e8f0 !important;
        }
        
        .answer-display {
            border: 3px solid var(--border-soft) !important;
            border-top: 3px solid var(--border-soft) !important;
            border-bottom: 3px solid var(--border-soft) !important;
        }
        
        .header-stat-item {
            border: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-top: 1.5px solid rgba(165, 132, 199, 0.3) !important;
            border-bottom: 1.5px solid rgba(165, 132, 199, 0.3) !important;
        }
        
        .header-nav-item {
            border: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-top: 2px solid rgba(255, 255, 255, 0.3) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã®æ”¹å–„ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        .modal {
            display: none;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            z-index: 1000;
            padding: 0 !important;
            margin: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«å¤‰æ›´ */
            overflow-y: auto !important;
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚’é˜»å®³ã—ãªã„ã‚ˆã†ã« */
            pointer-events: none;
        }
        
        .modal.show {
            display: flex !important;
            align-items: flex-start !important;
            justify-content: center !important;
            animation: modalFadeIn 0.4s ease-out;
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
            pointer-events: auto;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        .modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            margin: 1rem !important;
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            /* ğŸ”§ è‡ªç„¶ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
            overflow: visible !important;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ«ã®å®Œå…¨æ”¹å–„ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
        #quizModal .modal-content {
            width: 95% !important;
            max-width: 550px !important;
            min-width: 300px !important;
            margin: 1rem auto !important;
            /* ğŸ”§ æœ€å°é™ã®ä¸Šä¸‹ãƒãƒ¼ã‚¸ãƒ³ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            margin-top: 6rem !important;
            margin-bottom: 2rem !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            flex-shrink: 0 !important;
            /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
            overflow: visible !important;
        }
        
        #quizModal .modal-content .warm-card {
            width: 100% !important;
            max-width: none !important;
            position: static !important;
            transform: none !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            margin: 0 !important;
        }
        
        /* ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é¸æŠç”»é¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ”¹å–„ */
        .lesson-modal-content {
            width: 100% !important;
            max-width: 600px !important;
            max-height: none !important;
            /* ğŸ”§ é«˜ã•åˆ¶é™ã‚’å‰Šé™¤ */
            margin: 0.5rem !important;
            margin-bottom: 2rem !important;
            margin-top: 6rem !important;
            /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
            position: static !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            flex-shrink: 0 !important;
            pointer-events: auto !important;
            overflow: visible !important;
        }
        
        @media (max-width: 640px) {
            .modal {
                padding: 0 !important;
                margin: 0 !important;
                /* ğŸ”§ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã« */
                overflow-y: auto !important;
            }
            
            .modal-content {
                margin: 0.5rem !important;
                width: calc(100% - 1rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            #quizModal .modal-content {
                margin: 0.25rem auto !important;
                width: calc(100% - 0.5rem) !important;
                min-width: 280px !important;
                /* ğŸ”§ ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã®å¹²æ¸‰ã‚’é¿ã‘ã‚‹ */
                margin-top: 5rem !important;
                margin-bottom: 2rem !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
            
            .lesson-modal-content {
                margin: 0.25rem !important;
                margin-bottom: 1rem !important;
                margin-top: 5rem !important;
                width: calc(100% - 0.5rem) !important;
                position: static !important;
                transform: none !important;
                left: auto !important;
                right: auto !important;
                top: auto !important;
                bottom: auto !important;
            }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            font-weight: 600;
            z-index: 100;
            animation: particleFloat 2.5s ease-out forwards;
            font-size: 20px;
        }
        @keyframes particleFloat {
            0% {
                transform: translateY(0) scale(1) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: translateY(-40px) scale(1.3) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: translateY(-100px) scale(1.5) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ğŸ”§ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰- z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã« */
        .fixed-header {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            /* ğŸ”§ z-indexã‚’å¤§å¹…ã«ä¸Šã’ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚ˆã‚Šä¸Šã«è¡¨ç¤º */
            z-index: 10000;
            animation: floatingHeader 3s ease-in-out infinite;
            max-width: 90vw;
            overflow: hidden;
            background: transparent;
            border: none;
            box-shadow: none;
            backdrop-filter: none;
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        @keyframes floatingHeader {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }
        
        .header-stat-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
            border: 1.5px solid rgba(165, 132, 199, 0.3);
            border-radius: 18px;
            padding: 0.4rem 0.7rem;
            min-width: 60px;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(165, 132, 199, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-stat-item:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(165, 132, 199, 0.3);
            background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.95));
            border-color: rgba(165, 132, 199, 0.5);
        }
        
        .header-nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            /* ğŸ”§ ç¢ºå®Ÿã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹ */
            pointer-events: auto;
        }
        
        .header-nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .header-nav-item:hover::before {
            opacity: 1;
        }
        
        .header-nav-item:hover {
            transform: translateY(-4px) scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
        }
        
        .header-nav-item:active {
            transform: translateY(-2px) scale(1.05);
        }
        
        .header-nav-item.home {
            background: linear-gradient(135deg, var(--primary-coral), #f19a4e);
        }
        
        .header-nav-item.home:hover {
            box-shadow: 0 8px 25px rgba(244, 162, 97, 0.5);
        }
        
        .header-nav-item.back {
            background: linear-gradient(135deg, var(--primary-sage), #6fa055);
        }
        
        .header-nav-item.back:hover {
            box-shadow: 0 8px 25px rgba(127, 176, 105, 0.5);
        }
        
        .header-nav-item.voice {
            background: linear-gradient(135deg, var(--primary-lavender), #9574b5);
        }
        
        .header-nav-item.voice:hover {
            box-shadow: 0 8px 25px rgba(165, 132, 199, 0.5);
        }
        
        .header-stat-number {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--primary-lavender);
        }
        .header-stat-emoji {
            font-size: 1.1rem;
        }
        
        /* ğŸ”§ éŸ³å£°è¨­å®šã®æ–°ã—ã„ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ */
        .device-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 16px;
            border: 2px solid #e2e8f0;
        }
        
        .device-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .device-description {
            font-size: 0.8rem;
            color: var(--text-warm);
            text-align: center;
            margin-bottom: 1rem;
            line-height: 1.4;
        }
        
        .voice-choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }
        
        .voice-choice-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 0.5rem;
            background: var(--bg-white);
            border: 2px solid var(--border-soft);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-height: 80px;
            position: relative;
            overflow: hidden;
        }
        
        .voice-choice-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.2);
            background: #faf8ff;
        }
        
        .voice-choice-btn.selected {
            border-color: var(--primary-lavender);
            background: #f0ebff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        
        .voice-choice-btn.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 6px;
            right: 6px;
            background: var(--primary-lavender);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voice-gender-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        
        .voice-gender-description {
            font-size: 0.65rem;
            color: var(--text-warm);
            line-height: 1.2;
            margin-bottom: 0.25rem;
        }
        
        .voice-test-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .voice-test-btn:hover {
            background: #5aa3f0;
            transform: translateY(-1px);
        }
        
        .voice-toggle {
            margin-bottom: 1.5rem;
            text-align: center;
            padding: 0.75rem;
            background: var(--bg-cream);
            border-radius: 12px;
        }
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 28px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider {
            background-color: var(--primary-sage);
        }
        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        .speak-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--primary-sage);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 14px;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            vertical-align: middle;
        }
        .speak-btn:hover {
            background: #6fa055;
            transform: scale(1.1);
        }
        .speak-btn.speaking {
            animation: speakPulse 1s infinite;
        }
        @keyframes speakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        
        .timer-display {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            padding: 0.75rem;
            border-radius: 12px;
            margin: 0.5rem 0;
            transition: all 0.3s ease;
            border: 2px solid;
            display: inline-block;
            min-width: 80px;
        }
        .timer-normal {
            background: linear-gradient(135deg, #e8f5e8, #f0fdf0);
            color: var(--primary-sage);
            border-color: var(--primary-sage);
        }
        .timer-warning {
            background: linear-gradient(135deg, #fef3cd, #fefce8);
            color: #d97706;
            border-color: #d97706;
            animation: timerPulse 1s infinite;
        }
        .timer-danger {
            background: linear-gradient(135deg, #fee2e2, #fef2f2);
            color: #dc2626;
            border-color: #dc2626;
            animation: timerPulse 0.5s infinite;
        }
        .timer-unlimited {
            background: linear-gradient(135deg, #e0f2fe, #f0f9ff);
            color: #0284c7;
            border-color: #0284c7;
        }
        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .timer-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .timer-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .timer-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        
        .answer-display {
            background: var(--bg-cream);
            border-radius: 16px;
            padding: 2rem;
            margin-top: 1rem;
            border: 3px solid var(--border-soft);
            text-align: left;
            font-size: 1.1rem;
            line-height: 1.8;
            box-shadow: 0 4px 12px var(--shadow-gentle);
            min-height: 200px;
            /* ğŸ”§ æœ€å¤§é«˜ã•ã‚’åˆ¶é™ã—ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’æœ‰åŠ¹ã«ã™ã‚‹ */
            /* max-height: 400px; */
            /* overflow-y: auto; */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
        }
        .answer-display.show {
            border-color: var(--primary-sage);
            background: #f0f9f0;
            box-shadow: 0 4px 12px rgba(127, 176, 105, 0.2);
        }
        .answer-text {
            font-weight: 700;
            font-size: 1.4rem;
            color: var(--primary-sage);
            margin-bottom: 1rem;
            text-align: center;
            width: 100%;
            padding: 1rem;
            background: rgba(127, 176, 105, 0.1);
            border-radius: 12px;
            position: relative;
        }
        .explanation-text {
            color: var(--text-dark);
            font-size: 1.1rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
        }
        
        .show-answer-btn {
            background: var(--primary-sky);
            border: none;
            color: white;
            font-weight: 600;
            border-radius: 16px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(107, 182, 255, 0.3);
            margin: 0.5rem 0;
        }
        .show-answer-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(107, 182, 255, 0.4);
            background: #5aa3f0;
        }
        .show-answer-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            transform: none;
            box-shadow: none;
            cursor: not-allowed;
        }
        
        /* ğŸ”§ ã‚¯ã‚¤ã‚ºå•é¡Œæ ã®å›ºå®šåŒ– */
        .quiz-question {
            background: #f8fafc !important;
            border: 3px solid #e2e8f0 !important;
            border-radius: 16px !important;
            padding: 1.5rem !important;
            text-align: center !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            color: var(--text-dark) !important;
            line-height: 1.5 !important;
            margin-bottom: 1rem !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            position: static !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            left: auto !important;
            right: auto !important;
            top: auto !important;
            bottom: auto !important;
            transform: none !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            flex-shrink: 0 !important;
            overflow-wrap: break-word !important;
            word-wrap: break-word !important;
        }
        
        .grade-grid {
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        .lesson-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
        }
        .grammar-grid {
            grid-template-columns: 1fr;
            gap: 0.5rem;
        }
        .back-button {
            background: #f1f5f9;
            border: 3px solid #cbd5e1;
            color: var(--text-dark);
            border-radius: 16px;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .back-button:hover {
            background: #e2e8f0;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .stats-display {
            background: var(--bg-cream);
            border: 3px solid var(--border-soft);
            border-radius: 20px;
            padding: 1.25rem;
            text-align: center;
            box-shadow: 0 6px 20px var(--shadow-gentle);
        }
        .section-divider {
            height: 2px;
            background: var(--border-soft);
            margin: 1.25rem 0;
        }
        .mode-btn {
            background: var(--bg-white);
            border: 3px solid var(--border-soft);
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px var(--shadow-gentle);
        }
        .mode-btn:hover {
            border-color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.25);
        }
        .mode-btn.active {
            background: #fdf0e7;
            border-color: var(--primary-coral);
            color: var(--primary-coral);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(244, 162, 97, 0.3);
        }
        .direction-btn {
            background: var(--bg-white);
            border: 3px solid #d6c9e3;
            border-radius: 12px;
            color: var(--text-dark);
            transition: all 0.3s ease;
            padding: 0.75rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(165, 132, 199, 0.15);
        }
        .direction-btn:hover {
            border-color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.25);
        }
        .direction-btn.active {
            background: #e9dff7;
            border-color: var(--primary-lavender);
            color: var(--primary-lavender);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(165, 132, 199, 0.3);
        }
        
        @media (max-width: 640px) {
            .container-spacing {
                max-width: 95%;
                margin-bottom: 2rem;
            }
            .warm-card {
                margin: 0.25rem;
                padding: 1rem;
            }
            .game-title {
                font-size: clamp(1.25rem, 6vw, 2rem);
            }
            .grade-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }
            .lesson-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            .grammar-grid {
                grid-template-columns: 1fr;
                gap: 0.4rem;
            }
            .grade-btn {
                padding: 0.75rem 0.5rem;
                min-height: 70px;
                font-size: 0.8rem;
            }
            .lesson-btn {
                padding: 0.6rem 0.4rem;
                min-height: 50px;
                font-size: 0.75rem;
            }
            .grammar-btn {
                padding: 0.5rem 0.3rem;
                min-height: 45px;
                font-size: 0.7rem;
            }
            .timer-display {
                font-size: 1.25rem;
                padding: 0.5rem;
                min-width: 60px;
            }
            .quiz-question {
                font-size: 1rem !important;
                padding: 1rem !important;
            }
            .answer-display {
                padding: 1.5rem;
                min-height: 150px;
            }
            .answer-text {
                font-size: 1.2rem;
                padding: 0.75rem;
            }
            .explanation-text {
                font-size: 1rem;
            }
            .fixed-header {
                top: 0.5rem;
                padding: 0.6rem 1.2rem;
                gap: 0.8rem;
            }
            .header-stat-item {
                min-width: 50px;
                padding: 0.3rem 0.5rem;
                gap: 0.3rem;
                border-radius: 14px;
            }
            .header-stat-number {
                font-size: 0.8rem;
            }
            .header-stat-emoji {
                font-size: 0.95rem;
            }
            .header-nav-item {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .voice-choice-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .voice-choice-btn {
                min-height: 70px;
                padding: 0.5rem 0.4rem;
            }
            
            .device-section {
                padding: 0.75rem;
                margin-bottom: 1rem;
            }
            
            .voice-gender-icon {
                font-size: 1.2rem;
            }
            
            .voice-gender-label {
                font-size: 0.75rem;
            }
            
            .voice-gender-description {
                font-size: 0.6rem;
            }
        }
        
        button, .grade-btn, .lesson-btn, .grammar-btn, .warm-button, .back-button, .mode-btn, .direction-btn, .timer-btn, .show-answer-btn {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            touch-action: manipulation;
            -webkit-appearance: none;
        }
        
        * {
            touch-action: manipulation;
        }
        
        input, select, textarea {
            font-size: 16px;
        }

        .sparkle {
            position: relative;
            overflow: visible;
        }
        .sparkle::before,
        .sparkle::after {
            content: 'âœ¨';
            position: absolute;
            opacity: 0;
            animation: sparkleFloat 3s infinite ease-in-out;
        }
        .sparkle::before {
            top: -10px;
            left: -10px;
            animation-delay: 0s;
        }
        .sparkle::after {
            bottom: -10px;
            right: -10px;
            animation-delay: 1.5s;
        }
        @keyframes sparkleFloat {
            0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
            50% { opacity: 1; transform: translateY(-20px) scale(1.2); }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center gap-6 relative">
    <!-- ãƒ¡ã‚¤ãƒ³å­¦å¹´é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="mainGradeModal" class="modal show">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸ“ å­¦å¹´ã‚’é¸æŠã—ã‚ˆã†
                </h2>
                <p class="text-gray-600 text-sm mb-4">ã‚ãªãŸã®å­¦ç¿’ãƒ¬ãƒ™ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grade-grid mb-6">
                    <button class="grade-btn" data-grade="grade1">
                        <div class="text-3xl mb-1">ğŸŒ±</div>
                        <div class="font-semibold text-sm">ä¸­å­¦1å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade2">
                        <div class="text-3xl mb-1">ğŸŒ¿</div>
                        <div class="font-semibold text-sm">ä¸­å­¦2å¹´ç”Ÿ</div>
                    </button>
                    <button class="grade-btn" data-grade="grade3">
                        <div class="text-3xl mb-1">ğŸŒ³</div>
                        <div class="font-semibold text-sm">ä¸­å­¦3å¹´ç”Ÿ</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦1å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade1Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ± ä¸­å­¦1å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade1Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons1" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦2å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade2Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ¿ ä¸­å­¦2å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade2Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons2" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸­å­¦3å¹´ç”Ÿãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grade3Modal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-3 text-gray-700">
                    ğŸŒ³ ä¸­å­¦3å¹´ç”Ÿã®ãƒ¬ãƒƒã‚¹ãƒ³
                </h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã—ãŸã„ãƒ¬ãƒƒã‚¹ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid lesson-grid mb-6" id="grade3Lessons">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startMultipleLessons3" class="warm-button px-8 py-3 text-sm sparkle" style="display: none;" disabled>
                        ğŸš€ é¸æŠã—ã¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡æ³•é …ç›®é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="grammarModal" class="modal">
        <div class="lesson-modal-content">
            <div class="warm-card p-6 text-center">
                <h2 id="grammarModalTitle" class="text-lg font-semibold mb-3 text-gray-700"></h2>
                <p class="text-gray-600 text-sm mb-4">å­¦ç¿’ã™ã‚‹å†…å®¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>
                
                <div class="grid grammar-grid mb-4" id="grammarCategories">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center space-y-2" style="padding-bottom: 4rem;">
                    <button id="startGrammarQuiz" class="warm-button px-8 py-3 text-sm sparkle" disabled>
                        ğŸš€ ã‚¯ã‚¤ã‚ºã‚¹ã‚¿ãƒ¼ãƒˆï¼
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”§ éŸ³å£°è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰ -->
    <div id="voiceSettingsModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-6 text-center">
                <h2 class="text-lg font-semibold mb-4 text-gray-700">
                    ğŸ¤ éŸ³å£°è¨­å®š
                </h2>
                
                <!-- éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ -->
                <div class="voice-toggle">
                    <div class="text-sm font-semibold text-gray-700 mb-2">ğŸ”Š éŸ³å£°æ©Ÿèƒ½</div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="voiceEnabled" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <div class="text-xs text-gray-600 mt-2" id="voiceToggleDescription">éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™</div>
                </div>
                
                <!-- ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰ -->
                <div id="deviceRecommendations">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
                
                <div class="text-center mt-4">
                    <button class="warm-button px-6 py-2 text-sm" onclick="closeVoiceSettings()">
                        âœ… è¨­å®šå®Œäº†
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="gameScreen" class="hidden">
        <div class="warm-card p-6 text-center container-spacing mb-6">
            <h1 class="game-title sparkle">ğŸŒ ONE WORLD Quiz âœ¨</h1>
            <div id="currentCategory" class="text-lg font-semibold text-gray-700 mb-4"></div>
            <div class="stats-display">
                <div class="grid grid-cols-2 gap-4 text-center mb-4">
                    <div>
                        <div class="text-2xl font-bold text-blue-600" id="studyCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ“š å­¦ç¿’å›æ•°</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" id="clickCount">0</div>
                        <div class="text-xs text-gray-600">ğŸ–±ï¸ ã‚»ãƒƒã‚·ãƒ§ãƒ³</div>
                    </div>
                </div>
                
                <!-- åˆ¶é™æ™‚é–“è¨­å®šï¼ˆ4ã¤ã®ãƒœã‚¿ãƒ³ã‚’2x2ã‚°ãƒªãƒƒãƒ‰ã§çµ±ä¸€ï¼‰ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">â° åˆ¶é™æ™‚é–“è¨­å®š</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="timer3Btn" class="timer-btn active" data-time="3">
                            âš¡ 3ç§’
                        </button>
                        <button id="timer5Btn" class="timer-btn" data-time="5">
                            ğŸ”¥ 5ç§’
                        </button>
                        <button id="timer10Btn" class="timer-btn" data-time="10">
                            ğŸŒŸ 10ç§’
                        </button>
                        <button id="timerUnlimitedBtn" class="timer-btn" data-time="unlimited">
                            âˆ ç„¡åˆ¶é™
                        </button>
                    </div>
                </div>
                
                <!-- å‡ºé¡Œå½¢å¼é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸ² å‡ºé¡Œã‚¹ã‚¿ã‚¤ãƒ«</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="randomModeBtn" class="mode-btn active" data-mode="random">
                            ğŸ¯ ãƒ©ãƒ³ãƒ€ãƒ 
                        </button>
                        <button id="sequentialModeBtn" class="mode-btn" data-mode="sequential">
                            ğŸ“– é †ç•ªé€šã‚Š
                        </button>
                    </div>
                </div>

                <!-- å‡ºé¡Œæ–¹å‘é¸æŠ -->
                <div class="section-divider"></div>
                <div class="text-center">
                    <div class="text-sm font-semibold text-gray-700 mb-3">ğŸŒ è¨€èªæ–¹å‘</div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button id="jpToEnBtn" class="direction-btn active" data-direction="jp_to_en">
                            ğŸ‡¯ğŸ‡µâ†’ğŸ‡ºğŸ‡¸
                        </button>
                        <button id="enToJpBtn" class="direction-btn" data-direction="en_to_jp">
                            ğŸ‡ºğŸ‡¸â†’ğŸ‡¯ğŸ‡µ
                        </button>
                    </div>
                    <div class="grid grid-cols-1 gap-2">
                        <button id="mixedBtn" class="direction-btn" data-direction="mixed">
                            ğŸ”€ ãƒŸãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ãƒ‰
                        </button>
                    </div>
                </div>
            </div>
            <button id="startQuizButton" class="warm-button px-8 py-4 text-base font-semibold mt-6 sparkle">
                ğŸŒŸ ãƒ¬ãƒƒãƒ„ã‚¹ã‚¿ãƒ¼ãƒˆï¼
            </button>
        </div>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <div class="warm-card p-4 w-full max-w-lg mx-4">
                <div class="text-center mb-4">
                    <h2 class="font-semibold text-lg text-gray-700">
                        ğŸŒ ONE WORLD Quiz Challenge
                    </h2>
                    <div class="flex items-center justify-between mt-2">
                        <div id="remainingCount" class="text-sm text-gray-600"></div>
                        <div id="timerDisplay" class="timer-display timer-normal">
                            <span id="timerValue">æº–å‚™ä¸­</span>
                        </div>
                    </div>
                </div>
                
                <!-- å•é¡Œè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="quizQuestion" class="quiz-question"></div>
                
                <!-- è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
                <div class="text-center">
                    <button id="showAnswerBtn" class="show-answer-btn">
                        ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹
                    </button>
                </div>
                
                <!-- è§£ç­”ãƒ»è§£èª¬è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆæ‹¡å¤§ç‰ˆï¼‰ -->
                <div id="answerDisplay" class="answer-display">
                    <div id="answerContent">
                        <div class="text-gray-500" style="text-align: center;">é ­ã§è€ƒãˆã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>
                    </div>
                </div>
                
                <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
                <div class="flex gap-2 mt-4">
                    <button id="quizNext" class="flex-1 warm-button py-3 text-sm" disabled>
                        â­ æ¬¡ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆå…ƒãƒ•ãƒƒã‚¿ãƒ¼ï¼‰ -->
    <div class="fixed-header">
        <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item home" id="footerHomeBtn" title="ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹">
            ğŸ 
        </div>
        
        <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item back" id="footerBackBtn" title="å‰ã®ç”»é¢ã«æˆ»ã‚‹">
            â—€ï¸
        </div>
        
        <!-- ç·ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTotalStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ†</span>
            <span class="header-stat-number" id="footerTotalClick">0</span>
        </div>
        
        <!-- ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆ -->
        <div class="header-stat-item" id="footerTodayStat" title="ã‚¿ãƒƒãƒ—ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª">
            <span class="header-stat-emoji">ğŸ“…</span>
            <span class="header-stat-number" id="footerTodayClick">0</span>
        </div>
        
        <!-- éŸ³å£°è¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="header-nav-item voice" id="footerVoiceBtn" title="éŸ³å£°è¨­å®š">
            ğŸ¤
        </div>
    </div>

<script>
        /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³ãƒ»æ–‡æ³•é …ç›®å®šç¾©ï¼ˆå®Œå…¨ç‰ˆï¼‰ ----------------- */
        const lessons = {
            grade1: [
                {
                    id: 'lesson1',
                    name: 'Lesson1 - æ–‡ã®åŸºæœ¬',
                    grammar: [
                        {id: 'word_order', name: '1. æ—¥æœ¬èªã¨è‹±èªã®èªé †'},
                        {id: 'sentence_types', name: '2. è‹±èªã®æ–‡ã®ä»£è¡¨çš„ãª2ã¤ã®å‹'},
                        {id: 'personal_statements', name: '3. è‡ªåˆ†ã®ã“ã¨ã‚’è¿°ã¹ãŸã‚Šç›¸æ‰‹ã®ã“ã¨ã‚’ãŸãšã­ã‚‹'},
                        {id: 'various_questions', name: '4. ã•ã¾ã–ã¾ãªç–‘å•æ–‡'},
                        {id: 'requests', name: '5. ãŠé¡˜ã„ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ä»£åè©',
                    grammar: [
                        {id: 'she_he_it', name: '1. she, he, it ãªã©ã®ä½¿ã„æ–¹'},
                        {id: 'pronoun_questions', name: '2. she, he ãªã©ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'this_that', name: '3. this ã¨ that ã®ä½¿ã„æ–¹'},
                        {id: 'this_that_questions', name: '4. this, that ã‚’ä½¿ã£ãŸæ–‡ã®ç–‘å•æ–‡'},
                        {id: 'we_you_they', name: '5. We, you, they ã®ä½¿ã„æ–¹'},
                        {id: 'can_usage', name: '6. can ã®æ„å‘³ã¨ç”¨æ³•'},
                        {id: 'some_any', name: '7. some ã¨ any'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸€èˆ¬å‹•è©',
                    grammar: [
                        {id: 'general_verbs', name: '1. ä¸€èˆ¬å‹•è©ã«ã¯ã€ã©ã‚“ãªã‚‚ã®ãŒã‚ã‚‹ï¼Ÿ'},
                        {id: 'verb_s_es', name: '2. ä¸€èˆ¬å‹•è©ã«ã¤ã s, es'},
                        {id: 'verb_s_es_rules', name: '3. ä¸€èˆ¬å‹•è©ã® s, es ã®ã¤ã‘æ–¹'},
                        {id: 'noun_singular_plural', name: '4. ã€Œ1ã¤ï¼ˆå˜æ•°ï¼‰ã€ãªã®ã‹ã€Œ2ã¤ä»¥ä¸Šï¼ˆè¤‡æ•°ï¼‰ã€ãªã®ã‹ã‚’è¡¨ã™åè©ã«ã¤ã s, es'},
                        {id: 'plural_rules', name: '5. è¤‡æ•°å½¢ã®ã¤ãã‚Šæ–¹'},
                        {id: 'pronoun_i', name: '6. ã€Œç§ã€ã‚’è¡¨ã™2ã¤ã®å½¢'},
                        {id: 'pronoun_cases', name: '7. ä¸»èªã¨ã—ã¦ä½¿ã†å ´åˆã¨ä¸»èªä»¥å¤–ã§ä½¿ã†ã€Œã‚ãªãŸã€ã€Œå½¼ã€ãªã©'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - éå»å½¢',
                    grammar: [
                        {id: 'past_statements', name: '1. éå»ã®ã“ã¨ã‚’è¨€ã†ã¨ã'},
                        {id: 'past_questions', name: '2. éå»ã®ã“ã¨ã‚’ãŸãšã­ã‚‹ã¨ãï¼ˆç–‘å•æ–‡ï¼‰'},
                        {id: 'past_negative', name: '3. éå»ã®ã“ã¨ã§ã€Œã—ãªã‹ã£ãŸã€ã€Œã§ãªã‹ã£ãŸã€ã“ã¨ã‚’è¨€ã†ã¨ãï¼ˆå¦å®šæ–‡ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ç¾åœ¨é€²è¡Œå½¢',
                    grammar: [
                        {id: 'present_continuous', name: '1. ä»Šã—ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_negative', name: '2. ã€Œã€œã—ã¦ã„ã¾ã›ã‚“ã€ã¨ã„ã†ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'present_continuous_questions', name: '3. ã€Œã€œã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã€ã€Œä½•ã‚’ã—ã¦ã„ã‚‹ã®ã§ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - ç–‘å•è©',
                    grammar: [
                        {id: 'why_because', name: '1. ã€Œç†ç”±ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œç†ç”±ã€ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'how_often', name: '2. ã€Œã©ã®ãã‚‰ã„ã‚ˆãã€œã™ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ç­”ãˆã‚‹ã¨ã'},
                        {id: 'which_who_whose', name: '3. ã€Œã©ã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ãã€ã€Œã©ã¡ã‚‰ã‚’ã€ã€Œã ã‚ŒãŒã€ã€Œã ã‚Œã®ã€œã€ã‚’è³ªå•ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - åŠ©å‹•è©',
                    grammar: [
                        {id: 'must_prohibition', name: '1. ã€Œå¼·ã„å‘½ä»¤ã€ã‚„ã€Œç¦æ­¢ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'have_to_necessity', name: '2. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã€Œã€œã™ã‚‹å¿…è¦ã¯ãªã„ã€ã¨ä¼ãˆã‚‹ã¨ã'},
                        {id: 'may_able_to', name: '3. ã€Œã€œã‹ã‚‚ã—ã‚Œãªã„ã€ã¨è¿°ã¹ã‚‹ã¨ãã€ã€Œã€œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - æœªæ¥è¡¨ç¾',
                    grammar: [
                        {id: 'be_going_to', name: '1. äºˆå®šã‚„è¨ˆç”»ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'will_prediction', name: '2. æœªæ¥ã®ã“ã¨ã«ã¤ã„ã¦ã€Œã€œã ã‚ã†ã€ã¨ã„ã†äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'should', name: '3. ã€Œã€œã™ã¹ãã ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - There is/areæ–‡',
                    grammar: [
                        {id: 'there_is_are', name: '1. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ãŒã‚ã‚‹ï¼ˆã„ã‚‹ï¼‰ã€ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'there_is_are_questions', name: '2. ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã‚ã‚Šã¾ã™ã‹ã€ã€Œã€œã«ãƒ»ãƒ»ãƒ»ã¯ã„ãã¤ã‚ã‚Šã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹å ´åˆ'},
                        {id: 'look_sound', name: '3. ã€Œã€œãã†ã«è¦‹ãˆã‚‹ï¼èã“ãˆã‚‹ã€ã¨è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade2: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 1å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'have_to_must_review', name: '1. ã€Œã€œã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€ã‚„ã€Œå¼·ã„å‘½ä»¤ã€ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆhave [has] to ã¨ mustï¼‰'},
                        {id: 'future_review', name: '2. äºˆå®šã‚„æœªæ¥ã«ã¤ã„ã¦ã®äºˆæƒ³ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆbe going to ã¨ willï¼‰'},
                        {id: 'there_is_are_review', name: '3. ã‚‚ã®ãŒã‚ã‚‹ã“ã¨ã‚„ã€äººãŒã„ã‚‹ã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆThere is [are] ~.ï¼‰'},
                        {id: 'there_is_are_transformation', name: '4. There is [are] ~. ã®æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç›®çš„èª2ã¤/æ¥ç¶šè©that',
                    grammar: [
                        {id: 'double_object', name: '1. ã€Œï¼œäººï¼ã«ï¼œã‚‚ã®ï¼ã‚’ã‚ã’ã‚‹ãƒ»é€ã‚‹ã€ãªã©ã¨è¿°ã¹ã‚‹ã¨ãï¼ˆç›®çš„èªã‚’ï¼’ã¤ã¨ã‚‹å‹•è©ï¼‰'},
                        {id: 'that_opinion', name: '2. è‡ªåˆ†ã®æ„è¦‹ã‚„çŸ¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'},
                        {id: 'that_feeling', name: '3. è‡ªåˆ†ã®æ°—æŒã¡ã¨ãã®ç†ç”±ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - éå»é€²è¡Œå½¢/æ¥ç¶šè©',
                    grammar: [
                        {id: 'past_continuous', name: '1. éå»ã®ã‚ã‚‹æ™‚ç‚¹ã§ã—ã¦ã„ãŸã“ã¨ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆéå»é€²è¡Œå½¢ï¼‰'},
                        {id: 'when_conjunction', name: '2. ã©ã‚“ãªæ™‚ã®ã“ã¨ã‹ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®whenï¼‰'},
                        {id: 'if_because', name: '3. æ¡ä»¶ã‚’è¿°ã¹ã‚‹ã¨ãã€ç†ç”±ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®ifï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - ä¸å®šè©',
                    grammar: [
                        {id: 'infinitive_noun', name: '1. ã—ãŸã„ã“ã¨ã€ãªã‚ŠãŸã„ã‚‚ã®ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆåè©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ã“ã¨ã€ï¼‰'},
                        {id: 'infinitive_adverb', name: '2. ç›®çš„ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå‰¯è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã«ã€ï¼‰'},
                        {id: 'infinitive_adjective', name: '3. ã€Œã‚‚ã®ã®ç”¨é€”ã€ä½•ã‚’ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆå½¢å®¹è©çš„ç”¨æ³•ã€Œã€œã™ã‚‹ãŸã‚ã®ã€ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - å‹•åè©',
                    grammar: [
                        {id: 'gerund_object', name: '1. ã€Œã€œã™ã‚‹ã“ã¨ã‚’çµ‚ãˆã‚‹ãƒ»æ¥½ã—ã‚€ãƒ»å¥½ã‚€ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'gerund_subject', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã€ã‚’ä¸»èªã«ã—ã¦è¿°ã¹ã‚‹ã¨ãï¼ˆå‹•åè©ï¼‰'},
                        {id: 'teach_tell_that', name: '3. ã€Œã ã‚ŒãŒã ã‚Œã«ã©ã‚“ãªã“ã¨ã‚’æ•™ãˆãŸã‹ãƒ»ä¼ãˆãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆæ¥ç¶šè©ã®thatï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä¸å®šè©ã®ç™ºå±•',
                    grammar: [
                        {id: 'how_to_what_to', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to', name: '2. ã€Œã€œã™ã‚‹ã“ã¨ã¯ãŠã‚‚ã—ã‚ã„ãƒ»é›£ã—ã„ãƒ»ä¸å¯èƒ½ã ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ãï¼ˆIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€œ.ï¼‰'},
                        {id: 'teach_ask_how_to', name: '3. ã€Œã ã‚Œã«ã€œã®ä»•æ–¹ã€ä½•ã‚’ã™ã¹ãã‹ãªã©ã‚’ä¼ãˆã‚‹ãƒ»æ•™ãˆã‚‹ãƒ»ãŸãšã­ã‚‹ã‹ã€ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - æ¯”è¼ƒ',
                    grammar: [
                        {id: 'comparative', name: '1. 2ã¤ã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ãã®é•ã„ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆæ¯”è¼ƒç´šï¼‰'},
                        {id: 'superlative', name: '2. 3ã¤ä»¥ä¸Šã®ã‚‚ã®ã‚’æ¯”ã¹ã¦ã€ã€Œã„ã¡ã°ã‚“ã€œã ã€ã¨ä¼ãˆã‚‹ã¨ãï¼ˆæœ€ä¸Šç´šï¼‰'},
                        {id: 'as_as', name: '3. ã€ŒåŒã˜ãã‚‰ã„ã€œã ã€ã€Œã„ã¡ã°ã‚“å¥½ãã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆåŸç´šãªã©ï¼‰'},
                        {id: 'comparison_rules', name: '4. æ¯”è¼ƒç´šãƒ»æœ€ä¸Šç´šã®ä½œã‚Šæ–¹'},
                        {id: 'comparison_transformation', name: '5. æ¯”è¼ƒè¡¨ç¾ã®æ›¸ãæ›ãˆ'},
                        {id: 'comparison_notes', name: '6. ãã®ä»–ã«æ³¨æ„ã™ã‚‹ã“ã¨'}
                    ]
                },
                {
                    id: 'lesson7',
                    name: 'Lesson7 - å—å‹•æ…‹',
                    grammar: [
                        {id: 'passive_voice', name: '1. ã€Œ...ã¯ã€œã•ã‚Œã‚‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã‚‹ã€ã®ã‚ˆã†ãªè¡¨ç¾ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'passive_questions', name: '2. ã€Œâ€¦ã¯ã€œã•ã‚Œã¾ã™ã‹ã€ã€Œ...ã¯ã€œã•ã‚Œã¦ã„ã¾ã™ã‹ã€ãªã©ã¨è³ªå•ã™ã‚‹ã¨ã'},
                        {id: 'passive_modal', name: '3. ã€Œã€œã•ã‚Œã‚‹ã¹ãã ã€ã€Œã€œã•ã‚Œã‚‹ã“ã¨ãŒå¯èƒ½ã ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'past_participle_rules', name: '4. éå»åˆ†è©å½¢ã®ä½œã‚Šæ–¹'},
                        {id: 'passive_transformation', name: '5. å—ã‘èº«ã®æ–‡ã®æ›¸ãæ›ãˆä¾‹'}
                    ]
                },
                {
                    id: 'lesson8',
                    name: 'Lesson8 - é–“æ¥ç–‘å•æ–‡/æ„Ÿå˜†æ–‡',
                    grammar: [
                        {id: 'indirect_questions_know', name: '1. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€ŒçŸ¥ã£ã¦ã„ã‚‹ãƒ»çŸ¥ã‚‰ãªã„ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'indirect_questions_tell', name: '2. ã€Œã„ã¤ãƒ»ã©ã“ã§ã€ãªã©ã®æƒ…å ±ã‚’ã€Œã ã‚Œã«è¨€ã£ãŸã‹ãƒ»èã„ãŸã‹ã€ãªã©ã¨è¡¨ç¾ã™ã‚‹ã¨ã'},
                        {id: 'exclamatory', name: '3. é©šãã‚„æ„Ÿå‹•ã‚’è¡¨ç¾ã™ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson9',
                    name: 'Lesson9 - å‹•è©ã®æ§˜ã€…ãªä½¿ã„æ–¹',
                    grammar: [
                        {id: 'make_call', name: '1. ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ã€Œå‘¼ã³åã¯ä½•ã‹ã€ãªã©ã‚’ä¼ãˆã‚‹ã¨ã'},
                        {id: 'want_ask_to', name: '2. äººã«ã—ã¦ã»ã—ã„ã“ã¨ã‚’ä¼ãˆãŸã‚Šé ¼ã‚“ã ã‚Šã™ã‚‹ã¨ã'},
                        {id: 'let_help', name: '3. è¨±å¯ã‚’å¾—ã‚‹ã¨ãã€ã ã‚ŒãŒæ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ã‹ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                }
            ],
            grade3: [
                {
                    id: 'review_lesson',
                    name: 'Review Lesson - 2å¹´ç”Ÿã®å¾©ç¿’',
                    grammar: [
                        {id: 'how_to_what_to_review', name: '1. ã€Œã€œã®ä»•æ–¹ã€ã‚„ã€Œã™ã¹ãã“ã¨ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'make_call_review', name: '2. ã€Œå‘¼ã³åã¯ä½•ã‹ã€ã€Œã©ã‚“ãªæ°—æŒã¡ã«ãªã£ãŸã‹ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'},
                        {id: 'it_is_to_review', name: '3. ã€Œã€œã™ã‚‹ã“ã¨ã¯é›£ã—ã„ãƒ»ã‚„ã•ã—ã„ã€ãªã©ã‚’è¿°ã¹ã‚‹ã¨ã'}
                    ]
                },
                {
                    id: 'lesson1',
                    name: 'Lesson1 - ç¾åœ¨å®Œäº†å½¢(1)',
                    grammar: [
                        {id: 'present_perfect_completion', name: '1. ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience', name: '2. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_experience_questions', name: '3. ã€Œã€œã—ãŸçµŒé¨“ãŒã‚ã‚‹ã‹ã€ã‚’è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ï¼‰'}
                    ]
                },
                {
                    id: 'lesson2',
                    name: 'Lesson2 - ç¾åœ¨å®Œäº†å½¢(2)',
                    grammar: [
                        {id: 'present_perfect_continuation', name: '1. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuation_questions', name: '2. ã€Œã©ã®ãã‚‰ã„ã€œã—ã¦ã„ã¾ã™ã‹ã€ã¨è³ªå•ã™ã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ï¼‰'},
                        {id: 'present_perfect_continuous', name: '3. ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†é€²è¡Œå½¢ï¼‰'}
                    ]
                },
                {
                    id: 'lesson3',
                    name: 'Lesson3 - å¾Œç½®ä¿®é£¾',
                    grammar: [
                        {id: 'participle_present', name: '1. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®1ï¼šç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'participle_past', name: '2. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®2ï¼šéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'relative_pronoun_omission', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆãã®3ï¼šç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'}
                    ]
                },
                {
                    id: 'lesson4',
                    name: 'Lesson4 - é–¢ä¿‚ä»£åè©',
                    grammar: [
                        {id: 'relative_pronoun_who', name: '1. ã€Œã©ã‚“ãªäººã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_which', name: '2. ã€Œã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'relative_pronoun_object', name: '3. ã€Œã©ã‚“ãªäººã‹ãƒ»ã©ã‚“ãªã‚‚ã®ã‹ã€ã‚’èª¬æ˜ã™ã‚‹ã¨ãï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'}
                    ]
                },
                {
                    id: 'lesson5',
                    name: 'Lesson5 - ä»®å®šæ³•',
                    grammar: [
                        {id: 'subjunctive_1', name: '1. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®1ï¼‰'},
                        {id: 'subjunctive_2', name: '2. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®2ï¼‰'},
                        {id: 'subjunctive_3', name: '3. å®Ÿç¾ã™ã‚‹å¯èƒ½æ€§ãŒãªã„ã€ã¾ãŸã¯å¯èƒ½æ€§ãŒä½ã„ã“ã¨ã‚’ã€Œã€œãªã‚‰ãªã‚ã€ã¨è¡¨ç¾ã™ã‚‹å ´åˆï¼ˆãã®3ï¼‰'}
                    ]
                },
                {
                    id: 'lesson6',
                    name: 'Lesson6 - å¾Œç½®ä¿®é£¾ã¨é–¢ä¿‚ä»£åè©ã®ã¾ã¨ã‚',
                    grammar: [
                        {id: 'postposition_ing', name: '1. ã€ˆåè© ï¼‹ å‹•è©ã®-ingå½¢ ï¼‹ èªå¥ã€‰ï¼ˆç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_past_participle', name: '2. ã€ˆåè© ï¼‹ å‹•è©ã®éå»åˆ†è©å½¢ ï¼‹ èªå¥ã€‰ï¼ˆéå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ï¼‰'},
                        {id: 'postposition_omission', name: '3. ã€ˆåè© ï¼‹ ä¸»èª ï¼‹ å‹•è© ã€œã€‰ï¼ˆç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ã®çœç•¥ï¼‰'},
                        {id: 'relative_summary', name: '4. ã€ˆåè© ï¼‹ é–¢ä¿‚ä»£åè©ï¼ˆwho, which, thatï¼‰ ï¼‹ èªå¥ã€‰ï¼ˆä¸»æ ¼ã®é–¢ä¿‚ä»£åè©ã¨ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ï¼‰'},
                        {id: 'sentence_transformation', name: '5. æ–‡ã®æ›¸ãæ›ãˆ'}
                    ]
                }
            ]
        };

        /* ----------------- ğŸ”§ æ‹¡å……ã•ã‚ŒãŸã‚µãƒ³ãƒ—ãƒ«å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆä¸­3å®Œå…¨å¯¾å¿œç‰ˆï¼‰ ----------------- */
        const sampleProblems = {
            grade1: {
                lesson1: {
                    word_order: [
                        {
                            jp: "ç§ã¯å­¦ç”Ÿã§ã™ã€‚",
                            en: "I am a student.",
                            explanation: "æ—¥æœ¬èªã®èªé †ã¨è‹±èªã®èªé †ã®é•ã„ã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚è‹±èªã§ã¯ã€Œä¸»èª + å‹•è©ã€ã®é †ç•ªãŒåŸºæœ¬ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å…ˆç”Ÿã§ã™ã‹ï¼Ÿ",
                            en: "Are you a teacher?",
                            explanation: "ç–‘å•æ–‡ã§ã¯å‹•è©(beå‹•è©)ãŒä¸»èªã®å‰ã«æ¥ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He is not a doctor.",
                            explanation: "å¦å®šæ–‡ã§ã¯ beå‹•è©ã®å¾Œã« not ã‚’ä»˜ã‘ã¾ã™ã€‚"
                        }
                    ],
                    sentence_types: [
                        {
                            jp: "ã“ã‚Œã¯æœ¬ã§ã™ã€‚",
                            en: "This is a book.",
                            explanation: "è‹±èªã®åŸºæœ¬æ–‡å‹ã®ä¸€ã¤ã€Œä¸»èª + beå‹•è© + è£œèªã€ã®å½¢ã§ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯è‹±èªã‚’è©±ã—ã¾ã™ã€‚",
                            en: "I speak English.",
                            explanation: "ã€Œä¸»èª + å‹•è© + ç›®çš„èªã€ã®æ–‡å‹ã§ã™ã€‚"
                        }
                    ],
                    personal_statements: [
                        {
                            jp: "ç§ã®åå‰ã¯ç”°ä¸­ã§ã™ã€‚",
                            en: "My name is Tanaka.",
                            explanation: "è‡ªå·±ç´¹ä»‹ã®åŸºæœ¬çš„ãªè¡¨ç¾ã§ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã®è¶£å‘³ã¯ä½•ã§ã™ã‹ï¼Ÿ",
                            en: "What is your hobby?",
                            explanation: "ç›¸æ‰‹ã«ã¤ã„ã¦è³ªå•ã™ã‚‹æ™‚ã®è¡¨ç¾ã§ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    she_he_it: [
                        {
                            jp: "å½¼ã¯åŒ»è€…ã§ã™ã€‚",
                            en: "He is a doctor.",
                            explanation: "ç”·æ€§ã‚’è¡¨ã™æ™‚ã¯heã‚’ä½¿ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯çœ‹è­·å¸«ã§ã™ã€‚",
                            en: "She is a nurse.",
                            explanation: "å¥³æ€§ã‚’è¡¨ã™æ™‚ã¯sheã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    general_verbs: [
                        {
                            jp: "ç§ã¯æ¯æ—¥è‹±èªã‚’å‹‰å¼·ã—ã¾ã™ã€‚",
                            en: "I study English every day.",
                            explanation: "ä¸€èˆ¬å‹•è©ã¯å‹•ä½œã‚„çŠ¶æ…‹ã‚’è¡¨ã™å‹•è©ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯é‡çƒã‚’ã—ã¾ã™ã€‚",
                            en: "He plays baseball.",
                            explanation: "ä¸‰äººç§°å˜æ•°ç¾åœ¨å½¢ã§ã¯å‹•è©ã« s ãŒä»˜ãã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade2: {
                lesson1: {
                    double_object: [
                        {
                            jp: "ç§ã¯å½¼ã«æœ¬ã‚’ã‚ã’ã¾ã—ãŸã€‚",
                            en: "I gave him a book.",
                            explanation: "ç›®çš„èªã‚’2ã¤ã¨ã‚‹å‹•è©ã§ã¯ã€Œå‹•è© + äºº + ã‚‚ã®ã€ã®é †ç•ªã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯ç§ã«æ‰‹ç´™ã‚’é€ã‚Šã¾ã—ãŸã€‚",
                            en: "She sent me a letter.",
                            explanation: "send ã¯ã€Œäººã«ã‚‚ã®ã‚’é€ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã‚ã‚Œã¾ã™ã€‚"
                        }
                    ]
                }
            },
            grade3: {
                review_lesson: {
                    how_to_what_to_review: [
                        {
                            jp: "ç§ã¯æ³³ãæ–¹ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã€‚",
                            en: "I know how to swim.",
                            explanation: "ã€Œhow to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã®ä»•æ–¹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ä½•ã‚’ã™ã¹ãã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚",
                            en: "I don't know what to do.",
                            explanation: "ã€Œwhat to + å‹•è©ã®åŸå½¢ã€ã§ã€Œä½•ã‚’ã€œã™ã¹ãã‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    make_call_review: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯ç§ã‚’æ‚²ã—ãã•ã›ã¾ã—ãŸã€‚",
                            en: "The movie made me sad.",
                            explanation: "ã€Œmake + äºº + å½¢å®¹è©ã€ã§ã€Œäººã‚’ã€œã«ã™ã‚‹ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å½¼ã‚’ãƒˆãƒ ã¨å‘¼ã³ã¾ã™ã€‚",
                            en: "We call him Tom.",
                            explanation: "ã€Œcall + äºº + åå‰ã€ã§ã€Œäººã‚’ã€œã¨å‘¼ã¶ã€ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ],
                    it_is_to_review: [
                        {
                            jp: "è‹±èªã‚’å­¦ã¶ã“ã¨ã¯æ¥½ã—ã„ã§ã™ã€‚",
                            en: "It is fun to learn English.",
                            explanation: "ã€ŒIt is + å½¢å®¹è© + to + å‹•è©ã®åŸå½¢ã€ã§ã€Œã€œã™ã‚‹ã“ã¨ã¯...ã ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ—©èµ·ãã™ã‚‹ã“ã¨ã¯å¥åº·ã«è‰¯ã„ã§ã™ã€‚",
                            en: "It is good for your health to get up early.",
                            explanation: "It ã‚’ä»®ä¸»èªã¨ã—ã¦ä½¿ã„ã€çœŸã®ä¸»èªã¯ to ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚"
                        }
                    ]
                },
                lesson1: {
                    present_perfect_completion: [
                        {
                            jp: "ç§ã¯å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã€‚",
                            en: "I have finished my homework.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ã§ã¯ã€Œhave/has + éå»åˆ†è©ã€ã§ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯ã‚‚ã†å®¶ã«å¸°ã‚Šã¾ã—ãŸã€‚",
                            en: "He has already gone home.",
                            explanation: "already ã‚’ä½¿ã£ã¦ã€Œã‚‚ã†ã€œã—ãŸã€ã“ã¨ã‚’å¼·èª¿ã§ãã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ã¯ã¾ã æ˜¼é£Ÿã‚’é£Ÿã¹ã¦ã„ã¾ã›ã‚“ã€‚",
                            en: "I haven't eaten lunch yet.",
                            explanation: "yet ã¯å¦å®šæ–‡ã§ã€Œã¾ã ã€œã—ã¦ã„ãªã„ã€ã¨ã„ã†æ„å‘³ã§ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience: [
                        {
                            jp: "ç§ã¯æ±äº¬ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "I have been to Tokyo.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ã§ã€Œã€œã—ãŸã“ã¨ãŒã‚ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯å¯Œå£«å±±ã‚’è¦‹ãŸã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
                            en: "He has never seen Mt. Fuji.",
                            explanation: "never ã‚’ä½¿ã£ã¦ã€Œä¸€åº¦ã‚‚ã€œã—ãŸã“ã¨ãŒãªã„ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãªãŸã¯å¯¿å¸ã‚’é£Ÿã¹ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "Have you ever eaten sushi?",
                            explanation: "ever ã‚’ä½¿ã£ã¦çµŒé¨“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã‚’ä½œã‚Šã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_experience_questions: [
                        {
                            jp: "ã‚ãªãŸã¯ä½•å›æ—¥æœ¬ã«æ¥ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                            en: "How many times have you been to Japan?",
                            explanation: "ã€ŒHow many times + ç¾åœ¨å®Œäº†å½¢ã€ã§å›æ•°ã‚’å°‹ã­ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãƒ”ã‚¢ãƒã‚’å¼¾ã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you been playing the piano?",
                            explanation: "ç¶™ç¶šç”¨æ³•ã§æœŸé–“ã‚’å°‹ã­ã‚‹æ™‚ã¯ How long ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson2: {
                    present_perfect_continuation: [
                        {
                            jp: "ç§ã¯3å¹´é–“è‹±èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚",
                            en: "I have studied English for three years.",
                            explanation: "ç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ã§ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœˆæ›œæ—¥ã‹ã‚‰ãšã£ã¨ç—…æ°—ã§ã™ã€‚",
                            en: "He has been sick since Monday.",
                            explanation: "since ã¯ã€Œã€œã‹ã‚‰ã€ã¨ã„ã†èµ·ç‚¹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ç§ãŸã¡ã¯å­ä¾›ã®é ƒã‹ã‚‰ã®å‹é”ã§ã™ã€‚",
                            en: "We have been friends since we were children.",
                            explanation: "çŠ¶æ…‹ã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†å½¢ã§ã™ã€‚"
                        }
                    ],
                    present_perfect_continuation_questions: [
                        {
                            jp: "ã©ã®ãã‚‰ã„é•·ãæ—¥æœ¬ã«ä½ã‚“ã§ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "How long have you lived in Japan?",
                            explanation: "ç¶™ç¶šæœŸé–“ã‚’å°‹ã­ã‚‹ç–‘å•æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "ã„ã¤ã‹ã‚‰ãã®ä¼šç¤¾ã§åƒã„ã¦ã„ã‚‹ã®ã§ã™ã‹ï¼Ÿ",
                            en: "How long have you worked for that company?",
                            explanation: "work ã¯ç¶™ç¶šã‚’è¡¨ã™å‹•è©ã¨ã—ã¦ä½¿ãˆã¾ã™ã€‚"
                        }
                    ],
                    present_perfect_continuous: [
                        {
                            jp: "é›¨ãŒ2æ™‚é–“é™ã‚Šç¶šã„ã¦ã„ã¾ã™ã€‚",
                            en: "It has been raining for two hours.",
                            explanation: "ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’å¼·èª¿ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ã¯æœã‹ã‚‰ãšã£ã¨åƒã„ã¦ã„ã¾ã™ã€‚",
                            en: "He has been working since this morning.",
                            explanation: "å‹•ä½œã®ç¶™ç¶šã‚’è¡¨ã™ç¾åœ¨å®Œäº†é€²è¡Œå½¢ã§ã™ã€‚"
                        }
                    ]
                },
                lesson3: {
                    participle_present: [
                        {
                            jp: "èµ°ã£ã¦ã„ã‚‹å°‘å¹´ã¯ç§ã®å¼Ÿã§ã™ã€‚",
                            en: "The boy running is my brother.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã€Œã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚ãã“ã§æ­Œã£ã¦ã„ã‚‹å¥³ã®å­ã‚’çŸ¥ã£ã¦ã„ã¾ã™ã‹ï¼Ÿ",
                            en: "Do you know the girl singing over there?",
                            explanation: "ç¾åœ¨åˆ†è©ãŒåè©ã‚’å¾Œã‚ã‹ã‚‰ä¿®é£¾ã—ã¦ã„ã¾ã™ã€‚"
                        }
                    ],
                    participle_past: [
                        {
                            jp: "æ—¥æœ¬ã§ä½œã‚‰ã‚ŒãŸè»Šã¯äººæ°—ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "Cars made in Japan are popular.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—ã‘èº«ã®æ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å£Šã‚ŒãŸçª“ã‚’ä¿®ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                            en: "We need to repair the broken window.",
                            explanation: "éå»åˆ†è©ãŒåè©ã‚’ä¿®é£¾ã—ã¦çŠ¶æ…‹ã‚’è¡¨ã—ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_omission: [
                        {
                            jp: "ç§ãŒæ˜¨æ—¥èª­ã‚“ã æœ¬ã¯ã¨ã¦ã‚‚é¢ç™½ã‹ã£ãŸã§ã™ã€‚",
                            en: "The book I read yesterday was very interesting.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© which/that ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè©±ã—ã¦ã„ãŸäººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person he was talking to is my teacher.",
                            explanation: "å‰ç½®è©ã®ç›®çš„èªã«ãªã‚‹é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson4: {
                    relative_pronoun_who: [
                        {
                            jp: "è‹±èªã‚’æ•™ãˆã‚‹äººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                            en: "The person who teaches English is my teacher.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "æ˜¨æ—¥æ¥ãŸå­¦ç”ŸãŸã¡ã¯ä¸­å›½ã‹ã‚‰æ¥ã¾ã—ãŸã€‚",
                            en: "The students who came yesterday are from China.",
                            explanation: "è¤‡æ•°ã®äººã‚’å…ˆè¡Œè©ã¨ã™ã‚‹å ´åˆã‚‚ who ã‚’ä½¿ã„ã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_which: [
                        {
                            jp: "æœºã®ä¸Šã«ã‚ã‚‹æœ¬ã¯ç§ã®ã‚‚ã®ã§ã™ã€‚",
                            en: "The book which is on the desk is mine.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© which ã¯ç‰©ã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè²·ã£ãŸè»Šã¯èµ¤ã„ã§ã™ã€‚",
                            en: "The car which he bought is red.",
                            explanation: "which ã¯ that ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚"
                        }
                    ],
                    relative_pronoun_object: [
                        {
                            jp: "ç§ãŒä¼šã£ãŸäººã¯ã¨ã¦ã‚‚è¦ªåˆ‡ã§ã—ãŸã€‚",
                            en: "The person whom I met was very kind.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© whom ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¾ã™ï¼ˆwho ã‚‚å¯ï¼‰ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ãŒä½œã£ãŸæ–™ç†ã¯ãŠã„ã—ã‹ã£ãŸã§ã™ã€‚",
                            en: "The food that she cooked was delicious.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã¯äººãƒ»ç‰©ä¸¡æ–¹ã«ä½¿ãˆã¾ã™ã€‚"
                        }
                    ]
                },
                lesson5: {
                    subjunctive_1: [
                        {
                            jp: "ã‚‚ã—ãŠé‡‘ãŒã‚ã£ãŸã‚‰ã€æ–°ã—ã„è»Šã‚’è²·ã†ã®ã«ã€‚",
                            en: "If I had money, I would buy a new car.",
                            explanation: "ä»®å®šæ³•éå»ã§ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ™‚é–“ãŒã‚ã£ãŸã‚‰ã€ã‚ãªãŸã¨è©±ã™ã®ã«ã€‚",
                            en: "If I had time, I would talk with you.",
                            explanation: "ç¾åœ¨ã®äº‹å®Ÿã«åã™ã‚‹é¡˜æœ›ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_2: [
                        {
                            jp: "ã‚‚ã—æ˜¨æ—¥å‹‰å¼·ã—ã¦ã„ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã«åˆæ ¼ã—ã¦ã„ãŸã ã‚ã†ã€‚",
                            en: "If I had studied yesterday, I would have passed the test.",
                            explanation: "ä»®å®šæ³•éå»å®Œäº†ã§éå»ã®äº‹å®Ÿã«åã™ã‚‹ä»®å®šã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "ã‚‚ã—æ—©ãå‡ºç™ºã—ã¦ã„ãŸã‚‰ã€é…åˆ»ã—ãªã‹ã£ãŸã ã‚ã†ã€‚",
                            en: "If we had left earlier, we wouldn't have been late.",
                            explanation: "éå»ã®äº‹å®Ÿã«åã™ã‚‹å¾Œæ‚”ã‚„ä»®å®šã‚’è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ],
                    subjunctive_3: [
                        {
                            jp: "å½¼ãŒãã“ã«ã„ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish he were there.",
                            explanation: "wish + ä»®å®šæ³•ã§å®Ÿç¾å›°é›£ãªé¡˜æœ›ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "é›¨ãŒé™ã‚‰ãªã‘ã‚Œã°ã„ã„ã®ã«ã€‚",
                            en: "I wish it wouldn't rain.",
                            explanation: "æœªæ¥ã¸ã®é¡˜æœ›ã‚’ wish + would ã§è¡¨ç¾ã—ã¾ã™ã€‚"
                        }
                    ]
                },
                lesson6: {
                    postposition_ing: [
                        {
                            jp: "å…¬åœ’ã§éŠã‚“ã§ã„ã‚‹å­ä¾›ãŸã¡ã¯å…ƒæ°—ã§ã™ã€‚",
                            en: "The children playing in the park are energetic.",
                            explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ç¶™ç¶šçš„ãªå‹•ä½œã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "å›³æ›¸é¤¨ã§å‹‰å¼·ã—ã¦ã„ã‚‹å­¦ç”Ÿã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "I saw students studying in the library.",
                            explanation: "å ´æ‰€ã‚’å«ã‚€ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_past_participle: [
                        {
                            jp: "ãƒ•ãƒ©ãƒ³ã‚¹ã§ä½œã‚‰ã‚ŒãŸãƒ¯ã‚¤ãƒ³ã¯æœ‰åã§ã™ã€‚",
                            en: "Wine made in France is famous.",
                            explanation: "éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§å—å‹•çš„ãªæ„å‘³ã‚’è¡¨ã—ã¾ã™ã€‚"
                        },
                        {
                            jp: "10å¹´å‰ã«å»ºã¦ã‚‰ã‚ŒãŸå»ºç‰©ã¯å¤ãè¦‹ãˆã¾ã™ã€‚",
                            en: "The building built ten years ago looks old.",
                            explanation: "æ™‚ã‚’å«ã‚€éå»åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        }
                    ],
                    postposition_omission: [
                        {
                            jp: "ç§ãŒè²·ã£ãŸèŠ±ã¯ã¨ã¦ã‚‚ç¾ã—ã„ã§ã™ã€‚",
                            en: "The flowers I bought are very beautiful.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè©ãŒçœç•¥ã•ã‚ŒãŸå¾Œç½®ä¿®é£¾ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒè¨€ã£ãŸã“ã¨ã¯æœ¬å½“ã§ã—ãŸã€‚",
                            en: "What he said was true.",
                            explanation: "é–¢ä¿‚ä»£åè©ã®çœç•¥ã«ã‚ˆã‚‹ç°¡æ½”ãªè¡¨ç¾ã§ã™ã€‚"
                        }
                    ],
                    relative_summary: [
                        {
                            jp: "ãã“ã§åƒã„ã¦ã„ã‚‹äººã¯ç§ã®å‹é”ã§ã™ã€‚",
                            en: "The person who works there is my friend.",
                            explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼ãŒèª­ã‚“ã§ã„ã‚‹æœ¬ã¯é›£ã—ãã†ã§ã™ã€‚",
                            en: "The book that he is reading looks difficult.",
                            explanation: "ç›®çš„æ ¼ã®é–¢ä¿‚ä»£åè© that ã«ã‚ˆã‚‹ä¿®é£¾æ–‡ã§ã™ã€‚"
                        }
                    ],
                    sentence_transformation: [
                        {
                            jp: "ãã®æ˜ ç”»ã¯é¢ç™½ã‹ã£ãŸã§ã™ã€‚ç§ã¯ãã®æ˜ ç”»ã‚’è¦‹ã¾ã—ãŸã€‚",
                            en: "The movie that I watched was interesting.",
                            explanation: "2ã¤ã®æ–‡ã‚’é–¢ä¿‚ä»£åè©ã§1ã¤ã«ã¾ã¨ã‚ãŸä¾‹ã§ã™ã€‚"
                        },
                        {
                            jp: "å½¼å¥³ã¯è¦ªåˆ‡ãªäººã§ã™ã€‚å½¼å¥³ã¯ç§ã‚’åŠ©ã‘ã¦ãã‚Œã¾ã—ãŸã€‚",
                            en: "She is a kind person who helped me.",
                            explanation: "é–¢ä¿‚ä»£åè©ã‚’ä½¿ã£ãŸæ–‡ã®æ›¸ãæ›ãˆä¾‹ã§ã™ã€‚"
                        }
                    ]
                }
            }
        };

        /* ----------------- ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆåŠ¹æœéŸ³ã€éŸ³å£°åˆæˆç­‰ï¼‰ ----------------- */
        class SoundSystem {
            constructor() {
                this.audioContext = null;
                this.initAudio();
            }
            initAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                }
            }
            playClick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(660, 0.08, 0.15);
                } catch (e) {
                    console.log('ã‚¯ãƒªãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playStudyComplete() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(440, 0.25, 0.2);
                } catch (e) {
                    console.log('å®Œäº†éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playSuccess() {
                if (!this.audioContext) return;
                try {
                    this.createSoftTone(523, 0.15, 0.18);
                } catch (e) {
                    console.log('æˆåŠŸéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTick() {
                if (!this.audioContext) return;
                try {
                    this.createBell(800, 0.05, 0.1);
                } catch (e) {
                    console.log('ãƒãƒƒã‚¯éŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            playTimeUp() {
                if (!this.audioContext) return;
                try {
                    this.createWarmTone(220, 0.4, 0.3);
                } catch (e) {
                    console.log('æ™‚é–“åˆ‡ã‚ŒéŸ³ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            }
            createBell(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createSoftTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'triangle';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            createWarmTone(frequency, duration, volume = 0.2) {
                if (!this.audioContext) return;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = 'square';
                gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, this.audioContext.currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.001, this.audioContext.currentTime + duration);
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
        }

        // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰
        class VoiceSystem {
            constructor() {
                this.synth = null;
                this.voices = [];
                this.selectedVoice = null;
                this.isEnabled = true;
                this.deviceType = this.detectDevice();
                this.currentMaleVoice = null;
                this.currentFemaleVoice = null;
                
                try {
                    if ('speechSynthesis' in window) {
                        this.synth = window.speechSynthesis;
                        this.initializeVoices();
                    } else {
                        console.log('éŸ³å£°åˆæˆãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    }
                } catch (e) {
                    console.log('éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            // ğŸ”§ éŸ³å£°åˆæœŸåŒ–ã®æ”¹å–„
            initializeVoices() {
                this.loadVoices();
                
                // éŸ³å£°èª­ã¿è¾¼ã¿å®Œäº†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = () => {
                        this.loadVoices();
                    };
                }
            }

            loadVoices() {
                this.voices = speechSynthesis.getVoices();
                if (this.voices.length > 0) {
                    this.setDeviceRecommendedVoices();
                    this.loadSettings();
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡ºï¼ˆæ‹¡å¼µç‰ˆãƒ»ç¢ºå®Ÿãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
            detectDevice() {
                const userAgent = navigator.userAgent.toLowerCase();
                const platform = navigator.platform.toLowerCase();
                
                console.log('ğŸ” ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º:', { userAgent, platform });
                
                if (/iphone|ipad|ipod/.test(userAgent) || platform.includes('mac')) {
                    return 'apple';
                } else if (/android/.test(userAgent)) {
                    return 'android';
                } else if (/windows/.test(userAgent) || platform.includes('win')) {
                    return 'windows';
                } else if (/linux/.test(userAgent) || platform.includes('linux')) {
                    return 'linux';
                } else if (/chrome/.test(userAgent)) {
                    return 'chrome';
                } else {
                    return 'other';
                }
            }

            // ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨éŸ³å£°è¨­å®šï¼ˆå¼·åŒ–ç‰ˆãƒ»ç¢ºå®Ÿå‹•ä½œï¼‰
            setDeviceRecommendedVoices() {
                console.log('ğŸ¯ éŸ³å£°è¨­å®šé–‹å§‹ - ãƒ‡ãƒã‚¤ã‚¹:', this.deviceType, 'éŸ³å£°æ•°:', this.voices.length);
                
                // åˆ©ç”¨å¯èƒ½ãªå…¨éŸ³å£°ã‚’ãƒ­ã‚°å‡ºåŠ›
                this.voices.forEach((voice, index) => {
                    console.log(`éŸ³å£°${index + 1}:`, voice.name, voice.lang);
                });
                
                // ç”·æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentMaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('male') || 
                           name.includes('man') || 
                           name.includes('alex') || 
                           name.includes('david') || 
                           name.includes('daniel') || 
                           name.includes('mark') || 
                           name.includes('tom') ||
                           name.includes('aaron') ||
                           name.includes('arthur') ||
                           name.includes('george');
                });
                
                // å¥³æ€§éŸ³å£°ã®æ¤œå‡ºï¼ˆã‚ˆã‚Šåºƒç¯„å›²ã«ï¼‰
                this.currentFemaleVoice = this.voices.find(voice => {
                    const name = voice.name.toLowerCase();
                    return name.includes('female') || 
                           name.includes('woman') || 
                           name.includes('samantha') || 
                           name.includes('zira') || 
                           name.includes('victoria') || 
                           name.includes('karen') || 
                           name.includes('susan') ||
                           name.includes('allison') ||
                           name.includes('ava') ||
                           name.includes('hazel') ||
                           name.includes('helen');
                });
                
                // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼šæ€§åˆ¥ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                if (!this.currentMaleVoice && this.voices.length > 0) {
                    // æœ€åˆã®éŸ³å£°ã‚’ç”·æ€§ã¨ã—ã¦ä½¿ç”¨
                    this.currentMaleVoice = this.voices[0];
                    console.log('âš ï¸ ç”·æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentMaleVoice.name);
                }
                
                if (!this.currentFemaleVoice && this.voices.length > 1) {
                    // 2ç•ªç›®ã®éŸ³å£°ã‚’å¥³æ€§ã¨ã—ã¦ä½¿ç”¨ï¼ˆ1ç•ªç›®ã¨é•ã†éŸ³å£°ï¼‰
                    this.currentFemaleVoice = this.voices[1];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯:', this.currentFemaleVoice.name);
                } else if (!this.currentFemaleVoice && this.voices.length === 1) {
                    // 1ã¤ã—ã‹ãªã„å ´åˆã¯åŒã˜éŸ³å£°ã‚’ä½¿ç”¨
                    this.currentFemaleVoice = this.voices[0];
                    console.log('âš ï¸ å¥³æ€§éŸ³å£°ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€åŒã˜éŸ³å£°ã‚’ä½¿ç”¨:', this.currentFemaleVoice.name);
                }
                
                console.log('ğŸ¤ æœ€çµ‚é¸æŠéŸ³å£°:', {
                    device: this.deviceType,
                    male: this.currentMaleVoice?.name || 'ãªã—',
                    female: this.currentFemaleVoice?.name || 'ãªã—',
                    totalVoices: this.voices.length
                });
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéŸ³å£°è¨­å®š
                if (!this.selectedVoice) {
                    this.selectedVoice = this.currentFemaleVoice || this.currentMaleVoice || this.voices[0];
                }
            }

            // ğŸ”§ éŸ³å£°é¸æŠï¼ˆç”·æ€§/å¥³æ€§ï¼‰
            selectGenderVoice(gender) {
                let targetVoice = null;
                
                if (gender === 'male') {
                    targetVoice = this.currentMaleVoice;
                } else if (gender === 'female') {
                    targetVoice = this.currentFemaleVoice;
                }
                
                if (targetVoice) {
                    this.selectedVoice = targetVoice;
                    this.saveSettings();
                    this.updateVoiceSelectionUI(gender);
                    console.log(`ğŸ¤ éŸ³å£°é¸æŠ: ${gender} - ${targetVoice.name}`);
                    return true;
                }
                return false;
            }

            updateVoiceSelectionUI(selectedGender) {
                document.querySelectorAll('.voice-choice-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                
                const targetBtn = document.querySelector(`[data-voice-gender="${selectedGender}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('selected');
                }
            }

            // ğŸ”§ éŸ³å£°ãƒ†ã‚¹ãƒˆ
            testVoice(gender) {
                const testTexts = {
                    male: "Hello! I am the male voice for your English learning. I will help you practice pronunciation clearly and confidently.",
                    female: "Hi there! I am the female voice for your English learning. Let me help you improve your pronunciation with clear and natural speech."
                };
                
                if (gender === 'male' && this.currentMaleVoice) {
                    this.testSpecificVoice(this.currentMaleVoice, testTexts.male);
                } else if (gender === 'female' && this.currentFemaleVoice) {
                    this.testSpecificVoice(this.currentFemaleVoice, testTexts.female);
                }
            }

            testSpecificVoice(voice, text) {
                try {
                    this.synth.cancel();
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.voice = voice;
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.8;
                    
                    console.log(`ğŸ”Š éŸ³å£°ãƒ†ã‚¹ãƒˆ: ${voice.name}`);
                    this.synth.speak(utterance);
                } catch (e) {
                    console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            speak(text) {
                if (!this.isEnabled || !text.trim() || !this.synth) return;
                
                try {
                    this.synth.cancel();
                    
                    const cleanText = this.cleanEnglishText(text);
                    const utterance = new SpeechSynthesisUtterance(cleanText);
                    
                    if (this.selectedVoice) {
                        utterance.voice = this.selectedVoice;
                    }
                    
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    utterance.volume = 0.85;
                    
                    this.synth.speak(utterance);
                    return utterance;
                    
                } catch (e) {
                    console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            cleanEnglishText(text) {
                return text
                    .replace(/[^\w\s.!?',\-]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
            }

            setEnabled(enabled) {
                this.isEnabled = enabled;
                this.saveSettings();
                
                if (!enabled && this.synth) {
                    try {
                        this.synth.cancel();
                    } catch (e) {
                        console.log('éŸ³å£°åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                    }
                }
            }

            saveSettings() {
                try {
                    const settings = {
                        voiceName: this.selectedVoice ? this.selectedVoice.name : null,
                        isEnabled: this.isEnabled,
                        deviceType: this.deviceType
                    };
                    localStorage.setItem('oneWorldQuizVoiceSettings', JSON.stringify(settings));
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            loadSettings() {
                try {
                    const saved = localStorage.getItem('oneWorldQuizVoiceSettings');
                    if (saved) {
                        const settings = JSON.parse(saved);
                        this.isEnabled = settings.isEnabled !== false;
                        
                        if (settings.voiceName && this.voices.length > 0) {
                            const savedVoice = this.voices.find(v => v.name === settings.voiceName);
                            if (savedVoice) {
                                this.selectedVoice = savedVoice;
                                // UIæ›´æ–°
                                const gender = (savedVoice === this.currentMaleVoice) ? 'male' : 'female';
                                this.updateVoiceSelectionUI(gender);
                            }
                        }
                    }
                } catch (e) {
                    console.log('éŸ³å£°è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
                }
            }

            getSelectedVoiceName() {
                return this.selectedVoice ? this.selectedVoice.name : 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ';
            }

            getDeviceInfo() {
                const deviceNames = {
                    apple: 'iPhoneãƒ»iPadãƒ»Mac',
                    android: 'Android',
                    windows: 'Windows',
                    linux: 'Linux',
                    chrome: 'Chrome OS',
                    other: 'ãã®ä»–'
                };
                
                return {
                    type: this.deviceType,
                    typeName: deviceNames[this.deviceType] || 'ãã®ä»–',
                    totalVoices: this.voices.length,
                    maleVoice: this.currentMaleVoice?.name || 'ãªã—',
                    femaleVoice: this.currentFemaleVoice?.name || 'ãªã—',
                    selectedVoice: this.selectedVoice?.name || 'ãªã—'
                };
            }
        }

        let soundSystem, voiceSystem;
        try {
            soundSystem = new SoundSystem();
            voiceSystem = new VoiceSystem(); } catch (e) { console.log('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ'); soundSystem = { playClick: () => {}, playStudyComplete: () => {}, playSuccess: () => {}, playTick: () => {}, playTimeUp: () => {} }; voiceSystem = { speak: () => {}, selectGenderVoice: () => false, testVoice: () => {}, setEnabled: () => {}, isEnabled: true }; }

/* ----------------- ã‚²ãƒ¼ãƒ å¤‰æ•° ----------------- */
    let selectedGrammarItems = [];
    let selectedLessons = [];
    let currentQuestionIndex = 0;
    let studyCount = 0;
    let sessionClickCount = 0;
    let usedQuestions = [];
    let particleOffset = 0;
    let currentGrade = '';
    let currentLesson = '';
    let questionMode = 'random';
    let sequentialIndex = 0;
    let questionDirection = 'jp_to_en';
    let timerLimit = 3;
    let timerInterval = null;
    let currentTimerValue = 0;
    let isTimerRunning = false;
    let isQuizAnswered = false;
    let allQuestions = [];
    let currentScreen = 'main';

    /* ----------------- ã‚¯ãƒªãƒƒã‚¯æ•°ç®¡ç†æ©Ÿèƒ½ ----------------- */
    let clickStats = { total: 0, daily: {} };

    function getTodayDateString() {
        const today = new Date();
        return today.getFullYear() + '-' + 
               String(today.getMonth() + 1).padStart(2, '0') + '-' + 
               String(today.getDate()).padStart(2, '0');
    }

    function incrementClickCount() {
        const today = getTodayDateString();
        
        clickStats.total++;
        sessionClickCount++;
        
        if (!clickStats.daily[today]) {
            clickStats.daily[today] = 0;
        }
        clickStats.daily[today]++;
        
        updateClickDisplays();
        saveClickStats();
        
        if (clickStats.total % 10 === 0) {
            createParticle('âœ¨', '#a584c7', window.innerWidth / 2, window.innerHeight / 2);
        }
        
        if (clickStats.total % 100 === 0) {
            soundSystem.playSuccess();
            createParticle('ğŸ†', '#f4a261', window.innerWidth / 2, window.innerHeight / 2);
        }
        
        return true;
    }

    function updateClickDisplays() {
        try {
            const today = getTodayDateString();
            const todayClicks = clickStats.daily[today] || 0;
            
            const headerTotalElement = document.getElementById('footerTotalClick');
            const headerTodayElement = document.getElementById('footerTodayClick');
            const sessionElement = document.getElementById('clickCount');
            
            if (headerTotalElement) {
                headerTotalElement.textContent = clickStats.total;
            }
            if (headerTodayElement) {
                headerTodayElement.textContent = todayClicks;
            }
            if (sessionElement) {
                sessionElement.textContent = sessionClickCount;
            }
            
        } catch (e) {
            console.log('ã‚¯ãƒªãƒƒã‚¯è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function saveClickStats() {
        try {
            localStorage.setItem('oneWorldQuizClickStats', JSON.stringify(clickStats));
        } catch (e) {
            console.log('ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function loadClickStats() {
        try {
            const saved = localStorage.getItem('oneWorldQuizClickStats');
            if (saved) {
                clickStats = JSON.parse(saved);
                updateClickDisplays();
            }
        } catch (e) {
            console.log('ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            clickStats = { total: 0, daily: {} };
        }
    }

    function confirmResetTotal() {
        if (confirm('ğŸ† ç·ã‚¯ãƒªãƒƒã‚¯æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) {
            clickStats.total = 0;
            saveClickStats();
            updateClickDisplays();
            soundSystem.playClick();
        }
    }

    function confirmResetToday() {
        if (confirm('ğŸ“… ä»Šæ—¥ã®ã‚¯ãƒªãƒƒã‚¯æ•°ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) {
            const today = getTodayDateString();
            clickStats.daily[today] = 0;
            saveClickStats();
            updateClickDisplays();
            soundSystem.playClick();
        }
    }

    /* ----------------- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆé–¢æ•°ï¼ˆé€šçŸ¥å‰Šé™¤ï¼‰ ----------------- */
    function createParticle(text, color, x, y) {
        try {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = text;
            particle.style.color = color;
            particle.style.left = (x + particleOffset) + 'px';
            particle.style.top = (y + particleOffset) + 'px';
            particle.style.fontSize = '20px';
            document.body.appendChild(particle);

            particleOffset += 40;
            if (particleOffset > 160) particleOffset = 0;

            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 2500);
        } catch (e) {
            console.log('ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- ç”»é¢é·ç§»é–¢æ•° ----------------- */
    function updateBackButton() {
        const backBtn = document.getElementById('footerBackBtn');
        const homeBtn = document.getElementById('footerHomeBtn');
        
        if (currentScreen === 'main') {
            backBtn.style.opacity = '0.5';
            backBtn.style.pointerEvents = 'none';
            homeBtn.style.opacity = '0.5';
            homeBtn.style.pointerEvents = 'none';
        } else {
            backBtn.style.opacity = '1';
            backBtn.style.pointerEvents = 'auto';
            homeBtn.style.opacity = '1';
            homeBtn.style.pointerEvents = 'auto';
        }
    }

    function hideAllModals() {
        try {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
        } catch (e) {
            console.log('ãƒ¢ãƒ¼ãƒ€ãƒ«éè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function goBackToMain() {
        try {
            hideAllModals();
            const gameScreen = document.getElementById('gameScreen');
            if (gameScreen) {
                gameScreen.classList.add('hidden');
            }
            const mainModal = document.getElementById('mainGradeModal');
            if (mainModal) {
                mainModal.classList.add('show');
            }
            currentScreen = 'main';
            updateBackButton();
            soundSystem.playClick();
            currentGrade = '';
            
            resetLessonSelections();
            selectedLessons = [];
            selectedGrammarItems = [];
            
        } catch (e) {
            console.log('ãƒ¡ã‚¤ãƒ³ç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function resetLessonSelections() {
        try {
            ['grade1', 'grade2', 'grade3'].forEach(grade => {
                const container = document.getElementById(`${grade}Lessons`);
                if (container) {
                    container.querySelectorAll('.lesson-btn').forEach(btn => {
                        btn.classList.remove('selected');
                    });
                }
                
                const gradeNum = grade.replace('grade', '');
                const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
                if (startButton) {
                    startButton.style.display = 'none';
                    startButton.disabled = true;
                }
            });
        } catch (e) {
            console.log('ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
        }
    }

    function goBackToGrade(grade) {
        try {
            hideAllModals();
            const gradeModal = document.getElementById(`${grade}Modal`);
            if (gradeModal) {
                gradeModal.classList.add('show');
            }
            currentScreen = 'grade';
            updateBackButton();
            soundSystem.playClick();
            selectedGrammarItems = [];
        } catch (e) {
            console.log('å­¦å¹´ç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function goBackToGameSettings() {
        try {
            hideAllModals();
            const gameScreen = document.getElementById('gameScreen');
            if (gameScreen) {
                gameScreen.classList.remove('hidden');
            }
            currentScreen = 'game';
            updateBackButton();
            soundSystem.playClick();
            
            resetQuizState();
            
        } catch (e) {
            console.log('ã‚²ãƒ¼ãƒ è¨­å®šç”»é¢ã¸ã®é·ç§»ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function resetQuizState() {
        try {
            usedQuestions = [];
            currentQuestionIndex = 0;
            sequentialIndex = 0;
            isQuizAnswered = false;
            
            stopTimer();
        } catch (e) {
            console.log('ã‚¯ã‚¤ã‚ºçŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
        }
    }

    function goBack() {
        try {
            incrementClickCount();
            soundSystem.playClick();
            
            if (currentScreen === 'quiz') {
                goBackToGameSettings();
            } else if (currentScreen === 'game') {
                goBackToGrade(currentGrade);
            } else if (currentScreen === 'grammar') {
                goBackToGrade(currentGrade);
            } else if (currentScreen === 'grade') {
                goBackToMain();
            } else if (currentScreen === 'voice') {
                closeVoiceSettings();
            } else {
                goBackToMain();
            }
        } catch (e) {
            console.log('æˆ»ã‚‹å‹•ä½œã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- ğŸ”§ éŸ³å£°æ©Ÿèƒ½é–¢æ•°ï¼ˆå…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œãƒ»ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰ ----------------- */
function openVoiceSettings() { try { // éŸ³å£°ã‚’å¼·åˆ¶çš„ã«å†èª­ã¿è¾¼ã¿ setTimeout(() => { voiceSystem.loadVoices(); // å°‘ã—å¾…ã£ã¦ã‹ã‚‰UIæ›´æ–° setTimeout(() => { generateCompactDeviceRecommendations(); }, 500); }, 100);

    const modal = document.getElementById('voiceSettingsModal');
    const enabledCheckbox = document.getElementById('voiceEnabled');
    const toggleDescription = document.getElementById('voiceToggleDescription');
    
    if (enabledCheckbox && toggleDescription) {
        enabledCheckbox.checked = voiceSystem.isEnabled;
        toggleDescription.textContent = voiceSystem.isEnabled ? 'éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™' : 'éŸ³å£°æ©Ÿèƒ½ãŒç„¡åŠ¹ã§ã™';
    }
    
    // ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨UIç”Ÿæˆï¼ˆã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆï¼‰
    generateCompactDeviceRecommendations();
    
    currentScreen = 'voice';
    updateBackButton();
    
    if (modal) {
        modal.classList.add('show');
    }
    
    console.log('éŸ³å£°è¨­å®šç”»é¢è¡¨ç¤º - ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±:', voiceSystem.getDeviceInfo());
    
} catch (e) {
    console.log('éŸ³å£°è¨­å®šç”»é¢ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
}
}

// ğŸ”§ ãƒ‡ãƒã‚¤ã‚¹åˆ¥æ¨å¥¨UIç”Ÿæˆï¼ˆå®Œå…¨ç‰ˆãƒ»å…¨ãƒ‡ãƒã‚¤ã‚¹å¯¾å¿œï¼‰ function generateCompactDeviceRecommendations() { const container = document.getElementById('deviceRecommendations'); if (!container) return;

// éŸ³å£°ã‚’å¼·åˆ¶çš„ã«å†èª­ã¿è¾¼ã¿
voiceSystem.loadVoices();

const deviceInfo = voiceSystem.getDeviceInfo();
const allVoices = voiceSystem.voices;

console.log('ğŸ¤ UIç”Ÿæˆæ™‚ã®éŸ³å£°æƒ…å ±:', {
    deviceType: deviceInfo.type,
    voiceCount: allVoices.length,
    maleVoice: voiceSystem.currentMaleVoice?.name,
    femaleVoice: voiceSystem.currentFemaleVoice?.name
});

const deviceData = {
    apple: { emoji: 'ğŸ“±', name: 'iPhoneãƒ»iPadãƒ»Mac' },
    android: { emoji: 'ğŸ¤–', name: 'Android' },
    windows: { emoji: 'ğŸ’»', name: 'Windows' },
    linux: { emoji: 'ğŸ§', name: 'Linux' },
    chrome: { emoji: 'ğŸŒ', name: 'Chrome OS' },
    other: { emoji: 'ğŸ–¥ï¸', name: 'ãã®ä»–ã®ãƒ‡ãƒã‚¤ã‚¹' }
};

const currentDevice = deviceData[deviceInfo.type] || deviceData.other;

// éŸ³å£°æƒ…å ±ã®æº–å‚™
let maleVoiceText = 'åˆ©ç”¨å¯èƒ½';
let femaleVoiceText = 'åˆ©ç”¨å¯èƒ½';

if (voiceSystem.currentMaleVoice) {
    maleVoiceText = voiceSystem.currentMaleVoice.name.length > 18 
        ? voiceSystem.currentMaleVoice.name.substring(0, 18) + '...'
        : voiceSystem.currentMaleVoice.name;
} else if (allVoices.length > 0) {
    maleVoiceText = 'è‡ªå‹•é¸æŠ';
} else {
    maleVoiceText = 'ãªã—';
}

if (voiceSystem.currentFemaleVoice) {
    femaleVoiceText = voiceSystem.currentFemaleVoice.name.length > 18
        ? voiceSystem.currentFemaleVoice.name.substring(0, 18) + '...'
        : voiceSystem.currentFemaleVoice.name;
} else if (allVoices.length > 0) {
    femaleVoiceText = 'è‡ªå‹•é¸æŠ';
} else {
    femaleVoiceText = 'ãªã—';
}

container.innerHTML = `
    <div class="device-section">
        <div class="device-title">
            ${currentDevice.emoji} ${currentDevice.name}ã®éŸ³å£°é¸æŠ
        </div>
        <div class="device-description">
            ã‚ãªãŸã®ãƒ‡ãƒã‚¤ã‚¹ã§åˆ©ç”¨å¯èƒ½ãª ${allVoices.length} å€‹ã®éŸ³å£°ã‹ã‚‰æœ€é©ãªã‚‚ã®ã‚’é¸æŠã—ã¾ã—ãŸã€‚
        </div>
        <div class="voice-choice-grid">
            <div class="voice-choice-btn" data-voice-gender="male" onclick="selectAndTestVoice('male')" ${allVoices.length === 0 ? 'style="opacity: 0.5; pointer-events: none;"' : ''}>
                <div class="voice-gender-icon">ğŸ‘¨</div>
                <div class="voice-gender-label">ç”·æ€§éŸ³å£°</div>
                <div class="voice-gender-description">
                    ${maleVoiceText}
                </div>
                <button class="voice-test-btn" onclick="event.stopPropagation(); testDeviceVoice('male')" ${allVoices.length === 0 ? 'disabled' : ''}>
                    ğŸ”Š è©¦è´
                </button>
            </div>
            <div class="voice-choice-btn" data-voice-gender="female" onclick="selectAndTestVoice('female')" ${allVoices.length === 0 ? 'style="opacity: 0.5; pointer-events: none;"' : ''}>
                <div class="voice-gender-icon">ğŸ‘©</div>
                <div class="voice-gender-label">å¥³æ€§éŸ³å£°</div>
                <div class="voice-gender-description">
                    ${femaleVoiceText}
                </div>
                <button class="voice-test-btn" onclick="event.stopPropagation(); testDeviceVoice('female')" ${allVoices.length === 0 ? 'disabled' : ''}>
                    ğŸ”Š è©¦è´
                </button>
            </div>
        </div>
        <div class="text-center mt-2">
            <div class="text-xs text-gray-600">
                ğŸ’¡ æ¤œå‡º: ${deviceInfo.type} | éŸ³å£°: ${allVoices.length}å€‹
            </div>
            ${allVoices.length === 0 ? `
                <div class="text-xs text-orange-600 mt-1">
                    âš ï¸ éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚<br>
                    ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§éŸ³å£°æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚
                </div>
            ` : ''}
        </div>
    </div>
`;

// ç¾åœ¨é¸æŠã•ã‚Œã¦ã„ã‚‹éŸ³å£°ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
if (voiceSystem.selectedVoice) {
    const currentGender = (voiceSystem.selectedVoice === voiceSystem.currentMaleVoice) ? 'male' : 'female';
    voiceSystem.updateVoiceSelectionUI(currentGender);
}
}

    function selectAndTestVoice(gender) {
        incrementClickCount();
        soundSystem.playClick();
        
        if (voiceSystem.selectGenderVoice(gender)) {
            console.log(`âœ… ${gender}éŸ³å£°ã‚’é¸æŠã—ã¾ã—ãŸ`);
            // é¸æŠå¾Œã«è‡ªå‹•ãƒ†ã‚¹ãƒˆ
            setTimeout(() => {
                voiceSystem.testVoice(gender);
            }, 200);
        }
    }

    function testDeviceVoice(gender) {
        voiceSystem.testVoice(gender);
    }

    function closeVoiceSettings() {
        try {
            const modal = document.getElementById('voiceSettingsModal');
            if (modal) {
                modal.classList.remove('show');
            }
            
            if (currentScreen === 'voice') {
                currentScreen = 'main';
                hideAllModals();
                const mainModal = document.getElementById('mainGradeModal');
                if (mainModal) {
                    mainModal.classList.add('show');
                }
            }
            
            updateBackButton();
        } catch (e) {
            console.log('éŸ³å£°è¨­å®šç”»é¢ã®é–‰ã˜ã‚‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function toggleVoiceEnabled() {
        try {
            const checkbox = document.getElementById('voiceEnabled');
            const description = document.getElementById('voiceToggleDescription');
            
            if (checkbox && description) {
                voiceSystem.setEnabled(checkbox.checked);
                description.textContent = checkbox.checked ? 'éŸ³å£°æ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™' : 'éŸ³å£°æ©Ÿèƒ½ãŒç„¡åŠ¹ã§ã™';
            }
        } catch (e) {
            console.log('éŸ³å£°åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function addSpeakButton(text, container) {
        try {
            const englishRegex = /[a-zA-Z]/;
            if (!englishRegex.test(text)) return container;
            
            const speakBtn = document.createElement('button');
            speakBtn.className = 'speak-btn';
            speakBtn.innerHTML = 'ğŸ”Š';
            speakBtn.title = 'è‹±èªã§èª­ã¿ä¸Šã’';
            speakBtn.onclick = (e) => {
                e.stopPropagation();
                speakEnglishText(text, speakBtn);
            };
            
            const wrapper = document.createElement('span');
            wrapper.style.display = 'inline-flex';
            wrapper.style.alignItems = 'center';
            wrapper.appendChild(document.createTextNode(text));
            wrapper.appendChild(speakBtn);
            
            return wrapper;
        } catch (e) {
            console.log('ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒœã‚¿ãƒ³ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
            return container;
        }
    }

    function speakEnglishText(text, button = null) {
        try {
            if (!voiceSystem.isEnabled) {
                return;
            }
            
            if (button) {
                button.classList.add('speaking');
            }
            
            const utterance = voiceSystem.speak(text);
            
            if (utterance) {
                utterance.onend = () => {
                    if (button) {
                        button.classList.remove('speaking');
                    }
                };
            }
        } catch (e) {
            console.log('éŸ³å£°å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ');
            if (button) {
                button.classList.remove('speaking');
            }
        }
    }

    /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠæ©Ÿèƒ½ ----------------- */
    function toggleLessonSelection(grade, lessonId, lessonName) {
        try {
            const lessonBtn = document.querySelector(`#${grade}Lessons [data-lesson-id="${lessonId}"]`);
            
            if (!lessonBtn) {
                console.error('ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', lessonId);
                return;
            }

            const isSelected = lessonBtn.classList.contains('selected');
            
            if (isSelected) {
                lessonBtn.classList.remove('selected');
                selectedLessons = selectedLessons.filter(lesson => lesson.id !== lessonId);
            } else {
                lessonBtn.classList.add('selected');
                selectedLessons.push({id: lessonId, name: lessonName, grade: grade});
            }
            
            updateSelectedLessonsDisplay(grade);
            
        } catch (e) {
            console.error('ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠåˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ:', e);
        }
    }

    function updateSelectedLessonsDisplay(grade) {
        try {
            const gradeNum = grade.replace('grade', '');
            const startButton = document.getElementById(`startMultipleLessons${gradeNum}`);
            
            const gradeSelectedLessons = selectedLessons.filter(lesson => lesson.grade === grade);
            
            if (gradeSelectedLessons.length > 0) {
                startButton.style.display = 'inline-block';
                startButton.disabled = false;
            } else {
                startButton.style.display = 'none';
                startButton.disabled = true;
            }
            
        } catch (e) {
            console.log('é¸æŠãƒ¬ãƒƒã‚¹ãƒ³è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function startSelectedLessons(grade) {
        try {
            if (selectedLessons.length === 0) {
                return;
            }
            
            currentGrade = grade;
            showGrammarSelection();
            
        } catch (e) {
            console.log('ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function showGrammarSelection() {
        try {
            hideAllModals();
            
            const modal = document.getElementById('grammarModal');
            const title = document.getElementById('grammarModalTitle');
            const container = document.getElementById('grammarCategories');
            
            title.textContent = `ğŸ“š ${selectedLessons.map(l => l.name).join(', ')} - æ–‡æ³•é …ç›®é¸æŠ`;
            
            container.innerHTML = '';
            selectedGrammarItems = [];
            
            selectedLessons.forEach(lesson => {
                const lessonData = lessons[lesson.grade].find(l => l.id === lesson.id);
                if (lessonData) {
                    lessonData.grammar.forEach(grammar => {
                        const btn = document.createElement('button');
                        btn.className = 'grammar-btn';
                        btn.textContent = grammar.name;
                        btn.dataset.grammarId = `${lesson.id}_${grammar.id}`;
                        btn.dataset.lessonId = lesson.id;
                        btn.dataset.grade = lesson.grade;
                        
                        btn.addEventListener('click', () => {
                            incrementClickCount();
                            soundSystem.playClick();
                            toggleGrammarSelection(btn, grammar, lesson);
                        });
                        
                        container.appendChild(btn);
                    });
                }
            });
            
            currentScreen = 'grammar';
            updateBackButton();
            modal.classList.add('show');
            
        } catch (e) {
            console.log('æ–‡æ³•é¸æŠç”»é¢è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function toggleGrammarSelection(btn, grammar, lesson) {
        try {
            const isSelected = btn.classList.contains('selected');
            const grammarKey = `${lesson.id}_${grammar.id}`;
            
            if (isSelected) {
                btn.classList.remove('selected');
                selectedGrammarItems = selectedGrammarItems.filter(item => item.key !== grammarKey);
            } else {
                btn.classList.add('selected');
                selectedGrammarItems.push({
                    key: grammarKey,
                    lessonId: lesson.id,
                    grammarId: grammar.id,
                    name: grammar.name,
                    grade: lesson.grade
                });
            }
            
            const startButton = document.getElementById('startGrammarQuiz');
            if (selectedGrammarItems.length > 0) {
                startButton.disabled = false;
            } else {
                startButton.disabled = true;
            }
            
        } catch (e) {
            console.log('æ–‡æ³•é¸æŠåˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function startGrammarQuiz() {
        try {
            if (selectedGrammarItems.length === 0) {
                return;
            }
            
            prepareQuestions();
            showGameScreen();
            
        } catch (e) {
            console.log('æ–‡æ³•ã‚¯ã‚¤ã‚ºé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function prepareQuestions() {
        try {
            allQuestions = [];
            
            selectedGrammarItems.forEach(item => {
                const problems = sampleProblems[item.grade]?.[item.lessonId]?.[item.grammarId];
                if (problems) {
                    problems.forEach(problem => {
                        allQuestions.push({
                            ...problem,
                            grammarName: item.name,
                            lessonId: item.lessonId,
                            grade: item.grade
                        });
                    });
                }
            });
            
            // ğŸ”§ ä¸­3å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            if (allQuestions.length === 0) {
                console.log('âš ï¸ å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚‰ãªã„ãŸã‚ã€ã‚µãƒ³ãƒ—ãƒ«å•é¡Œã‚’ä½¿ç”¨ã—ã¾ã™');
                allQuestions = [
                    {
                        jp: "ç§ã¯å®¿é¡Œã‚’çµ‚ãˆã¾ã—ãŸã€‚",
                        en: "I have finished my homework.",
                        explanation: "ç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ã§ã¯ã€Œhave/has + éå»åˆ†è©ã€ã§ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’è¡¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ä¸­å­¦3å¹´ç”Ÿã§å­¦ç¿’ã™ã‚‹é‡è¦ãªæ–‡æ³•é …ç›®ã§ã™ã€‚",
                        grammarName: "ç¾åœ¨å®Œäº†å½¢ï¼ˆå®Œäº†ç”¨æ³•ï¼‰",
                        lessonId: "lesson1",
                        grade: "grade3"
                    },
                    {
                        jp: "ç§ã¯æ±äº¬ã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚",
                        en: "I have been to Tokyo.",
                        explanation: "ç¾åœ¨å®Œäº†å½¢ã®çµŒé¨“ç”¨æ³•ã§ã€Œã€œã—ãŸã“ã¨ãŒã‚ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚ã€Œhave/has been toã€ã¯ã€Œã€œã«è¡Œã£ãŸã“ã¨ãŒã‚ã‚‹ã€ã¨ã„ã†çµŒé¨“ã‚’è¡¨ã™è¡¨ç¾ã§ã™ã€‚",
                        grammarName: "ç¾åœ¨å®Œäº†å½¢ï¼ˆçµŒé¨“ç”¨æ³•ï¼‰",
                        lessonId: "lesson1",
                        grade: "grade3"
                    },
                    {
                        jp: "ç§ã¯3å¹´é–“è‹±èªã‚’å‹‰å¼·ã—ã¦ã„ã¾ã™ã€‚",
                        en: "I have studied English for three years.",
                        explanation: "ç¾åœ¨å®Œäº†å½¢ã®ç¶™ç¶šç”¨æ³•ã§ã€Œãšã£ã¨ã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚ã€Œforã€ã¯æœŸé–“ã‚’è¡¨ã—ã€ã€Œsinceã€ã¯èµ·ç‚¹ã‚’è¡¨ã—ã¾ã™ã€‚",
                        grammarName: "ç¾åœ¨å®Œäº†å½¢ï¼ˆç¶™ç¶šç”¨æ³•ï¼‰",
                        lessonId: "lesson2",
                        grade: "grade3"
                    },
                    {
                        jp: "èµ°ã£ã¦ã„ã‚‹å°‘å¹´ã¯ç§ã®å¼Ÿã§ã™ã€‚",
                        en: "The boy running is my brother.",
                        explanation: "ç¾åœ¨åˆ†è©ã«ã‚ˆã‚‹å¾Œç½®ä¿®é£¾ã§ã€Œã€œã—ã¦ã„ã‚‹ã€ã‚’è¡¨ã—ã¾ã™ã€‚åˆ†è©ãŒåè©ã‚’å¾Œã‚ã‹ã‚‰ä¿®é£¾ã™ã‚‹å½¢ã§ã™ã€‚",
                        grammarName: "å¾Œç½®ä¿®é£¾ï¼ˆç¾åœ¨åˆ†è©ï¼‰",
                        lessonId: "lesson3",
                        grade: "grade3"
                    },
                    {
                        jp: "è‹±èªã‚’æ•™ãˆã‚‹äººã¯ç§ã®å…ˆç”Ÿã§ã™ã€‚",
                        en: "The person who teaches English is my teacher.",
                        explanation: "ä¸»æ ¼ã®é–¢ä¿‚ä»£åè© who ã¯äººã‚’å…ˆè¡Œè©ã¨ã—ã¦ã€ãã®äººã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚",
                        grammarName: "é–¢ä¿‚ä»£åè©ï¼ˆä¸»æ ¼ï¼‰",
                        lessonId: "lesson4",
                        grade: "grade3"
                    }
                ];
            }
            
            usedQuestions = [];
            currentQuestionIndex = 0;
            sequentialIndex = 0;
            
            console.log(`âœ… å•é¡Œæº–å‚™å®Œäº†: ${allQuestions.length}å• (${selectedGrammarItems.map(item => item.name).join(', ')})`);
            
        } catch (e) {
            console.log('å•é¡Œæº–å‚™ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function showGameScreen() {
        try {
            hideAllModals();
            const gameScreen = document.getElementById('gameScreen');
            gameScreen.classList.remove('hidden');
            
            const categoryElement = document.getElementById('currentCategory');
            categoryElement.textContent = selectedGrammarItems.map(item => item.name).join(', ');
            
            updateClickDisplays();
            
            currentScreen = 'game';
            updateBackButton();
            
        } catch (e) {
            console.log('ã‚²ãƒ¼ãƒ ç”»é¢è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½ï¼ˆç„¡åˆ¶é™å¯¾å¿œï¼‰ ----------------- */
    function startTimer() {
        try {
            if (timerLimit === 'unlimited') {
                updateTimerDisplayUnlimited();
                return;
            }
            
            currentTimerValue = timerLimit;
            isTimerRunning = true;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                currentTimerValue--;
                updateTimerDisplay();
                
                if (currentTimerValue <= 0) {
                    clearInterval(timerInterval);
                    isTimerRunning = false;
                    handleTimerExpired();
                } else if (currentTimerValue <= 2) {
                    soundSystem.playTick();
                }
            }, 1000);
            
        } catch (e) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function updateTimerDisplay() {
        try {
            const timerValue = document.getElementById('timerValue');
            const timerDisplay = document.getElementById('timerDisplay');
            
            if (timerValue && timerDisplay) {
                timerValue.textContent = currentTimerValue;
                
                if (currentTimerValue > 3) {
                    timerDisplay.className = 'timer-display timer-normal';
                } else if (currentTimerValue > 1) {
                    timerDisplay.className = 'timer-display timer-warning';
                } else {
                    timerDisplay.className = 'timer-display timer-danger';
                }
            }
        } catch (e) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function updateTimerDisplayUnlimited() {
        try {
            const timerValue = document.getElementById('timerValue');
            const timerDisplay = document.getElementById('timerDisplay');
            
            if (timerValue && timerDisplay) {
                timerValue.textContent = 'âˆ';
                timerDisplay.className = 'timer-display timer-unlimited';
            }
        } catch (e) {
            console.log('ç„¡åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºæ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function handleTimerExpired() {
        try {
            soundSystem.playTimeUp();
            
            if (!isQuizAnswered) {
                showAnswer();
            }
            
        } catch (e) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼æœŸé™åˆ‡ã‚Œå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function stopTimer() {
        try {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            isTimerRunning = false;
        } catch (e) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼åœæ­¢ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ ----------------- */
    function startQuiz() {
        try {
            if (allQuestions.length === 0) {
                return;
            }
            
            hideAllModals();
            const gameScreenElement = document.getElementById('gameScreen');
            gameScreenElement.classList.add('hidden');
            
            const modal = document.getElementById('quizModal');
            modal.classList.add('show');
            
            currentScreen = 'quiz';
            updateBackButton();
            
            resetQuizState();
            
            showNextQuestion();
            
        } catch (e) {
            console.log('ã‚¯ã‚¤ã‚ºé–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function showNextQuestion() {
        try {
            if (usedQuestions.length >= allQuestions.length) {
                endQuiz();
                return;
            }
            
            let nextQuestion;
            
            if (questionMode === 'random') {
                const availableQuestions = allQuestions.filter((_, index) => !usedQuestions.includes(index));
                const randomIndex = Math.floor(Math.random() * availableQuestions.length);
                nextQuestion = availableQuestions[randomIndex];
                currentQuestionIndex = allQuestions.indexOf(nextQuestion);
            } else {
                if (sequentialIndex >= allQuestions.length) {
                    sequentialIndex = 0;
                }
                nextQuestion = allQuestions[sequentialIndex];
                currentQuestionIndex = sequentialIndex;
            }
            
            displayQuestion(nextQuestion);
            isQuizAnswered = false;
            
            const remainingElement = document.getElementById('remainingCount');
            if (remainingElement) {
                remainingElement.textContent = `æ®‹ã‚Š: ${allQuestions.length - usedQuestions.length}å•`;
            }
            
            startTimer();
            
        } catch (e) {
            console.log('æ¬¡ã®å•é¡Œè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function displayQuestion(question) {
        try {
            const questionElement = document.getElementById('quizQuestion');
            const answerDisplay = document.getElementById('answerDisplay');
            const answerContent = document.getElementById('answerContent');
            const showAnswerBtn = document.getElementById('showAnswerBtn');
            const nextBtn = document.getElementById('quizNext');
            
            let questionText = '';
            let currentQuestionType = '';
            
            if (questionDirection === 'jp_to_en') {
                questionText = question.jp;
                currentQuestionType = 'jp_to_en';
            } else if (questionDirection === 'en_to_jp') {
                questionText = question.en;
                currentQuestionType = 'en_to_jp';
            } else {
                const isJpToEn = Math.random() < 0.5;
                questionText = isJpToEn ? question.jp : question.en;
                currentQuestionType = isJpToEn ? 'jp_to_en' : 'en_to_jp';
            }
            
            questionElement.dataset.questionType = currentQuestionType;
            questionElement.textContent = questionText;
            
            answerDisplay.classList.remove('show');
            answerContent.innerHTML = '<div class="text-gray-500" style="text-align: center;">é ­ã§è€ƒãˆã¦ã‹ã‚‰è§£ç­”ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã­ï¼</div>';
            
            showAnswerBtn.disabled = false;
            showAnswerBtn.textContent = 'ğŸ’¡ è§£ç­”ã‚’è¦‹ã‚‹';
            nextBtn.disabled = true;
            
        } catch (e) {
            console.log('å•é¡Œè¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function showAnswer() {
        try {
            const question = allQuestions[currentQuestionIndex];
            const questionElement = document.getElementById('quizQuestion');
            const answerDisplay = document.getElementById('answerDisplay');
            const answerContent = document.getElementById('answerContent');
            const showAnswerBtn = document.getElementById('showAnswerBtn');
            const nextBtn = document.getElementById('quizNext');
            
            stopTimer();
            isQuizAnswered = true;
            
            const currentQuestionType = questionElement.dataset.questionType;
            
            let answerText = '';
            if (currentQuestionType === 'jp_to_en') {
                answerText = question.en;
            } else {
                answerText = question.jp;
            }
            
            let answerElement;
            if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                answerElement = addSpeakButton(answerText, document.createElement('div'));
            } else {
                answerElement = document.createElement('div');
                answerElement.textContent = answerText;
            }
            
            answerContent.innerHTML = '';
            
            const answerTextDiv = document.createElement('div');
            answerTextDiv.className = 'answer-text';
            answerTextDiv.appendChild(answerElement);
            
            const explanationDiv = document.createElement('div');
            explanationDiv.className = 'explanation-text';
            explanationDiv.textContent = question.explanation || 'è§£èª¬ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
            
            answerContent.appendChild(answerTextDiv);
            answerContent.appendChild(explanationDiv);
            
            answerDisplay.classList.add('show');
            
            if (currentQuestionType === 'jp_to_en' && answerText.match(/[a-zA-Z]/)) {
                setTimeout(() => {
                    speakEnglishText(answerText);
                }, 500);
            }
            
            showAnswerBtn.disabled = true;
            showAnswerBtn.textContent = 'âœ… è§£ç­”æ¸ˆã¿';
            nextBtn.disabled = false;
            
            studyCount++;
            document.getElementById('studyCount').textContent = studyCount;
            
            soundSystem.playStudyComplete();
            createParticle('â­', '#f4a261', window.innerWidth / 2, window.innerHeight / 3);

        } catch (e) {
            console.log('è§£ç­”è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function nextQuestion() {
        try {
            usedQuestions.push(currentQuestionIndex);
            
            if (questionMode === 'sequential') {
                sequentialIndex++;
            }
            
            incrementClickCount();
            soundSystem.playClick();
            showNextQuestion();
            
        } catch (e) {
            console.log('æ¬¡ã®å•é¡Œã¸ã®ç§»å‹•ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function endQuiz() {
        try {
            hideAllModals();
            
            const gameScreen = document.getElementById('gameScreen');
            gameScreen.classList.remove('hidden');
            
            currentScreen = 'game';
            updateBackButton();
            
            resetQuizState();
            
        } catch (e) {
            console.log('ã‚¯ã‚¤ã‚ºçµ‚äº†å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- è¨­å®šé–¢æ•°ï¼ˆç„¡åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼å¯¾å¿œï¼‰ ----------------- */
    function setTimerLimit(seconds) {
        try {
            timerLimit = seconds;
            
            document.querySelectorAll('.timer-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (seconds === 'unlimited') {
                document.getElementById('timerUnlimitedBtn').classList.add('active');
            } else {
                document.getElementById(`timer${seconds}Btn`).classList.add('active');
            }
            
        } catch (e) {
            console.log('ã‚¿ã‚¤ãƒãƒ¼è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function setQuestionMode(mode) {
        try {
            questionMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(`${mode}ModeBtn`).classList.add('active');
            
        } catch (e) {
            console.log('å•é¡Œãƒ¢ãƒ¼ãƒ‰è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    function setQuestionDirection(direction) {
        try {
            questionDirection = direction;
            
            document.querySelectorAll('.direction-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (direction === 'jp_to_en') {
                document.getElementById('jpToEnBtn').classList.add('active');
            } else if (direction === 'en_to_jp') {
                document.getElementById('enToJpBtn').classList.add('active');
            } else {
                document.getElementById('mixedBtn').classList.add('active');
            }
            
        } catch (e) {
            console.log('è¨€èªæ–¹å‘è¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    }

    /* ----------------- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šï¼ˆç„¡åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼å¯¾å¿œï¼‰ ----------------- */
    function initEventListeners() {
        try {
            // å­¦å¹´é¸æŠãƒœã‚¿ãƒ³
            document.querySelectorAll('[data-grade]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    incrementClickCount();
                    soundSystem.playClick();
                    const grade = e.currentTarget.dataset.grade;
                    currentGrade = grade;
                    hideAllModals();
                    
                    resetLessonSelections();
                    
                    const targetModal = document.getElementById(grade + 'Modal');
                    if (targetModal) {
                        targetModal.classList.add('show');
                    }
                    currentScreen = 'grade';
                    updateBackButton();
                });
            });

            // ãƒ¬ãƒƒã‚¹ãƒ³é–‹å§‹ãƒœã‚¿ãƒ³ï¼ˆè¤‡æ•°ï¼‰
            ['1', '2', '3'].forEach(gradeNum => {
                const startBtn = document.getElementById(`startMultipleLessons${gradeNum}`);
                if (startBtn) {
                    startBtn.addEventListener('click', () => {
                        incrementClickCount();
                        soundSystem.playClick();
                        startSelectedLessons(`grade${gradeNum}`);
                    });
                }
            });

            // æ–‡æ³•ã‚¯ã‚¤ã‚ºé–‹å§‹ãƒœã‚¿ãƒ³
            const startGrammarBtn = document.getElementById('startGrammarQuiz');
            if (startGrammarBtn) {
                startGrammarBtn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    startGrammarQuiz();
                });
            }

            // ã‚¯ã‚¤ã‚ºé–‹å§‹ãƒœã‚¿ãƒ³
            const startQuizBtn = document.getElementById('startQuizButton');
            if (startQuizBtn) {
                startQuizBtn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    startQuiz();
                });
            }

            // è§£ç­”è¡¨ç¤ºãƒœã‚¿ãƒ³
            const showAnswerBtn = document.getElementById('showAnswerBtn');
            if (showAnswerBtn) {
                showAnswerBtn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    showAnswer();
                });
            }

            // æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³
            const nextBtn = document.getElementById('quizNext');
            if (nextBtn) {
                nextBtn.addEventListener('click', () => {
                    nextQuestion();
                });
            }

            // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ—§ãƒ•ãƒƒã‚¿ãƒ¼ï¼‰
            const footerHomeBtn = document.getElementById('footerHomeBtn');
            if (footerHomeBtn) {
                footerHomeBtn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    goBackToMain();
                });
            }

            const footerBackBtn = document.getElementById('footerBackBtn');
            if (footerBackBtn) {
                footerBackBtn.addEventListener('click', () => {
                    goBack();
                });
            }

            const footerVoiceBtn = document.getElementById('footerVoiceBtn');
            if (footerVoiceBtn) {
                footerVoiceBtn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    openVoiceSettings();
                });
            }

            // çµ±è¨ˆã‚¯ãƒªãƒƒã‚¯ã§ãƒªã‚»ãƒƒãƒˆç¢ºèª
            const footerTotalStat = document.getElementById('footerTotalStat');
            if (footerTotalStat) {
                footerTotalStat.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    confirmResetTotal();
                });
            }

            const footerTodayStat = document.getElementById('footerTodayStat');
            if (footerTodayStat) {
                footerTodayStat.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    confirmResetToday();
                });
            }

            // éŸ³å£°ON/OFFåˆ‡ã‚Šæ›¿ãˆ
            const voiceEnabled = document.getElementById('voiceEnabled');
            if (voiceEnabled) {
                voiceEnabled.addEventListener('change', toggleVoiceEnabled);
            }

            // ã‚¿ã‚¤ãƒãƒ¼è¨­å®šãƒœã‚¿ãƒ³ï¼ˆç„¡åˆ¶é™å¯¾å¿œï¼‰
            document.querySelectorAll('.timer-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    const time = btn.dataset.time;
                    setTimerLimit(time === 'unlimited' ? 'unlimited' : parseInt(time));
                });
            });

            // å•é¡Œãƒ¢ãƒ¼ãƒ‰è¨­å®šãƒœã‚¿ãƒ³
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    const mode = btn.dataset.mode;
                    setQuestionMode(mode);
                });
            });

            // è¨€èªæ–¹å‘è¨­å®šãƒœã‚¿ãƒ³
            document.querySelectorAll('.direction-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    incrementClickCount();
                    soundSystem.playClick();
                    const direction = btn.dataset.direction;
                    setQuestionDirection(direction);
                });
            });

            console.log('å…¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šå®Œäº†');

        } catch (e) {
            console.error('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
        }
    }

    /* ----------------- ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–ï¼ˆãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯æ©Ÿèƒ½å¯¾å¿œï¼‰ ----------------- */
    function initLessonsAndGrammar() {
        try {
            console.log('ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–é–‹å§‹...');
            
            ['grade1', 'grade2', 'grade3'].forEach(grade => {
                const container = document.getElementById(`${grade}Lessons`);
                if (!container) {
                    console.error(`ã‚³ãƒ³ãƒ†ãƒŠãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${grade}Lessons`);
                    return;
                }
                
                console.log(`${grade}ã®ãƒ¬ãƒƒã‚¹ãƒ³æ•°: ${lessons[grade].length}`);
                
                lessons[grade].forEach(lesson => {
                    const btn = document.createElement('button');
                    btn.className = 'lesson-btn';
                    btn.innerHTML = lesson.name;
                    btn.setAttribute('data-lesson-id', lesson.id);
                    
                    btn.addEventListener('click', (e) => {
                        console.log('ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯:', lesson.id, lesson.name);
                        incrementClickCount();
                        soundSystem.playClick();
                        toggleLessonSelection(grade, lesson.id, lesson.name);
                        e.preventDefault();
                    });
                    
                    container.appendChild(btn);
                    console.log(`${grade} - ${lesson.id}ã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ `);
                });
                
                console.log(`${grade}ã®ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†`);
            });
            
            console.log('å…¨ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†');
            
        } catch (e) {
            console.error('ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', e);
        }
    }

    /* ----------------- ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–ï¼ˆå®Œå…¨ç‰ˆï¼‰ ----------------- */
    document.addEventListener('DOMContentLoaded', () => {
        console.log('=== ONE WORLD Quiz åˆæœŸåŒ–é–‹å§‹ ===');
        
        try {
            console.log('1. ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆèª­ã¿è¾¼ã¿é–‹å§‹');
            loadClickStats();
            console.log('âœ… ã‚¯ãƒªãƒƒã‚¯çµ±è¨ˆèª­ã¿è¾¼ã¿å®Œäº†');
            
            console.log('2. ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–é–‹å§‹');
            initLessonsAndGrammar();
            console.log('âœ… ãƒ¬ãƒƒã‚¹ãƒ³åˆæœŸåŒ–å®Œäº†');
            
            console.log('3. ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–é–‹å§‹');
            initEventListeners();
            console.log('âœ… ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼åˆæœŸåŒ–å®Œäº†');
            
            // éš ã—ã¦ãŠãã¹ãè¦ç´ 
            const gameScreen = document.getElementById('gameScreen');
            if (gameScreen) {
                gameScreen.classList.add('hidden');
            }
            
            // åˆæœŸç”»é¢è¨­å®š
            currentScreen = 'main';
            updateBackButton();
            
            // åˆæœŸå€¤è¨­å®šï¼ˆç„¡åˆ¶é™ã‚¿ã‚¤ãƒãƒ¼å¯¾å¿œï¼‰
            setTimerLimit(3);
            setQuestionMode('random');
            setQuestionDirection('jp_to_en');
            
            resetLessonSelections();
            
            console.log('4. åˆæœŸè¨­å®šå®Œäº†');
            
            // éŸ³å£°ã‚·ã‚¹ãƒ†ãƒ ã®è¿½åŠ åˆæœŸåŒ–ï¼ˆé…å»¶å®Ÿè¡Œï¼‰
            setTimeout(() => {
                if (voiceSystem.voices.length === 0) {
                    console.log('éŸ³å£°å†åˆæœŸåŒ–å®Ÿè¡Œ');
                    voiceSystem.loadVoices();
                }
            }, 2000);
            
            console.log('=== åˆæœŸåŒ–å®Œäº† ===');
            console.log(`å­¦å¹´åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³æ•°: 1å¹´ç”Ÿ=${lessons.grade1.length}, 2å¹´ç”Ÿ=${lessons.grade2.length}, 3å¹´ç”Ÿ=${lessons.grade3.length}`);
            console.log('ãƒ‡ãƒã‚¤ã‚¹æƒ…å ±:', voiceSystem.getDeviceInfo());
            console.log(`ä¸­3å•é¡Œãƒ‡ãƒ¼ã‚¿: ${Object.keys(sampleProblems.grade3).length}ãƒ¬ãƒƒã‚¹ãƒ³åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª`);
            
        } catch (error) {
            console.error('=== åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ ===', error);
            alert('åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
        }
    });

    /* ----------------- ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«æƒ…å ±ï¼ˆæ‹¡å……ç‰ˆï¼‰ ----------------- */
    console.log('ONE WORLD Quiz ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿å®Œäº†');
    console.log('åˆ©ç”¨å¯èƒ½ãªå­¦å¹´:', Object.keys(lessons));
    console.log('å„å­¦å¹´ã®ãƒ¬ãƒƒã‚¹ãƒ³æ•°:', {
        grade1: lessons.grade1.length,
        grade2: lessons.grade2.length,
        grade3: lessons.grade3.length
    });
    console.log('ä¸­3å•é¡Œãƒ‡ãƒ¼ã‚¿ç¢ºèª:', {
        review_lesson: Object.keys(sampleProblems.grade3.review_lesson || {}).length + 'é …ç›®',
        lesson1: Object.keys(sampleProblems.grade3.lesson1 || {}).length + 'é …ç›®',
        lesson2: Object.keys(sampleProblems.grade3.lesson2 || {}).length + 'é …ç›®',
        lesson3: Object.keys(sampleProblems.grade3.lesson3 || {}).length + 'é …ç›®',
        lesson4: Object.keys(sampleProblems.grade3.lesson4 || {}).length + 'é …ç›®',
        lesson5: Object.keys(sampleProblems.grade3.lesson5 || {}).length + 'é …ç›®',
        lesson6: Object.keys(sampleProblems.grade3.lesson6 || {}).length + 'é …ç›®'
    });

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ãƒ»æ‹¡å……ç‰ˆï¼‰
    window.oneWorldQuizDebug = {
        lessons,
        sampleProblems,
        clickStats,
        selectedLessons,
        selectedGrammarItems,
        allQuestions,
        incrementClickCount,
        currentScreen,
        voiceSystem,
        soundSystem,
        resetLessonSelections,
        resetQuizState,
        // ãƒ‡ãƒãƒƒã‚°ç”¨é–¢æ•°
        testVoice: () => {
            console.log('éŸ³å£°ãƒ†ã‚¹ãƒˆé–‹å§‹');
            voiceSystem.speak("This is a voice test. Hello World!");
        },
        getDeviceInfo: () => voiceSystem.getDeviceInfo(),
        resetClickStats: () => {
            clickStats = { total: 0, daily: {} };
            saveClickStats();
            updateClickDisplays();
        },
        checkLessonButtons: () => {
            console.log('=== ãƒ¬ãƒƒã‚¹ãƒ³ãƒœã‚¿ãƒ³ãƒã‚§ãƒƒã‚¯ ===');
            ['grade1', 'grade2', 'grade3'].forEach(grade => {
                const container = document.getElementById(`${grade}Lessons`);
                const buttons = container ? container.querySelectorAll('.lesson-btn') : [];
                console.log(`${grade}: ${buttons.length}å€‹ã®ãƒœã‚¿ãƒ³`);
                buttons.forEach((btn, index) => {
                    console.log(`  ${index + 1}. ID: ${btn.dataset.lessonId}, ãƒ†ã‚­ã‚¹ãƒˆ: ${btn.textContent.substring(0, 30)}...`);
                });
            });
        },
        testLessonSelection: (grade, lessonId) => {
            console.log('ãƒ¬ãƒƒã‚¹ãƒ³é¸æŠãƒ†ã‚¹ãƒˆ:', grade, lessonId);
            const lesson = lessons[grade].find(l => l.id === lessonId);
            if (lesson) {
                toggleLessonSelection(grade, lessonId, lesson.name);
            } else {
                console.error('ãƒ¬ãƒƒã‚¹ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            }
        },
        testSpecificVoice: (gender) => {
            console.log(`${gender}éŸ³å£°ãƒ†ã‚¹ãƒˆé–‹å§‹`);
            voiceSystem.testVoice(gender);
        },
        checkGrade3Problems: () => {
            console.log('=== ä¸­3å•é¡Œãƒ‡ãƒ¼ã‚¿è©³ç´°ãƒã‚§ãƒƒã‚¯ ===');
            const grade3Data = sampleProblems.grade3;
            Object.keys(grade3Data).forEach(lessonId => {
                console.log(`${lessonId}:`);
                Object.keys(grade3Data[lessonId]).forEach(grammarId => {
                    const problems = grade3Data[lessonId][grammarId];
                    console.log(`  ${grammarId}: ${problems.length}å•`);
                    problems.forEach((problem, index) => {
                        console.log(`    ${index + 1}. ${problem.jp} â†’ ${problem.en}`);
                    });
                });
            });
        },
        testGrade3Selection: () => {
            console.log('ä¸­3é¸æŠãƒ†ã‚¹ãƒˆå®Ÿè¡Œ');
            currentGrade = 'grade3';
            selectedLessons = [{id: 'lesson1', name: 'Lesson1 - ç¾åœ¨å®Œäº†å½¢(1)', grade: 'grade3'}];
            selectedGrammarItems = [{
                key: 'lesson1_present_perfect_completion',
                lessonId: 'lesson1',
                grammarId: 'present_perfect_completion',
                name: '1. ã€Œã€œã—çµ‚ãˆãŸã€ã“ã¨ã‚’ä¼ãˆã‚‹ã¨ãï¼ˆç¾åœ¨å®Œäº†å½¢ã®å®Œäº†ç”¨æ³•ï¼‰',
                grade: 'grade3'
            }];
            prepareQuestions();
            console.log('æº–å‚™ã•ã‚ŒãŸå•é¡Œ:', allQuestions);
        }
    };

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¨ã—ã¦å…¬é–‹ï¼ˆãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã€éŸ³å£°æ©Ÿèƒ½ï¼‰
    window.confirmResetTotal = confirmResetTotal;
    window.confirmResetToday = confirmResetToday;
    window.selectAndTestVoice = selectAndTestVoice;
    window.testDeviceVoice = testDeviceVoice;
    window.closeVoiceSettings = closeVoiceSettings;

</script>
</body>
</html>